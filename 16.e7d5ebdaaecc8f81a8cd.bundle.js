(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1058:function(e,t,a){"use strict";var n=a(1),r=a.n(n),o=a(0),i=a.n(o),s=a(321),l=a(1057),u=a(157),c=a(1063),g=a(1059),h=a(1051),p=a(1062),d=a(1041),f=a(1054);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const{getScale:y}=u.CategoricalColorNamespace;const b={formData:i.a.object.isRequired,mapboxApiKey:i.a.string.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,getLayer:i.a.func.isRequired,getPoints:i.a.func.isRequired,payload:i.a.object.isRequired,onAddFilter:i.a.func,width:i.a.number.isRequired,height:i.a.number.isRequired};class C extends r.a.PureComponent{constructor(e){super(e),m(this,"containerRef",r.a.createRef()),m(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const a=e.payload.data.features||[],n=a.map(e=>e.__timestamp),r=function(e,t){const a=e.color_picker||{r:0,g:0,b:0,a:1},n=[a.r,a.g,a.b,255*a.a],r=y(e.color_scheme),o={};return t.forEach(t=>{if(null!=t.cat_color&&!o.hasOwnProperty(t.cat_color)){let i;i=e.dimension?Object(h.hexToRGB)(r(t.cat_color),255*a.a):n,o[t.cat_color]={color:i,enabled:!0}}}),o}(e.formData,a);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:r});const o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:i,end:s,getStep:l,values:u,disabled:c}=Object(p.a)(n,o),{width:g,height:d,formData:m}=e;let{viewport:b}=e;return m.autozoom&&(b=Object(f.a)(b,{width:g,height:d,points:e.getPoints(a)})),{start:i,end:s,getStep:l,values:u,disabled:c,viewport:b,selected:[],lastClick:0,formData:e.payload.form_data,categories:r}}getLayers(e){const{getLayer:t,payload:a,formData:n,onAddFilter:r}=this.props;let o=a.data.features?[...a.data.features]:[];if(o=this.addColor(o,n),n.js_data_mutator){o=Object(d.a)(n.js_data_mutator)(o)}o=e[0]===e[1]||e[1]===this.end?o.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):o.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const i=this.state.categories;return n.dimension&&(o=o.filter(e=>i[e.cat_color]&&i[e.cat_color].enabled)),[t(n,v({},a,{data:v({},a.data,{features:o})}),r,this.setTooltip)]}addColor(e,t){const a=t.color_picker||{r:0,g:0,b:0,a:1},n=y(t.color_scheme);return e.map(e=>{let r;return t.dimension?(r=Object(h.hexToRGB)(n(e.cat_color),255*a.a),v({},e,{color:r})):e})}toggleCategory(e){const t=this.state.categories[e],a=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(a).every(e=>!e.enabled)&&Object.values(a).forEach(e=>{e.enabled=!0}),this.setState({categories:a})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(c.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},r.a.createElement(g.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}C.propTypes=b,a.d(t,"b",(function(){return O})),a.d(t,"a",(function(){return E}));const w={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,width:i.a.number.isRequired,height:i.a.number.isRequired},j={onAddFilter(){}};function O(e,t){class a extends r.a.PureComponent{constructor(e){super(e),x(this,"containerRef",r.a.createRef()),x(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:a,height:n,formData:o}=e;let{viewport:i}=e;o.autozoom&&(i=Object(f.a)(i,{width:a,height:n,points:t(e.payload.data.features)})),this.state={viewport:i,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=S({},e.formData,{viewport:null}),a=S({},this.props.formData,{viewport:null});Object(s.isEqual)(t,a)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:a,payload:n,onAddFilter:r}=t;return e(a,n,r,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:a,height:n,width:o}=this.props,{layer:i,viewport:s}=this.state;return r.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[i],mapStyle:e.mapbox_style,setControlValue:a,width:o,height:n,onViewportChange:this.onViewportChange})}}return a.propTypes=w,a.defaultProps=j,a}function E(e,t){function a(a){const{formData:n,payload:o,setControlValue:i,viewport:s,width:l,height:u}=a;return r.a.createElement(C,{formData:n,mapboxApiKey:o.data.mapboxApiKey,setControlValue:i,viewport:s,getLayer:e,payload:o,getPoints:t,width:l,height:u})}return a.propTypes=w,a.defaultProps=j,a}},1059:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(1),r=a.n(n),o=a(0),i=a.n(o),s=a(1065);a(1060);const l={categories:i.a.object,toggleCategory:i.a.func,showSingleCategory:i.a.func,format:i.a.string,position:i.a.oneOf([null,"tl","tr","bl","br"])};class u extends r.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.formatNumber)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,a]=e;const n={color:"rgba("+a.color.join(", ")+")"},o=a.enabled?"◼":"◻";return r.a.createElement("li",{key:t},r.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},r.a.createElement("span",{style:n},o)," ",this.formatCategoryLabel(t)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return r.a.createElement("div",{className:"legend",style:t},r.a.createElement("ul",{className:"categories"},e))}}u.propTypes=l,u.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},1060:function(e,t,a){var n=a(501),r=a(1061);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1},i=(n(r,o),r.locals?r.locals:{});e.exports=i},1061:function(e,t,a){(t=a(502)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n  font-size: 90%;\n  position: absolute;\n  background: #fff;\n  box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n  margin: 24px;\n  padding: 12px 20px;\n  outline: none;\n  overflow-y: scroll;\n  max-height: 200px;\n}\n\nul.categories {\n  list-style: none;\n  padding-left: 0;\n  margin: 0;\n}\n\nul.categories li a {\n  color: rgb(51, 51, 51);\n  text-decoration: none;\n}\n\nul.categories li a span {\n  margin-right: 10px;\n}\n',""]),e.exports=t},1074:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}));var n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function r(e,t,a){var n=new t(4*e.length);return e.forEach((function(e,t){var r=4*t;n[r]=e[0],n[r+1]=e[1],n[r+2]=e[2],n[r+3]=Number.isFinite(e[3])?e[3]:a})),n}},1075:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s}));var n={SUM:1,MEAN:2,MIN:3,MAX:4};function r(e,t){return e+t}function o(e,t){return t>e?t:e}function i(e,t){return t<e?t:e}function s(e,t){switch(n[e.toUpperCase()]||n.SUM){case n.MIN:return function(e){return function(e,t){var a=e.map(t).filter(Number.isFinite);return a.length?a.reduce(i,1/0):null}(e,t)};case n.SUM:return function(e){return function(e,t){var a=e.map(t).filter(Number.isFinite);return a.length?a.reduce(r,0):null}(e,t)};case n.MEAN:return function(e){return function(e,t){var a=e.map(t).filter(Number.isFinite);return a.length?a.reduce(r,0)/a.length:null}(e,t)};case n.MAX:return function(e){return function(e,t){var a=e.map(t).filter(Number.isFinite);return a.length?a.reduce(o,-1/0):null}(e,t)};default:return null}}},1134:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(1029),r=a(1030),o=a(1032),i=a(1031),s=a(1043),l=a(1033),u=a(1099),c=a(1052),g=a(1086),h=function(e){function t(){return Object(n.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(r.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(i.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var a=this.props._subLayerProps;return t&&t.length||a&&a[e]}},{key:"getSubLayerClass",value:function(e,t){var a=this.props._subLayerProps;return a&&a[e]&&a[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,a=t.opacity,n=t.pickable,r=t.visible,o=t.parameters,i=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,u=t.highlightColor,c=t.coordinateSystem,g=t.coordinateOrigin,h=t.wrapLongitude,p=t.positionFormat,d=t.modelMatrix,f=t._subLayerProps,v={opacity:a,pickable:n,visible:r,parameters:o,getPolygonOffset:i,highlightedObjectIndex:s,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:g,wrapLongitude:h,positionFormat:p,modelMatrix:d};if(e){var m=f&&f[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?c.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(g.b)(e,{filter:Boolean}),this.internalState.subLayers=e,c.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,a=!1,n=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value.parent=this}}catch(e){a=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(a)throw n}}}},{key:"isComposite",get:function(){return!0}}]),t}(u.a);h.layerName="CompositeLayer"},1221:function(e,t,a){"use strict";a.r(t);var n=a(1029),r=a(1030),o=a(1032),i=a(1031),s=a(1033),l=a(1225),u=a(1052),c=a(1134),g=a(1167),h=a(1111),p=a(1074),d=a(1112),f=a(1075),v=Math.PI/3,m=[0,v,2*v,3*v,4*v,5*v];function y(e){return e[0]}function b(e){return e[1]}var C=a(1122);function S(){}var x=new l.a,w={colorDomain:null,colorRange:p.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:S,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:S,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var a=e.data,n=e.radius,r=e.getPosition,o=function(e,t){var a=t.getDistanceScales().pixelsPerMeter;return e*a[0]}(n,t),i=[],s=Object(C.a)(a),l=s.iterable,u=s.objectInfo,c=!0,g=!1,h=void 0;try{for(var p,d=l[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var f=p.value;u.index++,i.push(Object.assign({screenCoord:t.projectFlat(r(f,u))},f))}}catch(e){g=!0,h=e}finally{try{c||null==d.return||d.return()}finally{if(g)throw h}}return{hexagons:function(){var e,t,a,n=0,r=0,o=1,i=1,s=y,l=b;function u(e){var n,r={},o=[],i=e.length;for(n=0;n<i;++n)if(!isNaN(c=+s.call(null,u=e[n],n,e))&&!isNaN(g=+l.call(null,u,n,e))){var u,c,g,h=Math.round(g/=a),p=Math.round(c=c/t-(1&h)/2),d=g-h;if(3*Math.abs(d)>1){var f=c-p,v=p+(c<p?-1:1)/2,m=h+(g<h?-1:1),y=c-v,b=g-m;f*f+d*d>y*y+b*b&&(p=v+(1&h?1:-1)/2,h=m)}var C=p+"-"+h,S=r[C];S?S.push(u):(o.push(S=r[C]=[u]),S.x=(p+(1&h)/2)*t,S.y=h*a)}return o}function c(e){var t=0,a=0;return m.map((function(n){var r=Math.sin(n)*e,o=-Math.cos(n)*e,i=r-t,s=o-a;return t=r,a=o,[i,s]}))}return u.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},u.centers=function(){for(var s=[],l=Math.round(r/a),u=Math.round(n/t),c=l*a;c<i+e;c+=a,++l)for(var g=u*t+(1&l)*t/2;g<o+t/2;g+=t)s.push([g,c]);return s},u.mesh=function(){var t=c(e).slice(0,4).join("l");return u.centers().map((function(e){return"M"+e+"m"+t})).join("")},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(l=e,u):l},u.radius=function(n){return arguments.length?(t=2*(e=+n)*Math.sin(v),a=1.5*e,u):e},u.size=function(e){return arguments.length?(n=r=0,o=+e[0],i=+e[1],u):[o-n,i-r]},u.extent=function(e){return arguments.length?(n=+e[0][0],r=+e[0][1],o=+e[1][0],i=+e[1][1],u):[[n,r],[o,i]]},u.radius(1)}().radius(o).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(i).map((function(e,a){return{position:t.unprojectFlat([e.x,e.y]),points:e,index:a}}))}},getPosition:{type:"accessor",value:function(e){return e.position}},fp64:!1,material:x},j=["getColorValue","colorAggregation","getColorWeight"],O=["getElevationValue","elevationAggregation","getElevationWeight"],E=function(e){function t(){return Object(n.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(r.a)(t,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:S,elevationScaleFunc:S,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,a=e.oldProps,n=e.props,r=e.changeFlags;this.updateGetValueFuncs(a,n);var o=this.getDimensionChanges(a,n);r.dataChanged||this.needsReProjectPoints(a,n)?this.getHexagons():o&&o.forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var a=!1,n=!1,r=0;r<j.length;r++){var o=j[r];e[o]!==t[o]&&(a=!0)}for(var i=0;i<O.length;i++){var s=O[i];e[s]!==t[s]&&(n=!0)}return{colorChanged:a,elevationChanged:n}}},{key:"updateGetValueFuncs",value:function(e,t){var a=t.getColorValue,n=t.getElevationValue,r=this.props,o=r.colorAggregation,i=r.getColorWeight,s=r.elevationAggregation,l=r.getElevationWeight,u=this.colorElevationPropsChanged(e,t),c=u.colorChanged,g=u.elevationChanged;c&&null===a&&(a=Object(f.b)(o,i)),g&&null===n&&(n=Object(f.b)(s,l)),a&&this.setState({getColorValue:a}),n&&this.setState({getElevationValue:n})}},{key:"needsReProjectPoints",value:function(e,t){return e.radius!==t.radius||e.hexagonAggregator!==t.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var a=this.state.dimensionUpdaters,n=[];for(var r in a){var o=a[r].find((function(a){return a.triggers.some((function(a){return e[a]!==t[a]}))}));o&&n.push(o.updater)}return n.length?n:null}},{key:"getHexagons",value:function(){var e=this.props.hexagonAggregator,t=this.context.viewport,a=e(this.props,t),n=a.hexagons,r=a.hexagonVertices;this.updateRadiusAngle(r),this.setState({hexagons:n}),this.getSortedBins()}},{key:"getPickingInfo",value:function(e){var t=e.info,a=this.state,n=a.sortedColorBins,r=a.sortedElevationBins,o=null;if(t.picked&&t.index>-1){var i=this.state.hexagons[t.index],s=n.binMap[i.index]&&n.binMap[i.index].value,l=r.binMap[i.index]&&r.binMap[i.index].value;o=Object.assign({colorValue:s,elevationValue:l},i)}return Object.assign(t,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,a={},n=function(n){a[n]={};var r=!0,o=!1,i=void 0;try{for(var s,l=t[n][Symbol.iterator]();!(r=(s=l.next()).done);r=!0){s.value.triggers.forEach((function(t){a[n][t]=e.props[t]}))}}catch(e){o=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}};for(var r in t)n(r);return a}},{key:"updateRadiusAngle",value:function(e){var t=this.props.radius,a=90;if(Array.isArray(e)){e.length<6&&u.a.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var n=e[0],r=e[3],o=this.context.viewport.getDistanceScales().pixelsPerMeter,i=this.projectFlat(n),s=this.projectFlat(r),l=i[0]-s[0],c=i[1]-s[1],g=Math.sqrt(l*l+c*c);a=Math.acos(l/g)*-Math.sign(c)/Math.PI*180+90,t=g/2/o[0]}this.setState({angle:a,radius:t})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new h.a(this.state.hexagons||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new h.a(this.state.hexagons||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,a=e.upperPercentile,n=e.onSetColorDomain;t>a&&u.a.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,a]),"function"==typeof n&&n(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,a=e.elevationUpperPercentile,n=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,a]),"function"==typeof n&&n(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(d.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(d.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,a=t.sortedColorBins,n=t.colorScaleFunc,r=t.colorValueDomain,o=a.binMap[e.index]&&a.binMap[e.index].value,i=this.props.colorDomain||r,s=o>=i[0]&&o<=i[i.length-1]?n(o):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,a=t.sortedElevationBins,n=t.elevationScaleFunc,r=t.elevationValueDomain,o=a.binMap[e.index]&&a.binMap[e.index].value,i=this.props.elevationDomain||r;return o>=i[0]&&o<=i[i.length-1]?n(o):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,a=e.extruded,n=e.coverage,r=e.material,o=e.fp64,i=e.transitions,s=this.state,l=s.angle,u=s.radius;return new(this.getSubLayerClass("hexagon-cell",g.a))({fp64:o,radius:u,diskResolution:6,elevationScale:t,angle:l,extruded:a,coverage:n,material:r,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:i&&{getFillColor:i.getColorValue||i.getColorWeight,getElevation:i.getElevationValue||i.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),t}(c.a);E.layerName="HexagonLayer",E.defaultProps=w;var V=a(1),D=a.n(V),P=a(3),_=a(1048),k=a(1041),L=a(1058),A=a(1050);function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function F(e){return D.a.createElement("div",{className:"deckgl-tooltip"},D.a.createElement(A.a,{label:Object(P.t)("Centroid (Longitude and Latitude)")+": ",value:"("+e.coordinate[0]+", "+e.coordinate[1]+")"}),D.a.createElement(A.a,{label:Object(P.t)("Height")+": ",value:""+e.object.elevationValue}))}function M(e,t,a,n){const r=e,o=r.color_picker;let i=t.data.features.map(e=>R({},e,{color:[o.r,o.g,o.b,255*o.a]}));if(r.js_data_mutator){i=Object(k.a)(r.js_data_mutator)(i)}const s=Object(_.b)(r.js_agg_function,e=>e.weight);return new E(R({id:"hex-layer-"+r.slice_id,data:i,pickable:!0,radius:r.grid_size,minColor:[0,0,0,0],extruded:r.extruded,maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getElevationValue:s,getColorValue:s},Object(_.a)(r,n,F)))}a.d(t,"getLayer",(function(){return M}));t.default=Object(L.b)(M,(function(e){return e.map(e=>e.position)}))},1225:function(e,t,a){"use strict";var n=a(1029),r=a(1032),o=a(1031),i=a(1040),s=a(1033);a.d(t,"a",(function(){return u}));var l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},u=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(r.a)(this,Object(o.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(i.a)(a),e),a}return Object(s.a)(t,e),t}((function e(){Object(n.a)(this,e)}))}}]);