/*! For license information please see 0.9661511a8b38d2d1dee0.bundle.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{685:function(t,e,n){"use strict";n.r(e);var r=n(851),i=n(694);if(r.global.deck&&"5.3.5"!==r.global.deck.VERSION)throw new Error("deck.gl - multiple versions detected: ".concat(r.global.deck.VERSION," vs ").concat("5.3.5"));r.global.deck||(i.a.log(0,"deck.gl ".concat("5.3.5"," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),r.global.deck=r.global.deck||{VERSION:"5.3.5",version:"5.3.5",log:i.a}),console.table||(console.table=function(){}),n(848);n(848);var o=n(732),a=n(692),s=n(689),u=n(766),l=n.n(u);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var v=s.m.Attribute,g={isExternalBuffer:!1,needsAlloc:!1,needsUpdate:!1,needsRedraw:!1,allocedInstances:-1},y=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!h(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),n=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));var i=r.transition,o=void 0!==i&&i,a=r.noAlloc,s=void 0!==a&&a,u=r.update,l=void 0===u?null:u,c=r.accessor,p=void 0===c?null:c,d=r.defaultValue,v=void 0===d?[0,0,0,0]:d;return v=Array.isArray(v)?v:[v],Object.assign(n.userData,g,r,{transition:o,noAlloc:s,update:l,accessor:p,defaultValue:v}),Object.seal(n.userData),n._validateAttributeUpdaters(),n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");d(t.prototype,e&&e.prototype),e&&d(t,e)}(e,t),n=e,(r=[{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearChangedFlags,n=void 0!==e&&e,r=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!n,r}},{key:"getInstanceCount",value:function(){return null!==this.value?this.value.length/this.size:0}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat(t||[])}},{key:"supportsTransition",value:function(){return this.userData.transition}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsUpdate=this.userData.needsUpdate||t}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"setNumInstances",value:function(t){var e=this.userData;if(!e.isExternalBuffer&&!e.noAlloc){var n=this.getInstanceCount();(0===n||n<t)&&(e.update||e.accessor)&&(e.needsAlloc=!0,this.setNeedsUpdate(this.id))}}},{key:"allocate",value:function(t){this.setNumInstances(t);var e=this.userData;if(e.needsAlloc){var n=Math.max(t,1),r=m(this.type||s.g.FLOAT);return this.isGeneric=!1,this.value=new r(this.size*n),e.needsAlloc=!1,e.needsUpdate=!0,e.allocedInstances=n,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,n=t.data,r=t.props,i=t.context;if(!this.needsUpdate())return!1;var o=this.userData,a=o.update,s=o.accessor,u=!0;return a?(a.call(i,this,{data:n,props:r,numInstances:e}),this.update({value:this.value,isGeneric:this.isGeneric}),this._checkAttributeArray()):s?(this._updateBufferViaStandardAccessor(n,r),this._checkAttributeArray()):u=!1,o.needsUpdate=!1,o.needsRedraw=!0,u}},{key:"setGenericValue",value:function(t){var e=t.props,n=this.userData,r=e[n.accessor];if(void 0!==r&&"function"!=typeof r){r=this._normalizeValue(r);var i=!this.isGeneric||!this._areValuesEqual(r,this.value);i&&this.update({isGeneric:!0,value:r}),n.needsRedraw=n.needsUpdate||i,n.needsUpdate=!1,n.isExternalBuffer=!0}}},{key:"setExternalBuffer",value:function(t,e){var n=this.userData;if(t)if(n.isExternalBuffer=!0,n.needsUpdate=!1,h(t,s.b))this.externalBuffer!==t&&(this.update({isGeneric:!1,buffer:t}),n.needsRedraw=!0);else{var r=m(this.type||s.g.FLOAT);if(!h(t,r))throw new Error("Attribute ".concat(this.id," must be of type ").concat(r.name));if(n.auto&&t.length<=e*this.size)throw new Error("Attribute prop array must match length and size");this.value!==t&&(this.update({value:t}),n.needsRedraw=!0)}else n.isExternalBuffer=!1}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.size,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.userData.defaultValue;switch(Array.isArray(t)||ArrayBuffer.isView(t)||(t=[t]),e){case 4:t[3]=Number.isFinite(t[3])?t[3]:n[3];case 3:t[2]=Number.isFinite(t[2])?t[2]:n[2];case 2:t[1]=Number.isFinite(t[1])?t[1]:n[1];case 1:t[0]=Number.isFinite(t[0])?t[0]:n[0]}return t}},{key:"_areValuesEqual",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}},{key:"_updateBufferViaStandardAccessor",value:function(t,e){var n=this.userData,r=n.accessor,i=n.defaultValue,o=this.value,s=this.size,u=e[r];Object(a.a)("function"==typeof u,'accessor "'.concat(r,'" is not a function'));var l=0,c=!0,h=!1,p=void 0;try{for(var f,d=t[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=u(f.value);v=this._normalizeValue(v,s,i);for(var g=0;g<s;g++)o[l++]=v[g]}}catch(t){h=!0,p=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw p}}this.update({value:o})}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!t.noAlloc&&"function"!=typeof t.update&&"string"!=typeof t.accessor)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}}])&&p(n.prototype,r),i&&p(n,i),e}(v);function m(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===e||e;switch(t){case s.g.FLOAT:return Float32Array;case s.g.UNSIGNED_SHORT:case s.g.UNSIGNED_SHORT_5_6_5:case s.g.UNSIGNED_SHORT_4_4_4_4:case s.g.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case s.g.UNSIGNED_INT:return Uint32Array;case s.g.UNSIGNED_BYTE:return n?Uint8ClampedArray:Uint8Array;case s.g.BYTE:return Int8Array;case s.g.SHORT:return Int16Array;case s.g.INT:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.filter,r=void 0===n?function(){return!0}:n,i=e.map,o=void 0===i?function(t){return t}:i,a=e.result,s=void 0===a?[]:a;return Array.isArray(t)?function t(e,n,r,i){var o=-1;for(;++o<e.length;){var a=e[o];Array.isArray(a)?t(a,n,r,i):n(a)&&i.push(r(a))}return i}(t,r,o,s):r(t)?[o(t)]:[]}function b(t){for(var e=t.target,n=t.source,r=t.start,i=void 0===r?0:r,o=t.count,a=void 0===o?1:o,s=n.length,u=a*s,l=0,c=i;l<s;l++)e[c++]=n[l];for(;l<u;)l<u-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+u-l),l=u);return e}var x={1:"float",2:"vec2",3:"vec3",4:"vec4"};function w(t){var e={},n={};for(var r in t){var i=t[r],o=i.fromState,a=i.toState,s=i.buffer;e["".concat(r,"From")]=o,e["".concat(r,"To")]=a,n["".concat(r)]=s}return{sourceBuffers:e,destinationBuffers:n}}function E(t){var e=t.fromState,n=t.toState,r=t.fromLength,i=t.toLength;if(!(r>=i)&&(o=e,null!=(a=s.b)&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?a[Symbol.hasInstance](o):o instanceof a)){var o,a,u=new Float32Array(i);u.set(e.getData({})),n.isGeneric?b({target:u,source:n.value,start:r,count:(i-r)/n.size}):u.set(n.buffer.data.subarray(r),r),e.setData({data:u})}}function S(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var T={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function P(){}var k=function(){function t(e){S(this,t),this._startTime=null,this._state=T.NONE,this.duration=1,this.easing=function(t){return t},this.onStart=P,this.onUpdate=P,this.onInterrupt=P,this.onEnd=P,Object.assign(this,e)}var e,n,r;return e=t,(n=[{key:"start",value:function(t){this.inProgress&&this.onInterrupt(this),Object.assign(this,t),this._setState(T.PENDING)}},{key:"cancel",value:function(){this.inProgress&&(this.onInterrupt(this),this._setState(T.NONE))}},{key:"update",value:function(t){if(this.state===T.PENDING&&(this._startTime=t,this._setState(T.IN_PROGRESS)),this.state===T.IN_PROGRESS){var e=!1,n=(t-this._startTime)/this.duration;return n>=1&&(n=1,e=!0),this.time=this.easing(n),this.onUpdate(this),e&&this._setState(T.ENDED),!0}return!1}},{key:"_setState",value:function(t){if(this._state!==t)switch(this._state=t,t){case T.PENDING:this.onStart(this);break;case T.ENDED:this.onEnd(this)}}},{key:"state",get:function(){return this._state}},{key:"inProgress",get:function(){return this._state===T.PENDING||this._state===T.IN_PROGRESS}}])&&A(e.prototype,n),r&&A(e,r),t}();function C(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var I=s.m.Transform,M=function(){},R=function(){function t(e,n){var r=n.id;C(this,t),this.id=r,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,I.isSupported(e)?this.isSupported=!0:i.a.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}var e,n,r;return e=t,(n=[{key:"finalize",value:function(){for(var t in this.transform&&this.transform.delete(),this.attributeTransitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,n=t.transitions,r=void 0===n?{}:n,i=t.numInstances;if(this.opts=r,this.numInstances=i,this.isSupported){var o=this.attributeTransitions,a={};for(var s in e)this._updateAttribute(s,e[s])&&(a[s]=o[s]);for(var u in o){var l=e[u];l&&l.supportsTransition()||this._removeTransition(u)}if(this.transform){if(this.transform){var c=w(a),h=c.sourceBuffers,p=c.destinationBuffers;this.transform.update({elementCount:this.numInstances,sourceBuffers:h,destinationBuffers:p})}}else this._createModel()}}},{key:"hasAttribute",value:function(t){return t in this.attributeTransitions}},{key:"getAttributes",value:function(){var t={};for(var e in this.attributeTransitions){var n=this.attributeTransitions[e];n.buffer&&(t[e]=n.buffer)}return t}},{key:"setCurrentTime",value:function(t){if(!this.transform)return!1;var e={},n=this.needsRedraw;for(var r in this.needsRedraw=!1,this.attributeTransitions){var i=this.attributeTransitions[r];i.update(t)&&(e["".concat(r,"Time")]=i.time,n=!0)}return n&&this.transform.run({uniforms:e}),n}},{key:"_createTransition",value:function(t,e){var n=this.attributeTransitions[t];return n?null:(n=new k({name:t,attribute:e}),this.attributeTransitions[t]=n,this._invalidateModel(),n)}},{key:"_removeTransition",value:function(t){var e=this.attributeTransitions[t];e&&(e.buffer&&e.buffer.delete(),e._swapBuffer&&e._swapBuffer.delete(),delete this.attributeTransitions[t],this._invalidateModel())}},{key:"_updateAttribute",value:function(t,e){var n=this._getTransitionSettings(e);if(n){var r,i=this.attributeTransitions[t];if(i?r=e.needsRedraw():(i=this._createTransition(t,e),r=!0),r)return this._triggerTransition(i,n),!0}return!1}},{key:"_invalidateModel",value:function(){this.transform&&(this.transform.delete(),this.transform=null)}},{key:"_createModel",value:function(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new I(this.gl,Object.assign({elementCount:this.numInstances},w(this.attributeTransitions),function(t){var e=[],n=[],r=[],i=[],o=[];for(var a in t){var s=t[a],u=x[s.attribute.size];u&&(s.bufferIndex=e.length,e.push(a),n.push("attribute ".concat(u," ").concat(a,"From;")),n.push("attribute ".concat(u," ").concat(a,"To;")),r.push("uniform float ".concat(a,"Time;")),i.push("varying ".concat(u," ").concat(a,";")),o.push("".concat(a," = mix(").concat(a,"From, ").concat(a,"To,\n        ").concat(a,"Time);")))}return{vs:"\n#define SHADER_NAME feedback-vertex-shader\n".concat(n.join("\n"),"\n").concat(r.join("\n"),"\n").concat(i.join("\n"),"\n\nvoid main(void) {\n  ").concat(o.join("\n"),"\n  gl_Position = vec4(0.0);\n}\n"),fs:"#define SHADER_NAME feedback-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n".concat(i.join("\n"),"\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n"),varyings:e}}(this.attributeTransitions))))}},{key:"_getNextTransitionStates",value:function(t){var e,n=t.attribute,r=n.size;e=n.isGeneric?{isGeneric:!0,value:n.value,size:r}:{isGeneric:!1,buffer:n.getBuffer(),size:r};var i=t.buffer||e,o=this.numInstances*r,a=i.data&&i.data.length||o,u=t._swapBuffer;return t._swapBuffer=t.buffer,u||(u=new s.b(this.gl,{size:r,data:new Float32Array(o),usage:s.g.DYNAMIC_COPY})),u.data.length<o&&u.setData({data:new Float32Array(o)}),E({fromState:i,toState:e,fromLength:a,toLength:o}),{fromState:i,toState:e,buffer:u}}},{key:"_getTransitionSettings",value:function(t){var e=this.opts,n=t.userData,r=n.transition,i=n.accessor;return r?Array.isArray(i)?i.map((function(t){return e[t]})).find(Boolean):e[i]:null}},{key:"_normalizeTransitionSettings",value:function(t){return Number.isFinite(t)&&(t={duration:t}),Object(a.a)(t&&t.duration>0),{duration:t.duration,easing:t.easing||function(t){return t},onStart:t.onStart||M,onEnd:t.onEnd||M,onInterrupt:t.onInterrupt||M}}},{key:"_triggerTransition",value:function(t,e){this.needsRedraw=!0;var n=this._normalizeTransitionSettings(e);t.start(Object.assign({},this._getNextTransitionStates(t),n))}}])&&O(e.prototype,n),r&&O(e,r),t}();function L(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function F(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e&&F(t.prototype,e),n&&F(t,n),t}function j(){}var D={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,n=t.message;i.a.log(e,n)()},onUpdateStart:function(t){t.level,t.numInstances;D.savedMessages=[],D.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;D.savedMessages&&D.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,n=t.id,r=t.numInstances,o=Math.round(new Date-D.timeStart),a="".concat(o,"ms");i.a.group(e,"Updated attributes for ".concat(r," instances in ").concat(n," in ").concat(a),{collapsed:!0})();var s=!0,u=!1,l=void 0;try{for(var c,h=D.savedMessages[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=c.value;i.a.log(e,p)()}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}i.a.groupEnd(e,"Updated attributes for ".concat(r," instances in ").concat(n," in ").concat(a))(),D.savedMessages=null}},z=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.id,i=void 0===r?"attribute-manager":r,o=n.stats;L(this,t),this.id=i,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=o,this.attributeTransitionManager=new R(e,{id:"".concat(i,"-transitions")}),Object.seal(this)}return N(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,n=t.onUpdateStart,r=t.onUpdate,i=t.onUpdateEnd;void 0!==e&&(D.onLog=e||j),void 0!==n&&(D.onUpdateStart=n||j),void 0!==r&&(D.onUpdate=r||j),void 0!==i&&(D.onUpdateEnd=i||j)}}]),N(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0!==e&&e,r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!n,r&&this.id}},{key:"setNeedsRedraw",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=!0,this}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._add(t,e)}},{key:"addInstanced",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];void 0!==this.attributes[n]&&(this.attributes[n].delete(),delete this.attributes[n])}}},{key:"invalidate",value:function(t){var e=this._invalidateTrigger(t);D.onLog({level:3,message:"invalidated attributes ".concat(e," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(){for(var t in this.attributes)this.attributes[t].setNeedsUpdate();D.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.numInstances,r=t.transitions,i=t.props,o=void 0===i?{}:i,a=t.buffers,s=void 0===a?{}:a,u=t.context,l=void 0===u?{}:u,c=t.ignoreUnknownAttributes,h=void 0!==c&&c;this._checkExternalBuffers({buffers:s,ignoreUnknownAttributes:h}),this._setExternalBuffers(s),this._setGenericAttributes({data:e,props:o,context:l}),this._checkIfBuffersNeedUpdating({numInstances:n})&&(D.onUpdateStart({level:2,id:this.id,numInstances:n}),this.stats&&this.stats.timeStart("attribute updates",this.id),this._allocateBuffers({numInstances:n,data:e,props:o,context:l}),this._updateBuffers({numInstances:n,data:e,props:o,context:l}),this.stats&&this.stats.timeEnd("attribute updates",this.id),D.onUpdateEnd({level:2,id:this.id,numInstances:n})),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}},{key:"updateTransition",value:function(){var t=this.attributeTransitionManager.setCurrentTime(Date.now());return this.needsRedraw=this.needsRedraw||t,t}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(t){var e=t.transition,n=void 0!==e&&e,r=(t.clearChangedFlags,this.attributes),i=this.attributeTransitionManager;if(n)return i.getAttributes();var o={};for(var a in r){var s=r[a];s.needsRedraw({clearChangedFlags:!0})&&(i.hasAttribute(a)||(o[a]=s))}return o}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&i.a.removed("AttributeManager.add({updaters}) - updater map no longer supported");var r={};for(var o in t){var a=t[o];r[o]=new y(this.gl,Object.assign({},a,{id:o,isGeneric:a.isGeneric||!1,isIndexed:a.isIndexed||a.elements,size:a.elements?1:a.size,value:a.value||null,instanced:a.instanced||n.instanced}))}Object.assign(this.attributes,r),this._mapUpdateTriggersToAttributes()}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},n=function(n){t.attributes[n].getUpdateTriggers().forEach((function(t){e[t]||(e[t]=[]),e[t].push(n)}))};for(var r in this.attributes)n(r);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t){var e=this.attributes,n=this.updateTriggers[t];if(n)n.forEach((function(t){var n=e[t];n&&n.setNeedsUpdate()}));else{var r="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");r+="Valid triggers: ".concat(Object.keys(e).join(", ")),i.a.warn(r,n)()}return n}},{key:"_setExternalBuffers",value:function(t){for(var e in this.attributes){var n=this.attributes[e],r=t[e];n.setExternalBuffer(r,this.numInstances),this.needsRedraw|=n.needsRedraw()}}},{key:"_checkExternalBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.buffers,n=void 0===e?{}:e,r=t.ignoreUnknownAttributes,i=void 0!==r&&r,o=this.attributes;for(var a in n){var s=o[a];if(!s&&!i)throw new Error("Unknown attribute prop ".concat(a))}}},{key:"_checkIfBuffersNeedUpdating",value:function(t){var e=t.numInstances;Object(a.a)(void 0!==e,"numInstances not defined");var n=!1;for(var r in this.attributes){var i=this.attributes[r];i.setNumInstances(e),n=n||i.needsUpdate()}return n}},{key:"_setGenericAttributes",value:function(t){t.data;var e=t.props,n=(t.context,this.attributes);for(var r in n){n[r].setGenericValue({props:e})}}},{key:"_allocateBuffers",value:function(t){var e=t.numInstances,n=(t.data,t.props,t.context,this.attributes);for(var r in n){n[r].allocate(e)&&D.onUpdate({level:3,message:"".concat(r," allocated ").concat(e),id:this.id})}}},{key:"_updateBuffers",value:function(t){var e=t.numInstances,n=t.data,r=t.props,i=t.context;for(var o in this.attributes){var a=this.attributes[o],s=Date.now();if(a.updateBuffer({numInstances:e,data:n,props:r,context:i})){this.needsRedraw=!0;var u=Math.round(Date.now()-s);D.onUpdate({level:3,message:"".concat(o," updated ").concat(e," in ").concat(u,"ms")})}}}}]),t}();function B(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var U=new Map,V=function(t){if(l.a.isReady()&&t.id){var e=U.get(t.id);e&&e.forEach((function(e,n){!function t(e,n,r){e&&(n.length>1?t(e[n[0]],n.slice(1),r):e[n[0]]=r)}(t,n,e),"data"===n[0]&&(t.data=B(t.data))}))}},G=function(t){l.a.isReady()&&l.a.listenFor("deck.gl",t)},W=function(t){l.a.isReady()&&l.a.listenFor("init",t)},X=function(t){if(l.a.isReady()&&t){var e=[t.constructor.layerName];l.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},H=function(t){if(l.a.isReady()&&!l.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],n=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var r=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:r}),n.push(t.getAttributeManager().stats.getTimeString())}if(t.state.model){t.state.model.timerQueryEnabled=!0;var i=t.state.model.stats.lastFrameTime;i&&n.push("".concat((1e3*i).toFixed(0),"Î¼s"))}}return e.push({path:"badges",data:n}),e}(t);l.a.multiUpdate("deck.gl",t.id,e)}};function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e){var n=K({newProps:t,oldProps:e,ignoreProps:{data:null,updateTriggers:null}}),r=function(t,e){if(null===e)return"oldProps is null, initial diff";var n=t.dataComparator;if(n){if(!n(t.data,e.data))return"Data comparator detected a change"}else if(t.data!==e.data)return"A new data container was supplied";return null}(t,e),i=!1;return r||(i=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){if(Y(e,t,"all"))return{all:!0}}var n={},r=!1;for(var i in t.updateTriggers){if("all"!==i)Y(e,t,i)&&(n[i]=!0,r=n)}return r}(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i}}function K(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,n=t.oldProps,r=t.ignoreProps,i=void 0===r?{}:r,o=t.shallowCompareProps,s=void 0===o?{}:o,u=t.triggerName,l=void 0===u?"props":u;if(Object(a.a)(void 0!==n&&void 0!==e,"compareProps args"),n===e)return null;if("object"!==q(e)||null===e)return"".concat(l," changed shallowly");if("object"!==q(n)||null===n)return"".concat(l," changed shallowly");for(var c in n)if(!(c in i)){if(!(c in e))return"".concat(l,".").concat(c," dropped: ").concat(n[c]," -> undefined");var h=e[c]&&n[c]&&e[c].equals;if(h&&!h.call(e[c],n[c]))return"".concat(l,".").concat(c," changed deeply: ").concat(n[c]," -> ").concat(e[c]);if(c in s)"function"===q(e[c])&&"function"==typeof n[c]&&(h=!0);if(!h&&n[c]!==e[c])return"".concat(l,".").concat(c," changed shallowly: ").concat(n[c]," -> ").concat(e[c])}for(var p in e)if(!(p in i||p in n))return"".concat(l,".").concat(p," added: undefined -> ").concat(e[p]);return null}function Y(t,e,n){var r=t.updateTriggers[n]||{};return K({oldProps:e.updateTriggers[n]||{},newProps:r,triggerName:n})}function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Q="count(): argument not an object",$="count(): argument not a container";function tt(t){if(null===(e=t)||"object"!==J(e))throw new Error(Q);var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===J(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error($)}var et={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"};function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var it={boolean:{validate:function(t,e){return!0}},number:{validateType:function(t,e){return"value"in e&&(!("max"in e)||Number.isFinite(e.max))&&(!("min"in e)||Number.isFinite(e.min))},validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}}};function ot(t,e){switch(at(e)){case"object":return function(t){var e=t.type,n=(it[e]||{}).typeValidator;n&&Object(a.a)(n(t),"Illegal prop type");return t}(e=function(t,e){if(!("type"in e))return"value"in e?Object.assign({name:t,type:at(e.value)},e):{name:t,type:"object",value:e};return Object.assign({name:t},e)}(t,e));case"array":return function(t,e){if(/color/i.test(t)&&(3===e.length||4===e.length))return{name:t,type:"color",value:e};return{name:t,type:"array",value:e}}(t,e);case"boolean":return{name:t,type:"boolean",value:e};case"number":return function(t,e){var n=/radius|scale|width|height|pixel|size|miter/i.test(t)&&/^((?!scale).)*$/.test(t)?100:1;return{name:t,type:"number",max:Math.max(e,n),min:Math.min(e,0),value:e}}(t,e);case"function":return{name:t,type:"function",value:e};default:return{name:t,type:"unknown",value:e}}}function at(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":null===t?"null":nt(t)}function st(){for(var t=ut(this.constructor).defaultProps,e=Object.create(t,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),n=0;n<arguments.length;++n)Object.assign(e,arguments[n]);return V(e),Object.freeze(e),e}function ut(t){var e=ct(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:ct(t,"_propTypes")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var n=Object.getPrototypeOf(t),r=e&&ut(n)||null,o=function(t){for(var e={},n={},r=Object.entries(t),i=0;i<r.length;i++){var o=rt(r[i],2),a=o[0],s=ot(a,o[1]);e[a]=s,n[a]=s.value}return{propTypes:e,defaultProps:n}}(ct(t,"defaultProps")||{}),a=Object.assign({},r&&r.propTypes,o.propTypes),s=function(t,e,n,r){var o=Object.create(null);Object.assign(o,e,t);var a=function(t){var e=ct(t,"layerName")||ct(t,"componentName");e||i.a.once(0,"".concat(t.name,".componentName not specified"));return e||t.name}(r);return delete t.id,Object.defineProperties(o,{id:{configurable:!1,writable:!0,value:a}}),function(t,e){var n={},r={_asyncPropDefaultValues:{enumerable:!1,value:n},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var i in e){var o=e[i],a=o.name,s=o.value;o.async&&(n[a]=s,r[a]=lt(a))}Object.defineProperties(t,r)}(o,n),o}(o.defaultProps,r&&r.defaultProps,a,t);return t._mergedDefaultProps=s,t._propTypes=a,{propTypes:a,defaultProps:s}}(t)}function lt(t){return{configurable:!1,enumerable:!0,set:function(e){var n,r;"string"==typeof e||(n=e,null!=(r=Promise)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r)?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}var n=this._component&&this._component.internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)}return this._asyncPropDefaultValues[t]}}}function ct(t,e){return Object.prototype.hasOwnProperty.call(t,e)&&t[e]}function ht(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ft=Object.freeze({}),dt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(t,e){if(!ht(t,e))throw new TypeError("Cannot call a class as a function")}(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=ft,this.oldAsyncProps=null}var e,n,r;return e=t,(n=[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={},this.oldProps)this.oldAsyncProps[t]=this.oldProps[t]}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},n=t._asyncPropOriginalValues||t,r=t._asyncPropDefaultValues||{};for(var i in e){var o=e[i];this._createAsyncPropData(i,o,r[i]),this._updateAsyncProp(i,o)}for(var a in n){var s=n[a];this._createAsyncPropData(a,s,r[a]),this._updateAsyncProp(a,s)}}},{key:"_updateAsyncProp",value:function(t,e){this._didAsyncInputValueChange(t,e)&&("string"==typeof e&&(e=(0,this.layer.props.fetch)(e)),ht(e,Promise)?this._watchPromise(t,e):this._setPropValue(t,e))}},{key:"_didAsyncInputValueChange",value:function(t,e){var n=this.asyncProps[t];return e!==n.lastValue&&(n.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var n=this.asyncProps[t];n.value=e,n.resolvedValue=e,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,n){var r=this.asyncProps[t];r&&n>=r.resolvedLoadCount&&(Object(a.a)(void 0!==e),this.freezeAsyncOldProps(),e=this._postProcessValue(t,e),r.resolvedValue=e,r.resolvedLoadCount=n,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var n=this,r=this.asyncProps[t];r.pendingLoadCount++;var o=r.pendingLoadCount;e.then((function(e){return n._setAsyncPropValue(t,e,o)})).catch((function(t){return i.a.error(t)}))}},{key:"_postProcessValue",value:function(t,e){var n=(this.component?this.component.props:{}).dataTransform;return"data"===t&&n&&(e=n(e)),e}},{key:"_createAsyncPropData",value:function(t,e,n){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0})}}])&&pt(e.prototype,n),r&&pt(e,r),t}();function vt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var yt=0,mt=function(){function t(){vt(this,t),this.props=st.apply(this,arguments),this.id=this.props.id,this.count=yt++,this.lifecycle=et.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}var e,n,r;return e=t,(n=[{key:"clone",value:function(t){return new this.constructor(Object.assign({},this.props,t))}},{key:"_initState",value:function(){this.internalState=new dt({})}},{key:"stats",get:function(){return this.internalState.stats}}])&&gt(e.prototype,n),r&&gt(e,r),t}();function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wt(t,e){return!e||"object"!==_t(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Et(t,e){return(Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}mt.defaultProps={};var St=function(t){function e(t){var n,r=t.attributeManager,i=t.layer;return bt(this,e),(n=wt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i))).attributeManager=r,n.model=null,n.needsRedraw=!0,n.subLayers=null,n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Et(t.prototype,e&&e.prototype),e&&Et(t,e)}(e,t),n=e,(r=[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}])&&xt(n.prototype,r),i&&xt(n,i),e}(dt);function At(t){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Pt(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ct(t,e){return!e||"object"!==At(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ot(t,e){return(Ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var It=function(){},Mt={data:{type:"data",value:Object.freeze([]),async:!0},dataComparator:null,dataTransform:function(t){return t},fetch:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return fetch(t).then((function(t){return t.json()}))})),updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:It,onClick:It,coordinateSystem:o.a.LNGLAT,coordinateOrigin:[0,0,0],parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:function(t){return[0,100*-t.layerIndex]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:[0,0,128,128]},Rt=function(t){function e(){return function(t,e){if(!Pt(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),Ct(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,u;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Ot(t.prototype,e&&e.prototype),e&&Ot(t,e)}(e,t),n=e,(r=[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setLayerNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this))}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0!==e&&e;return this._getNeedsRedraw(n)}},{key:"needsUpdate",value:function(){return this.shouldUpdateState(this._getUpdateParams())}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,n=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0)return i.value}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return null}},{key:"project",value:function(t){var e=this.context.viewport;return Object(a.a)(Array.isArray(t)),e.project(t)}},{key:"unproject",value:function(t){var e=this.context.viewport;return Object(a.a)(Array.isArray(t)),e.unproject(t)}},{key:"projectFlat",value:function(t){var e=this.context.viewport;return Object(a.a)(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){var e=this.context.viewport;return Object(a.a)(Array.isArray(t)),e.unprojectFlat(t)}},{key:"is64bitEnabled",value:function(){if(this.props.fp64){if(this.props.coordinateSystem===o.a.LNGLAT)return!0;i.a.once(0,"64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT. Rendering in 32-bit mode instead")}return!1}},{key:"screenToDevicePixels",value:function(t){return i.a.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),t*("undefined"!=typeof window?window.devicePixelRatio:1)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){return Object(a.a)(0==(t+1>>24&255),"index out of picking color range"),[t+1&255,t+1>>8&255,t+1>>8>>8&255]}},{key:"decodePickingColor",value:function(t){Object(a.a)(Pt(t,Uint8Array));var e=Tt(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"shouldUpdateState",value:function(t){return t.oldProps,t.props,t.context,t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,n=this.getAttributeManager();e.dataChanged&&n&&n.invalidateAll()}},{key:"finalizeState",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.getModels()[Symbol.iterator]();!(t=(r=i.next()).done);t=!0)r.value.delete()}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}this.getAttributeManager().finalize()}},{key:"draw",value:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=this.getModels()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0)i.value.draw(t)}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=(t.mode,e.index);return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.getAttributeManager();n&&("all"===t?(i.a.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),n.invalidateAll()):(i.a.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),n.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var n=this.getNumInstances(t);e.update({data:t.data,numInstances:n,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var r=this.getSingleModel();if(r){var i=e.getChangedAttributes({clearChangedFlags:!0});r.setAttributes(i)}}}},{key:"updateTransition",value:function(){var t=this.getSingleModel(),e=this.getAttributeManager(),n=e&&e.updateTransition();t&&n&&t.setAttributes(e.getChangedAttributes({transition:!0}))}},{key:"calculateInstancePickingColors",value:function(t,e){for(var n=e.numInstances,r=t.value,i=t.size,o=0;o<n;o++){var a=this.encodePickingColor(o);r[o*i+0]=a[0],r[o*i+1]=a[1],r[o*i+2]=a[2]}}},{key:"_clearInstancePickingColor",value:function(t){var e=this.getAttributeManager().attributes.instancePickingColors.state,n=e.value,r=e.size,i=this.decodePickingColor(t);n[i*r+0]=0,n[i*r+1]=0,n[i*r+2]=0;var o=this.getModels();o&&o.forEach((function(t){return t.setAttributes({instancePickingColors:e})}))}},{key:"_clearPickingColor",value:function(t){for(var e=this.getAttributeManager().attributes.pickingColors.state,n=e.value,r=0;r<n.length;r+=3)n[r+0]===t[0]&&n[r+1]===t[1]&&n[r+2]===t[2]&&(n[r+0]=0,n[r+1]=0,n[r+2]=0);var i=this.getModels();i&&i.forEach((function(t){return t.setAttributes({pickingColors:e})}))}},{key:"clearPickingColor",value:function(t){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(t):this._clearInstancePickingColor(t)}},{key:"copyPickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,n=t.instancePickingColors;return new Uint8ClampedArray((e||n).value)}},{key:"restorePickingColors",value:function(t){var e=this.getAttributeManager().attributes,n=e.pickingColors,r=e.instancePickingColors,i=n||r;i.value.set(t),i.setNeedsUpdate(),this.updateAttributes(this.props)}},{key:"getNumInstances",value:function(t){return t=t||this.props,this.state&&void 0!==this.state.numInstances?this.state.numInstances:void 0!==t.numInstances?t.numInstances:tt(this.props.data)}},{key:"_initialize",value:function(){Object(a.a)(this.context.gl),this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();var t=this.getSingleModel();t&&(t.id=this.props.id,t.program.id="".concat(this.props.id,"-program"),t.geometry.id="".concat(this.props.id,"-geometry"),t.setAttributes(this.getAttributeManager().getAttributes()))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this._getUpdateParams();this.updateState(t),this.isComposite&&this._renderLayers(t),this.updateAttributes(this.props),this._updateBaseUniforms(),this._updateModuleSettings(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()),this.clearChangeFlags(),this.internalState.resetOldProps()}},{key:"_finalize",value:function(){var t;Object(a.a)(this.internalState&&this.state),this.finalizeState(this.context),t=this.id,l.a.isReady()&&t&&l.a.deleteItem("deck.gl",t)}},{key:"drawLayer",value:function(t){var e=this,n=t.moduleParameters,r=void 0===n?null:n,i=t.uniforms,o=void 0===i?{}:i,a=t.parameters,u=void 0===a?{}:a;if(o.picking_uActive||this.updateTransition(),r){var l=!0,c=!1,h=void 0;try{for(var p,f=this.getModels()[Symbol.iterator]();!(l=(p=f.next()).done);l=!0)p.value.updateModuleSettings(r)}catch(t){c=!0,h=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}}var d=this.props.getPolygonOffset,v=d&&d(o)||[0,0];u.polygonOffset=v,Object(s.v)(this.context.gl,u,(function(){e.draw({moduleParameters:r,uniforms:o,parameters:u,context:e.context})}))}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var n=this.internalState.changeFlags;t.dataChanged&&!n.dataChanged&&(n.dataChanged=t.dataChanged,i.a.log(2,(function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)}))()),t.updateTriggersChanged&&!n.updateTriggersChanged&&(n.updateTriggersChanged=n.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,n.updateTriggersChanged):t.updateTriggersChanged||n.updateTriggersChanged,i.a.log(2,(function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)}))()),t.propsChanged&&!n.propsChanged&&(n.propsChanged=t.propsChanged,i.a.log(2,(function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)}))()),t.viewportChanged&&!n.viewportChanged&&(n.viewportChanged=t.viewportChanged,i.a.log(3,(function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)}))());var r=t.dataChanged||t.updateTriggersChanged||t.propsChanged;n.propsOrDataChanged=n.propsOrDataChanged||r,n.somethingChanged=n.somethingChanged||r||t.viewportChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var n=Z(t,e);if(n.updateTriggersChanged)for(var r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this._activeUpdateTrigger(r);return this.setChangeFlags(n)}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t;var n=this.getAttributeManager(),r=n&&n.getNeedsRedraw({clearRedrawFlags:t});e=e||r;var i=!0,o=!1,a=void 0;try{for(var s,u=this.getModels()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=l.getNeedsRedraw({clearRedrawFlags:t});c&&"string"!=typeof c&&(c="model ".concat(l.id)),e=e||c}}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return e}},{key:"_initState",value:function(){Object(a.a)(!this.internalState&&!this.state);var t=new z(this.context.gl,{id:this.props.id,stats:this.context.stats});t.addInstanced({instancePickingColors:{type:s.g.UNSIGNED_BYTE,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new St({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=this.getAttributeManager(),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,n=t.internalState;if(Object(a.a)(e&&n),this!==t){this.internalState=n,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var r=!0,i=!1,o=void 0;try{for(var s,u=this.getModels()[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)s.value.userData.layer=this}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"_checkRequiredProp",value:function(t,e){var n=this.props[t];if(void 0===n)throw new Error("Property ".concat(t," undefined in layer ").concat(this));if(e&&!e(n))throw new Error("Bad property ".concat(t," in layer ").concat(this))}},{key:"_updateBaseUniforms",value:function(){var t={opacity:Math.pow(this.props.opacity,1/2.2),ONE:1},e=!0,n=!1,r=void 0;try{for(var i,o=this.getModels()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0)i.value.setUniforms(t)}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}this.setNeedsRedraw()}},{key:"_updateModuleSettings",value:function(){var t={pickingHighlightColor:this.props.highlightColor},e=!0,n=!1,r=void 0;try{for(var i,o=this.getModels()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0)i.value.updateModuleSettings(t)}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"setUniforms",value:function(t){var e=!0,n=!1,r=void 0;try{for(var o,a=this.getModels()[Symbol.iterator]();!(e=(o=a.next()).done);e=!0)o.value.setUniforms(t)}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}this.setNeedsRedraw(),i.a.deprecated("layer.setUniforms","model.setUniforms")()}}])&&kt(n.prototype,r),u&&kt(n,u),e}(mt);Rt.layerName="Layer",Rt.defaultProps=Mt;var Lt=2,Ft=0,Nt=function(t){var e=t.useDevicePixels;return Object(a.a)("boolean"==typeof e,"Invalid useDevicePixels"),e&&"undefined"!=typeof window?window.devicePixelRatio:1},jt=function(t,e){var n=e.viewport,r=e.pixelRatio,i=t.canvas?t.canvas.clientHeight:100,o=n;return[o.x*r,(i-o.y-o.height)*r,o.width*r,o.height*r]};function Dt(t,e){var n=e.layers,r=e.viewports,o=e.onViewportActive,a=e.useDevicePixels,u=e.drawPickingColors,l=void 0!==u&&u,c=e.deviceRect,h=void 0===c?null:c,p=e.parameters,f=void 0===p?{}:p,d=e.layerFilter,v=void 0===d?null:d,g=e.pass,y=void 0===g?"draw":g,m=e.redrawReason,_=void 0===m?"":m,b=e.stats;!function(t,e){e.useDevicePixels;var n=t.drawingBufferWidth,r=t.drawingBufferHeight;Object(s.v)(t,{viewport:[0,0,n,r]},(function(){t.clear(s.g.COLOR_BUFFER_BIT|s.g.DEPTH_BUFFER_BIT)}))}(t,{useDevicePixels:a}),r.forEach((function(e,r){var u=function(t){return t.viewport?t.viewport:t}(e);o(u),function(t,e){var n=e.layers,r=e.viewport,o=e.useDevicePixels,a=e.drawPickingColors,u=void 0!==a&&a,l=(e.deviceRect,e.parameters),c=void 0===l?{}:l,h=e.layerFilter,p=e.pass,f=void 0===p?"draw":p,d=e.redrawReason,v=void 0===d?"":d,g=e.stats,y=Nt({useDevicePixels:o}),m=jt(t,{viewport:r,pixelRatio:y}),_={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Object(s.u)(t,c||{}),n.forEach((function(e,n){var i=e.props.visible;u&&(i=i&&e.props.pickable),i&&h&&(i=h({layer:e,viewport:r,isPicking:u})),i&&e.props.pickable&&_.pickableCount++,e.isComposite&&_.compositeCount++,i&&(e.isComposite||_.visibleCount++,function(t){t.gl;var e=t.layer,n=t.layerIndex,r=t.drawPickingColors,i=t.pixelRatio,o=t.glViewport,a=t.parameters,s=Object.assign(Object.create(e.props),{viewport:e.context.viewport,pickingActive:r?1:0,devicePixelRatio:i}),u=Object.assign({},e.context.uniforms,{layerIndex:n}),l=Object.assign({},e.props.parameters||{},a);Object.assign(l,{viewport:o}),r?Object.assign(l,{blendColor:[0,0,0,(n+1)/255]}):Object.assign(s,function(t){if(Number.isInteger(t.props.highlightedObjectIndex)){return{pickingSelectedColor:t.props.highlightedObjectIndex>=0?t.encodePickingColor(t.props.highlightedObjectIndex):null}}return null}(e));e.drawLayer({moduleParameters:s,uniforms:u,parameters:l})}({gl:t,layer:e,layerIndex:n,drawPickingColors:u,pixelRatio:y,glViewport:m,parameters:c}))})),Ft++,function(t){var e=t.renderStats,n=t.pass,r=t.redrawReason,o=t.stats;if(i.a.priority>=Lt){var a=e.totalCount,s=e.visibleCount,u=e.compositeCount,l=e.pickableCount,c=a-u-s,h="";h+="RENDER #".concat(Ft," ").concat(s," (of ").concat(a," layers) to ").concat(n," because ").concat(r," "),i.a.priority>Lt&&(h+="(".concat(c," hidden, ").concat(u," composite ").concat(l," pickable)")),i.a.log(Lt,h)(),o&&o.increment("redraw layers",s)}}({renderStats:_,pass:f,redrawReason:v,stats:g})}(t,{layers:n,viewport:u,useDevicePixels:a,drawPickingColors:l,deviceRect:h,parameters:f,layerFilter:v,pass:y,redrawReason:_,stats:b})}))}var zt={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function Bt(t,e){for(var n=e.layers,r=e.viewports,i=e.x,o=e.y,a=e.radius,s=e.layerFilter,u=e.depth,l=void 0===u?1:u,c=e.mode,h=e.onViewportActive,p=e.pickingFBO,f=e.lastPickedInfo,d=e.useDevicePixels,v=Nt({useDevicePixels:d}),g=Math.round(i*v),y=Math.round(t.canvas.height-o*v),m=Math.round(a*v),_=function(t){var e=t.deviceX,n=t.deviceY,r=t.deviceRadius,i=t.deviceWidth,o=t.deviceHeight;if(!(e>=0&&n>=0&&e<i&&n<o))return null;var a=Math.max(0,e-r),s=Math.max(0,n-r),u=Math.min(i,e+r)-a+1,l=Math.min(o,n+r)-s+1;return{x:a,y:s,width:u,height:l}}({deviceX:g,deviceY:y,deviceRadius:m,deviceWidth:p.width,deviceHeight:p.height}),b=[],x={},w=0;w<l;w++){var E=_&&Vt(t,{layers:n,viewports:r,onViewportActive:h,useDevicePixels:d,pickingFBO:p,deviceRect:_,layerFilter:s,redrawReason:c}),S=E&&Wt(t,{pickedColors:E,layers:n,deviceX:g,deviceY:y,deviceRadius:m,deviceRect:_})||zt;if(S.pickedColor&&w+1<l){var A=S.pickedColor[3]-1;x[A]||(x[A]=n[A].copyPickingColors()),n[A].clearPickingColor(S.pickedColor)}var T=Gt({pickInfo:S,lastPickedInfo:f,mode:c,layers:n,viewports:r,x:i,y:o,deviceX:g,deviceY:y,pixelRatio:v});if(T&&T.forEach((function(t){return b.push(t)})),!S.pickedColor)break}return Object.keys(x).forEach((function(t){return n[t].restorePickingColors(x[t])})),b}function Ut(t,e){var n=e.layers,r=e.viewports,o=e.x,a=e.y,s=e.width,u=e.height,l=e.mode,c=e.layerFilter,h=e.onViewportActive,p=e.pickingFBO,f=e.useDevicePixels,d=Nt({useDevicePixels:f}),v=Math.round(o*d),g=Math.round(t.canvas.height-a*d),y=Math.round((o+s)*d),m=Math.round(t.canvas.height-(a+u)*d),_=function(t,e){var n=e.pickedColors,r=e.layers,o=new Map;if(n)for(var a=0;a<n.length;a+=4){var s=n[a+3]-1;if(s>=0){var u=n.slice(a,a+4),l=u.join(",");if(!o.has(l)){var c=r[s];c?o.set(l,{pickedColor:u,pickedLayer:c,pickedObjectIndex:c.decodePickingColor(u)}):i.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(o.values())}(0,{pickedColors:Vt(t,{layers:n,viewports:r,onViewportActive:h,pickingFBO:p,useDevicePixels:f,deviceRect:{x:v,y:m,width:y-v,height:g-m},layerFilter:c,redrawReason:l}),layers:n}),b=new Map;return _.forEach((function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:o,y:a,width:s,height:u,pixelRatio:d};e=Xt({layer:t.pickedLayer,info:e,mode:l}),b.has(e.object)||b.set(e.object,e)})),Array.from(b.values())}function Vt(t,e){var n=e.layers,r=e.viewports,i=e.onViewportActive,o=e.useDevicePixels,u=e.pickingFBO,l=e.deviceRect,c=e.layerFilter,h=e.redrawReason;if(Object(a.a)(l),Object(a.a)(Number.isFinite(l.width)&&l.width>0,"`width` must be > 0"),Object(a.a)(Number.isFinite(l.height)&&l.height>0,"`height` must be > 0"),n.filter((function(t){return t.isPickable()})).length<1)return null;!function(t,e){var n=e.layers,r=e.viewports,i=e.onViewportActive,o=e.useDevicePixels,a=e.pickingFBO,u=e.deviceRect,l=u.x,c=u.y,h=u.width,p=u.height,f=e.layerFilter,d=void 0===f?null:f,v=e.redrawReason,g=void 0===v?"":v;Object(s.v)(t,{framebuffer:a,scissorTest:!0,scissor:[l,c,h,p],clearColor:[0,0,0,0]},(function(){Dt(t,{layers:n,viewports:r,onViewportActive:i,useDevicePixels:o,drawPickingColors:!0,layerFilter:d,pass:"picking",redrawReason:g,parameters:{blend:!0,blendFunc:[t.ONE,t.ZERO,t.CONSTANT_ALPHA,t.ZERO],blendEquation:t.FUNC_ADD,blendColor:[0,0,0,0]}})}))}(t,{layers:n,viewports:r,onViewportActive:i,useDevicePixels:o,pickingFBO:u,deviceRect:l,layerFilter:c,redrawReason:h});var p=l.x,f=l.y,d=l.width,v=l.height,g=new Uint8Array(d*v*4);return u.readPixels({x:p,y:f,width:d,height:v,pixelArray:g}),g}function Gt(t){var e=t.pickInfo,n=t.lastPickedInfo,r=t.mode,i=t.layers,o=t.viewports,a=t.x,s=t.y,u=t.deviceX,l=t.deviceY,c=t.pixelRatio,h=e.pickedColor,p=e.pickedLayer,f=e.pickedObjectIndex,d=p?[p]:[];if("hover"===r){var v=n.index,g=n.layerId,y=p&&p.props.id;if(y!==g||f!==v){if(y!==g){var m=i.find((function(t){return t.props.id===g}));m&&d.unshift(m)}n.layerId=y,n.index=f}}var _={color:null,layer:null,index:-1,picked:!1,x:a,y:s,pixel:[a,s],lngLat:{viewports:o}.viewports[0].unproject([a,s]),devicePixel:[u,l],pixelRatio:c},b=new Map;return d.forEach((function(t){var e=Object.assign({},_);t===p&&(e.color=h,e.index=f,e.picked=!0),(e=Xt({layer:t,info:e,mode:r}))&&b.set(e.layer.id,e);var n={pickingSelectedColor:t.props.autoHighlight&&p===t?h:null},i=!0,o=!1,a=void 0;try{for(var s,u=t.getModels()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){s.value.updateModuleSettings(n)}}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}})),function(t,e){var n=[];return t.forEach((function(t){var r=!1;switch(e){case"click":r=t.layer.props.onClick(t);break;case"hover":r=t.layer.props.onHover(t);break;case"query":break;default:throw new Error("unknown pick type")}r||n.push(t)})),n}(b,r)}function Wt(t,e){var n=e.pickedColors,r=e.layers,o=e.deviceX,s=e.deviceY,u=e.deviceRadius,l=e.deviceRect;Object(a.a)(n);for(var c=l.x,h=l.y,p=l.width,f=l.height,d=u*u,v=-1,g=0,y=0;y<f;y++){var m=y+h-s,_=m*m;if(_>d)g+=4*p;else for(var b=0;b<p;b++){if(n[g+3]-1>=0){var x=b+c-o,w=x*x+_;w<=d&&(d=w,v=g)}g+=4}}if(v>=0){var E=n[v+3]-1,S=n.slice(v,v+4),A=r[E];if(A){var T=A.decodePickingColor(S);return{pickedColor:S,pickedLayer:A,pickedObjectIndex:T}}i.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}return zt}function Xt(t){for(var e=t.layer,n=t.info,r=t.mode;e&&n;){var i=n.layer||e;n.layer=e,n=e.pickLayer({info:n,mode:r,sourceLayer:i}),e=e.parent}return n}function Ht(t,e){return Object.keys(t).some((function(n){return Array.isArray(t[n])&&Array.isArray(e[n])?Ht(t[n],e[n]):t[n]===e[n]}))}var qt=n(901),Zt=n.n(qt),Kt=n(735),Yt=n.n(Kt);function Jt(t,e){if(!t)return null;var n=Yt()([0,0,0,0],e,t),r=1/n[3];return Zt()(n,n,[r,r,r,r]),n}var Qt=n(690),$t=n(730),te=n.n($t),ee=n(731),ne=n.n(ee),re=n(729),ie=n.n(re),oe=n(764),ae=n.n(oe),se=n(792);function ue(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function le(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var he=Math.PI/180,pe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],fe=[0,0,0],de={pixelsPerMeter:[1,1,1],metersPerPixel:[1,1,1],pixelsPerDegree:[1,1,1],degreesPerPixel:[1,1,1]},ve=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!le(t,e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.id,r=void 0===n?null:n,i=e.x,o=void 0===i?0:i,a=e.y,s=void 0===a?0:a,u=e.width,l=void 0===u?1:u,c=e.height,h=void 0===c?1:c;this.id=r||this.constructor.displayName||"viewport",this.x=o,this.y=s,this.width=l||1,this.height=h||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}var e,n,r;return e=t,(n=[{key:"equals",value:function(e){return!!le(e,t)&&e.width===this.width&&e.height===this.height&&Object(Qt.d)(e.projectionMatrix,this.projectionMatrix)&&Object(Qt.d)(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=ue(t,3),o=i[0],a=i[1],s=i[2],u=void 0===s?0:s,l=this.projectFlat([o,a]),c=ue(l,2),h=c[0],p=c[1],f=Object(se.k)([h,p,u],this.pixelProjectionMatrix),d=ue(f,2),v=d[0],g=d[1],y=r?g:this.height-g;return 2===t.length?[v,y]:[v,y,f[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=ue(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=Object(se.h)([a,l,u],this.pixelUnprojectionMatrix,i),h=this.unprojectFlat(c),p=ue(h,2),f=p[0],d=p[1];return Number.isFinite(u)?[f,d,c[2]]:Number.isFinite(i)?[f,d,i]:[f,d]}},{key:"projectFlat",value:function(t){var e=ue(t,2);return e[0],e[1],arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,this._projectFlat.apply(this,arguments)}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,this._unprojectFlat.apply(this,arguments)}},{key:"_projectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"_unprojectFlat",value:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale,t}},{key:"getMercatorParams",value:function(){var t=this._addMetersToLngLat([this.longitude||0,this.latitude||0],this.meterOffset);return{longitude:t[0],latitude:t[1]}}},{key:"isMapSynched",value:function(){return!1}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(se.a)({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.modelMatrix,n=void 0===e?null:e,r=this.viewProjectionMatrix,i=this.pixelProjectionMatrix,o=this.pixelUnprojectionMatrix;n&&(r=ie()([],this.viewProjectionMatrix,n),i=ie()([],this.pixelProjectionMatrix,n),o=ae()([],i));var a=Object.assign({modelViewProjectionMatrix:r,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:i,pixelUnprojectionMatrix:o,width:this.width,height:this.height,scale:this.scale});return a}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_addMetersToLngLat",value:function(t,e){var n=ue(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o,s=ue(this._metersToLngLatDelta(e),3),u=s[0],l=s[1],c=s[2],h=void 0===c?0:c;return 2===t.length?[r+u,i+l]:[r+u,i+l,a+h]}},{key:"_metersToLngLatDelta",value:function(t){var e=ue(t,3),n=e[0],r=e[1],i=e[2],o=void 0===i?0:i;Object(a.a)(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o),"Illegal argument to Viewport");var s=this.distanceScales,u=s.pixelsPerMeter,l=s.degreesPerPixel,c=n*u[0]*l[0],h=r*u[1]*l[1];return 2===t.length?[c,h]:[c,h,o]}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,n=t.fovyRadians,r=t.aspect,i=t.focalDistance,o=t.near,s=t.far;return Object(a.a)(Number.isFinite(n)),e?(new Qt.a).orthographic({fovy:n,aspect:r,focalDistance:i,near:o,far:s}):(new Qt.a).perspective({fovy:n,aspect:r,near:o,far:s})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,n=void 0===e?pe:e,r=t.longitude,i=void 0===r?null:r,o=t.latitude,a=void 0===o?null:o,s=t.zoom,u=void 0===s?null:s,l=t.position,c=void 0===l?null:l,h=t.modelMatrix,p=void 0===h?null:h,f=t.focalDistance,d=void 0===f?1:f,v=t.distanceScales,g=void 0===v?null:v;this.isGeospatial=Number.isFinite(a)&&Number.isFinite(i),this.zoom=u,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(se.b)({latitude:a})+Math.log2(d):0),this.scale=Math.pow(2,this.zoom),this.distanceScales=this.isGeospatial?Object(se.a)({latitude:a,longitude:i,scale:this.scale}):g||de,this.focalDistance=d,this.distanceScales.metersPerPixel=new Qt.b(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new Qt.b(this.distanceScales.pixelsPerMeter),this.position=fe,this.meterOffset=fe,c&&(this.position=c,this.modelMatrix=p,this.meterOffset=p?p.transformVector(c):c),this.viewMatrixUncentered=n,this.isGeospatial?(this.center=Object(se.f)({longitude:i,latitude:a,scale:this.scale,distanceScales:this.distanceScales,meterOffset:this.meterOffset}),this.viewMatrix=(new Qt.a).multiplyRight(this.viewMatrixUncentered).scale([1,-1,1]).translate(new Qt.b(this.center||fe).negate())):(this.center=c,this.viewMatrix=n)}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,n=void 0===e?null:e,r=t.orthographic,i=void 0!==r&&r,o=t.fovyRadians,a=t.fovyDegrees,s=t.fovy,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?1e3:c,p=t.focalDistance,f=void 0===p?1:p,d=t.orthographicFocalDistance,v=o||(a||s||75)*he;this.projectionMatrix=n||this._createProjectionMatrix({orthographic:i,fovyRadians:v,aspect:this.width/this.height,focalDistance:d||f,near:l,far:h})}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ie()(t,t,this.projectionMatrix),ie()(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=ae()([],this.viewMatrix)||this.viewMatrix;var e,n,r,o=(e={viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse},n=e.viewMatrix,{eye:[(r=e.viewMatrixInverse)[12],r[13],r[14]],direction:[n[2],n[6],n[10]],up:[n[1],n[5],n[9]]}),a=o.eye,s=o.direction,u=o.up;this.cameraPosition=a,this.cameraDirection=s,this.cameraUp=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];te()(l,l,[this.width/2,-this.height/2,1]),ne()(l,l,[1,-1,0]),ie()(l,l,this.viewProjectionMatrix),this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=ae()([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||i.a.warn("Pixel project matrix not invertible")()}}])&&ce(e.prototype,n),r&&ce(e,r),t}();function ge(t){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ve.displayName="Viewport";var ye=/([0-9]+\.?[0-9]*)(%|px)/;function me(t){switch(ge(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(ye);if(e&&e.length>=3){var n="%"===e[2],r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function _e(t,e){return t.relative?Math.round(t.position*e):t.position}function be(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var we=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!be(t,e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.id,r=void 0===n?null:n,i=e.x,o=void 0===i?0:i,s=e.y,u=void 0===s?0:s,l=e.width,c=void 0===l?"100%":l,h=e.height,p=void 0===h?"100%":h,f=e.projectionMatrix,d=void 0===f?null:f,v=e.fovy,g=void 0===v?75:v,y=e.near,m=void 0===y?.1:y,_=e.far,b=void 0===_?1e3:_,x=e.modelMatrix,w=void 0===x?null:x,E=e.viewportInstance,S=void 0===E?null:E,A=e.type,T=void 0===A?ve:A;Object(a.a)(!S||be(S,ve)),this.viewportInstance=S,this.id=r||this.constructor.displayName||"view",this.type=T,this.props=Object.assign({},e,{projectionMatrix:d,fovy:g,near:m,far:b,modelMatrix:w}),this._parseDimensions({x:o,y:u,width:c,height:p}),this.equals=this.equals.bind(this),Object.seal(this)}var e,n,r;return e=t,(n=[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):Ht(this,t))}},{key:"makeViewport",value:function(t){var e=t.width,n=t.height,r=t.viewState;if(this.viewportInstance)return this.viewportInstance;var i=this.getDimensions({width:e,height:n}),o=Object.assign({viewState:r},r,this.props,i);return this._getViewport(o)}},{key:"getDimensions",value:function(t){var e=t.width,n=t.height;return{x:_e(this._x,e),y:_e(this._y,n),width:_e(this._width,e),height:_e(this._height,n)}}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height;this._x=me(e),this._y=me(n),this._width=me(r),this._height=me(i)}}])&&xe(e.prototype,n),r&&xe(e,r),t}();function Ee(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ae={latitude:0,longitude:0,zoom:1},Te=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!Ee(t,e))throw new TypeError("Cannot call a class as a function")}(this,t),this.views=[],this.width=100,this.height=100,this.viewState=Ae,this._viewports=[],this._needsRedraw="Initial render",this._needsUpdate=!0,Object.seal(this),this.setProps(e)}var e,n,r;return e=t,(n=[{key:"finalize",value:function(){}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0===e||e,r=this._needsRedraw;return n&&(this._needsRedraw=!1),r}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"getViewports",value:function(){return this._rebuildViewportsFromViews(),this._viewports}},{key:"project",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{topLeft:!0},n=this.getViewports(),r=n.length-1;r>=0;--r){var i=n[r];if(i.contains(t,e))return i.project(t,e)}return null}},{key:"unproject",value:function(t,e){for(var n=this.getViewports(),r=n.length-1;r>=0;--r){var i=n[r];if(i.containsPixel(t,e))return i.unproject(t)}return null}},{key:"setProps",value:function(t){"views"in t&&this.setViews(t.views),"viewState"in t&&this.setViewState(t.viewState),("width"in t||"height"in t)&&this.setSize(t.width,t.height),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels)}},{key:"setSize",value:function(t,e){Object(a.a)(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"setViews",value:function(t){t=_(t,{filter:Boolean}).map((function(t){return Ee(t,ve)?new we({viewportInstance:t}):t})),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"setViewState",value:function(t){t?(Ht(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):i.a.warn("setting null viewState")()}},{key:"_rebuildViewportsFromViews",value:function(){if(this._needsUpdate){var t=this.width,e=this.height,n=this.views,r=this.viewState;this._viewports=n.map((function(n){return n.makeViewport({width:t,height:e,viewState:r})})),this._needsUpdate=!1}}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some((function(n,r){return!t[r].equals(e[r])}))}}])&&Se(e.prototype,n),r&&Se(e,r),t}(),Pe=n(708),ke=n(686),Ce=n(687),Oe=n(697),Ie=n(208),Me=n(695),Re=n(209),Le=n(768),Fe=n(748),Ne=Object(Fe.a)(),je=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?Ne:i,a=e.projectionMatrix,s=void 0===a?Ne:a;Object(ke.a)(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.viewMatrix=o,this.projectionMatrix=s;var u=Object(Fe.a)();ie()(u,u,this.projectionMatrix),ie()(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=Object(Fe.a)();te()(l,l,[this.width/2,-this.height/2,1]),ne()(l,l,[1,-1,0]),ie()(l,l,this.viewProjectionMatrix);var c=ae()(Object(Fe.a)(),l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(Ce.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&Object(Le.c)(e.projectionMatrix,this.projectionMatrix)&&Object(Le.c)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=Object(Pe.a)(t,3),o=i[0],a=i[1],s=i[2],u=this.projectFlat([o,a]),l=Object(Pe.a)(u,2),c=l[0],h=l[1],p=Object(se.k)([c,h,s],this.pixelProjectionMatrix),f=Object(Pe.a)(p,2),d=f[0],v=f[1],g=r?v:this.height-v;return 2===t.length?[d,g]:[d,g,p[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=Object(Pe.a)(t,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=Object(se.h)([a,l,u],this.pixelUnprojectionMatrix,i),h=this.unprojectFlat(c),p=Object(Pe.a)(h,2),f=p[0],d=p[1];return Number.isFinite(u)?[f,d,c[2]]:Number.isFinite(i)?[f,d,i]:[f,d]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}(),De=n(809),ze=n.n(De),Be=n(810),Ue=n.n(Be),Ve=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,p=void 0===h?0:h,f=n.bearing,d=void 0===f?0:f,v=n.altitude,g=void 0===v?1.5:v,y=n.farZMultiplier,m=void 0===y?10:y;Object(ke.a)(this,e),r=r||1,i=i||1;var _=Object(se.l)(c);g=Math.max(.75,g);var b=Object(se.f)({longitude:u,latitude:a,scale:_}),x=Object(se.c)({width:r,height:i,pitch:p,bearing:d,altitude:g,farZMultiplier:m}),w=Object(se.e)({height:i,center:b,pitch:p,bearing:d,altitude:g,flipY:!0});return(t=Object(Oe.a)(this,Object(Ie.a)(e).call(this,{width:r,height:i,viewMatrix:w,projectionMatrix:x}))).latitude=a,t.longitude=u,t.zoom=c,t.pitch=p,t.bearing=d,t.altitude=g,t.scale=_,t.center=b,Object.freeze(Object(Re.a)(Object(Re.a)(t))),t}return Object(Me.a)(e,t),Object(Ce.a)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(se.g)(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(se.j)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,r=Object(se.h)(n,this.pixelUnprojectionMatrix),i=Object(se.g)(e,this.scale),o=ze()([],i,Ue()([],r)),a=ze()([],this.center,o);return Object(se.j)(a,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=We(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(je),Ge=n(807);function We(t){var e=t.width,n=t.height,r=t.bounds,i=t.padding,o=void 0===i?0:i,a=t.offset,s=void 0===a?[0,0]:a,u=Object(Pe.a)(r,2),l=Object(Pe.a)(u[0],2),c=l[0],h=l[1],p=Object(Pe.a)(u[1],2),f=p[0],d=p[1];if(Number.isFinite(o)){o={top:o,bottom:o,left:o,right:o}}else Object(Ge.a)(Number.isFinite(o.top)&&Number.isFinite(o.bottom)&&Number.isFinite(o.left)&&Number.isFinite(o.right));var v=new Ve({width:e,height:n,longitude:0,latitude:0,zoom:0}),g=v.project([c,d]),y=v.project([f,h]),m=[Math.abs(y[0]-g[0]),Math.abs(y[1]-g[1])],_=[e-o.left-o.right-2*Math.abs(s[0]),n-o.top-o.bottom-2*Math.abs(s[1])];Object(Ge.a)(_[0]>0&&_[1]>0);var b=_[0]/m[0],x=_[1]/m[1],w=(o.right-o.left)/2/b,E=(o.bottom-o.top)/2/x,S=[(y[0]+g[0])/2+w,(y[1]+g[1])/2+E],A=v.unproject(S),T=v.zoom+Math.log2(Math.abs(Math.min(b,x)));return{longitude:A[0],latitude:A[1],zoom:T}}function Xe(t){return(Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function He(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function qe(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ke(t,e){return(Ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ye(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Je=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};qe(this,e);var r=n.latitude,i=void 0===r?0:r,o=n.longitude,a=void 0===o?0:o,s=n.zoom,u=void 0===s?11:s,l=n.pitch,c=void 0===l?0:l,h=n.bearing,p=void 0===h?0:h,f=n.farZMultiplier,d=void 0===f?10:f,v=n.orthographic,g=void 0!==v&&v,y=n.width,m=n.height,_=n.altitude,b=void 0===_?1.5:_;y=y||1,m=m||1,b=Math.max(.75,b);var x=Object(se.d)({width:y,height:m,pitch:c,altitude:b,farZMultiplier:d}),w=x.fov,E=x.aspect,S=x.focalDistance,A=x.near,T=x.far,P=Object(se.e)({height:m,pitch:c,bearing:p,altitude:b}),k=n.position&&[n.position[0],n.position[1],0],C=Object.assign({},n,{width:y,height:m,viewMatrix:P,longitude:a,latitude:i,zoom:u,position:k,orthographic:g,fovyRadians:w,aspect:E,orthographicFocalDistance:S,near:A,far:T});return(t=function(t,e){return!e||"object"!==Xe(e)&&"function"!=typeof e?Ye(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C))).latitude=i,t.longitude=a,t.zoom=u,t.pitch=c,t.bearing=p,t.altitude=b,t.orthographic=g,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Ye(t)),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Ye(t)),t.addMetersToLngLat=t.addMetersToLngLat.bind(Ye(t)),Object.freeze(Ye(t)),t}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Ke(t.prototype,e&&e.prototype),e&&Ke(t,e)}(e,t),n=e,(r=[{key:"metersToLngLatDelta",value:function(t){var e=He(t,3),n=e[0],r=e[1],i=e[2],o=void 0===i?0:i;Object(a.a)(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o),"Illegal argument to WebMercatorViewport");var s=this.distanceScales,u=s.pixelsPerMeter,l=s.degreesPerPixel,c=n*u[0]*l[0],h=r*u[1]*l[1];return 2===t.length?[c,h]:[c,h,o]}},{key:"lngLatDeltaToMeters",value:function(t){var e=He(t,3),n=e[0],r=e[1],i=e[2],o=void 0===i?0:i;Object(a.a)(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o),"Illegal argument to WebMercatorViewport");var s=this.distanceScales,u=s.pixelsPerDegree,l=s.metersPerPixel,c=n*u[0]*l[0],h=r*u[1]*l[1];return 2===t.length?[c,h]:[c,h,o]}},{key:"addMetersToLngLat",value:function(t,e){var n=He(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o,s=He(this.metersToLngLatDelta(e),3),u=s[0],l=s[1],c=s[2],h=void 0===c?0:c;return 2===t.length?[r+u,i+l]:[r+u,i+l,a+h]}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,r=Object(se.h)(n,this.pixelUnprojectionMatrix),i=Object(se.g)(e,this.scale),o=ze()([],i,Ue()([],r)),a=ze()([],this.center,o);return Object(se.j)(a,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=We(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}},{key:"isMapSynched",value:function(){var t=60,e=40,n=this.pitch,r=this.zoom;return n<=t+1e-6&&r<=e+1e-6}},{key:"_projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(se.g)(t,e)}},{key:"_unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(se.j)(t,e)}}])&&Ze(n.prototype,r),i&&Ze(n,i),e}(ve);function Qe(t){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $e(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function tn(t,e){return!e||"object"!==Qe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function en(t,e){return(en=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Je.displayName="WebMercatorViewport";var nn=function(t){function e(t){return $e(this,e),tn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{type:Je})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");en(t.prototype,e&&e.prototype),e&&en(t,e)}(e,t),e}(we);nn.displayName="MapView";var rn=n(744);function on(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function an(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sn(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}var un=Object.seal({layerManager:null,gl:null,useDevicePixels:!0,stats:null,viewport:null,shaderCache:null,pickingFBO:null,lastPickedInfo:{index:-1,layerId:null},userData:{}}),ln=function(t){return sn(t,Rt)?"".concat(t):t?"invalid":"null"},cn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.eventManager,i=n.stats;!function(t,e){if(!sn(t,e))throw new TypeError("Cannot call a class as a function")}(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},un,{layerManager:this,gl:e,shaderCache:new s.j({gl:e,_cachePrograms:!0}),stats:i||new rn.Stats({id:"deck.gl"})}),this.viewManager=new Te,this.layerFilter=null,this.drawPickingColors=!1,this._needsRedraw="Initial render",this._needsUpdate=!1,this._pickingRadius=0,this._eventManager=null,this._onLayerClick=null,this._onLayerHover=null,this._onClick=this._onClick.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),this.width=100,this.height=100,Object.seal(this),W(this._initSeer),G(this._editSeer),r&&this._initEventHandling(r),this.setViews()}var e,n,r;return e=t,(n=[{key:"finalize",value:function(){l.a.removeListener(this._initSeer),l.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0===e||e;return this._checkIfNeedsRedraw(n)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.layerIds,n=void 0===e?null:e;return n?this.layers.filter((function(t){return n.find((function(e){return 0===t.id.indexOf(e)}))})):this.layers}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(){var t=this.viewManager.getViewports();return t.length&&this._activateViewport(t[0]),t}},{key:"setProps",value:function(t){"eventManager"in t&&this._initEventHandling(t.eventManager),("pickingRadius"in t||"onLayerClick"in t||"onLayerHover"in t)&&this._setEventHandlingParameters(t),("width"in t||"height"in t)&&(this.viewManager.setSize(t.width,t.height),this.width=t.width,this.height=t.height),"views"in t&&this.setViews(t.views),"viewState"in t&&this.viewManager.setViewState(t.viewState),"layers"in t&&this.setLayers(t.layers),"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this.setNeedsRedraw("layerFilter changed")),"drawPickingColors"in t&&t.drawPickingColors!==this.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this.setNeedsRedraw("drawPickingColors changed")),"userData"in t&&(this.context.userData=t.userData),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels)}},{key:"setViews",value:function(t){t&&0!==t.length||(t=[new nn({id:"default-view"})]),this.viewManager.setViews(t)}},{key:"setLayers",value:function(t){if(this.getViewports(),Object(a.a)(this.context.viewport,"LayerManager.updateLayers: viewport not set"),t===this.lastRenderedLayers)return i.a.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=_(t,{filter:Boolean});var e=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(e=(o=s.next()).done);e=!0)o.value.context=this.context}catch(t){n=!0,r=t}finally{try{e||null==s.return||s.return()}finally{if(n)throw r}}var u=this._updateLayers({oldLayers:this.layers,newLayers:t}),l=u.error,c=u.generatedLayers;if(this.layers=c,l)throw l;return this}},{key:"updateLayers",value:function(){var t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(on(this.lastRenderedLayers)))}},{key:"drawLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.pass,n=void 0===e?"render to screen":e,r=t.redrawReason,i=void 0===r?"unknown reason":r,o=this.drawPickingColors,a=this.context,s=a.gl,u=a.useDevicePixels;Dt(s,{layers:this.layers,viewports:this.getViewports(),onViewportActive:this._activateViewport.bind(this),useDevicePixels:u,drawPickingColors:o,pass:n,layerFilter:this.layerFilter,redrawReason:i})}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,r=t.mode,i=t.radius,o=void 0===i?0:i,a=t.layerIds,s=t.layerFilter,u=t.depth,l=void 0===u?1:u,c=this.context,h=c.gl,p=c.useDevicePixels;return Bt(h,{x:e,y:n,radius:o,layers:this.getLayers({layerIds:a}),mode:r,layerFilter:s,depth:l,viewports:this.getViewports(),onViewportActive:this._activateViewport.bind(this),pickingFBO:this._getPickingBuffer(),lastPickedInfo:this.context.lastPickedInfo,useDevicePixels:p})}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.layerIds,a=t.layerFilter,s=this.context,u=s.gl,l=s.useDevicePixels;return Ut(u,{x:e,y:n,width:r,height:i,layers:this.getLayers({layerIds:o}),layerFilter:a,mode:"pickObjects",viewports:this.getViewports(),onViewportActive:this._activateViewport.bind(this),pickingFBO:this._getPickingBuffer(),useDevicePixels:l})}},{key:"setParameters",value:function(t){return this.setProps(t)}},{key:"setSize",value:function(t,e){this.setProps({width:t,height:e})}},{key:"setViewState",value:function(t){this.setProps({viewState:t})}},{key:"setViewports",value:function(t){return i.a.deprecated("setViewport","setViews")(),this.setViews(t),this}},{key:"setViewport",value:function(t){return i.a.deprecated("setViewport","setViews")(),this.setViews([t]),this}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t&&(this._needsRedraw=!1),e=e||this.viewManager.needsRedraw();var n=!0,r=!1,i=void 0;try{for(var o,a=this.layers[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value.getNeedsRedraw({clearRedrawFlags:t});e=e||s}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}},{key:"_initEventHandling",value:function(t){this._eventManager=t,this._eventManager.on({click:this._onClick,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave})}},{key:"_setEventHandlingParameters",value:function(t){var e=t.pickingRadius,n=t.onLayerClick,r=t.onLayerHover;isNaN(e)||(this._pickingRadius=e),void 0!==n&&(this._onLayerClick=n),void 0!==r&&(this._onLayerHover=r),this._validateEventHandling()}},{key:"_activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){i.a.log(4,"Viewport changed",t)(),this.context.viewport=t;var n=!0,r=!1,o=void 0;try{for(var s,u=this.layers[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;l.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(l)}}catch(t){r=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(r)throw o}}}return Object(a.a)(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_getPickingBuffer",value:function(){var t=this.context.gl;return this.context.pickingFBO=this.context.pickingFBO||new s.f(t),this.context.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.context.pickingFBO}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,n=t.newLayers,r={},o=!0,a=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;r[c.id]?i.a.warn("Multiple old layers with same id ".concat(ln(c)))():r[c.id]=c}}catch(t){a=!0,s=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}var h=[],p=this._updateSublayersRecursively({newLayers:n,oldLayerMap:r,generatedLayers:h}),f=this._finalizeOldLayers(r);return this._needsUpdate=!1,{error:p||f,generatedLayers:h}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,n=t.oldLayerMap,r=t.generatedLayers,o=null,a=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value;h.context=this.context;var p=n[h.id];null===p&&i.a.warn("Multiple new layers with same id ".concat(ln(h)))(),n[h.id]=null;var f=null;try{p?(this._transferLayerState(p,h),this._updateLayer(h),H(h)):(this._initializeLayer(h),X(h)),r.push(h),f=h.isComposite&&h.getSubLayers()}catch(t){i.a.warn("error during matching of ".concat(ln(h)),t),o=o||t}f&&this._updateSublayersRecursively({newLayers:f,oldLayerMap:n,generatedLayers:r})}}catch(t){s=!0,u=t}finally{try{a||null==c.return||c.return()}finally{if(s)throw u}}return o}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var n in t){var r=t[n];r&&(e=e||this._finalizeLayer(r))}return e}},{key:"_initializeLayer",value:function(t){i.a.log(2,"initializing ".concat(ln(t)))();var e=null;try{t._initialize(),t.lifecycle=et.INITIALIZED}catch(n){i.a.warn("error while initializing ".concat(ln(t),"\n"),n)(),e=e||n}t.internalState.layer=t;var n=!0,r=!1,o=void 0;try{for(var a,s=t.getModels()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)a.value.userData.layer=t}catch(t){r=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=et.MATCHED,e!==t?(i.a.log(4,"matched ".concat(ln(e)),t,"->",e)(),t.lifecycle=et.AWAITING_GC):i.a.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){i.a.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(n){i.a.warn("error during update of ".concat(ln(t)),n)(),e=n}return e}},{key:"_finalizeLayer",value:function(t){Object(a.a)(t.lifecycle!==et.AWAITING_FINALIZATION),t.lifecycle=et.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(ln(t)));try{t._finalize()}catch(n){i.a.warn("error during finalization of ".concat(ln(t)),n)(),e=n}return t.lifecycle=et.FINALIZED,i.a.log(2,"finalizing ".concat(ln(t))),e}},{key:"_validateEventHandling",value:function(){(this.onLayerClick||this.onLayerHover)&&this.layers.length&&!this.layers.some((function(t){return t.props.pickable}))&&i.a.warn("You have supplied a top-level input event handler (e.g. `onLayerClick`), but none of your layers have set the `pickable` flag.")()}},{key:"_onClick",value:function(t){t.offsetCenter&&this._pickAndCallback({callback:this._onLayerClick,event:t,mode:"click"})}},{key:"_onPointerMove",value:function(t){t.leftButton||t.rightButton||this._pickAndCallback({callback:this._onLayerHover,event:t,mode:"hover"})}},{key:"_onPointerLeave",value:function(t){this.pickObject({x:-1,y:-1,radius:this._pickingRadius,mode:"hover"})}},{key:"_pickAndCallback",value:function(t){var e=t.event.offsetCenter,n=this._pickingRadius,r=this.pickObject({x:e.x,y:e.y,radius:n,mode:t.mode});if(t.callback){var i=r.find((function(t){return t.index>=0}))||null;t.callback(i,r,t.event.srcEvent)}}},{key:"_initSeer",value:function(){this.layers.forEach((function(t){X(t),H(t)}))}},{key:"_editSeer",value:function(t){if("edit"===t.type&&"props"===t.valuePath[0]){var e,n,r;e=t.itemKey,n=t.valuePath.slice(1),r=t.value,l.a.isReady()&&(U.has(e)||U.set(e,new Map),U.get(e).set(n,r));var i=this.layers.map((function(t){return new t.constructor(t.props)}));this.updateLayers({newLayers:i})}}}])&&an(e.prototype,n),r&&an(e,r),t}();function hn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function pn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var fn=function(){function t(e){var n=e.gl,r=e.layerManager;hn(this,t),this.gl=n,this.layerManager=r,this._effects=[]}var e,n,r;return e=t,(n=[{key:"addEffect",value:function(t){this._effects.push(t),this._sortEffects(),t.initialize({gl:this.gl,layerManager:this.layerManager})}},{key:"removeEffect",value:function(t){var e=this._effects.indexOf(t);return e>=0&&(t.finalize({gl:this.gl,layerManager:this.layerManager}),this._effects.splice(e,1),!0)}},{key:"preDraw",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._effects[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.needsRedraw&&o.preDraw({gl:this.gl,layerManager:this.layerManager})}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}},{key:"draw",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._effects[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.needsRedraw&&o.draw({gl:this.gl,layerManager:this.layerManager})}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}}},{key:"_sortEffects",value:function(){this._effects.sort((function(t,e){return t.priority>e.priority?-1:t.priority<e.priority?1:t.count-e.count}))}}])&&pn(e.prototype,n),r&&pn(e,r),t}();function dn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function vn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var gn=0,yn=function(){function t(){dn(this,t),this.id="effect",this.count=gn++,this.visible=!0,this.priority=0,this.needsRedraw=!1}var e,n,r;return e=t,(n=[{key:"initialize",value:function(t){t.gl,t.layerManager}},{key:"finalize",value:function(t){t.gl,t.layerManager}},{key:"preDraw",value:function(t){t.gl,t.layerManager}},{key:"draw",value:function(t){t.gl,t.layerManager}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.needsRedraw=t}}])&&vn(e.prototype,n),r&&vn(e,r),t}(),mn=n(902),_n=1,bn=2,xn=4,wn={mousedown:_n,mousemove:bn,mouseup:xn};var En,Sn,An=void 0;mn.a&&(An=n(811)),An&&(En=An.PointerEventInput,Sn=En.prototype.handler,En.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(e,(function(e){return e.pointerId===t.pointerId}))||e.push(t)),Sn.call(this,t)},An.MouseInput.prototype.handler=function(t){var e=wn[t.type];e&_n&&t.button>=0&&(this.pressed=!0),e&bn&&0===t.which&&(e=xn),this.pressed&&(e&xn&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))});var Tn=An?An.Manager:function(t){var e={},n=function(){return e};return e.get=function(){return null},e.set=n,e.on=n,e.off=n,e.destroy=n,e.emit=n,e},Pn=An,kn=Pn?[[Pn.Rotate,{enable:!1}],[Pn.Pinch,{enable:!1}],[Pn.Swipe,{enable:!1}],[Pn.Pan,{threshold:0,enable:!1}],[Pn.Press,{enable:!1}],[Pn.Tap,{event:"doubletap",taps:2,enable:!1}],[Pn.Tap,{enable:!1}]]:null,Cn={rotate:["pinch"]},On={doubletap:["tap"]},In={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Mn=["keydown","keyup"],Rn=["mousedown","mousemove","mouseup","mouseleave"],Ln=["wheel","mousewheel","DOMMouseScroll"],Fn={tap:"tap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Nn={click:"tap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseleave:"pointerleave"},jn=n(904),Dn=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var zn=-1!==jn.a.indexOf("firefox"),Bn=Ln,Un=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.events=Bn.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent)}))}return Dn(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){this.options.legacyBlockScroll&&t.preventDefault();var e=t.deltaY;jn.b.WheelEvent&&(zn&&t.deltaMode===jn.b.WheelEvent.DOM_DELTA_PIXEL&&(e/=jn.b.devicePixelRatio),t.deltaMode===jn.b.WheelEvent.DOM_DELTA_LINE&&(e*=40));var n={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,n)}}},{key:"_onWheel",value:function(t,e,n){this.callback({type:"wheel",center:n,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),Vn=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Gn=Rn,Wn=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.events=Gn.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent)}))}return Vn(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){if(this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target}),this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),Xn=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Hn=Mn,qn=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=Hn.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent)}))}return Xn(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),Zn=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Kn=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Zn(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"handleEvent",value:function(t){this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target}),this.options.rightButton&&t.preventDefault()}}]),t}(),Yn=1,Jn=2,Qn=4,$n={pointerdown:Yn,pointermove:Jn,pointerup:Qn,mousedown:Yn,mousemove:Jn,mouseup:Qn},tr=1,er=2,nr=3,rr=0,ir=1,or=2,ar=1,sr=2,ur=4;var lr=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var cr={events:null,recognizers:null,Manager:Tn,rightButton:!1,touchAction:"none",legacyBlockScroll:!0},hr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({},cr,n),this.eventHandlers=[],this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var r=n.events;r&&this.on(r)}return lr(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var n=this.options,r=n.Manager;this.manager=new r(t,{touchAction:n.touchAction,recognizers:n.recognizers||kn}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Cn).forEach((function(t){var n=e.manager.get(t);n&&Cn[t].forEach((function(t){n.recognizeWith(t)}))})),this.wheelInput=new Un(t,this._onOtherEvent,{enable:!1,legacyBlockScroll:n.legacyBlockScroll}),this.moveInput=new Wn(t,this._onOtherEvent,{enable:!1}),this.keyInput=new qn(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new Kn(t,this._onOtherEvent,{rightButton:n.rightButton}),this.eventHandlers.forEach((function(t){var n=t.recognizerName,r=t.eventAlias,i=t.wrappedHandler;e._toggleRecognizer(n,!0),e.manager.on(r,i)}))}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,n){if("string"==typeof t)this._addEventHandler(t,e,n);else for(var r in n=e,t)this._addEventHandler(r,t[r],n)}},{key:"off",value:function(t,e){if("string"==typeof t)this._removeEventHandler(t,e);else for(var n in t)this._removeEventHandler(n,t[n])}},{key:"_toggleRecognizer",value:function(t,e){var n=this.manager;if(n){var r=n.get(t);if(r){r.set({enable:e});var i=On[t];i&&!this.options.recognizers&&i.forEach((function(r){var i=n.get(r);e?i.requireFailure(t):i.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.manager,i=this.eventHandlers,o=this._wrapEventHandler(t,e,n),a=Nn[t]||t,s=Fn[a]||a;this._toggleRecognizer(s,!0);var u=i.filter((function(t){return t.eventAlias===a&&t.srcElement!==n&&(!t.srcElement||t.srcElement.contains(n))}));i.push({event:t,eventAlias:a,recognizerName:s,srcElement:n,handler:e,wrappedHandler:o}),u.forEach((function(t){return r.off(a,t.wrappedHandler)})),r&&r.on(a,o),u.forEach((function(t){return r.on(a,t.wrappedHandler)}))}},{key:"_removeEventHandler",value:function(t,e){for(var n=this.manager,r=this.eventHandlers,i=!1,o=r.length;o--;){var a=r[o];a.event===t&&a.handler===e&&(n&&n.off(a.eventAlias,a.wrappedHandler),r.splice(o,1),i=!0)}if(i){var s=Nn[t]||t,u=Fn[s]||s;r.find((function(t){return t.recognizerName===u}))||this._toggleRecognizer(u,!1)}}},{key:"_wrapEventHandler",value:function(t,e,n){var r=this;return function(i){var o=i.mjolnirEvent;(o||(o=r._normalizeEvent(i),i.mjolnirEvent=o),o.handled&&o.handled!==n)||(!n||n.contains(i.srcEvent.target))&&e(Object.assign({},o,{type:t,stopPropagation:function(){o.handled||(o.handled=n)}}))}}},{key:"_normalizeEvent",value:function(t){var e=this.element;return Object.assign({},t,function(t){var e=$n[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,r=n.buttons,i=n.button,o=n.which,a=!1,s=!1,u=!1;return e===Qn||e===Jn&&!Number.isFinite(r)?(a=o===tr,s=o===er,u=o===nr):e===Jn?(a=Boolean(r&ar),s=Boolean(r&ur),u=Boolean(r&sr)):e===Yn&&(a=i===rr,s=i===ir,u=i===or),{leftButton:a,middleButton:s,rightButton:u}}(t),function(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var r=t.center||{x:n.clientX,y:n.clientY},i=e.getBoundingClientRect(),o=i.width/e.offsetWidth,a=i.height/e.offsetHeight;return{center:r,offsetCenter:{x:(r.x-i.left-e.clientLeft)/o,y:(r.y-i.top-e.clientTop)/a}}}(t,e),{handled:!1,rootElement:e})}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,n=In[e.type];n&&this.manager.emit(n,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();function pr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function fr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var dr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};pr(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var n=e,r=n.compare,i=n.extract,o=n.required;this._propsToCompare=r,this._propsToExtract=i,this._requiredProps=o}var e,n,r;return e=t,(n=[{key:"arePropsEqual",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(!Object(Qt.d)(t[s],e[s]))return!1}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return!0}},{key:"initializeProps",value:function(t,e){var n;if(this._propsToExtract){var r={},i={},o=!0,a=!1,s=void 0;try{for(var u,l=this._propsToExtract[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;r[c]=t[c],i[c]=e[c]}}catch(t){a=!0,s=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}n={start:r,end:i}}else n={start:t,end:e};return this._checkRequiredProps(n.start),this._checkRequiredProps(n.end),n}},{key:"interpolateProps",value:function(t,e,n){Object(a.a)(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach((function(e){var n=t[e];Object(a.a)(Number.isFinite(n)||Array.isArray(n),"".concat(e," is required for transition"))}))}}])&&fr(e.prototype,n),r&&fr(e,r),t}();function vr(t){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mr(t,e){return!e||"object"!==vr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _r(t,e){return(_r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var br=["longitude","latitude","zoom","bearing","pitch"],xr=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:br;return gr(this,e),mr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");_r(t.prototype,e&&e.prototype),e&&_r(t,e)}(e,t),n=e,(r=[{key:"interpolateProps",value:function(t,e,n){var r={};for(var i in e)r[i]=Object(Qt.f)(t[i],e[i],n);return r}}])&&yr(n.prototype,r),i&&yr(n,i),e}(dr);function wr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Sr=function(){},Ar={BREAK:1,SNAP_TO_END:2,IGNORE:3},Tr={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new xr,transitionInterruption:Ar.BREAK,onTransitionStart:Sr,onTransitionInterrupt:Sr,onTransitionEnd:Sr},Pr=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};wr(this,t),Object(a.a)(e),this.ControllerState=e,this.props=Object.assign({},Tr,n),this.animation=null,this.propsInTransition=null,this.transition=new k,this._onTransitionFrame=this._onTransitionFrame.bind(this),this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}var e,n,r;return e=t,(n=[{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,n=this.props;if(t=Object.assign({},this.props,t),this.props=t,this._shouldIgnoreViewportChange(n,t))return e;if(this._isTransitionEnabled(t)){var r=Object.assign({},n,this.transition.interruption===Ar.SNAP_TO_END?this.transition.endProps:this.propsInTransition||n);this._triggerTransition(r,t),e=!0}else this.transition.cancel();return e}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.interruption===Ar.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){Object(a.a)(this._isTransitionEnabled(e),"Transition is not enabled"),cancelAnimationFrame(this.animation);var n=new this.ControllerState(t),r=new this.ControllerState(e).shortestPathFrom(n),i=e.transitionInterpolator.initializeProps(t,r);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:i.start,endProps:i.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this._onTransitionFrame()}},{key:"_onTransitionFrame",value:function(){this.animation=requestAnimationFrame(this._onTransitionFrame),this.transition.update(Date.now())}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(n){cancelAnimationFrame(e.animation),e.propsInTransition=null,t(n)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.interpolator,n=t.startProps,r=t.endProps,i=t.time,o=e.interpolateProps(n,r,i);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,o)).getViewportProps(),this.props.onViewportChange&&this.props.onViewportChange(this.propsInTransition,{inTransition:!0}),this.props.onViewStateChange&&this.props.onViewStateChange({viewState:this.propsInTransition},{inTransition:!0})}}])&&Er(e.prototype,n),r&&Er(e,r),t}();function kr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Cr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Pr.defaultProps=Tr;var Ir={transitionDuration:0},Mr=["wheel"],Rr=["panstart","panmove","panend"],Lr=["pinchstart","pinchmove","pinchend"],Fr=["doubletap"],Nr=["keydown"],jr=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Cr(this,t),Object(a.a)(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new Pr(e,n),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewportChange=null,this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}var e,n,r;return e=t,(n=[{key:"finalize",value:function(){}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=t.offsetCenter;return[e.x,e.y]}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&(this.onViewportChange=t.onViewportChange),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps="viewState"in t?Object.assign({},t,t.viewState):t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,n=void 0===e||e,r=t.dragPan,i=void 0===r||r,o=t.dragRotate,a=void 0===o||o,s=t.doubleClickZoom,u=void 0===s||s,l=t.touchZoom,c=void 0===l||l,h=t.touchRotate,p=void 0!==h&&h,f=t.keyboard,d=void 0===f||f,v=Boolean(this.onViewportChange||this.onViewStateChange);this.toggleEvents(Mr,v&&n),this.toggleEvents(Rr,v&&(i||a)),this.toggleEvents(Lr,v&&(c||p)),this.toggleEvents(Fr,v&&u),this.toggleEvents(Nr,v&&d),this.scrollZoom=n,this.dragPan=i,this.dragRotate=a,this.doubleClickZoom=u,this.touchZoom=c,this.touchRotate=p,this.keyboard=d}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach((function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))}))}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},t.getViewportProps(),e),i=!0;if(i){var o=this.controllerState?this.controllerState.getViewportProps():null;this.onViewportChange&&this.onViewportChange(r,n,o),this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:n,oldViewState:o})}Object.assign(this._state,Object.assign({},t.getInteractiveState(),n)),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t),n=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,Ir,{isDragging:!0})}},{key:"_onPan",value:function(t){var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1})}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.controllerState.pan({pos:e});return this.updateViewport(n,Ir,{isDragging:!0})}},{key:"_onPanRotate",value:function(t){return!!this.dragRotate&&(this.invertPan?this._onPanRotateMap(t):this._onPanRotateStandard(t))}},{key:"_onPanRotateStandard",value:function(t){var e=t.deltaX,n=t.deltaY,r=this.controllerState.getViewportProps(),i=e/r.width,o=n/r.height,a=this.controllerState.rotate({deltaScaleX:i,deltaScaleY:o});return this.updateViewport(a,Ir,{isDragging:!0})}},{key:"_onPanRotateMap",value:function(t){var e=t.deltaX,n=t.deltaY,r=kr(this.getCenter(t),2)[1],i=r-n,o=this.controllerState.getViewportProps(),a=o.width,s=o.height,u=e/a,l=0;n>0?Math.abs(s-i)>5&&(l=n/(i-s)*1.2):n<0&&i>5&&(l=1-r/i),l=Math.min(1,Math.max(-1,l));var c=this.controllerState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(c,Ir,{isDragging:!0})}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var e=this.getCenter(t),n=t.delta,r=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==r&&(r=1/r);var i=this.controllerState.zoom({pos:e,scale:r});return this.updateViewport(i,Ir)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t),n=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,Ir,{isDragging:!0})}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.controllerState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);e=e.zoom({pos:r,scale:n})}if(this.touchRotate){var i=t.rotation,o=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(i-o)/180})}return this.updateViewport(e,Ir,{isDragging:!0})}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1})}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t),n=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps())}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),r=this.controllerState;switch(t.srcEvent.keyCode){case 189:e=n?r.zoomOut().zoomOut():r.zoomOut();break;case 187:e=n?r.zoomIn().zoomIn():r.zoomIn();break;case 37:e=n?r.rotateLeft():r.moveLeft();break;case 39:e=n?r.rotateRight():r.moveRight();break;case 38:e=n?r.rotateUp():r.moveUp();break;case 40:e=n?r.rotateDown():r.moveDown();break;default:return!1}return this.updateViewport(e,this._getTransitionProps())}},{key:"_getTransitionProps",value:function(){return Ir}}])&&Or(e.prototype,n),r&&Or(e,r),t}();function Dr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Br=Qt.e.SphericalCoordinates,Ur={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},Vr=function(){function t(e){Dr(this,t);var n=e.width,r=e.height,i=e.position,o=void 0===i?Ur.position:i;Object(a.a)(Number.isFinite(n),"`width` must be supplied"),Object(a.a)(Number.isFinite(r),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new Qt.b(o)}))}var e,n,r;return e=t,(n=[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new Br({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new Br({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}])&&zr(e.prototype,n),r&&zr(e,r),t}(),Gr=85.05113,Wr=-85.05113;function Xr(t){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function qr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kr(t,e,n){return e&&Zr(t.prototype,e),n&&Zr(t,n),t}function Yr(t,e){return!e||"object"!==Xr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Jr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Qr(t.prototype,e&&e.prototype),e&&Qr(t,e)}function Qr(t,e){return(Qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $r={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new xr,transitionInterruption:Ar.BREAK},ti={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},ei={pitch:0,bearing:0,altitude:1.5},ni=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,s=n.longitude,u=n.zoom,l=n.bearing,c=void 0===l?ei.bearing:l,h=n.pitch,p=void 0===h?ei.pitch:h,f=n.altitude,d=void 0===f?ei.altitude:f,v=n.maxZoom,g=void 0===v?ti.maxZoom:v,y=n.minZoom,m=void 0===y?ti.minZoom:y,_=n.maxPitch,b=void 0===_?ti.maxPitch:_,x=n.minPitch,w=void 0===x?ti.minPitch:x,E=n.startPanLngLat,S=n.startZoomLngLat,A=n.startBearing,T=n.startPitch,P=n.startZoom;return qr(this,e),Object(a.a)(Number.isFinite(s),"`longitude` must be supplied"),Object(a.a)(Number.isFinite(o),"`latitude` must be supplied"),Object(a.a)(Number.isFinite(u),"`zoom` must be supplied"),(t=Yr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{width:r,height:i,latitude:o,longitude:s,zoom:u,bearing:c,pitch:p,altitude:d,maxZoom:g,minZoom:m,maxPitch:b,minPitch:w})))._interactiveState={startPanLngLat:E,startZoomLngLat:S,startBearing:A,startPitch:T,startZoom:P},t}return Jr(e,t),Kr(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._interactiveState.startPanLngLat||this._unproject(n);if(!r)return this;var i=Hr(this._calculateNewLngLat({startPanLngLat:r,pos:e}),2),o=i[0],a=i[1];return this._getUpdatedState({longitude:o,latitude:a})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,r=t.deltaScaleY,i=void 0===r?0:r,o=this._interactiveState,a=o.startBearing,s=o.startPitch;if(!Number.isFinite(a)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:i,startBearing:a,startPitch:s}),l=u.pitch,c=u.bearing;return this._getUpdatedState({bearing:c,pitch:l})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale;Object(a.a)(r>0,"`scale` must be a positive number");var i=this._interactiveState,o=i.startZoom,s=i.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,s=this._unproject(n)||this._unproject(e)),Object(a.a)(s,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var u=this._calculateNewZoom({scale:r,startZoom:o}),l=Hr(new Ve(Object.assign({},this._viewportProps,{zoom:u})).getLocationAtPoint({lngLat:s,pos:e}),2),c=l[0],h=l[1];return this._getUpdatedState({zoom:u,longitude:c,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),n=Object.assign({},this._viewportProps),r=n.bearing,i=n.longitude;return Math.abs(r-e.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(i-e.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,n=e.width,r=e.height;return this.zoom({pos:[n/2,r/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,n=e.width,r=e.height;return this.pan({startPos:[n/2,r/2],pos:[n/2+t[0],r/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=Object(Qt.c)(r,n,e);var i=t.maxPitch,o=t.minPitch,a=t.pitch;return t.pitch=Object(Qt.c)(a,o,i),Object.assign(t,function(t){var e=t.width,n=t.height,r=t.longitude,i=t.latitude,o=t.zoom,a=t.pitch,s=void 0===a?0:a,u=t.bearing,l=void 0===u?0:u;(r<-180||r>180)&&(r=Object(Fe.c)(r+180,360)-180),(l<-180||l>180)&&(l=Object(Fe.c)(l+180,360)-180);var c=new Ve({width:e,height:n,longitude:r,latitude:i,zoom:o}),h=c.project([r,Gr])[1],p=c.project([r,Wr])[1],f=0;return p-h<n&&(o+=Math.log2(n/(p-h)),h=(c=new Ve({width:e,height:n,longitude:r,latitude:i,zoom:o})).project([r,Gr])[1],p=c.project([r,Wr])[1]),h>0?f=h:p<n&&(f=p-n),f&&(i=c.unproject([e/2,n/2+f])[1]),{width:e,height:n,longitude:r,latitude:i,zoom:o,pitch:s,bearing:l}}(t)),t}},{key:"_unproject",value:function(t){var e=new Ve(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return new Ve(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,r=this._viewportProps,i=r.maxZoom,o=r.minZoom,a=n+Math.log2(e);return Object(Qt.c)(a,o,i)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,i=t.startPitch;n=Object(Qt.c)(n,-1,1);var o=this._viewportProps,a=o.minPitch,s=o.maxPitch,u=i;return n>0?u=i+n*(s-i):n<0&&(u=i-n*(a-i)),{pitch:u,bearing:r+180*e}}}]),e}(Vr),ri=function(t){function e(t){var n;return qr(this,e),(n=Yr(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,ni,t))).invertPan=!0,n}return Jr(e,t),Kr(e,[{key:"_getTransitionProps",value:function(){return $r}}]),e}(jr);function ii(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function oi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ai(){}var si={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,onWebGLInitialized:ai,onBeforeRender:ai,onAfterRender:ai,onLayerClick:null,onLayerHover:null,useDevicePixels:!0,debug:!1,drawPickingColors:!1},ui={GRABBING:"".concat("-webkit-","grabbing"),GRAB:"".concat("-webkit-","grab"),POINTER:"pointer"},li=Object.assign({},ti,{scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoomRotate:!0,getCursor:function(t){return t.isDragging?ui.GRABBING:ui.GRAB}}),ci=function(){function t(e){ii(this,t),e=Object.assign({},si,e),this.width=0,this.height=0,this.needsRedraw=!0,this.layerManager=null,this.effectManager=null,this.controller=null,this.stats=new rn.Stats({id:"deck.gl"}),this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),this.canvas=this._createCanvas(e),this.controller=this._createController(e),this.animationLoop=this._createAnimationLoop(e),this.setProps(e),this.animationLoop.start()}var e,n,r;return e=t,(n=[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.controller&&(this.controller.finalize(),this.controller=null),this.eventManager&&this.eventManager.destroy()}},{key:"setProps",value:function(t){this.stats.timeStart("deck.setProps"),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{viewState:this._getViewState(t),width:this.width,height:this.height});this.layerManager&&this.layerManager.setParameters(e),this.animationLoop&&this.animationLoop.setProps(e),this.controller&&this.controller.setProps(Object.assign(e,{onViewStateChange:this._onViewStateChange})),this.stats.timeEnd("deck.setProps")}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,r=t.radius,i=void 0===r?0:r,o=t.layerIds,a=void 0===o?null:o;this.stats.timeStart("deck.pickObject");var s=this.layerManager.pickObject({x:e,y:n,radius:i,layerIds:a,mode:"query",depth:1});return this.stats.timeEnd("deck.pickObject"),s.length?s[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,n=t.y,r=t.radius,i=void 0===r?0:r,o=t.layerIds,a=void 0===o?null:o,s=t.depth,u=void 0===s?10:s;this.stats.timeStart("deck.pickMultipleObjects");var l=this.layerManager.pickObject({x:e,y:n,radius:i,layerIds:a,mode:"query",depth:u});return this.stats.timeEnd("deck.pickMultipleObjects"),l}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,r=t.width,i=void 0===r?1:r,o=t.height,a=void 0===o?1:o,s=t.layerIds,u=void 0===s?null:s;this.stats.timeStart("deck.pickObjects");var l=this.layerManager.pickObjects({x:e,y:n,width:i,height:a,layerIds:u});return this.stats.timeEnd("deck.pickObjects"),l}},{key:"getViewports",value:function(){return this.layerManager?this.layerManager.getViewports():[]}},{key:"_createCanvas",value:function(t){var e=t.canvas;"string"==typeof e&&(e=document.getElementById(e),Object(a.a)(e)),e||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var n=t.id,r=t.style;return e.id=n,Object.assign(e.style,r),e}},{key:"_setCanvasSize",value:function(t){var e=this.canvas,n=t.width,r=t.height;(n||0===n)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,e.style.width=n),(r||0===r)&&(r=Number.isFinite(r)?"".concat(r,"px"):r,e.style.position="absolute",e.style.height=r)}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.layerManager.setParameters({width:t,height:e}),this.controller&&this.controller.setProps({viewState:this._getViewState(this.props),width:this.width,height:this.height}),this.props.onResize&&this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;return!(!t||this.width===t.clientWidth&&this.height===t.clientHeight||(this.width=t.clientWidth,this.height=t.clientHeight,0))}},{key:"_createController",value:function(t){var e=null;return t.controller&&(e=new(0,t.controller)(t)).setProps(Object.assign({},this.props,li,{eventManager:this.eventManager,viewState:this._getViewState(t),onViewStateChange:this._onViewStateChange,onStateChange:this._onInteractiveStateChange})),e}},{key:"_createAnimationLoop",value:function(t){var e=this,n=t.width,r=t.height,i=t.gl,o=t.glOptions,a=t.debug,u=t.useDevicePixels,l=t.autoResizeDrawingBuffer;return new s.a({width:n,height:r,useDevicePixels:u,autoResizeDrawingBuffer:l,onCreateContext:function(t){return i||Object(s.l)(Object.assign({},o,t,{canvas:e.canvas,debug:a}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return Object.assign({},t.viewState||this.viewState||{},{width:this.width,height:this.height})}},{key:"_onViewStateChange",value:function(t){var e=t.viewState;if(this.props.onViewStateChange){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];e=(n=this.props).onViewStateChange.apply(n,[{viewState:e}].concat(i))||e}this.viewState&&(this.viewState=e,this.layerManager.setParameters({viewState:e}),this.controller.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,n=void 0!==e&&e;n!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=n,this.props.getCursor&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState)))}},{key:"_onRendererInitialized",value:function(t){var e=t.gl,n=t.canvas;Object(s.u)(e,{blend:!0,blendFunc:[s.g.SRC_ALPHA,s.g.ONE_MINUS_SRC_ALPHA,s.g.ONE,s.g.ONE_MINUS_SRC_ALPHA],polygonOffsetFill:!0,depthTest:!0,depthFunc:s.g.LEQUAL}),this.props.onWebGLInitialized(e),this.eventManager=new hr(n),this.controller&&this.controller.setProps({eventManager:this.eventManager}),this.layerManager=new cn(e,{eventManager:this.eventManager,stats:this.stats}),this.effectManager=new fn({gl:e,layerManager:this.layerManager});var r=!0,i=!1,o=void 0;try{for(var a,u=this.props.effects[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;this.effectManager.addEffect(l)}}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}this.setProps(this.props),this._updateCanvasSize()}},{key:"_onRenderFrame",value:function(t){var e=t.gl;if(this.stats.oneSecondPassed()){var n=this.stats.getStatsTable();this.stats.reset(),i.a.table(1,n)()}this._updateCanvasSize(),this.layerManager.updateLayers(),this.stats.bump("fps");var r=this.layerManager.needsRedraw({clearRedrawFlags:!0});r&&(this.stats.bump("render-fps"),this.props.onBeforeRender&&this.props.onBeforeRender({gl:e}),this.layerManager.drawLayers({pass:"screen",redrawReason:r,drawPickingColors:this.props.drawPickingColors}),this.props.onAfterRender&&this.props.onAfterRender({gl:e}))}}])&&oi(e.prototype,n),r&&oi(e,r),t}();function hi(t){return(hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pi(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function fi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function di(t,e){return!e||"object"!==hi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function vi(t,e){return(vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}ci.displayName="Deck",ci.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,controller:t.func,onViewStateChange:t.func,effects:t.arrayOf(t.instanceOf(yn)),glOptions:t.object,gl:t.object,pickingRadius:t.number,onWebGLInitialized:t.func,onResize:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLayerClick:t.func,onLayerHover:t.func,useDevicePixels:t.bool,debug:t.bool,drawPickingColors:t.bool}},ci.defaultProps=si;var gi=function(t){function e(t){return pi(this,e),di(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");vi(t.prototype,e&&e.prototype),e&&vi(t,e)}(e,t),n=e,(r=[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"getSubLayerProps",value:function(t){var e=this.props,n={opacity:e.opacity,pickable:e.pickable,visible:e.visible,parameters:e.parameters,getPolygonOffset:e.getPolygonOffset,highlightedObjectIndex:e.highlightedObjectIndex,autoHighlight:e.autoHighlight,highlightColor:e.highlightColor,coordinateSystem:e.coordinateSystem,coordinateOrigin:e.coordinateOrigin,modelMatrix:e.modelMatrix};return t&&Object.assign(n,t,{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers)}),n}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?i.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=_(t=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=t,i.a.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,n=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0)o.value.parent=this}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"isComposite",get:function(){return!0}}])&&fi(n.prototype,r),o&&fi(n,o),e}(Rt);gi.layerName="CompositeLayer";var yi=n(723),mi=n(758),_i=n(757);function bi(t){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xi(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function wi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ei(t,e){return!e||"object"!==bi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Si(t,e){return(Si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ai=Qt.e.SphericalCoordinates;var Ti=function(t){function e(){return xi(this,e),Ei(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Si(t.prototype,e&&e.prototype),e&&Si(t,e)}(e,t),n=e,(r=[{key:"_getViewport",value:function(t){var e=t.viewState,n=e.modelMatrix,r=void 0===n?null:n,i=e.bearing,o=e.up,a=void 0===o?[0,0,1]:o,s=function(t){var e=t.bearing,n=t.pitch;return new Ai({bearing:e,pitch:n}).toVector3().normalize()}({bearing:i,pitch:89}),u=r?r.transformDirection(s):s,l=(new Qt.a).lookAt({eye:[0,0,0],center:u,up:a});return new ve(Object.assign({},t,{zoom:null,viewMatrix:l}))}}])&&wi(n.prototype,r),i&&wi(n,i),e}(we);function Pi(t){return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ki(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Ci(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Oi(t,e){return!e||"object"!==Pi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ii(t,e){return(Ii=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Ti.displayName="FirstPersonView";var Mi=Qt.e.SphericalCoordinates;var Ri=function(t){function e(){return ki(this,e),Oi(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Ii(t.prototype,e&&e.prototype),e&&Ii(t,e)}(e,t),n=e,(r=[{key:"_getViewport",value:function(t){var e=t.viewState,n=e.bearing,r=e.pitch,i=e.position,o=e.up,a=50*e.zoom,s=function(t){var e=t.bearing,n=t.pitch;return new Mi({bearing:e,pitch:n}).toVector3().normalize()}({bearing:n,pitch:r}).scale(-a).multiply(new Qt.b(1,1,-1)),u=(new Qt.a).multiplyRight((new Qt.a).lookAt({eye:s,center:i,up:o}));return new ve(Object.assign({},t,{id:this.id,zoom:null,viewMatrix:u}))}}])&&Ci(n.prototype,r),i&&Ci(n,i),e}(we);Ri.displayName="ThirdPersonView";var Li=n(727),Fi=n.n(Li),Ni=n(728),ji=n.n(Ni),Di=n(745),zi=n.n(Di),Bi=n(765),Ui=n.n(Bi),Vi=n(746),Gi=n.n(Vi);function Wi(t){return(Wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Hi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function qi(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Zi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ki(t,e,n){return e&&Zi(t.prototype,e),n&&Zi(t,n),t}function Yi(t,e){return!e||"object"!==Wi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ji(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Qi(t.prototype,e&&e.prototype),e&&Qi(t,e)}function Qi(t,e){return(Qi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $i=Math.PI/180,to=function(t){function e(){return qi(this,e),Yi(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ji(e,t),Ki(e,[{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0!==n&&n,i=Jt(this.pixelProjectionMatrix,Hi(t).concat([1])),o=Xi(i,3),a=o[0],s=o[1],u=o[2],l=r?this.height-s:s;return[a,l,u]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0!==n&&n,i=Xi(t,3),o=i[0],a=i[1],s=i[2],u=r?this.height-a:a;return Jt(this.pixelUnprojectionMatrix,[o,u,s,1])}}]),e}(ve),eo=function(t){function e(){return qi(this,e),Yi(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return Ji(e,t),Ki(e,[{key:"_getViewport",value:function(t){var e=t.viewState,n=t.width||1,r=t.height||1,i=t.fov||t.fovy||e.fovy||75,o=t.near||e.near||1,a=t.far||e.far||100,s=Number.isFinite(e.aspect)?e.aspect:n/r,u=i*$i;return new to({id:this.id,viewMatrix:this._getViewMatrix(t.viewState),projectionMatrix:ji()([],u,s,o,a),x:t.x,y:t.y,width:n,height:r})}},{key:"_getViewMatrix",value:function(t){var e=t.distance,n=t.rotationX,r=void 0===n?0:n,i=t.rotationOrbit,o=void 0===i?0:i,a=t.orbitAxis,s=void 0===a?"Z":a,u=t.lookAt,l=void 0===u?[0,0,0]:u,c=t.up,h=void 0===c?[0,1,0]:c,p=t.zoom,f=void 0===p?1:p,d=zi()([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-r/180*Math.PI);"Z"===s?Gi()(d,d,-o/180*Math.PI):Ui()(d,d,-o/180*Math.PI);var v=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];te()(v,v,[f,f,f]),ne()(v,v,[-l[0],-l[1],-l[2]]);var g=Fi()([],[0,0,e],[0,0,0],h);return ie()(g,g,ie()(d,d,v)),g}},{key:"fitBounds",value:function(t,e){var n=this.width,r=this.height,i=this.fov,o=this.near,a=this.far;return this._getViewport({width:n,height:r,fov:i,near:o,far:a})}}],[{key:"getDistance",value:function(t){var e=t.boundingBox,n=t.fov;return Math.max(e[0],e[1],e[2])/2/Math.tan(n/180*Math.PI/2)}}]),e}(we);function no(t){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ro(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function io(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oo(t,e){return!e||"object"!==no(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ao(t,e){return(ao=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}eo.displayName="OrbitView";var so=Math.PI/180,uo=function(t){function e(){return ro(this,e),oo(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");ao(t.prototype,e&&e.prototype),e&&ao(t,e)}(e,t),n=e,(r=[{key:"_getViewport",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.viewState,a=o.eye,s=o.lookAt,u=void 0===s?[0,0,0]:s,l=o.up,c=void 0===l?[0,1,0]:l,h=t.fovy||o.fovy||75,p=t.near||o.near||1,f=t.far||o.far||100,d=Number.isFinite(o.aspect)?o.aspect:r/i,v=h*so;return new ve({id:this.id,x:e,y:n,width:r,height:i,viewMatrix:Fi()([],a,u,c),projectionMatrix:ji()([],v,d,p,f)})}}])&&io(n.prototype,r),i&&io(n,i),e}(we);function lo(t){return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function co(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ho(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function po(t,e){return!e||"object"!==lo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function fo(t,e){return(fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}uo.displayName="PerspectiveView";var vo=function(t){function e(){return co(this,e),po(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");fo(t.prototype,e&&e.prototype),e&&fo(t,e)}(e,t),n=e,(r=[{key:"_getViewport",value:function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.viewState,a=o.eye,s=void 0===a?[0,0,1]:a,u=o.lookAt,l=void 0===u?[0,0,0]:u,c=o.up,h=void 0===c?[0,1,0]:c;r=r||1,i=i||1;var p=this.props,f=p.left,d=void 0===f?-r/2:f,v=p.top,g=void 0===v?-i/2:v,y=p.near,m=void 0===y?1:y,_=p.far,b=void 0===_?100:_,x=this.props,w=x.right,E=void 0===w?null:w,S=x.bottom,A=void 0===S?null:S;return E=Number.isFinite(E)?E:d+r,A=Number.isFinite(A)?A:g+i,new ve({id:this.id,x:e,y:n,width:r,height:i,viewMatrix:(new Qt.a).lookAt({eye:s,lookAt:l,up:h}),projectionMatrix:(new Qt.a).ortho({left:d,right:E,bottom:A,top:g,near:m,far:b})})}}])&&ho(n.prototype,r),i&&ho(n,i),e}(we);function go(t){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function mo(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function _o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bo(t,e){return!e||"object"!==go(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function xo(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");wo(t.prototype,e&&e.prototype),e&&wo(t,e)}function wo(t,e){return(wo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}vo.displayName="OrthographicView";function Eo(t,e){return Number.isFinite(t)?t:e}var So=function(t){function e(t){var n,r=t.width,i=t.height,o=t.position,a=t.bearing,s=t.pitch,u=t.longitude,l=t.latitude,c=t.zoom,h=(t.syncBearing,t.bounds,t.startPanEventPosition),p=t.startPanPosition,f=t.startRotateCenter,d=t.startRotateViewport,v=t.startZoomPos,g=t.startZoom;return mo(this,e),(n=bo(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{width:r,height:i,position:o,bearing:a,pitch:s,longitude:u,latitude:l,zoom:c})))._interactiveState={startPanEventPosition:h,startPanPosition:p,startRotateCenter:f,startRotateViewport:d,startZoomPos:v,startZoom:g},n}var n,r,i;return xo(e,t),n=e,(r=[{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,n=this._viewportProps,r=n.translationX,i=n.translationY;return this._getUpdatedState({startPanPosition:[r,i],startPanEventPosition:e})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._interactiveState.startPanEventPosition||n;Object(a.a)(r,"`startPanEventPosition` props is required");var i=yo(this._interactiveState.startPanPosition||[],2),o=i[0],s=i[1];o=Eo(o,this._viewportProps.translationX),s=Eo(s,this._viewportProps.translationY);var u=e[0]-r[0],l=e[1]-r[1];return this._getUpdatedState({translationX:o+u,translationY:s-l})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}},{key:"rotateStart",value:function(t){return t.pos,this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,r=this._viewportProps,i=r.bearing,o=r.pitch;return this._getUpdatedState({bearing:i+10*e,pitch:o-10*n})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale,i=this._viewportProps,o=i.zoom,a=i.minZoom,s=i.maxZoom,u=(i.width,i.height,i.translationX,i.translationY,this._interactiveState.startZoomPos||n||e),l=Object(Qt.c)(o*r,a,s);return e[0],u[0],e[1],u[1],u[0],u[1],l/o<1?this.moveBackward():this.moveForward()}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=this._viewportProps.bearing-2;return this._getUpdatedState({bearing:t})}},{key:"moveRight",value:function(){var t=this._viewportProps.bearing+2;return this._getUpdatedState({bearing:t})}},{key:"moveForward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),n=new Qt.b(e).normalize().scale(1);return this._getUpdatedState({position:new Qt.b(t).add(n)})}},{key:"moveBackward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),n=new Qt.b(e).normalize().scale(-1);return this._getUpdatedState({position:new Qt.b(t).add(n)})}},{key:"moveUp",value:function(){var t=this._viewportProps.position;return this._getUpdatedState({position:new Qt.b(t).add([0,0,1])})}},{key:"moveDown",value:function(){var t=this._viewportProps.position,e=t[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new Qt.b(t).add(e)})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}}])&&_o(n.prototype,r),i&&_o(n,i),e}(Vr),Ao=function(t){function e(t){return mo(this,e),bo(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,So,t))}return xo(e,t),e}(jr);function To(t){return(To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Po(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ko(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Co(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Oo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Io(t,e){return!e||"object"!==To(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Mo(t,e){return(Mo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ro=Math.PI/180,Lo=function(t){function e(t){var n,r=t.id,i=void 0===r?"orbit-viewport":r,o=t.width,a=t.height,s=t.distance,u=t.rotationX,l=void 0===u?0:u,c=t.rotationOrbit,h=void 0===c?0:c,p=t.orbitAxis,f=void 0===p?"Z":p,d=t.lookAt,v=void 0===d?[0,0,0]:d,g=t.up,y=void 0===g?[0,1,0]:g,m=t.fov,_=void 0===m?75:m,b=t.near,x=void 0===b?1:b,w=t.far,E=void 0===w?100:w,S=t.zoom,A=void 0===S?1:S;Co(this,e);var T=zi()([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],-l/180*Math.PI);"Z"===f?Gi()(T,T,-h/180*Math.PI):Ui()(T,T,-h/180*Math.PI);var P=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];te()(P,P,[A,A,A]),ne()(P,P,[-v[0],-v[1],-v[2]]);var k=Fi()([],[0,0,s],[0,0,0],y),C=_*Ro,O=o/a,I=ji()([],C,O,x,E);return(n=Io(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{id:i,viewMatrix:ie()(k,k,ie()(T,T,P)),projectionMatrix:I,width:o,height:a}))).width=o,n.height=a,n.distance=s,n.rotationX=l,n.rotationOrbit=h,n.orbitAxis=f,n.lookAt=v,n.up=y,n.fov=_,n.near=x,n.far=E,n.zoom=A,n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Mo(t.prototype,e&&e.prototype),e&&Mo(t,e)}(e,t),n=e,(r=[{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0!==n&&n,i=Jt(this.pixelProjectionMatrix,ko(t).concat([1])),o=Po(i,3),a=o[0],s=o[1],u=o[2],l=r?this.height-s:s;return[a,l,u]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0!==n&&n,i=Po(t,3),o=i[0],a=i[1],s=i[2],u=r?this.height-a:a;return Jt(this.pixelUnprojectionMatrix,[o,u,s,1])}},{key:"getDistance",value:function(t){var e=t.boundingBox,n=t.fov;return Math.max(e[0],e[1],e[2])/2/Math.tan(n/180*Math.PI/2)}},{key:"fitBounds",value:function(t){var n=this.width,r=this.height,i=this.rotationX,o=this.rotationOrbit,a=this.orbitAxis,s=this.lookAt,u=this.up,l=this.fov;return new e({width:n,height:r,rotationX:i,rotationOrbit:o,orbitAxis:a,up:u,fov:l,near:this.near,far:this.far,zoom:this.zoom,lookAt:s,distance:this.getDistance({boundingBox:t,fov:l})})}}])&&Oo(n.prototype,r),i&&Oo(n,i),e}(ve);function Fo(t){return(Fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function No(t,e){return!e||"object"!==Fo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jo(t,e){return(jo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Do(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function zo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Lo.displayName="OrbitViewport";var Bo={lookAt:[0,0,0],rotationX:0,rotationOrbit:0,fov:50,near:1,far:100,translationX:0,translationY:0,zoom:1},Uo={minZoom:0,maxZoom:1/0};function Vo(t,e){return Number.isFinite(t)?t:e}var Go=function(){function t(e){var n=e.width,r=e.height,i=e.distance,o=e.rotationX,s=e.rotationOrbit,u=e.orbitAxis,l=e.bounds,c=e.lookAt,h=e.fov,p=e.near,f=e.far,d=e.translationX,v=e.translationY,g=e.zoom,y=e.minZoom,m=e.maxZoom,_=e.startPanViewport,b=e.startPanPos,x=e.isPanning,w=e.startRotateViewport,E=e.isRotating,S=e.startZoomViewport,A=e.startZoomPos;Do(this,t),Object(a.a)(Number.isFinite(n),"`width` must be supplied"),Object(a.a)(Number.isFinite(r),"`height` must be supplied"),Object(a.a)(Number.isFinite(i),"`distance` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:r,distance:i,rotationX:Vo(o,Bo.rotationX),rotationOrbit:Vo(s,Bo.rotationOrbit),orbitAxis:u,bounds:l,lookAt:c||Bo.lookAt,fov:Vo(h,Bo.fov),near:Vo(p,Bo.near),far:Vo(f,Bo.far),translationX:Vo(d,Bo.translationX),translationY:Vo(v,Bo.translationY),zoom:Vo(g,Bo.zoom),minZoom:Vo(y,Uo.minZoom),maxZoom:Vo(m,Uo.maxZoom)}),this._interactiveState={startPanViewport:_,startPanPos:b,isPanning:x,startRotateViewport:w,isRotating:E,startZoomViewport:S,startZoomPos:A}}var e,n,r;return e=t,(n=[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,n=new Lo(this._viewportProps);return this._getUpdatedOrbitState({startPanPos:e,startPanViewport:n})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos;if(this._interactiveState.isRotating)return this._getUpdatedOrbitState();var r=this._interactiveState.startPanPos||n;Object(a.a)(r,"`startPanPos` props is required");var i=this._interactiveState.startPanViewport||new Lo(this._viewportProps),o=e[0]-r[0],s=e[1]-r[1],u=i.project(i.lookAt),l=i.unproject([u[0]-o,u[1]-s,u[2]]);return this._getUpdatedOrbitState({lookAt:l,isPanning:!0})}},{key:"panEnd",value:function(){return this._getUpdatedOrbitState({startPanViewport:null,startPanPos:null,isPanning:null})}},{key:"rotateStart",value:function(t){t.pos;var e=new Lo(this._viewportProps);return this._getUpdatedOrbitState({startRotateViewport:e})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY;if(this._interactiveState.isPanning)return this._getUpdatedOrbitState();var r=this._interactiveState.startRotateViewport||{},i=r.rotationX,o=r.rotationOrbit;i=Vo(i,this._viewportProps.rotationX),o=Vo(o,this._viewportProps.rotationOrbit);var a=Object(Qt.c)(i-180*n,-89.999,89.999),s=(o-180*e)%360;return this._getUpdatedOrbitState({rotationX:a,rotationOrbit:s,isRotating:!0})}},{key:"rotateEnd",value:function(){return this._getUpdatedOrbitState({startRotateViewport:null,isRotating:null})}},{key:"zoomStart",value:function(t){var e=t.pos,n=new Lo(this._viewportProps);return this._getUpdatedOrbitState({startZoomViewport:n,startZoomPos:e})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale,i=this._viewportProps,o=i.zoom,a=i.minZoom,s=i.maxZoom,u=i.width,l=i.height,c=this._interactiveState.startZoomPos||n||e,h=this._interactiveState.startZoomViewport||new Lo(this._viewportProps),p=Object(Qt.c)(o*r,a,s),f=e[0]-c[0],d=e[1]-c[1],v=c[0]-u/2,g=l/2-c[1],y=h.project(h.lookAt),m=y[0]-v+v*p/o+f,_=y[1]+g-g*p/o-d,b=h.unproject([m,_,y[2]]);return this._getUpdatedOrbitState({lookAt:b,zoom:p})}},{key:"zoomEnd",value:function(){return this._getUpdatedOrbitState({startZoomPos:null})}},{key:"_getUpdatedOrbitState",value:function(e){return new t(Object.assign({},this._viewportProps,this._interactiveState,e))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,r=t.zoom;return t.zoom=r>e?e:r,t.zoom=r<n?n:r,t}}])&&zo(e.prototype,n),r&&zo(e,r),t}(),Wo=function(t){function e(t){return Do(this,e),No(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Go,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");jo(t.prototype,e&&e.prototype),e&&jo(t,e)}(e,t),e}(jr),Xo=n(850),Ho=n(749),qo=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(ke.a)(this,e),t=Object(Oe.a)(this,Object(Ie.a)(e).call(this,2)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r),t}return Object(Me.a)(e,t),Object(Ce.a)(e,[{key:"cross",value:function(t){return Ho.b(this,this,t),this.check()}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}(Xo.a),Zo=.01,Ko=["longitude","latitude","zoom"];function Yo(t){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jo(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Qo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $o(t,e){return!e||"object"!==Yo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ta(t,e){return(ta=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ea=["bearing","pitch"],na=function(t){function e(){return Jo(this,e),$o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");ta(t.prototype,e&&e.prototype),e&&ta(t,e)}(e,t),n=e,(r=[{key:"interpolateProps",value:function(t,e,n){for(var r=function(t,e,n){var r={},i=t.zoom,o=[t.longitude,t.latitude],a=Object(se.l)(i),s=e.zoom,u=[e.longitude,e.latitude],l=Object(se.l)(s-i),c=new qo(Object(se.g)(o,a)),h=new qo(Object(se.g)(u,a)).subtract(c),p=Math.max(t.width,t.height),f=p/l,d=Math.sqrt(h.x*h.x+h.y*h.y);if(Math.abs(d)<Zo){for(var v=0;v<Ko.length;v++){var g=Ko[v],y=t[g],m=e[g];r[g]=Object(Fe.b)(y,m,n)}return r}var _=1.414*1.414,b=(f*f-p*p+_*_*d*d)/(2*p*_*d),x=(f*f-p*p-_*_*d*d)/(2*f*_*d),w=Math.log(Math.sqrt(b*b+1)-b),E=n*((Math.log(Math.sqrt(x*x+1)-x)-w)/1.414),S=Math.cosh(w)/Math.cosh(w+1.414*E),A=p*((Math.cosh(w)*Math.tanh(w+1.414*E)-Math.sinh(w))/_)/d,T=1/S,P=i+Object(se.i)(T),k=Object(se.j)(c.add(h.scale(A)).scale(T),Object(se.l)(P));return r.longitude=k[0],r.latitude=k[1],r.zoom=P,r}(t,e,n),i=0;i<ea.length;i++){var o=ea[i];r[o]=Object(Qt.f)(t[o]||0,e[o]||0,n)}return r}}])&&Qo(n.prototype,r),i&&Qo(n,i),e}(dr);function ra(t){return(ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ia(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function oa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function aa(t,e){return!e||"object"!==ra(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function sa(t,e){return(sa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ua=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return ia(this,e),(t=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).reflectivity=n,t.blur=r,t.framebuffer=null,t.setNeedsRedraw(),t}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");sa(t.prototype,e&&e.prototype),e&&sa(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME reflection-effect-vs\n\nattribute vec3 vertices;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  uv = vertices.xy;\n  gl_Position = vec4(2. * vertices.xy - vec2(1., 1.), 1., 1.);\n}\n",fs:'#define SHADER_NAME reflection-effect-fs\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D reflectionTexture;\nuniform int reflectionTextureWidth;\nuniform int reflectionTextureHeight;\n\nuniform float reflectivity;\nuniform float blur;\n\n\nvarying vec2 uv;\n\n#define KERNEL_SIZE 7\n\n/*\n * Samples from tex with a gaussian-shaped patch, centered at uv and\n * with standard deviation sigma.  The size of the texture in\n * pixels must be specified by dim\n */\nvec4 sample_gaussian(sampler2D tex, vec2 dim, vec2 uv, float sigma) {\n  if (sigma == 0.0) {\n    return texture2D(tex, uv);\n  }\n\n  vec2 delta = 1.0 / dim;\n  vec2 top_left = uv - delta * float(KERNEL_SIZE+1) / 2.0;\n\n  vec4 color = vec4(0);\n  float sum = 0.0;\n  for (int i = 0; i <  KERNEL_SIZE; ++i) {\n    for (int j = 0; j < KERNEL_SIZE; ++j) {\n      vec2 uv2 = top_left + vec2(i, j) * delta;\n      float d = length((uv2 - uv) * dim);\n      float f = exp(-(d*d) / (2.0*sigma * sigma));\n      color += f * texture2D(tex, uv2);\n      sum += f;\n    }\n  }\n  return color / sum;\n}\n\nvoid main(void) {\n  //map blur in [0, 1] to sigma in [0, inf]\n  //alpha will determine the "steepness" of our curve.\n  //this was picked just to make the scale feel "natural"\n  //if our image is 1000 pixels wide, a blur of 0.5 should correspond\n  //to a sigma of 1 pixels\n  float alpha = 1000.0;\n  float sigma = blur / (alpha * (1.0 - blur));\n  //let this be our standard deviation in terms of screen-widths.\n  //rewrite this in terms of pixels.\n  sigma *= float(reflectionTextureWidth);\n\n\n  gl_FragColor = sample_gaussian(reflectionTexture, vec2(reflectionTextureWidth,\n    reflectionTextureHeight), vec2(uv.x, 1. - uv.y), sigma);\n  //because our canvas expects alphas to be pre-multiplied, we multiply by whole\n  //color vector by reflectivity, not just the alpha channel\n  gl_FragColor *= reflectivity;\n}\n',modules:[],shaderCache:this.context.shaderCache}}},{key:"initialize",value:function(t){var e=t.gl;t.layerManager,this.unitQuad=new s.i(e,Object.assign({},this.getShaders(),{id:"reflection-effect",geometry:new s.h({drawMode:s.g.TRIANGLE_FAN,vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])})})),this.framebuffer=new s.f(e,{depth:!0})}},{key:"preDraw",value:function(t){var e=t.gl,n=t.layerManager,r=n.context.viewport,i="undefined"!=typeof window&&window.devicePixelRatio||1;this.framebuffer.resize({width:i*r.width,height:i*r.height});var o=r.pitch;this.framebuffer.bind(),n.setViewport(new Je(Object.assign({},r,{pitch:-180-o}))),e.clear(s.g.COLOR_BUFFER_BIT|s.g.DEPTH_BUFFER_BIT),n.drawLayers({pass:"reflection"}),n.setViewport(r),this.framebuffer.unbind()}},{key:"draw",value:function(t){t.gl,t.layerManager,this.unitQuad.render({reflectionTexture:this.framebuffer.texture,reflectionTextureWidth:this.framebuffer.width,reflectionTextureHeight:this.framebuffer.height,reflectivity:this.reflectivity,blur:this.blur})}},{key:"finalize",value:function(t){t.gl,t.layerManager}}])&&oa(n.prototype,r),i&&oa(n,i),e}(yn);function la(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ca(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ha(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pa=function(t){return t.length},fa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pa;ca(this,t),this.sortedBins=this.getSortedBins(e,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}var e,n,r;return e=t,(n=[{key:"getSortedBins",value:function(t,e){return t.reduce((function(t,n,r){var i=e(n.points);return null!=i&&t.push({i:Number.isFinite(n.index)?n.index:r,value:i,counts:n.points.length}),t}),[]).sort((function(t,e){return t.value-e.value}))}},{key:"getValueRange",value:function(t){var e=la(t,2),n=e[0],r=e[1],i=this.sortedBins.length;if(!i)return[0,0];var o=Math.ceil(n/100*(i-1)),a=Math.floor(r/100*(i-1));return[this.sortedBins[o].value,this.sortedBins[a].value]}},{key:"getMaxCount",value:function(){var t=0;return this.sortedBins.forEach((function(e){return t=t>e.counts?t:e.counts})),t}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(t,e){return Object.assign(t,(n={},r=e.i,i=e,r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n));var n,r,i}),{})}}])&&ha(e.prototype,n),r&&ha(e,r),t}();function da(t,e,n){var r=t[1]-t[0];if(r<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]"),e[0];var o=r/e.length,a=Math.floor((n-t[0])/o);return e[Math.max(Math.min(a,e.length-1),0)]}function va(t){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ga(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ya(t,e){return!e||"object"!==va(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ma(t,e){return(ma=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _a=Math.PI/180,ba=function(t){function e(t){var n=t.width,r=t.height,o=t.eye,a=t.lookAt,s=void 0===a?[0,0,0]:a,u=t.up,l=void 0===u?[0,1,0]:u,c=t.fovy,h=void 0===c?75:c,p=t.near,f=void 0===p?1:p,d=t.far,v=void 0===d?100:d,g=t.aspect,y=void 0===g?null:g;ga(this,e),i.a.deprecated("PerspectiveViewport","PerspectiveView")();var m=h*_a;return y=Number.isFinite(y)?y:n/r,ya(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{viewMatrix:Fi()([],o,s,l),projectionMatrix:ji()([],m,y,f,v),width:n,height:r}))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");ma(t.prototype,e&&e.prototype),e&&ma(t,e)}(e,t),e}(ve),xa=n(802),wa=n.n(xa);function Ea(t){return(Ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sa(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Aa(t,e){return!e||"object"!==Ea(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ta(t,e){return(Ta=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Pa=function(t){function e(t){var n=t.width,r=t.height,o=t.eye,a=void 0===o?[0,0,1]:o,s=t.lookAt,u=void 0===s?[0,0,0]:s,l=t.up,c=void 0===l?[0,1,0]:l,h=t.near,p=void 0===h?1:h,f=t.far,d=void 0===f?100:f,v=t.left,g=t.top,y=t.right,m=void 0===y?null:y,_=t.bottom,b=void 0===_?null:_;return Sa(this,e),i.a.deprecated("OrthographicViewport","OrthographicView")(),m=Number.isFinite(m)?m:v+n,b=Number.isFinite(b)?b:g+r,Aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{viewMatrix:Fi()([],a,u,c),projectionMatrix:wa()([],v,m,b,g,p,d),width:n,height:r}))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Ta(t.prototype,e&&e.prototype),e&&Ta(t,e)}(e,t),e}(ve);function ka(t){return(ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ca(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Oa(t,e){return!e||"object"!==ka(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ia(t,e){return(Ia=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ma=Qt.e.SphericalCoordinates;var Ra=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ca(this,e),i.a.deprecated("FirstPersonViewport","FirstPersonView")();var n=t.modelMatrix,r=void 0===n?null:n,o=t.bearing,a=t.up,s=void 0===a?[0,0,1]:a,u=function(t){var e=t.bearing,n=t.pitch;return new Ma({bearing:e,pitch:n}).toVector3().normalize()}({bearing:o,pitch:89}),l=r?r.transformDirection(u):u,c=(new Qt.a).lookAt({eye:[0,0,0],center:l,up:s});return Oa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{zoom:null,viewMatrix:c})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Ia(t.prototype,e&&e.prototype),e&&Ia(t,e)}(e,t),e}(ve);function La(t){return(La="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fa(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Na(t,e){return!e||"object"!==La(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ja(t,e){return(ja=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Da=Qt.e.SphericalCoordinates;var za=function(t){function e(t){Fa(this,e),i.a.deprecated("ThirdPersonViewport","ThirdPersonView")();var n=t.bearing,r=t.pitch,o=t.position,a=t.up,s=50*t.zoom,u=function(t){var e=t.bearing,n=t.pitch;return new Da({bearing:e,pitch:n}).toVector3().normalize()}({bearing:n,pitch:r}).scale(-s).multiply(new Qt.b(1,1,-1)),l=(new Qt.a).multiplyRight((new Qt.a).lookAt({eye:u,center:o,up:a}));return Na(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{zoom:null,viewMatrix:l})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");ja(t.prototype,e&&e.prototype),e&&ja(t,e)}(e,t),e}(ve);n.d(e,"experimental",(function(){return Ba})),n.d(e,"COORDINATE_SYSTEM",(function(){return o.a})),n.d(e,"Deck",(function(){return ci})),n.d(e,"LayerManager",(function(){return cn})),n.d(e,"AttributeManager",(function(){return z})),n.d(e,"Layer",(function(){return Rt})),n.d(e,"CompositeLayer",(function(){return gi})),n.d(e,"Viewport",(function(){return ve})),n.d(e,"WebMercatorViewport",(function(){return Je})),n.d(e,"project",(function(){return yi.a})),n.d(e,"project64",(function(){return mi.a})),n.d(e,"lighting",(function(){return _i.a})),n.d(e,"View",(function(){return we})),n.d(e,"MapView",(function(){return nn})),n.d(e,"FirstPersonView",(function(){return Ti})),n.d(e,"ThirdPersonView",(function(){return Ri})),n.d(e,"OrbitView",(function(){return eo})),n.d(e,"PerspectiveView",(function(){return uo})),n.d(e,"OrthographicView",(function(){return vo})),n.d(e,"Controller",(function(){return jr})),n.d(e,"MapController",(function(){return ri})),n.d(e,"log",(function(){return i.a})),n.d(e,"PerspectiveViewport",(function(){return ba})),n.d(e,"OrthographicViewport",(function(){return Pa}));var Ba={FirstPersonController:Ao,OrbitController:Wo,FirstPersonViewport:Ra,ThirdPersonViewport:za,OrbitViewport:Lo,EffectManager:fn,Effect:yn,TRANSITION_EVENTS:Ar,LinearInterpolator:xr,ViewportFlyToInterpolator:na,BinSorter:fa,linearScale:function(t,e,n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]},getLinearScale:function(t,e){return function(n){return(n-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}},quantizeScale:da,getQuantizeScale:function(t,e){return function(n){return da(t,e,n)}},defaultColorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],flattenVertices:function t(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.result,i=void 0===r?[]:r,o=n.dimensions,a=void 0===o?3:o,s=-1,u=0;++s<e.length;){var l=e[s];Array.isArray(l)||ArrayBuffer.isView(l)?t(l,{result:i,dimensions:a}):u<a&&(i.push(l),u++)}return u>0&&u<a&&i.push(0),i},fillArray:b,ReflectionEffect:ua}},686:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return r}))},687:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",(function(){return i}))},689:function(t,e,n){"use strict";var r=n(726),i=n(734);function o(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}var a=null;if(!i.a){try{a=n(762)}catch(t){console.error("".concat(t.message))}console.warn(a&&a.WebGLRenderingContext)}var s=function t(){o(this,t)},u=a||r.a,l=u.WebGLRenderingContext,c=void 0===l?s:l,h=(u.WebGLProgram,u.WebGLShader,u.WebGLBuffer),p=void 0===h?s:h;u.WebGLFramebuffer,u.WebGLRenderbuffer,u.WebGLTexture,u.WebGLUniformLocation,u.WebGLActiveInfo,u.WebGLShaderPrecisionFormat;var f=r.a.WebGL2RenderingContext||function t(){o(this,t)};r.a.Image;function d(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function v(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var g=35632,y=35633;function m(t){var e=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return e?e[1]:"unnamed"}function _(t,e,n){for(var r=t.split(/\r?\n/),i={},o={},a=m(e)||"(unnamed)",s="".concat(function(t){switch(t){case g:return"fragment";case y:return"vertex";default:return"unknown type"}}(n)," shader ").concat(a),u=0;u<r.length;u++){var l=r[u];if(!(l.length<=1)){var c=l.split(":"),h=c[0],p=parseInt(c[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(s,": ").concat(t));"WARNING"!==h?i[p]=l:o[p]=l}}var f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((function(t,r){var o=r+e,a=String(o).length;return x(o,i-a)+n+t}))}(e);return{shaderName:s,errors:b(i,f),warnings:b(o,f)}}function b(t,e){for(var n="",r=0;r<e.length;r++){var i=e[r];if((t[r+3]||t[r+2]||t[r+1])&&(n+="".concat(i,"\n"),t[r+1])){var o=t[r+1],a=o.split(":",3),s=a[0],u=parseInt(a[1],10)||0,l=o.substring(a.join(":").length+1).trim();n+=x("^^^ ".concat(s,": ").concat(l,"\n\n"),u)}}return n}function x(t,e){for(var n="",r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}var w=5120,E=5121,S=5122,A=5123,T=5124,P=5125,k=5126,C=32819,O=32820,I=33635,M="Failed to deduce GL constant from typed array";function R(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return k;case Uint16Array:return A;case Uint32Array:return P;case Uint8Array:case Uint8ClampedArray:return E;case Int8Array:return w;case Int16Array:return S;case Int32Array:return T;default:throw new Error(M)}}function L(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,n=void 0===e||e;switch(t){case k:return Float32Array;case A:case I:case C:case O:return Uint16Array;case P:return Uint32Array;case E:return n?Uint8ClampedArray:Uint8Array;case w:return Int8Array;case S:return Int16Array;case T:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function F(t){var e=t.data,n=t.width,r=t.height,i=t.bytesPerPixel,o=void 0===i?4:i,a=t.temp,s=n*o;a=a||new Uint8Array(s);for(var u=0;u<r/2;++u){var l=u*s,c=(r-u-1)*s;a.set(e.subarray(l,l+s)),e.copyWithin(l,c,c+s),e.set(a,c)}}function N(t){for(var e=t.data,n=t.width,r=t.height,i=Math.round(n/2),o=Math.round(r/2),a=new Uint8Array(i*o*4),s=0;s<o;s++)for(var u=0;u<i;u++)for(var l=0;l<4;l++)a[4*(s*i+u)+l]=e[4*(2*s*n+2*u)+l];return{data:a,width:i,height:o}}function j(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function D(t,e){if("string"!=typeof e)return e;var n=Number(e);if(!isNaN(n))return n;var r=t[e=e.replace(/^.*\./,"")];return j(void 0!==r,"Accessing undefined constant GL.".concat(e)),r}function z(t,e){for(var n in e=Number(e),t)if(t[n]===e)return"gl.".concat(n);return String(e)}var B=n(691),U=n.n(B);function V(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}var G=34962,W=32874,X="Invalid WebGLRenderingContext",H="Requires WebGL2";function q(t){return Boolean(t&&(V(t,c)||t.ARRAY_BUFFER===G))}function Z(t){return Boolean(t&&(V(t,f)||t.TEXTURE_BINDING_3D===W))}function K(t){j(q(t),X)}function Y(t){j(Z(t),H)}var J="Failed to create WebGL context in Node.js, headless gl not available",Q="Failed to create WebGL context in Node.js, headless gl returned null",$=null;if(!i.a)try{$=n(763)}catch(t){console.error(),console.error("".concat('WebGL not available in Node.js, install using "npm install gl".',"\n").concat(t.message))}i.a;var tt={};function et(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";tt[t]=tt[t]||1;var e=tt[t]++;return"".concat(t,"-").concat(e)}function nt(t){return j("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function rt(t){var e=!0;for(var n in t){e=!1;break}return e}var it=n(761);function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.isInteger,r=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){for(var n=e.maxElts,r=void 0===n?16:n,i=e.size,o=void 0===i?1:i,a="[",s=0;s<t.length&&s<r;++s)s>0&&(a+=",".concat(s%o==0?" ":"")),a+=ot(t[s],e);var u=t.length>r?"...":"]";return"".concat(a).concat(u)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return r?"0":"0.";if(r)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}var at,st,ut,lt=i.a&&"undefined"!=typeof document,ct=lt&&"complete"===document.readyState,ht=lt?new Promise((function(t,e){ct?t(document):window.onload=function(){ct=!0,t(document)}})):Promise.resolve({});function pt(){return ht}function ft(t){var e=t.width,n=void 0===e?800:e,r=t.height,i=void 0===r?600:r,o=t.id,a=void 0===o?"gl-canvas":o,s=t.insert,u=void 0===s||s,l=document.createElement("canvas");return l.id=a,l.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",l.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",u&&pt().then((function(t){var e=t.body;e.insertBefore(l,e.firstChild)})),l}function dt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function vt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var gt,yt=(vt(at={},U.a.BLEND,!1),vt(at,U.a.BLEND_COLOR,new Float32Array([0,0,0,0])),vt(at,U.a.BLEND_EQUATION_RGB,U.a.FUNC_ADD),vt(at,U.a.BLEND_EQUATION_ALPHA,U.a.FUNC_ADD),vt(at,U.a.BLEND_SRC_RGB,U.a.ONE),vt(at,U.a.BLEND_DST_RGB,U.a.ZERO),vt(at,U.a.BLEND_SRC_ALPHA,U.a.ONE),vt(at,U.a.BLEND_DST_ALPHA,U.a.ZERO),vt(at,U.a.COLOR_CLEAR_VALUE,new Float32Array([0,0,0,0])),vt(at,U.a.COLOR_WRITEMASK,[!0,!0,!0,!0]),vt(at,U.a.CULL_FACE,!1),vt(at,U.a.CULL_FACE_MODE,U.a.BACK),vt(at,U.a.DEPTH_TEST,!1),vt(at,U.a.DEPTH_CLEAR_VALUE,1),vt(at,U.a.DEPTH_FUNC,U.a.LESS),vt(at,U.a.DEPTH_RANGE,new Float32Array([0,1])),vt(at,U.a.DEPTH_WRITEMASK,!0),vt(at,U.a.DITHER,!0),vt(at,U.a.FRAMEBUFFER_BINDING,null),vt(at,U.a.FRONT_FACE,U.a.CCW),vt(at,U.a.GENERATE_MIPMAP_HINT,U.a.DONT_CARE),vt(at,U.a.LINE_WIDTH,1),vt(at,U.a.POLYGON_OFFSET_FILL,!1),vt(at,U.a.POLYGON_OFFSET_FACTOR,0),vt(at,U.a.POLYGON_OFFSET_UNITS,0),vt(at,U.a.SAMPLE_COVERAGE_VALUE,1),vt(at,U.a.SAMPLE_COVERAGE_INVERT,!1),vt(at,U.a.SCISSOR_TEST,!1),vt(at,U.a.SCISSOR_BOX,new Int32Array([0,0,1024,1024])),vt(at,U.a.STENCIL_TEST,!1),vt(at,U.a.STENCIL_CLEAR_VALUE,0),vt(at,U.a.STENCIL_WRITEMASK,4294967295),vt(at,U.a.STENCIL_BACK_WRITEMASK,4294967295),vt(at,U.a.STENCIL_FUNC,U.a.ALWAYS),vt(at,U.a.STENCIL_REF,0),vt(at,U.a.STENCIL_VALUE_MASK,4294967295),vt(at,U.a.STENCIL_BACK_FUNC,U.a.ALWAYS),vt(at,U.a.STENCIL_BACK_REF,0),vt(at,U.a.STENCIL_BACK_VALUE_MASK,4294967295),vt(at,U.a.STENCIL_FAIL,U.a.KEEP),vt(at,U.a.STENCIL_PASS_DEPTH_FAIL,U.a.KEEP),vt(at,U.a.STENCIL_PASS_DEPTH_PASS,U.a.KEEP),vt(at,U.a.STENCIL_BACK_FAIL,U.a.KEEP),vt(at,U.a.STENCIL_BACK_PASS_DEPTH_FAIL,U.a.KEEP),vt(at,U.a.STENCIL_BACK_PASS_DEPTH_PASS,U.a.KEEP),vt(at,U.a.VIEWPORT,new Int32Array([0,0,1024,1024])),vt(at,U.a.PACK_ALIGNMENT,4),vt(at,U.a.UNPACK_ALIGNMENT,4),vt(at,U.a.UNPACK_FLIP_Y_WEBGL,!1),vt(at,U.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),vt(at,U.a.UNPACK_COLORSPACE_CONVERSION_WEBGL,U.a.BROWSER_DEFAULT_WEBGL),vt(at,U.a.FRAGMENT_SHADER_DERIVATIVE_HINT,U.a.DONT_CARE),vt(at,U.a.READ_FRAMEBUFFER_BINDING,null),vt(at,U.a.RASTERIZER_DISCARD,!1),vt(at,U.a.PACK_ROW_LENGTH,0),vt(at,U.a.PACK_SKIP_PIXELS,0),vt(at,U.a.PACK_SKIP_ROWS,0),vt(at,U.a.UNPACK_ROW_LENGTH,0),vt(at,U.a.UNPACK_IMAGE_HEIGHT,0),vt(at,U.a.UNPACK_SKIP_PIXELS,0),vt(at,U.a.UNPACK_SKIP_ROWS,0),vt(at,U.a.UNPACK_SKIP_IMAGES,0),at),mt=function(t,e,n){return e?t.enable(n):t.disable(n)},_t=function(t,e,n){return t.hint(n,e)},bt=function(t,e,n){return t.pixelStorei(n,e)},xt=(vt(st={},U.a.BLEND,mt),vt(st,U.a.BLEND_COLOR,(function(t,e){return t.blendColor.apply(t,dt(e))})),vt(st,U.a.BLEND_EQUATION_RGB,"blendEquation"),vt(st,U.a.BLEND_EQUATION_ALPHA,"blendEquation"),vt(st,U.a.BLEND_SRC_RGB,"blendFunc"),vt(st,U.a.BLEND_DST_RGB,"blendFunc"),vt(st,U.a.BLEND_SRC_ALPHA,"blendFunc"),vt(st,U.a.BLEND_DST_ALPHA,"blendFunc"),vt(st,U.a.COLOR_CLEAR_VALUE,(function(t,e){return t.clearColor.apply(t,dt(e))})),vt(st,U.a.COLOR_WRITEMASK,(function(t,e){return t.colorMask.apply(t,dt(e))})),vt(st,U.a.CULL_FACE,mt),vt(st,U.a.CULL_FACE_MODE,(function(t,e){return t.cullFace(e)})),vt(st,U.a.DEPTH_TEST,mt),vt(st,U.a.DEPTH_CLEAR_VALUE,(function(t,e){return t.clearDepth(e)})),vt(st,U.a.DEPTH_FUNC,(function(t,e){return t.depthFunc(e)})),vt(st,U.a.DEPTH_RANGE,(function(t,e){return t.depthRange.apply(t,dt(e))})),vt(st,U.a.DEPTH_WRITEMASK,(function(t,e){return t.depthMask(e)})),vt(st,U.a.DITHER,mt),vt(st,U.a.FRAGMENT_SHADER_DERIVATIVE_HINT,_t),vt(st,U.a.FRAMEBUFFER_BINDING,(function(t,e){var n=Z(t)?U.a.DRAW_FRAMEBUFFER:U.a.FRAMEBUFFER;return t.bindFramebuffer(n,e)})),vt(st,U.a.FRONT_FACE,(function(t,e){return t.frontFace(e)})),vt(st,U.a.GENERATE_MIPMAP_HINT,_t),vt(st,U.a.LINE_WIDTH,(function(t,e){return t.lineWidth(e)})),vt(st,U.a.POLYGON_OFFSET_FILL,mt),vt(st,U.a.POLYGON_OFFSET_FACTOR,"polygonOffset"),vt(st,U.a.POLYGON_OFFSET_UNITS,"polygonOffset"),vt(st,U.a.RASTERIZER_DISCARD,mt),vt(st,U.a.SAMPLE_COVERAGE_VALUE,"sampleCoverage"),vt(st,U.a.SAMPLE_COVERAGE_INVERT,"sampleCoverage"),vt(st,U.a.SCISSOR_TEST,mt),vt(st,U.a.SCISSOR_BOX,(function(t,e){return t.scissor.apply(t,dt(e))})),vt(st,U.a.STENCIL_TEST,mt),vt(st,U.a.STENCIL_CLEAR_VALUE,(function(t,e){return t.clearStencil(e)})),vt(st,U.a.STENCIL_WRITEMASK,(function(t,e){return t.stencilMaskSeparate(U.a.FRONT,e)})),vt(st,U.a.STENCIL_BACK_WRITEMASK,(function(t,e){return t.stencilMaskSeparate(U.a.BACK,e)})),vt(st,U.a.STENCIL_FUNC,"stencilFuncFront"),vt(st,U.a.STENCIL_REF,"stencilFuncFront"),vt(st,U.a.STENCIL_VALUE_MASK,"stencilFuncFront"),vt(st,U.a.STENCIL_BACK_FUNC,"stencilFuncBack"),vt(st,U.a.STENCIL_BACK_REF,"stencilFuncBack"),vt(st,U.a.STENCIL_BACK_VALUE_MASK,"stencilFuncBack"),vt(st,U.a.STENCIL_FAIL,"stencilOpFront"),vt(st,U.a.STENCIL_PASS_DEPTH_FAIL,"stencilOpFront"),vt(st,U.a.STENCIL_PASS_DEPTH_PASS,"stencilOpFront"),vt(st,U.a.STENCIL_BACK_FAIL,"stencilOpBack"),vt(st,U.a.STENCIL_BACK_PASS_DEPTH_FAIL,"stencilOpBack"),vt(st,U.a.STENCIL_BACK_PASS_DEPTH_PASS,"stencilOpBack"),vt(st,U.a.VIEWPORT,(function(t,e){return t.viewport.apply(t,dt(e))})),vt(st,U.a.PACK_ALIGNMENT,bt),vt(st,U.a.UNPACK_ALIGNMENT,bt),vt(st,U.a.UNPACK_FLIP_Y_WEBGL,bt),vt(st,U.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,bt),vt(st,U.a.UNPACK_COLORSPACE_CONVERSION_WEBGL,bt),vt(st,U.a.PACK_ROW_LENGTH,bt),vt(st,U.a.PACK_SKIP_PIXELS,bt),vt(st,U.a.PACK_SKIP_ROWS,bt),vt(st,U.a.READ_FRAMEBUFFER_BINDING,(function(t,e){return t.bindFramebuffer(U.a.READ_FRAMEBUFFER,e)})),vt(st,U.a.UNPACK_ROW_LENGTH,bt),vt(st,U.a.UNPACK_IMAGE_HEIGHT,bt),vt(st,U.a.UNPACK_SKIP_PIXELS,bt),vt(st,U.a.UNPACK_SKIP_ROWS,bt),vt(st,U.a.UNPACK_SKIP_IMAGES,bt),st),wt={blendEquation:function(t,e){return t.blendEquationSeparate(e[U.a.BLEND_EQUATION_RGB],e[U.a.BLEND_EQUATION_ALPHA])},blendFunc:function(t,e){return t.blendFuncSeparate(e[U.a.BLEND_SRC_RGB],e[U.a.BLEND_DST_RGB],e[U.a.BLEND_SRC_ALPHA],e[U.a.BLEND_DST_ALPHA])},polygonOffset:function(t,e){return t.polygonOffset(e[U.a.POLYGON_OFFSET_FACTOR],e[U.a.POLYGON_OFFSET_UNITS])},sampleCoverage:function(t,e){return t.sampleCoverage(e[U.a.SAMPLE_COVERAGE_VALUE],e[U.a.SAMPLE_COVERAGE_INVERT])},stencilFuncFront:function(t,e){return t.stencilFuncSeparate(U.a.FRONT,e[U.a.STENCIL_FUNC],e[U.a.STENCIL_REF],e[U.a.STENCIL_VALUE_MASK])},stencilFuncBack:function(t,e){return t.stencilFuncSeparate(U.a.BACK,e[U.a.STENCIL_BACK_FUNC],e[U.a.STENCIL_BACK_REF],e[U.a.STENCIL_BACK_VALUE_MASK])},stencilOpFront:function(t,e){return t.stencilOpSeparate(U.a.FRONT,e[U.a.STENCIL_FAIL],e[U.a.STENCIL_PASS_DEPTH_FAIL],e[U.a.STENCIL_PASS_DEPTH_PASS])},stencilOpBack:function(t,e){return t.stencilOpSeparate(U.a.BACK,e[U.a.STENCIL_BACK_FAIL],e[U.a.STENCIL_BACK_PASS_DEPTH_FAIL],e[U.a.STENCIL_BACK_PASS_DEPTH_PASS])}},Et=function(t,e){return t.isEnabled(e)},St=(vt(ut={},U.a.BLEND,Et),vt(ut,U.a.CULL_FACE,Et),vt(ut,U.a.DEPTH_TEST,Et),vt(ut,U.a.DITHER,Et),vt(ut,U.a.POLYGON_OFFSET_FILL,Et),vt(ut,U.a.SAMPLE_ALPHA_TO_COVERAGE,Et),vt(ut,U.a.SAMPLE_COVERAGE,Et),vt(ut,U.a.SCISSOR_TEST,Et),vt(ut,U.a.STENCIL_TEST,Et),vt(ut,U.a.RASTERIZER_DISCARD,Et),ut);function At(t,e){var n={};for(var r in e){var i=Number(r),o=xt[r];o&&("string"==typeof o?n[o]=!0:o(t,e[r],i))}var a=t.state&&t.state.cache;if(a){var s=Object.assign({},a,e);for(var u in n){(0,wt[u])(t,s)}}}function Tt(t,e){var n=St[e];return n?n(t,Number(e)):t.getParameter(Number(e))}function Pt(t,e){e=e||yt;var n=Array.isArray(e)?e:Object.keys(e),r={},i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r[l]=Tt(t,l)}}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}return r}function kt(t){At(t,Object.assign({},yt,{}))}function Ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ot,It=function(t){return Rt(t)?void 0:0},Mt=(Ct(gt={},U.a.READ_BUFFER,(function(t){return Rt(t)?void 0:U.a.COLOR_ATTACHMENT0})),Ct(gt,35723,(function(t){return Rt(t)?void 0:4352})),Ct(gt,U.a.RASTERIZER_DISCARD,It),Ct(gt,U.a.SAMPLES,It),Ct(gt,36795,(function(t,e){var n=Rt(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0})),Ct(gt,37445,(function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_VENDOR_WEBGL||U.a.VENDOR)})),Ct(gt,37446,(function(t,e){var n=t.getExtension("WEBGL_debug_renderer_info");return e(n&&n.UNMASKED_RENDERER_WEBGL||U.a.RENDERER)})),Ct(gt,34047,(function(t,e){var n=t.luma.extensions.EXT_texture_filter_anisotropic;return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1})),Ct(gt,U.a.MAX_3D_TEXTURE_SIZE,It),Ct(gt,U.a.MAX_ARRAY_TEXTURE_LAYERS,It),Ct(gt,U.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL,It),Ct(gt,U.a.MAX_COLOR_ATTACHMENTS,(function(t,e){if(!Rt(t)){var n=t.getExtension("WEBGL_draw_buffers");return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}})),Ct(gt,U.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,It),Ct(gt,U.a.MAX_COMBINED_UNIFORM_BLOCKS,It),Ct(gt,U.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,It),Ct(gt,U.a.MAX_DRAW_BUFFERS,(function(t){if(!Rt(t)){var e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}})),Ct(gt,U.a.MAX_ELEMENT_INDEX,(function(t){return t.getExtension("OES_element_index")?2147483647:65535})),Ct(gt,U.a.MAX_ELEMENTS_INDICES,(function(t){return t.getExtension("OES_element_index")?16777216:65535})),Ct(gt,U.a.MAX_ELEMENTS_VERTICES,(function(t){return 16777216})),Ct(gt,U.a.MAX_FRAGMENT_INPUT_COMPONENTS,It),Ct(gt,U.a.MAX_FRAGMENT_UNIFORM_BLOCKS,It),Ct(gt,U.a.MAX_FRAGMENT_UNIFORM_COMPONENTS,It),Ct(gt,U.a.MAX_SAMPLES,It),Ct(gt,U.a.MAX_SERVER_WAIT_TIMEOUT,It),Ct(gt,U.a.MAX_TEXTURE_LOD_BIAS,It),Ct(gt,U.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,It),Ct(gt,U.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,It),Ct(gt,U.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,It),Ct(gt,U.a.MAX_UNIFORM_BLOCK_SIZE,It),Ct(gt,U.a.MAX_UNIFORM_BUFFER_BINDINGS,It),Ct(gt,U.a.MAX_VARYING_COMPONENTS,It),Ct(gt,U.a.MAX_VERTEX_OUTPUT_COMPONENTS,It),Ct(gt,U.a.MAX_VERTEX_UNIFORM_BLOCKS,It),Ct(gt,U.a.MAX_VERTEX_UNIFORM_COMPONENTS,It),Ct(gt,U.a.MIN_PROGRAM_TEXEL_OFFSET,It),Ct(gt,U.a.MAX_PROGRAM_TEXEL_OFFSET,It),Ct(gt,U.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT,It),gt);function Rt(t){return t&&32874===t.TEXTURE_BINDING_3D}function Lt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ft(t){return t&&32874===t.TEXTURE_BINDING_3D}var Nt=(Lt(Ot={},"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){j(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),Lt(Ot,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(t,e){j(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),Lt(Ot,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){j(!1)}}),Lt(Ot,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){j(!1)},deleteQuery:function(){j(!1)},beginQuery:function(){j(!1)},endQuery:function(){},getQuery:function(t,e){return this.getQueryObject(t,e)},getQueryParameter:function(t,e){return this.getQueryObject(t,e)},queryCounter:function(){},getQueryObject:function(){}}),Lt(Ot,"EXT_disjoint_timer_query_webgl2",{meta:{suffix:"EXT"},queryCounter:null}),Lt(Ot,"OVERRIDES",{readBuffer:function(t,e,n){Ft(t)&&e(n)},getVertexAttrib:function(t,e,n,r){var i,o=function(t,e){return{webgl2:Ft(t),ext:t.getExtension(e)}}(t,"ANGLE_instanced_arrays"),a=o.webgl2,s=o.ext;switch(r){case 35069:i=!!a&&void 0;break;case 35070:i=a||s?void 0:0}return void 0!==i?i:e(n,r)},getProgramParameter:function(t,e,n,r){if(!Ft(t))switch(r){case 35967:return 35981;case 35971:case 35382:return 0}return e(n,r)},getInternalformatParameter:function(t,e,n,r,i){if(!Ft(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter:function(t,e,n,r){switch(r){case 34046:var i=t.luma.extensions.EXT_texture_filter_anisotropic;r=i&&i.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(n,r)},getParameter:function(t,e,n){var r=Mt[n],i="function"==typeof r?r(t,e,n):r;return void 0!==i?i:e(n)},hint:function(t,e,n,r){return e(n,r)}}),Ot);function jt(t,e){var n=e.extension,r=e.target,i=e.target2,o=Nt[n];j(o);var a=o.meta,s=(void 0===a?{}:a).suffix,u=void 0===s?"":s,l=t.getExtension(n);Object.keys(o).forEach((function(e){var n="".concat(e).concat(u),a=null;"meta"===e||"function"==typeof t[e]||(l&&"function"==typeof l[n]?a=function(){return l[n].apply(l,arguments)}:"function"==typeof o[e]&&(a=o[e].bind(r))),a&&(r[e]=a,i[e]=a)}))}function Dt(t){if(t.luma=t.luma||{},function(t){t.luma.extensions={};var e=t.getSupportedExtensions(),n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.luma[s]=t.getExtension(s)}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}(t),!t.luma.polyfilled){for(var e in Nt)"overrides"!==e&&jt(t,{extension:e,target:t.luma,target2:t});!function(t,e){var n=e.target,r=e.target2,i=Nt.OVERRIDES;Object.keys(i).forEach((function(e){if("function"==typeof i[e]){var o=t[e]?t[e].bind(t):function(){},a=i[e].bind(null,t,o);n[e]=a,r[e]=a}}))}(t,{target:t.luma,target2:t}),t.luma.polyfilled=!0}return t}function zt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ut(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vt=function(t,e){var n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return t===e},Gt={enable:function(t,e){return t(Ut({},e,!0))},disable:function(t,e){return t(Ut({},e,!1))},pixelStorei:function(t,e,n){return t(Ut({},e,n))},hint:function(t,e,n){return t(Ut({},e,n))},bindFramebuffer:function(t,e,n){var r;switch(e){case U.a.FRAMEBUFFER:return t((Ut(r={},U.a.DRAW_FRAMEBUFFER_BINDING,n),Ut(r,U.a.READ_FRAMEBUFFER_BINDING,n),r));case U.a.DRAW_FRAMEBUFFER:return t(Ut({},U.a.DRAW_FRAMEBUFFER_BINDING,n));case U.a.READ_FRAMEBUFFER:return t(Ut({},U.a.READ_FRAMEBUFFER_BINDING,n));default:return null}},blendColor:function(t,e,n,r,i){return t(Ut({},U.a.BLEND_COLOR,new Float32Array([e,n,r,i])))},blendEquation:function(t,e){var n;return t((Ut(n={},U.a.BLEND_EQUATION_RGB,e),Ut(n,U.a.BLEND_EQUATION_ALPHA,e),n))},blendEquationSeparate:function(t,e,n){var r;return t((Ut(r={},U.a.BLEND_EQUATION_RGB,e),Ut(r,U.a.BLEND_EQUATION_ALPHA,n),r))},blendFunc:function(t,e,n){var r;return t((Ut(r={},U.a.BLEND_SRC_RGB,e),Ut(r,U.a.BLEND_DST_RGB,n),Ut(r,U.a.BLEND_SRC_ALPHA,e),Ut(r,U.a.BLEND_DST_ALPHA,n),r))},blendFuncSeparate:function(t,e,n,r,i){var o;return t((Ut(o={},U.a.BLEND_SRC_RGB,e),Ut(o,U.a.BLEND_DST_RGB,n),Ut(o,U.a.BLEND_SRC_ALPHA,r),Ut(o,U.a.BLEND_DST_ALPHA,i),o))},clearColor:function(t,e,n,r,i){return t(Ut({},U.a.COLOR_CLEAR_VALUE,new Float32Array([e,n,r,i])))},clearDepth:function(t,e){return t(Ut({},U.a.DEPTH_CLEAR_VALUE,e))},clearStencil:function(t,e){return t(Ut({},U.a.STENCIL_CLEAR_VALUE,e))},colorMask:function(t,e,n,r,i){return t(Ut({},U.a.COLOR_WRITEMASK,[e,n,r,i]))},cullFace:function(t,e){return t(Ut({},U.a.CULL_FACE_MODE,e))},depthFunc:function(t,e){return t(Ut({},U.a.DEPTH_FUNC,e))},depthRange:function(t,e,n){return t(Ut({},U.a.DEPTH_RANGE,new Float32Array([e,n])))},depthMask:function(t,e){return t(Ut({},U.a.DEPTH_WRITEMASK,e))},frontFace:function(t,e){return t(Ut({},U.a.FRONT_FACE,e))},lineWidth:function(t,e){return t(Ut({},U.a.LINE_WIDTH,e))},polygonOffset:function(t,e,n){var r;return t((Ut(r={},U.a.POLYGON_OFFSET_FACTOR,e),Ut(r,U.a.POLYGON_OFFSET_UNITS,n),r))},sampleCoverage:function(t,e,n){var r;return t((Ut(r={},U.a.SAMPLE_COVERAGE_VALUE,e),Ut(r,U.a.SAMPLE_COVERAGE_INVERT,n),r))},scissor:function(t,e,n,r,i){return t(Ut({},U.a.SCISSOR_BOX,new Int32Array([e,n,r,i])))},stencilMask:function(t,e){var n;return t((Ut(n={},U.a.STENCIL_WRITEMASK,e),Ut(n,U.a.STENCIL_BACK_WRITEMASK,e),n))},stencilMaskSeparate:function(t,e,n){return t(Ut({},e===U.a.FRONT?U.a.STENCIL_WRITEMASK:U.a.STENCIL_BACK_WRITEMASK,n))},stencilFunc:function(t,e,n,r){var i;return t((Ut(i={},U.a.STENCIL_FUNC,e),Ut(i,U.a.STENCIL_REF,n),Ut(i,U.a.STENCIL_VALUE_MASK,r),Ut(i,U.a.STENCIL_BACK_FUNC,e),Ut(i,U.a.STENCIL_BACK_REF,n),Ut(i,U.a.STENCIL_BACK_VALUE_MASK,r),i))},stencilFuncSeparate:function(t,e,n,r,i){var o;return t((Ut(o={},e===U.a.FRONT?U.a.STENCIL_FUNC:U.a.STENCIL_BACK_FUNC,n),Ut(o,e===U.a.FRONT?U.a.STENCIL_REF:U.a.STENCIL_BACK_REF,r),Ut(o,e===U.a.FRONT?U.a.STENCIL_VALUE_MASK:U.a.STENCIL_BACK_VALUE_MASK,i),o))},stencilOp:function(t,e,n,r){var i;return t((Ut(i={},U.a.STENCIL_FAIL,e),Ut(i,U.a.STENCIL_PASS_DEPTH_FAIL,n),Ut(i,U.a.STENCIL_PASS_DEPTH_PASS,r),Ut(i,U.a.STENCIL_BACK_FAIL,e),Ut(i,U.a.STENCIL_BACK_PASS_DEPTH_FAIL,n),Ut(i,U.a.STENCIL_BACK_PASS_DEPTH_PASS,r),i))},stencilOpSeparate:function(t,e,n,r,i){var o;return t((Ut(o={},e===U.a.FRONT?U.a.STENCIL_FAIL:U.a.STENCIL_BACK_FAIL,n),Ut(o,e===U.a.FRONT?U.a.STENCIL_PASS_DEPTH_FAIL:U.a.STENCIL_BACK_PASS_DEPTH_FAIL,r),Ut(o,e===U.a.FRONT?U.a.STENCIL_PASS_DEPTH_PASS:U.a.STENCIL_BACK_PASS_DEPTH_PASS,i),o))},viewport:function(t,e,n,r,i){return t(Ut({},U.a.VIEWPORT,new Int32Array([e,n,r,i])))}};function Wt(t,e){var n=t[e].bind(t);t[e]=function(){var e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache||(t.state.cache[e]=n.apply(void 0,arguments)),t.state.enable?t.state.cache[e]:n.apply(void 0,arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Xt(t,e,n){var r=t[e].bind(t);t[e]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s,u=n.apply(void 0,[t.state._updateCache].concat(o)),l=u.valueChanged,c=u.oldValue;l&&((s=t.state).log.apply(s,["gl.".concat(e)].concat(o)),r.apply(void 0,o));return c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}var Ht,qt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.copyState,i=void 0!==r&&r,o=n.log,a=void 0===o?function(){}:o;zt(this,t),this.gl=e,this.stateStack=[],this.enable=!0,this.cache=i?Pt(e):Object.assign({},yt),this.log=a,this._updateCache=this._updateCache.bind(this),Object.seal(this)}var e,n,r;return e=t,(n=[{key:"push",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],this.stateStack.push({})}},{key:"pop",value:function(){j(this.stateStack.length>0);var t=this.stateStack[this.stateStack.length-1];At(this.gl,t,this.cache),this.stateStack.pop()}},{key:"_updateCache",value:function(t){var e,n=!1,r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var i in t)j(void 0!==i),Vt(t[i],this.cache[i])||(n=!0,e=this.cache[i],!r||i in r||(r[i]=this.cache[i]),this.cache[i]=t[i]);return{valueChanged:n,oldValue:e}}}])&&Bt(e.prototype,n),r&&Bt(e,r),t}();function Zt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.enable,r=void 0===n||n,i=e.copyState;if(j(void 0!==i),!t.state){for(var o in Dt(t),t.state=new qt(t,{copyState:i,enable:r}),Gt){Xt(t,o,Gt[o])}Wt(t,"getParameter"),Wt(t,"isEnabled")}return t.state.enable=r,t}function Kt(t){j(t.state),t.state.pop()}function Yt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Jt(t){return t.luma=t.luma||{},t.luma}function Qt(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).debug;return null===t?null:void 0===e||e?function(t){if(null===t)return null;if(!r.a.WebGLDebug)return it.a.warn('WebGL debug mode activation failed. import "luma.gl/debug" to enable.')(),t;var e=Jt(t);if(e.realContext)return t;if(e.debugContext)return e.debugContext;var n=r.a.WebGLDebug.makeDebugContext(t,te,ee);return Object.assign(function t(){Yt(this,t)}.prototype,n),e.debugContext=n,n.debug=!0,n.gl=t,it.a.info("debug context actived."),n}(t):function(t){if(null===t)return null;var e=Jt(t);return e.realContext?e.realContext:t}(t)}function $t(t,e){var n=r.a.WebGLDebug.glFunctionArgsToString(t,e);return n="".concat(n.slice(0,100)).concat(n.length>100?"...":""),"gl.".concat(t,"(").concat(n,")")}function te(t,e,n){var i=r.a.WebGLDebug.glEnumToString(t),o=r.a.WebGLDebug.glFunctionArgsToString(e,n),a="".concat(i," in gl.").concat(e,"(").concat(o,")");if(it.a.throw)throw new Error(a);it.a.error(a)()}function ee(t,e){var n;if(it.a.priority>=4&&(n=$t(t,e),it.a.info(4,n)()),it.a.break){n=n||$t(t,e);it.a.break&&it.a.break.every((function(t){return-1!==n.indexOf(t)}))}var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){if(void 0===a.value){if(n=n||$t(t,e),it.a.throw)throw new Error("Undefined argument: ".concat(n));it.a.error("Undefined argument: ".concat(n))}}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var re=(ne(Ht={},U.a.ALIASED_LINE_WIDTH_RANGE,{gl1:new Float32Array([1,1])}),ne(Ht,U.a.ALIASED_POINT_SIZE_RANGE,{gl1:new Float32Array([1,1])}),ne(Ht,U.a.MAX_TEXTURE_SIZE,{gl1:64,gl2:2048}),ne(Ht,U.a.MAX_CUBE_MAP_TEXTURE_SIZE,{gl1:16}),ne(Ht,U.a.MAX_TEXTURE_IMAGE_UNITS,{gl1:8}),ne(Ht,U.a.MAX_COMBINED_TEXTURE_IMAGE_UNITS,{gl1:8}),ne(Ht,U.a.MAX_VERTEX_TEXTURE_IMAGE_UNITS,{gl1:0}),ne(Ht,U.a.MAX_RENDERBUFFER_SIZE,{gl1:1}),ne(Ht,U.a.MAX_VARYING_VECTORS,{gl1:8}),ne(Ht,U.a.MAX_VERTEX_ATTRIBS,{gl1:8}),ne(Ht,U.a.MAX_VERTEX_UNIFORM_VECTORS,{gl1:128}),ne(Ht,U.a.MAX_FRAGMENT_UNIFORM_VECTORS,{gl1:16}),ne(Ht,U.a.MAX_VIEWPORT_DIMS,{gl1:new Int32Array([0,0])}),ne(Ht,U.a.MAX_3D_TEXTURE_SIZE,{gl1:0,gl2:256}),ne(Ht,U.a.MAX_ARRAY_TEXTURE_LAYERS,{gl1:0,gl2:256}),ne(Ht,U.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_COLOR_ATTACHMENTS,{gl1:0,gl2:4}),ne(Ht,U.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_COMBINED_UNIFORM_BLOCKS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_DRAW_BUFFERS,{gl1:0,gl2:4}),ne(Ht,U.a.MAX_ELEMENT_INDEX,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_ELEMENTS_INDICES,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_ELEMENTS_VERTICES,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_FRAGMENT_INPUT_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_FRAGMENT_UNIFORM_BLOCKS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_FRAGMENT_UNIFORM_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_SAMPLES,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_SERVER_WAIT_TIMEOUT,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_TEXTURE_LOD_BIAS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_UNIFORM_BLOCK_SIZE,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_UNIFORM_BUFFER_BINDINGS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_VARYING_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_VERTEX_OUTPUT_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_VERTEX_UNIFORM_BLOCKS,{gl1:0,gl2:0}),ne(Ht,U.a.MAX_VERTEX_UNIFORM_COMPONENTS,{gl1:0,gl2:0}),ne(Ht,U.a.MIN_PROGRAM_TEXEL_OFFSET,{gl1:0,gl2:-8,negative:!0}),ne(Ht,U.a.MAX_PROGRAM_TEXEL_OFFSET,{gl1:0,gl2:7}),ne(Ht,U.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT,{gl1:0,gl2:0}),Ht);var ie=37445,oe=37446;function ae(t){var e=function(t){if(t.luma=t.luma||{},!t.luma.limits){t.luma.limits={},t.luma.webgl1MinLimits={},t.luma.webgl2MinLimits={};var e=Z(t);for(var n in re){var r=re[n],i=r.gl1,o="gl2"in r?r.gl2:r.gl1,a=e?o:i,s="gl2"in r&&!e||"extension"in r&&!t.getExtension(r.extension)?a:t.getParameter(n);t.luma.limits[n]=s,t.luma.webgl1MinLimits[n]=i,t.luma.webgl2MinLimits[n]=o}}return t.luma.limits}(t),n=function(t){if(t.luma=t.luma||{},!t.luma.info){var e,n=t.getExtension("WEBGL_debug_renderer_info");t.luma.info=(ne(e={},U.a.VENDOR,t.getParameter(U.a.VENDOR)),ne(e,U.a.RENDERER,t.getParameter(U.a.RENDERER)),ne(e,U.a.UNMASKED_VENDOR_WEBGL,t.getParameter(n&&n.UNMASKED_VENDOR_WEBGL||U.a.VENDOR)),ne(e,U.a.UNMASKED_RENDERER_WEBGL,t.getParameter(n&&n.UNMASKED_RENDERER_WEBGL||U.a.RENDERER)),ne(e,U.a.VERSION,t.getParameter(U.a.VERSION)),ne(e,U.a.SHADING_LANGUAGE_VERSION,t.getParameter(U.a.SHADING_LANGUAGE_VERSION)),e)}return t.luma.info}(t);return{vendor:n[ie]||n[U.a.VENDOR],renderer:n[oe]||n[U.a.RENDERER],version:n[U.a.VERSION],shadingLanguageVersion:n[U.a.SHADING_LANGUAGE_VERSION],info:n,limits:e,webgl1MinLimits:t.luma.webgl1MinLimits,webgl2MinLimits:t.luma.webgl2MinLimits}}function se(t){return function(t){var e=t.getParameter(U.a.VENDOR),n=t.getParameter(U.a.RENDERER),r=t.getExtension("WEBGL_debug_renderer_info");return{vendor:r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||U.a.VENDOR)||e,renderer:r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||U.a.RENDERER)||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(U.a.VERSION),shadingLanguageVersion:t.getParameter(U.a.SHADING_LANGUAGE_VERSION)}}(t)}function ue(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ce=function(t){return t},he=new(function(){function t(){!function(t,e){if(!ue(t,e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pendingQueries=new Set,this.invalidQueryType=null,this.invalidErrorMessage="",this.checkInvalid=function(){return!1}}var e,n,r;return e=t,(n=[{key:"poll",value:function(t){this.cancelInvalidQueries(t);var e=!0,n=!1,r=void 0;try{for(var i,o=this.pendingQueries.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(a.isResultAvailable()){var s=a.getResult();this.resolveQuery(a,s)}}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"setInvalidator",value:function(t){var e=t.queryType,n=t.errorMessage,r=t.checkInvalid;this.invalidQueryType=e,this.invalidErrorMessage=n,this.checkInvalid=r}},{key:"beginQuery",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ce,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ce;this.cancelInvalidQueries(t.gl),this.cancelQuery(t);var r={};return t.promise=new Promise((function(t,e){r.resolve=t,r.reject=e})),Object.assign(t.promise,r),this.pendingQueries.add(t),t.promise.then(e).catch(n)}},{key:"resolveQuery",value:function(t,e){this.pendingQueries.delete(t),t.promise.resolve(e)}},{key:"rejectQuery",value:function(t,e){this.pendingQueries.delete(t),t.promise&&t.promise.reject(new Error(e))}},{key:"deleteQuery",value:function(t){return this.rejectQuery(t,"Query was deleted before result was available")}},{key:"cancelQuery",value:function(t){return this.rejectQuery(t,"Query was canceled before result was available")}},{key:"invalidateQuery",value:function(t){ue(t,this.invalidQueryType)&&this.rejectQuery(t,this.invalidErrorMessage)}},{key:"cancelInvalidQueries",value:function(t){if(this.checkInvalid(t)){var e=!0,n=!1,r=void 0;try{for(var i,o=this.pendingQueries.values()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.invalidateQuery(a)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}}}])&&le(e.prototype,n),r&&le(e,r),t}());function pe(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}var fe=32874;function de(t){return Boolean(t&&(pe(t,f)||t.TEXTURE_BINDING_3D===fe))}var ve={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function ge(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e=Object.assign({},ve,e),r=n.canvas,o=n.width,a=n.height,s=n.throwOnError,u=n.manageState,l=n.debug;function c(t){if(s)throw new Error(t);return null}i.a?t=function(t){var e=t.canvas,n=t.opts,r=void 0===n?{}:n,i=t.onError,o=void 0===i?function(t){return null}:i;function a(t){o("WebGL context: ".concat(t.statusMessage||"Unknown error"))}e.addEventListener("webglcontextcreationerror",a,!1);var s=r.webgl1,u=void 0===s||s,l=r.webgl2,c=void 0===l||l,h=null;return c&&(h=(h=h||e.getContext("webgl2",r))||e.getContext("experimental-webgl2",r)),u&&(h=(h=h||e.getContext("webgl",r))||e.getContext("experimental-webgl",r)),e.removeEventListener("webglcontextcreationerror",a,!1),h||o("Failed to create ".concat(c&&!u?"WebGL2":"WebGL"," context"))}({canvas:function(t){var e,n=t.canvas,r=t.width,i=t.height,o=t.onError,a=void 0===o?function(){}:o;return"string"==typeof n?(ct||a("createGLContext called on canvas '".concat(n,"' before page was loaded")),e=document.getElementById(n)):e=n||ft({id:"lumagl-canvas",width:r,height:i,onError:a}),e}({canvas:r,width:o,height:a,onError:c}),opts:e}):t=function(t){var e=t.width,n=t.height,r=t.opts,i=t.onError,o=r.webgl1;if(r.webgl2&&!o)return i("headless-gl does not support WebGL2");if(!$)return i(J);var a=$(e,n,r);return a||i(Q)}({width:o,height:a,opts:e,onError:c});return t?(u&&Zt(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return it.a.log.apply(it.a,[1].concat(e))()}}),i.a&&l&&(t=Qt(t,{debug:l}),it.a.priority=Math.max(it.a.priority,1)),function(t){var e=de(t)?"WebGL2":"WebGL1",n=se(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";it.a.once(0,"".concat(e).concat(i," context ").concat(r))()}(t),t):null}function ye(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function me(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var _e={framebuffer:function(t,e){var n=e&&e.handle?e.handle:e;return t.bindFramebuffer(U.a.FRAMEBUFFER,n)},blend:function(t,e){return e?t.enable(U.a.BLEND):t.disable(U.a.BLEND)},blendColor:function(t,e){return t.blendColor.apply(t,me(e))},blendEquation:function(t,e){e=be(e)?e:[e,e],t.blendEquationSeparate.apply(t,me(e))},blendFunc:function(t,e){e=be(e)&&2===e.length?me(e).concat(me(e)):e,t.blendFuncSeparate.apply(t,me(e))},clearColor:function(t,e){return t.clearColor.apply(t,me(e))},clearDepth:function(t,e){return t.clearDepth(e)},clearStencil:function(t,e){return t.clearStencil(e)},colorMask:function(t,e){return t.colorMask.apply(t,me(e))},cull:function(t,e){return e?t.enable(U.a.CULL_FACE):t.disable(U.a.CULL_FACE)},cullFace:function(t,e){return t.cullFace(e)},depthTest:function(t,e){return e?t.enable(U.a.DEPTH_TEST):t.disable(U.a.DEPTH_TEST)},depthFunc:function(t,e){return t.depthFunc(e)},depthMask:function(t,e){return t.depthMask(e)},depthRange:function(t,e){return t.depthRange.apply(t,me(e))},dither:function(t,e){return e?t.enable(U.a.DITHER):t.disable(U.a.DITHER)},derivativeHint:function(t,e){t.hint(U.a.FRAGMENT_SHADER_DERIVATIVE_HINT,e)},frontFace:function(t,e){return t.frontFace(e)},mipmapHint:function(t,e){return t.hint(U.a.GENERATE_MIPMAP_HINT,e)},lineWidth:function(t,e){return t.lineWidth(e)},polygonOffsetFill:function(t,e){return e?t.enable(U.a.POLYGON_OFFSET_FILL):t.disable(U.a.POLYGON_OFFSET_FILL)},polygonOffset:function(t,e){return t.polygonOffset.apply(t,me(e))},sampleCoverage:function(t,e){return t.sampleCoverage.apply(t,me(e))},scissorTest:function(t,e){return e?t.enable(U.a.SCISSOR_TEST):t.disable(U.a.SCISSOR_TEST)},scissor:function(t,e){return t.scissor.apply(t,me(e))},stencilTest:function(t,e){return e?t.enable(U.a.STENCIL_TEST):t.disable(U.a.STENCIL_TEST)},stencilMask:function(t,e){var n=ye(e=be(e)?e:[e,e],2),r=n[0],i=n[1];t.stencilMaskSeparate(U.a.FRONT,r),t.stencilMaskSeparate(U.a.BACK,i)},stencilFunc:function(t,e){var n=ye(e=be(e)&&3===e.length?me(e).concat(me(e)):e,6),r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5];t.stencilFuncSeparate(U.a.FRONT,r,i,o),t.stencilFuncSeparate(U.a.BACK,a,s,u)},stencilOp:function(t,e){var n=ye(e=be(e)&&3===e.length?me(e).concat(me(e)):e,6),r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5];t.stencilOpSeparate(U.a.FRONT,r,i,o),t.stencilOpSeparate(U.a.BACK,a,s,u)},viewport:function(t,e){return t.viewport.apply(t,me(e))}};function be(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function xe(t,e){for(var n in At(t,e),e){var r=_e[n];r&&r(t,e[n],n)}}function we(t,e,n){if(rt(e))return n(t);var r,i=e.nocatch,o=void 0===i||i;if(j(!e.frameBuffer),function(t){t.state||Zt(t,{copyState:!1}),t.state.push()}(t),xe(t,e),o)r=n(t),Kt(t);else try{r=n(t)}finally{Kt(t)}return r}var Ee={VERTEX_ARRAY_OBJECT:["OES_vertex_array_object",!0],TIMER_QUERY:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],INSTANCED_RENDERING:["ANGLE_instanced_arrays",!0],MULTIPLE_RENDER_TARGETS:["WEBGL_draw_buffers",!0],ELEMENT_INDEX_UINT32:["OES_element_index_uint",!0],BLEND_EQUATION_MINMAX:["EXT_blend_minmax",!0],COLOR_ENCODING_SRGB:["EXT_sRGB",!0],TEXTURE_DEPTH:["WEBGL_depth_texture",!0],TEXTURE_FLOAT:["OES_texture_float",!0],TEXTURE_HALF_FLOAT:["OES_texture_half_float",!0],TEXTURE_FILTER_LINEAR_FLOAT:["OES_texture_float_linear"],TEXTURE_FILTER_LINEAR_HALF_FLOAT:["OES_texture_half_float_linear"],TEXTURE_FILTER_ANISOTROPIC:["EXT_texture_filter_anisotropic"],COLOR_ATTACHMENT_RGBA32F:["WEBGL_color_buffer_float","EXT_color_buffer_float"],COLOR_ATTACHMENT_FLOAT:[!1,"EXT_color_buffer_float"],COLOR_ATTACHMENT_HALF_FLOAT:[!1,"EXT_color_buffer_half_float"],GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Se={};Object.keys(Ee).forEach((function(t){Se[t]=t}));var Ae={};function Te(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Ee[e];if(j(i,e),!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r.b.navigator||{},n=t.userAgent||e.userAgent,i=-1!==n.indexOf("MSIE "),o=-1!==n.indexOf("Trident/");return i||o}(n))return!0;if(e in Ae)return Ae[e];var o=i[0],a="#extension GL_".concat(o," : enable\nvoid main(void) {}"),s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,a),t.compileShader(s);var u=t.getShaderParameter(s,t.COMPILE_STATUS);return t.deleteShader(s),Ae[e]=u,u}function Pe(t,e){var n=Ee[e];j(n,e);var r=Z(t)&&n[1]||n[0],i="string"==typeof r?Boolean(t.getExtension(r)):r;return j(!1===i||!0===i),i}function ke(t,e){return Ce(t,e)}function Ce(t,e){return(e=Array.isArray(e)?e:[e]).every((function(e){return Pe(t,e)}))}var Oe=n(798);function Ie(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Re="Resource subclass must define virtual methods",Le=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ie(this,t),K(e);var r=n.id,i=n.userData,o=void 0===i?{}:i;this.gl=e,this.ext=Dt(e),this.id=r||et(this.constructor.name),this.userData=o,this.opts=n,this._handle=n.handle,void 0===this._handle&&(this._handle=this._createHandle()),this._addStats()}var e,n,r;return e=t,(n=[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.deleteChildren,n=void 0!==e&&e,r=this._handle&&this._deleteHandle(this._handle);return this._handle=null,this._removeStats(),r&&n&&r.filter(Boolean).forEach((function(t){t.delete()})),this}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};j(t=D(this.gl,t));var n=this.constructor.PARAMETERS||{},r=n[t];if(r){var i=Z(this.gl),o=(!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension));if(!o){var a=r.webgl1,s="webgl2"in r?r.webgl2:r.webgl1,u=i?s:a;return u}}return this._getParameter(t,e)}},{key:"getParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},n=e.parameters,r=e.keys,i=this.constructor.PARAMETERS||{},o=Z(this.gl),a={},s=n||Object.keys(i),u=!0,l=!1,c=void 0;try{for(var h,p=s[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value,d=i[f],v=d&&(!("webgl2"in d)||o)&&(!("extension"in d)||this.gl.getExtension(d.extension));if(v){var g=r?z(this.gl,f):f;a[g]=this.getParameter(f,t),r&&"GLenum"===d.type&&(a[g]=z(this.gl,a[g]))}}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}return a}},{key:"setParameter",value:function(t,e){j(t=D(this.gl,t));var n=(this.constructor.PARAMETERS||{})[t];if(n){var r=Z(this.gl);if("webgl2"in n&&!r||"extension"in n&&!this.gl.getExtension(n.extension))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(e=D(e))}return this._setParameter(t,e),this}},{key:"setParameters",value:function(t){for(var e in t)this.setParameter(e,t[e]);return this}},{key:"initialize",value:function(t){}},{key:"_createHandle",value:function(){throw new Error(Re)}},{key:"_deleteHandle",value:function(){throw new Error(Re)}},{key:"_getOptsFromHandle",value:function(){throw new Error(Re)}},{key:"_getParameter",value:function(t,e){throw new Error(Re)}},{key:"_setParameter",value:function(t,e){throw new Error(Re)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var t=this.constructor.name,e=Oe.default.stats;e.resourceCount=e.resourceCount||0,e.resourceMap=e.resourceMap||{},e.resourceCount++,e.resourceMap[t]=e.resourceMap[t]||{created:0,active:0},e.resourceMap[t].created++,e.resourceMap[t].active++}},{key:"_removeStats",value:function(){var t=this.constructor.name;Oe.default.stats.resourceMap[t].active--}},{key:"handle",get:function(){return this._handle}}])&&Me(e.prototype,n),r&&Me(e,r),t}();function Fe(t){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function je(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function De(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}var ze=36662,Be=34962,Ue=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.type,r=e.size,i=void 0===r?1:r,o=e.offset,a=void 0===o?0:o,s=e.stride,u=void 0===s?0:s,l=e.normalized,c=void 0!==l&&l,h=e.integer,p=void 0!==h&&h,f=e.instanced,d=void 0===f?0:f;De(this,t),this.type=n,this.size=i,this.offset=a,this.stride=u,this.normalized=c,this.integer=p,this.instanced=d},Ve=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return De(this,e),(n=function(t,e){return!e||"object"!==Fe(e)&&"function"!=typeof e?je(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).target=r.target||(n.gl.webgl2?ze:Be),n.setData(r),Object.seal(je(n)),n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"setDataLayout",value:function(t){var e=t.layout,n=t.type,r=t.size,i=void 0===r?1:r,o=t.offset,a=void 0===o?0:o,s=t.stride,u=void 0===s?0:s,l=t.normalized,c=void 0!==l&&l,h=t.integer,p=void 0!==h&&h,f=t.instanced,d=void 0===f?0:f;return this.layout=e||new Ue({type:n||this.type,size:i,offset:a,stride:u,normalized:c,integer:p,instanced:d}),this}},{key:"updateLayout",value:function(t){Object.assign(this.layout,t)}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.bytes,r=t.usage,i=void 0===r?35044:r,o=(t.layout,t.type),a=(t.size,t.offset,t.stride,t.normalized,t.integer,t.instanced,t.index),s=void 0===a?null:a,u=arguments[0];e?(o=o||R(e),n=e.byteLength,j(o)):(o=o||5126,n&&0!==n||(n=0,e=new Float32Array(0))),this.bytes=n,this.bytesUsed=n,this.data=e,this.type=o,this.usage=i,this.index=s,this.setDataLayout(Object.assign(u));var l=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(l,this.handle),this.gl.bufferData(l,e||n,i),this.gl.bindBuffer(l,null),this}},{key:"setData",value:function(t){return this.initialize(t)}},{key:"subData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.offset,r=void 0===n?0:n,i=t.srcOffset,o=void 0===i?0:i,a=t.length;j(e);var s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==o||void 0!==a?(Y(this.gl),this.gl.bufferSubData(this.target,r,e,o,a||0)):this.gl.bufferSubData(s,r,e),this.gl.bindBuffer(s,null),this}},{key:"copyData",value:function(t){var e=t.sourceBuffer,n=t.readOffset,r=void 0===n?0:n,i=t.writeOffset,o=void 0===i?0:i,a=t.size;return Y(this.gl),this.gl.bindBuffer(ze,e.handle),this.gl.bindBuffer(36663,this.handle),this.gl.copyBufferSubData(ze,36663,r,o,a),this.gl.bindBuffer(ze,null),this.gl.bindBuffer(36663,null),this}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dstData,n=void 0===e?null:e,r=t.srcByteOffset,i=void 0===r?0:r,o=t.dstOffset,a=void 0===o?0:o,s=t.length,u=void 0===s?0:s;Y(this.gl);var l,c,h=L(this.type,{clamped:!1}),p=this._getAvailableElementCount(i),f=a;n?l=(c=n.length)-f:c=f+(l=Math.min(p,u||p));var d=Math.min(p,l);return j((u=u||d)<=d,"Invalid srcByteOffset, dstOffset and length combination"),n=n||new h(c),this.gl.bindBuffer(ze,this.handle),this.gl.getBufferSubData(ze,i,n,a,u),this.gl.bindBuffer(ze,null),n}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,r=t.index,i=void 0===r?this.index:r,o=t.offset,a=void 0===o?0:o,s=t.size,u=35345===n||35982===n?void 0!==s?"ranged":"indexed":"non-indexed";switch(u){case"non-indexed":this.gl.bindBuffer(n,this.handle);break;case"indexed":Y(this.gl),j(0===a),this.gl.bindBufferBase(n,i,this.handle);break;case"ranged":Y(this.gl),this.gl.bindBufferRange(n,i,this.handle,a,s);break;default:j(!1)}return this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?this.target:e,r=t.index,i=void 0===r?this.index:r,o=35345===n||35982===n;return o?this.gl.bindBufferBase(n,i,null):this.gl.bindBuffer(n,null),this}},{key:"getIndexedParameter",value:function(t,e){var n=this.gl.webgl2?ze:this.target;return this.gl.bindBuffer(n,e),this.gl.getIndexedParameter(t,e)}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle)}},{key:"_getParameter",value:function(t){this.gl.bindBuffer(this.target,this.handle);var e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}},{key:"_getAvailableElementCount",value:function(t){var e=L(this.type,{clamped:!1});return this.bytes/e.BYTES_PER_ELEMENT-t/e.BYTES_PER_ELEMENT}}])&&Ne(n.prototype,r),i&&Ne(n,i),e}(Le);function Ge(t){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Xe(t,e){return!e||"object"!==Ge(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function He(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qe(t,e,n){return e&&He(t.prototype,e),n&&He(t,n),t}function Ze(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Ke="Shader: GLSL source code must be a JavaScript string",Ye=35632,Je=35633,Qe=function(t){function e(t,n,r){var i;return We(this,e),K(t),j("string"==typeof n,Ke),(i=Xe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{id:m(n)||et(e.getTypeName(r))}))).shaderType=r,i.source=n,i.opts.source=n,i.initialize(i.opts),i}return Ze(e,t),qe(e,null,[{key:"getTypeName",value:function(t){switch(t){case Je:return"vertex-shader";case Ye:return"fragment-shader";default:return j(!1),"unknown"}}}]),qe(e,[{key:"initialize",value:function(t){var e=t.source,n=m(e);n&&(this.id=et(n)),this._compile(e),this.opts.source=e}},{key:"getParameter",value:function(t){return this.gl.getShaderParameter(this.handle,t)}},{key:"toString",value:function(){return"".concat(this.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return m(this.opts.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){if(this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var t=_(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType),e=t.shaderName,n=t.errors,r=t.warnings;throw it.a.error("GLSL compilation errors in ".concat(e,"\n").concat(n))(),it.a.warn("GLSL compilation warnings in ".concat(e,"\n").concat(r))(),new Error("GLSL compilation errors in ".concat(e))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}]),e}(Le),$e=function(t){function e(t,n){return We(this,e),Xe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,Je))}return Ze(e,t),qe(e,[{key:"_createHandle",value:function(){return this.gl.createShader(Je)}}]),e}(Qe),tn=function(t){function e(t,n){return We(this,e),Xe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,Ye))}return Ze(e,t),qe(e,[{key:"_createHandle",value:function(){return this.gl.createShader(Ye)}}]),e}(Qe);function en(t){return(en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nn(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function rn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function on(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function an(t,e,n){return e&&on(t.prototype,e),n&&on(t,n),t}function sn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var un,ln=[34338,34339,34340,34341,34922,34373,34975,35069,35070],cn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rn(this,e),(n=function(t,e){return!e||"object"!==en(e)&&"function"!=typeof e?sn(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).elements=null,n.buffers={},n.locations={},n.names={},n.drawParameters={},n._bound=!1,n._filledLocations={},Object.seal(sn(n)),n.initialize(r),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),an(e,[{key:"MAX_ATTRIBUTES",get:function(){return this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS)}}],[{key:"isSupported",value:function(t){return Z(t)||t.getExtension("OES_vertex_array_object")}},{key:"getDefaultArray",value:function(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new e(t,{handle:null})),t.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(t){return t.getParameter(t.MAX_VERTEX_ATTRIBS)}}]),an(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.buffers,n=void 0===e?{}:e,r=t.elements,i=void 0===r?null:r,o=t.locations,a=void 0===o?{}:o;this.setLocations(a),this.setBuffers(n,{clear:!0}),this.setElements(i)}},{key:"setBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.location,n=t.buffer,r=t.target,i=t.layout,o=this.gl;r=void 0!==r?r:n.target,i=void 0!==i?i:n.layout,j(r,"setBuffer needs target"),j(i,"setBuffer called on uninitialized buffer"),this._filledLocations[e]=!0,this.bind((function(){n.bind({target:o.ARRAY_BUFFER});var t=i,r=t.size,a=t.type,s=t.normalized,u=t.stride,l=t.offset;i.integer?(j(Z(o)),o.vertexAttribIPointer(e,r,a,u,l)):o.vertexAttribPointer(e,r,a,s,u,l)}))}},{key:"setBuffers",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.clear,r=void 0===n||n;r&&this.clearBindings();var i=this._getLocations(t),o=i.locations,a=i.elements;for(var s in this.ext.bindVertexArray(this.handle),o){var u=o[s];if(u){var l=this._getBufferAndLayout(u),c=l.buffer,h=l.layout;this.setBuffer({location:s,buffer:c,layout:h}),this.setDivisor(s,h.instanced?1:0),this.enable(s)}else this.disable(s)}this.buffers=t,this.ext.bindVertexArray(null),a&&this.setElements(a)}},{key:"setLocations",value:function(t){this.locations=t,this.names={}}},{key:"setElements",value:function(t){return j(!t||34963===t.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.ext.bindVertexArray(this.handle),this.gl.bindBuffer(34963,t&&t.handle),this.ext.bindVertexArray(null),this.elements=t,this}},{key:"clearBindings",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.disableZero,r=void 0!==n&&n;this.bind((function(){for(var e in t._filledLocations)t._filledLocations[e]&&(e>0||r)&&t.gl.disableVertexAttribArray(e);t._filledLocations={}}))}},{key:"enable",value:function(t){var e=this;this.bind((function(){e.gl.enableVertexAttribArray(t)}))}},{key:"disable",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(t>0||n)&&this.bind((function(){e.gl.disableVertexAttribArray(t)}))}},{key:"setDivisor",value:function(t,e){var n=this;this.bind((function(){n.ext.vertexAttribDivisor(t,e)}))}},{key:"setGeneric",value:function(t){var e=t.location,n=t.array;switch(this._filledLocations[e]=!0,n.constructor){case Float32Array:this._setGenericFloatArray(e,n);break;case Int32Array:this._setGenericIntArray(e,n);break;case Uint32Array:this._setGenericUintArray(e,n);break;default:this.setGenericValues.apply(this,[e].concat(nn(n)))}}},{key:"setGenericValues",value:function(t,e,n,r,i){var o=this.gl;switch(arguments.length-1){case 1:o.vertexAttrib1f(t,e);break;case 2:o.vertexAttrib2f(t,e,n);break;case 3:o.vertexAttrib3f(t,e,n,r);break;case 4:o.vertexAttrib4f(t,e,n,r,i);break;default:j(!1)}}},{key:"bind",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this.bindVertexArray(e),this):(this._bound?t=e():(this.ext.bindVertexArray(this.handle),this._bound=!0,t=e(),this.ext.bindVertexArray(null),this._bound=!1),t)}},{key:"_deduceDrawParameters",value:function(){var t=!1,e=!1,n=null;return this.elements&&(e=!0,n=this.elements.layout.type),this.buffers.forEach((function(e){e.layout.instanced>0&&(t=!0)})),{isInstanced:t,isIndexed:e,indexType:n}}},{key:"_getLocations",value:function(t){var e=null,n={};for(var r in t){var i=t[r];i&&34963===i.target&&(j(!e,"Duplicate GL.ELEMENT_ARRAY_BUFFER"),e=i);var o=Number(r);Number.isFinite(o)||(o=this.locations[r]),j(Number.isFinite(o)),j(!n[o],"Duplicate attribute for binding point ".concat(o)),n[o]=i}return{locations:n,elements:e}}},{key:"_sortBuffersByLocation",value:function(t){var e=null,n=new Array(this._attributeCount).fill(null);for(var r in t){var i=t[r];34963===i.target?(j(!e,"Duplicate GL.ELEMENT_ARRAY_BUFFER"),e=i):this._warn[r]||(it.a.warn(2,"".concat(this._print(r)," not used"))(),this._warn[r]=!0);var o=Number(r);Number.isFinite(o)||(o=this.locations[r]),n[o]=r,j(null===n[o],"Duplicate attribute for binding point ".concat(o)),n[o]=o}return{locations:n,elements:e}}},{key:"_getBufferAndLayout",value:function(t){var e,n;return t.handle?(e=t,n=t.layout):(e=t.buffer,n=Object.assign({},e.layout,t.layout||{},t)),{buffer:e,layout:n}}},{key:"_setGenericFloatArray",value:function(t,e){var n=this.gl;switch(e.length){case 1:n.vertexAttrib1fv(t,e);break;case 2:n.vertexAttrib2fv(t,e);break;case 3:n.vertexAttrib3fv(t,e);break;case 4:n.vertexAttrib4fv(t,e);break;default:j(!1)}}},{key:"_setGenericIntArray",value:function(t,e){var n=this.gl;switch(j(Z(n)),e.length){case 1:n.vertexAttribI1iv(t,e);break;case 2:n.vertexAttribI2iv(t,e);break;case 3:n.vertexAttribI3iv(t,e);break;case 4:n.vertexAttribI4iv(t,e);break;default:j(!1)}}},{key:"_setGenericUintArray",value:function(t,e){var n=this.gl;switch(j(Z(n)),e.length){case 1:n.vertexAttribI1uiv(t,e);break;case 2:n.vertexAttribI2uiv(t,e);break;case 3:n.vertexAttribI3uiv(t,e);break;case 4:n.vertexAttribI4uiv(t,e);break;default:j(!1)}}},{key:"_createHandle",value:function(){return this.ext.createVertexArray()}},{key:"_deleteHandle",value:function(t){return this.ext.deleteVertexArray(t),[this.elements]}},{key:"_getParameter",value:function(t,e){var n,r=e.location;switch(j(Number.isFinite(r)),this.ext.bindVertexArray(this.handle),t){case 34373:n=this.gl.getVertexAttribOffset(r,t);break;default:n=this.ext.getVertexAttrib(r,t)}return this.ext.bindVertexArray(null),n}},{key:"_getData",value:function(){var t=this;return new Array(this.MAX_ATTRIBUTES).fill(0).map((function(e,n){var r={};return ln.forEach((function(e){r[z(t.gl,e)]=t.getParameter(e,{location:n})})),r}))}},{key:"_bind",value:function(t){this.ext.bindVertexArray(t)}},{key:"filledLocations",get:function(){return this._filledLocations}}]),e}(Le);function hn(t){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pn(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function fn(t,e){return!e||"object"!==hn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function dn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vn(t,e,n){return e&&dn(t.prototype,e),n&&dn(t,n),t}function gn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var yn=[U.a.LINEAR,U.a.NEAREST],mn=(gn(un={},U.a.RGB,{dataFormat:U.a.RGB,types:[U.a.UNSIGNED_BYTE,U.a.UNSIGNED_SHORT_5_6_5]}),gn(un,U.a.RGBA,{dataFormat:U.a.RGBA,types:[U.a.UNSIGNED_BYTE,U.a.UNSIGNED_SHORT_4_4_4_4,U.a.UNSIGNED_SHORT_5_5_5_1]}),gn(un,U.a.ALPHA,{dataFormat:U.a.ALPHA,types:[U.a.UNSIGNED_BYTE]}),gn(un,U.a.LUMINANCE,{dataFormat:U.a.LUMINANCE,types:[U.a.UNSIGNED_BYTE]}),gn(un,U.a.LUMINANCE_ALPHA,{dataFormat:U.a.LUMINANCE_ALPHA,types:[U.a.UNSIGNED_BYTE]}),un);function _n(t,e){var n=mn[e];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;var r=Z(t)&&n.gl2||n.gl1;return"string"==typeof r?t.getExtension(r):r}function bn(t,e){var n=mn[e];switch(n&&n.types[0]){case U.a.FLOAT:return t.getExtension("OES_texture_float_linear");case U.a.HALF_FLOAT:return t.getExtension("OES_texture_half_float_linear");default:return!0}}var xn=function(t){function e(t,n){var r;!function(t,e){if(!pn(t,e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=n.id,o=void 0===i?et("texture"):i,a=n.handle,s=n.target;return(r=fn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,{id:o,handle:a}))).target=s,r.hasFloatTexture=t.getExtension("OES_texture_float"),r.textureUnit=void 0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),vn(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.format,r=e.linearFiltering,i=!0;return n&&(i=(i=i&&_n(t,n))&&(!r||bn(t,n))),i}}]),vn(e,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,n=t.pixels,r=void 0===n?null:n,i=t.format,o=void 0===i?U.a.RGBA:i,a=t.type,s=void 0===a?U.a.UNSIGNED_BYTE:a,u=t.border,l=void 0===u?0:u,c=t.recreate,h=void 0!==c&&c,p=t.parameters,f=void 0===p?{}:p,d=t.pixelStore,v=void 0===d?{}:d,g=t.unpackFlipY,y=void 0===g||g,m=t.mipmaps,_=void 0===m||m;e||(e=r);var b=t.width,x=t.height,w=t.dataFormat,E=this._deduceParameters({format:o,type:s,dataFormat:w,compressed:!1,data:e,width:b,height:x});b=E.width,x=E.height,w=E.dataFormat,this.width=b,this.height=x,this.format=o,this.type=s,this.dataFormat=w,this.border=l,this.mipmaps=_;var S=gn({},U.a.UNPACK_FLIP_Y_WEBGL,y),A=Object.assign({},S,v);this._isNPOT()&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),_=!1,this._updateForNPOT(f)),this.setImageData({data:e,width:b,height:x,format:o,type:s,dataFormat:w,border:l,mipmaps:_,parameters:A}),_&&this.generateMipmap(),this.setParameters(f),h&&(this.data=e)}},{key:"resize",value:function(t){var e=t.width,n=t.height;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:!1}):this}},{key:"generateMipmap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindTexture(this.target,this.handle),we(this.gl,e,(function(){t.gl.generateMipmap(t.target)})),this.gl.bindTexture(this.target,null),this}},{key:"setImageData",value:function(t){var e=this,n=t.target,r=void 0===n?this.target:n,i=t.pixels,o=void 0===i?null:i,a=t.data,s=void 0===a?null:a,u=t.width,l=t.height,c=t.level,h=void 0===c?0:c,p=t.format,f=void 0===p?U.a.RGBA:p,d=t.type,v=t.dataFormat,g=t.offset,y=void 0===g?0:g,m=t.border,_=void 0===m?0:m,b=t.compressed,x=void 0!==b&&b,w=t.parameters,E=void 0===w?{}:w;s||(s=o);var S=this._deduceParameters({format:f,type:d,dataFormat:v,compressed:x,data:s,width:u,height:l});d=S.type,v=S.dataFormat,x=S.compressed,u=S.width,l=S.height;var A=this.gl;A.bindTexture(this.target,this.handle);var T,P=this._getDataType({data:s,compressed:x});s=P.data,T=P.dataType,we(this.gl,E,(function(){switch(T){case"null":A.texImage2D(r,h,f,u,l,_,v,d,s);break;case"typed-array":A.texImage2D(r,h,f,u,l,_,v,d,s,y);break;case"buffer":Y(A),A.bindBuffer(U.a.PIXEL_UNPACK_BUFFER,s.handle||s),A.texImage2D(r,h,f,u,l,_,f,d,y);break;case"browser-object":A.texImage2D(r,h,f,f,d,s);break;case"compressed":A.compressedTexImage2D(e.target,h,f,u,l,_,s);break;default:j(!1,"Unknown image data type")}}))}},{key:"setSubImageData",value:function(t){var e=this,n=t.target,r=void 0===n?this.target:n,i=t.pixels,o=void 0===i?null:i,a=t.data,s=void 0===a?null:a,u=t.x,l=void 0===u?0:u,c=t.y,h=void 0===c?0:c,f=t.width,d=t.height,v=t.level,g=void 0===v?0:v,y=t.format,m=void 0===y?U.a.RGBA:y,_=t.type,b=t.dataFormat,x=t.compressed,w=void 0!==x&&x,E=t.offset,S=void 0===E?0:E,A=t.border,T=void 0===A?0:A,P=t.parameters,k=void 0===P?{}:P,C=this._deduceParameters({format:m,type:_,dataFormat:b,compressed:w,data:s,width:f,height:d});if(_=C.type,b=C.dataFormat,w=C.compressed,f=C.width,d=C.height,s||(s=o),s&&s.data){var O=s;s=O.data,f=O.shape[0],d=O.shape[1]}pn(s,Ve)&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),we(this.gl,k,(function(){w?e.gl.compressedTexSubImage2D(r,g,l,h,f,d,m,s):null===s?e.gl.texSubImage2D(r,g,m,f,d,T,b,_,null):ArrayBuffer.isView(s)?e.gl.texSubImage2D(r,g,l,h,f,d,m,_,s,S):pn(s,p)?(Y(e.gl),e.gl.bindBuffer(U.a.PIXEL_UNPACK_BUFFER,s),e.gl.texSubImage2D(r,g,m,f,d,T,m,_,S),e.gl.bindBuffer(U.a.GL_PIXEL_UNPACK_BUFFER,null)):e.gl.texSubImage2D(r,g,l,h,m,_,s)})),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(t){var e=t.target,n=(void 0===e&&this.target,t.framebuffer),r=(t.offset,t.x),i=void 0===r?0:r,o=t.y,a=void 0===o?0:o,s=t.width,u=t.height,l=t.level,c=void 0===l?0:l,h=t.internalFormat,p=void 0===h?U.a.RGBA:h,f=t.border,d=void 0===f?0:f;n&&n.bind(),this.bind(),this.gl.copyTexImage2D(this.target,c,p,i,a,s,u,d),this.unbind(),n&&n.unbind()}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(U.a.ACTIVE_TEXTURE)-U.a.TEXTURE0}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit;if(void 0===t)throw new Error("Texture.bind: must specify texture unit");return this.textureUnit=t,this.gl.activeTexture(U.a.TEXTURE0+t),this.gl.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){if(void 0===this.textureUnit)throw new Error("Texture.unbind: texture unit not specified");return this.gl.activeTexture(U.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,null),this.textureUnit}},{key:"_getDataType",value:function(t){var e=t.data,n=t.compressed;return void 0!==n&&n?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:pn(e,Ve)?{data:e.handle,dataType:"buffer"}:pn(e,p)?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}},{key:"setImage3D",value:function(t){var e=t.level,n=void 0===e?0:e,r=t.internalformat,i=void 0===r?U.a.RGBA:r,o=t.width,a=t.height,s=t.depth,u=void 0===s?1:s,l=t.border,c=void 0===l?0:l,h=t.format,p=t.type,f=void 0===p?U.a.UNSIGNED_BYTE:p,d=t.offset,v=void 0===d?0:d,g=t.pixels;return ArrayBuffer.isView(g)?(this.gl.texImage3D(this.target,n,i,o,a,u,c,h,f,g),this):(pn(g,Ve)&&(this.gl.bindBuffer(U.a.PIXEL_UNPACK_BUFFER,g.handle),this.gl.texImage3D(this.target,n,i,o,a,u,c,h,f,v)),this)}},{key:"_deduceParameters",value:function(t){var e=t.format,n=t.data,r=t.width,i=t.height,o=t.dataFormat,a=t.type,s=t.compressed,u=mn[e];o=o||u&&u.dataFormat,a=a||u&&u.types[0],s=s||u&&u.compressed;var l=this._deduceImageSize({data:n,width:r,height:i});return{dataFormat:o,type:a,compressed:s,width:r=l.width,height:i=l.height,format:e,data:n}}},{key:"_deduceImageSize",value:function(t){var e,n=t.data,r=t.width,i=t.height;return j(e="undefined"!=typeof ImageData&&pn(n,ImageData)?{width:n.width,height:n.height}:"undefined"!=typeof HTMLImageElement&&pn(n,HTMLImageElement)?{width:n.naturalWidth,height:n.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&pn(n,HTMLCanvasElement)?{width:n.width,height:n.height}:"undefined"!=typeof HTMLVideoElement&&pn(n,HTMLVideoElement)?{width:n.videoWidth,height:n.videoHeight}:n?{width:r,height:i}:{width:r>=0?r:1,height:i>=0?i:1},"Could not deduced texture size"),j(void 0===r||e.width===r,"Deduced texture width does not match supplied width"),j(void 0===i||e.height===i,"Deduced texture height does not match supplied height"),e}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle)}},{key:"_getParameter",value:function(t){switch(t){case U.a.TEXTURE_WIDTH:return this.width;case U.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);var e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}},{key:"_setParameter",value:function(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case U.a.TEXTURE_MIN_LOD:case U.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,t,e);break;case U.a.TEXTURE_WIDTH:case U.a.TEXTURE_HEIGHT:throw new Error("Cannot set emulated parameter");default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!(Z(this.gl)||nt(this.width)&&nt(this.height))}},{key:"_updateForNPOT",value:function(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, forcing TEXTURE_MIN_FILTER to LINEAR"))(),t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, forcing TEXTURE_WRAP_S to CLAMP_TO_EDGE"))(),t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, forcing TEXTURE_WRAP_T to CLAMP_TO_EDGE"))(),t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(t,e){if(this._isNPOT())switch(t){case U.a.TEXTURE_MIN_FILTER:-1===yn.indexOf(e)&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, forcing TEXTURE_MIN_FILTER to LINEAR"))(),e=U.a.LINEAR);break;case U.a.TEXTURE_WRAP_S:case U.a.TEXTURE_WRAP_T:e!==U.a.CLAMP_TO_EDGE&&(it.a.warn("texture: ".concat(this," is Non-Power-Of-Two, ").concat(z(this.gl,t)," to CLAMP_TO_EDGE"))(),e=U.a.CLAMP_TO_EDGE)}return e}}]),e}(Le);function wn(t){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function En(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Sn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function An(t,e,n){return e&&Sn(t.prototype,e),n&&Sn(t,n),t}function Tn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Pn,kn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return En(this,e),K(t),(n=function(t,e){return!e||"object"!==wn(e)&&"function"!=typeof e?Tn(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,Object.assign({},r,{target:t.TEXTURE_2D})))).initialize(r),Object.seal(Tn(n)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),An(e,null,[{key:"isSupported",value:function(t,e){return xn.isSupported(t,e)}}]),An(e,[{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;if(void 0===t)throw new Error("Texture.bind: must specify texture unit");return this.textureUnit=t,e.activeTexture(e.TEXTURE0+t),e.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){var t=this.gl;if(void 0===this.textureUnit)throw new Error("Texture.unbind: texture unit not specified");return t.activeTexture(t.TEXTURE0+this.textureUnit),t.bindTexture(this.target,null),this.textureUnit}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(U.a.ACTIVE_TEXTURE)-U.a.TEXTURE0}}]),e}(xn);function Cn(t){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function On(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function In(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Mn(t,e,n){return e&&In(t.prototype,e),n&&In(t,n),t}function Rn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ln(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Fn="EXT_color_buffer_float",Nn=(Ln(Pn={},U.a.DEPTH_COMPONENT16,{}),Ln(Pn,U.a.DEPTH_COMPONENT24,{gl2:!0}),Ln(Pn,U.a.DEPTH_COMPONENT32F,{gl2:!0}),Ln(Pn,U.a.STENCIL_INDEX8,{}),Ln(Pn,U.a.DEPTH_STENCIL,{}),Ln(Pn,U.a.DEPTH24_STENCIL8,{gl2:!0}),Ln(Pn,U.a.DEPTH32F_STENCIL8,{gl2:!0}),Ln(Pn,U.a.RGBA4,{}),Ln(Pn,U.a.RGB565,{}),Ln(Pn,U.a.RGB5_A1,{}),Ln(Pn,U.a.R8,{gl2:!0}),Ln(Pn,U.a.R8UI,{gl2:!0}),Ln(Pn,U.a.R8I,{gl2:!0}),Ln(Pn,U.a.R16UI,{gl2:!0}),Ln(Pn,U.a.R16I,{gl2:!0}),Ln(Pn,U.a.R32UI,{gl2:!0}),Ln(Pn,U.a.R32I,{gl2:!0}),Ln(Pn,U.a.RG8,{gl2:!0}),Ln(Pn,U.a.RG8UI,{gl2:!0}),Ln(Pn,U.a.RG8I,{gl2:!0}),Ln(Pn,U.a.RG16UI,{gl2:!0}),Ln(Pn,U.a.RG16I,{gl2:!0}),Ln(Pn,U.a.RG32UI,{gl2:!0}),Ln(Pn,U.a.RG32I,{gl2:!0}),Ln(Pn,U.a.RGB8,{gl2:!0}),Ln(Pn,U.a.RGBA8,{gl2:!0}),Ln(Pn,U.a.RGB10_A2,{gl2:!0}),Ln(Pn,U.a.RGBA8UI,{gl2:!0}),Ln(Pn,U.a.RGBA8I,{gl2:!0}),Ln(Pn,U.a.RGB10_A2UI,{gl2:!0}),Ln(Pn,U.a.RGBA16UI,{gl2:!0}),Ln(Pn,U.a.RGBA16I,{gl2:!0}),Ln(Pn,U.a.RGBA32I,{gl2:!0}),Ln(Pn,U.a.RGBA32UI,{gl2:!0}),Ln(Pn,U.a.R16F,{gl2:Fn}),Ln(Pn,U.a.RG16F,{gl2:Fn}),Ln(Pn,U.a.RGBA16F,{gl2:Fn}),Ln(Pn,U.a.R32F,{gl2:Fn}),Ln(Pn,U.a.RG32F,{gl2:Fn}),Ln(Pn,U.a.RGBA32F,{gl2:Fn}),Ln(Pn,U.a.R11F_G11F_B10F,{gl2:Fn}),Pn);function jn(t,e,n){var r=n[e];if(!r)return!1;var i=Z(t)&&r.gl2||r.gl1;return"string"==typeof i?t.getExtension(i):i}var Dn=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return On(this,e),(n=function(t,e){return!e||"object"!==Cn(e)&&"function"!=typeof e?Rn(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).initialize(r),Object.seal(Rn(n)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),Mn(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.format;return!n||jn(t,n,Nn)}},{key:"getSamplesForFormat",value:function(t,e){var n=e.format;return t.getInternalformatParameter(36161,n,32937)}}]),Mn(e,[{key:"initialize",value:function(t){var e=t.format,n=t.width,r=void 0===n?1:n,i=t.height,o=void 0===i?1:i,a=t.samples,s=void 0===a?0:a;return j(e,"Needs format"),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&Z(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,r,o):this.gl.renderbufferStorage(36161,e,r,o),this.format=e,this.width=r,this.height=o,this.samples=s,this}},{key:"resize",value:function(t){var e=t.width,n=t.height;return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle)}},{key:"_syncHandle",value:function(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}]),e}(Le);function zn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Bn=256,Un=1024,Vn=16384,Gn=6144,Wn=6145,Xn=6146,Hn=34041,qn="clear: bad arguments";function Zn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,r=void 0===n?null:n,i=e.color,o=void 0===i?null:i,a=e.depth,s=void 0===a?null:a,u=e.stencil,l=void 0===u?null:u,c={};r&&(c.framebuffer=r);var h=0;o&&(h|=Vn,!0!==o&&(c.clearColor=o)),s&&(h|=Bn,!0!==s&&(c.clearDepth=s)),l&&(h|=Un,!0!==s&&(c.clearStencil=s)),j(0!==h,qn),we(t,c,(function(){t.clear(h)}))}function Kn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.framebuffer,r=void 0===n?null:n,i=e.buffer,o=void 0===i?Gn:i,a=e.drawBuffer,s=void 0===a?0:a,u=e.value,l=void 0===u?[0,0,0,0]:u;Y(t),we(t,{framebuffer:r},(function(){switch(o){case Gn:switch(l.constructor){case Int32Array:t.clearBufferiv(o,s,l);break;case Uint32Array:t.clearBufferuiv(o,s,l);break;case Float32Array:default:t.clearBufferfv(o,s,l)}break;case Wn:t.clearBufferfv(Wn,0,[l]);break;case Xn:t.clearBufferiv(Xn,0,[l]);break;case Hn:var e=zn(l,2),n=e[0],r=e[1];t.clearBufferfi(Hn,0,n,r);break;default:j(!1,qn)}}))}var Yn=6406,Jn=6407,Qn=6408,$n=5121,tr=32819,er=32820,nr=33635,rr=5126;function ir(t){switch(t){case Yn:return 1;case Jn:return 3;case Qn:return 4;default:return j(!1),0}}function or(t){return(or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ar(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ur(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function lr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cr(t,e,n){return e&&lr(t.prototype,e),n&&lr(t,n),t}function hr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var pr=36064,fr=34069,dr=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!ur(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e){return!e||"object"!==or(e)&&"function"!=typeof e?hr(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).width=null,n.height=null,n.attachments={},n.readBuffer=pr,n.drawBuffers=[pr],n.initialize(r),Object.seal(hr(n)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),cr(e,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.colorBufferFloat,r=e.colorBufferHalfFloat;return n&&t.getExtension(Z(t)?"EXT_color_buffer_float":"WEBGL_color_buffer_float"),r&&t.getExtension(Z(t)?"EXT_color_buffer_float":"EXT_color_buffer_half_float")}},{key:"getDefaultFramebuffer",value:function(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer||(t.luma.defaultFramebuffer=new e(t,{handle:null,attachments:{}})),t.luma.defaultFramebuffer}}]),cr(e,[{key:"initialize",value:function(t){var e=t.width,n=void 0===e?1:e,r=t.height,i=void 0===r?1:r,o=t.attachments,a=void 0===o?null:o,s=t.color,u=void 0===s||s,l=t.depth,c=void 0===l||l,h=t.stencil,p=void 0!==h&&h,f=t.check,d=void 0===f||f,v=t.readBuffer,g=t.drawBuffers;if(j(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,a)for(var y in a){var m=a[y];(Array.isArray(m)?m[0]:m).resize({width:n,height:i})}else a=this._createDefaultAttachments({color:u,depth:c,stencil:p,width:n,height:i});this.update({clearAttachments:!0,attachments:a,readBuffer:v,drawBuffers:g}),a&&d&&this.checkStatus()}},{key:"update",value:function(t){var e=t.attachments,n=void 0===e?{}:e,r=t.readBuffer,i=t.drawBuffers,o=t.clearAttachments,a=void 0!==o&&o;this.attach(n,{clearAttachments:a});var s=this.gl,u=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),s.bindFramebuffer(36160,u||null),this}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,n=t.height;if(null===this.handle)return j(void 0===e&&void 0===n),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var r in void 0===e&&(e=this.gl.drawingBufferWidth),void 0===n&&(n=this.gl.drawingBufferHeight),e!==this.width&&n!==this.height&&it.a.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(n)),this.attachments)this.attachments[r].resize({width:e,height:n});return this.width=e,this.height=n,this}},{key:"attach",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.clearAttachments,i=void 0!==r&&r,o={};i&&Object.keys(this.attachments).forEach((function(t){o[t]=null})),Object.assign(o,t);var a=this.gl.bindFramebuffer(36160,this.handle);for(var s in o){j("undefined"!==s,"Misspelled framebuffer binding point?");var u=o[s],l=u;if(l)if(ur(l,Dn))this._attachRenderbuffer({attachment:s,renderbuffer:l});else if(Array.isArray(u)){var c=sr(u,3),h=c[0],p=c[1],f=void 0===p?0:p,d=c[2],v=void 0===d?0:d;l=h,this._attachTexture({attachment:s,texture:h,layer:f,level:v})}else this._attachTexture({attachment:s,texture:l,layer:0,level:0});else this._unattach({attachment:s});l&&l.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,a||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((function(t){return!e.attachments[t]})).forEach((function(t){delete e.attachments[t]}))}},{key:"checkStatus",value:function(){var t=this.gl,e=t.bindFramebuffer(36160,this.handle),n=t.checkFramebufferStatus(36160);if(t.bindFramebuffer(36160,e||null),n!==t.FRAMEBUFFER_COMPLETE)throw new Error(function(t){return(dr.STATUS||{})[t]||"Framebuffer error ".concat(t)}(n));return this}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,n=t.depth,r=t.stencil,i=t.drawBuffers,o=void 0===i?[]:i,a=this.gl.bindFramebuffer(36160,this.handle);return(e||n||r)&&Zn(this.gl,{color:e,depth:n,stencil:r}),o.forEach((function(t,e){Kn({drawBuffer:e,value:t})})),this.gl.bindFramebuffer(36160,a||null),this}},{key:"readPixels",value:function(t){var e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.width,a=void 0===o?this.width:o,s=t.height,u=void 0===s?this.height:s,l=t.format,c=void 0===l?U.a.RGBA:l,h=t.type,p=t.pixelArray,f=void 0===p?null:p,d=t.attachment,v=void 0===d?pr:d,g=this.gl;if(v===U.a.COLOR_ATTACHMENT0&&null===this.handle&&(v=U.a.FRONT),!f){var y=L(h=h||g.UNSIGNED_BYTE,{clamped:!1}),m=ir(c);f=f||new y(a*u*m)}h=h||R(f);var _=this.gl.bindFramebuffer(36160,this.handle);return this.gl.readPixels(n,i,a,u,c,h,f),this.gl.bindFramebuffer(36160,_||null),f}},{key:"readPixelsToBuffer",value:function(t){var e=t.x,n=void 0===e?0:e,r=t.y,i=void 0===r?0:r,o=t.width,a=void 0===o?this.width:o,s=t.height,u=void 0===s?this.height:s,l=t.format,c=void 0===l?U.a.RGBA:l,h=t.type,p=t.buffer,f=void 0===p?null:p,d=t.byteOffset,v=void 0===d?0:d,g=this.gl;if(Y(g),h=h||(f?f.type:U.a.UNSIGNED_BYTE),!f){var y=ir(c),m=function(t){switch(t){case $n:return 1;case nr:case tr:case er:return 2;case rr:return 4;default:return j(!1),0}}(h);f=new Ve(g,{bytes:v+a*u*y*m,type:h,size:y})}return f.bind({target:U.a.PIXEL_PACK_BUFFER}),we(g,{framebuffer:this},(function(){g.readPixels(n,i,a,u,c,h,v)})),f.unbind({target:U.a.PIXEL_PACK_BUFFER}),f}},{key:"copyToDataUrl",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.attachment,n=void 0===e?pr:e,r=t.maxHeight,i=void 0===r?Number.MAX_SAFE_INTEGER:r,o=this.readPixels({attachment:n}),a=this.width,s=this.height;s>i;){var u=N({data:o,width:a,height:s});o=u.data,a=u.width,s=u.height}F({data:o,width:a,height:s});var l=document.createElement("canvas");l.width=a,l.height=s;var c=l.getContext("2d"),h=c.createImageData(a,s);return h.data.set(o),c.putImageData(h,0,0),l.toDataURL()}},{key:"copyToImage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.image,n=void 0===e?null:e,r=t.attachment,i=void 0===r?pr:r,o=t.maxHeight,a=(void 0===o&&Number.MAX_SAFE_INTEGER,this.readDataUrl({attachment:i}));return(n=n||new Image).src=a,n}},{key:"copyToTexture",value:function(t){var e=t.texture,n=t.target,r=t.xoffset,i=void 0===r?0:r,o=t.yoffset,a=void 0===o?0:o,s=t.zoffset,u=void 0===s?0:s,l=t.mipmapLevel,c=void 0===l?0:l,h=t.attachment,p=void 0===h?pr:h,f=t.x,d=void 0===f?0:f,v=t.y,g=void 0===v?0:v,y=t.width,m=t.height,_=this.gl,b=_.bindFramebuffer(36160,this.handle),x=_.readBuffer(p);switch(y=Number.isFinite(y)?y:e.width,m=Number.isFinite(m)?m:e.height,e.target){case 3553:case 34067:_.copyTexSubImage2D(n||e.target,c,i,a,d,g,y,m);break;case 35866:case 32879:_.copyTexSubImage3D(n||e.target,c,i,a,u,d,g,y,m)}return _.readBuffer(x),_.bindFramebuffer(36160,b||null),e}},{key:"blit",value:function(t){var e=t.srcFramebuffer,n=t.attachment,r=void 0===n?pr:n,i=t.srcX0,o=void 0===i?0:i,a=t.srcY0,s=void 0===a?0:a,u=t.srcX1,l=t.srcY1,c=t.dstX0,h=void 0===c?0:c,p=t.dstY0,f=void 0===p?0:p,d=t.dstX1,v=t.dstY1,g=t.color,y=void 0===g||g,m=t.depth,_=void 0!==m&&m,b=t.stencil,x=void 0!==b&&b,w=t.mask,E=void 0===w?0:w,S=t.filter,A=void 0===S?U.a.NEAREST:S,T=this.gl;Y(T),e.handle||r!==pr||(r=U.a.FRONT),y&&(E|=16384),_&&(E|=256),x&&(E|=1024),j(E),u=void 0===u?e.width:u,l=void 0===l?e.height:l,d=void 0===d?this.width:d,v=void 0===v?this.height:v;var P=T.bindFramebuffer(36008,this.handle),k=T.bindFramebuffer(36009,e.handle);return T.readBuffer(r),T.blitFramebuffer(o,s,u,l,h,f,d,v,E,A),T.readBuffer(this.readBuffer),T.bindFramebuffer(36009,k||null),T.bindFramebuffer(36008,P||null),this}},{key:"invalidate",value:function(t){var e=t.attachments,n=void 0===e?[]:e,r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o,s=t.width,u=t.height,l=this.gl;Y(l);var c=l.bindFramebuffer(36009,this.handle);return 0===i&&0===a&&void 0===s&&void 0===u?l.invalidateFramebuffer(36009,n):l.invalidateFramebuffer(36009,n,i,a,s,u),l.bindFramebuffer(36009,c),this}},{key:"getAttachmentParameter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.attachment,n=void 0===e?pr:e,r=t.pname,i=this._getAttachmentParameterFallback(r);return null===i&&(this.gl.bindTexture(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,n,r),this.gl.bindTexture(36160,null)),i}},{key:"getAttachmentParameters",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.constructor.ATTACHMENT_PARAMETERS||{},e={};for(var n in t)e[n]=this.getAttachmentParameter(n);return this}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(this.copyToDataUrl(),"luma-debug-texture"),this}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.priority,n=void 0===e?0:e,r=t.message,i=void 0===r?"":r;if(n>it.a.priority||"undefined"==typeof window)return this;i=i||"Framebuffer ".concat(this.id);var o=this.copyToDataUrl({maxHeight:100});return it.a.image({priority:n,message:i,image:o},i)(),this}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?36160:e;return this.gl.bindFramebuffer(n,this.handle),this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,n=void 0===e?36160:e;return this.gl.bindFramebuffer(n,null),this}},{key:"_createDefaultAttachments",value:function(t){var e,n=t.color,r=t.depth,i=(t.stencil,t.width),o=t.height,a=null;n&&((a=a||{})[pr]=new kn(this.gl,{pixels:null,format:U.a.RGBA,type:U.a.UNSIGNED_BYTE,width:i,height:o,mipmaps:!1,parameters:(e={},ar(e,U.a.TEXTURE_MIN_FILTER,U.a.NEAREST),ar(e,U.a.TEXTURE_MAG_FILTER,U.a.NEAREST),ar(e,U.a.TEXTURE_WRAP_S,U.a.CLAMP_TO_EDGE),ar(e,U.a.TEXTURE_WRAP_T,U.a.CLAMP_TO_EDGE),e)}));return r&&((a=a||{})[36096]=new Dn(this.gl,{format:U.a.DEPTH_COMPONENT16,width:i,height:o})),a}},{key:"_unattach",value:function(t){var e=t.attachment;this.gl.bindRenderbuffer(36161,this.handle),this.gl.framebufferRenderbuffer(36160,e,36161,null),delete this.attachments[e]}},{key:"_attachRenderbuffer",value:function(t){var e=t.attachment,n=void 0===e?pr:e,r=t.renderbuffer;this.gl.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}},{key:"_attachTexture",value:function(t){var e=t.attachment,n=void 0===e?pr:e,r=t.texture,i=t.layer,o=t.level,a=this.gl;switch(a.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:a.framebufferTextureLayer(36160,n,r.target,o,i);break;case 34067:var s=function(t){return t<fr?t+fr:t}(i);a.framebufferTexture2D(36160,n,s,r.handle,o);break;case 3553:a.framebufferTexture2D(36160,n,3553,r.handle,o);break;default:j(!1,"Illegal texture type")}a.bindTexture(r.target,null),this.attachments[n]=r}},{key:"_setReadBuffer",value:function(t,e){Z(t)?t.readBuffer(e):j(e===pr||e===U.a.BACK,"Multiple render targets not supported"),this.readBuffer=e}},{key:"_setDrawBuffers",value:function(t,e){if(Z(t))t.drawBuffers(e);else{var n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):j(1===e.length&&(e[0]===pr||e[0]===U.a.BACK),"Multiple render targets not supported")}this.drawBuffers=e}},{key:"_getAttachmentParameterFallback",value:function(t){var e=function(t){if(t.luma=t.luma||{},!t.luma.caps)for(var e in t.luma.caps={},t.luma.caps.webgl2=Z(t),Ee)t.luma.caps[e]=Pe(t,e);return t.luma.caps}(this.gl);switch(t){case U.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return e.webgl2?null:0;case U.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case U.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case U.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case U.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case U.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case U.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return e.webgl2?null:8;case U.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return e.webgl2?null:U.a.UNSIGNED_INT;case U.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return e.webgl2||e.EXT_sRGB?null:U.a.LINEAR;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"color",get:function(){return this.attachments[pr]||null}},{key:"texture",get:function(){return this.attachments[pr]||null}},{key:"depth",get:function(){return this.attachments[36096]||null}},{key:"stencil",get:function(){return this.attachments[36128]||null}}]),e}(Le);function vr(t){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mr(t,e,n){return e&&yr(t.prototype,e),n&&yr(t,n),t}function _r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var br,xr=function(t){function e(t,n){var r;return gr(this,e),Y(t),r=function(t,e){return!e||"object"!==vr(e)&&"function"!=typeof e?_r(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),Object.seal(_r(r)),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),mr(e,null,[{key:"isSupported",value:function(t){return Z(t)}},{key:"isHandle",value:function(t){return this.gl.isSampler(this.handle)}}]),mr(e,[{key:"bind",value:function(t){return this.gl.bindSampler(t,this.handle),this}},{key:"unbind",value:function(t){return this.gl.bindSampler(t,null),this}},{key:"_createHandle",value:function(){return this.gl.createSampler()}},{key:"_deleteHandle",value:function(){this.gl.deleteSampler(this.handle)}},{key:"_getParameter",value:function(t){return this.gl.getSamplerParameter(this.handle,t)}},{key:"_setParameter",value:function(t,e){switch(t){case U.a.TEXTURE_MIN_LOD:case U.a.TEXTURE_MAX_LOD:this.gl.samplerParameterf(this.handle,t,e);break;default:this.gl.samplerParameteri(this.handle,t,e)}return this}}]),e}(Le);function wr(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function Er(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Sr=(Er(br={},5126,(function(t,e,n){return t.uniform1f(e,n)})),Er(br,35664,(function(t,e,n){return t.uniform2fv(e,Cr(n,2))})),Er(br,35665,(function(t,e,n){return t.uniform3fv(e,Cr(n,3))})),Er(br,35666,(function(t,e,n){return t.uniform4fv(e,Cr(n,4))})),Er(br,5124,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,35667,(function(t,e,n){return t.uniform2iv(e,Or(n,2))})),Er(br,35668,(function(t,e,n){return t.uniform3iv(e,Or(n,3))})),Er(br,35669,(function(t,e,n){return t.uniform4iv(e,Or(n,4))})),Er(br,35670,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,35671,(function(t,e,n){return t.uniform2iv(e,Or(n,2))})),Er(br,35672,(function(t,e,n){return t.uniform3iv(e,Or(n,3))})),Er(br,35673,(function(t,e,n){return t.uniform4iv(e,Or(n,4))})),Er(br,35674,(function(t,e,n){return t.uniformMatrix2fv(e,!1,Cr(n,4))})),Er(br,35675,(function(t,e,n){return t.uniformMatrix3fv(e,!1,Cr(n,9))})),Er(br,35676,(function(t,e,n){return t.uniformMatrix4fv(e,!1,Cr(n,16))})),Er(br,35678,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,35680,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,5125,(function(t,e,n){return t.uniform1ui(e,n)})),Er(br,36294,(function(t,e,n){return t.uniform2uiv(e,Ir(n,2))})),Er(br,36295,(function(t,e,n){return t.uniform3uiv(e,Ir(n,3))})),Er(br,36296,(function(t,e,n){return t.uniform4uiv(e,Ir(n,4))})),Er(br,35685,(function(t,e,n){return t.uniformMatrix2x3fv(e,!1,Cr(n,6))})),Er(br,35686,(function(t,e,n){return t.uniformMatrix2x4fv(e,!1,Cr(n,8))})),Er(br,35687,(function(t,e,n){return t.uniformMatrix3x2fv(e,!1,Cr(n,6))})),Er(br,35688,(function(t,e,n){return t.uniformMatrix3x4fv(e,!1,Cr(n,12))})),Er(br,35689,(function(t,e,n){return t.uniformMatrix4x2fv(e,!1,Cr(n,8))})),Er(br,35690,(function(t,e,n){return t.uniformMatrix4x3fv(e,!1,Cr(n,12))})),Er(br,35679,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,35682,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36289,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36292,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36293,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36298,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36299,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36300,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36303,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36306,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36307,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36308,(function(t,e,n){return t.uniform1i(e,n)})),Er(br,36311,(function(t,e,n){return t.uniform1i(e,n)})),br),Ar={},Tr={},Pr={};function kr(t,e,n,r){var i=t.length;if(i%e&&it.a.warn("Uniform size should be multiples of ".concat(e),t)(),wr(t,n))return t;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=t[a];return o}function Cr(t,e){return kr(t,e,Float32Array,Ar)}function Or(t,e){return kr(t,e,Int32Array,Tr)}function Ir(t,e){return kr(t,e,Uint32Array,Pr)}function Mr(t){var e=t.match(/([^\[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function Rr(t,e,n){var r=Sr[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r.bind(null,t,e)}function Lr(t,e){for(var n in t){var r=t[n];if(!Fr(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(n),r),new Error("".concat(e," Bad uniform ").concat(n))}return!0}function Fr(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;for(var e=Math.min(t.length,16),n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(!(!wr(t,xn)&&!wr(t,xr))||!!wr(t,dr)&&Boolean(t.texture)))}function Nr(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t)){if(!e)return!1;var n=t.length;if(e.length!==n)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return t===e}function jr(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.header,n=void 0===e?"Uniforms":e,r=t.program,i=t.uniforms,o=t.undefinedOnly,a=void 0!==o&&o;j(r);var s=r._uniformSetters,u={},l=Object.keys(s).sort(),c=0,h=!0,p=!1,f=void 0;try{for(var d,v=l[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var g=d.value;g.match(".*_.*")||g.match(".*Matrix")||Dr({table:u,header:n,uniforms:i,uniformName:g,undefinedOnly:a})&&c++}}catch(t){p=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(p)throw f}}var y=!0,m=!1,_=void 0;try{for(var b,x=l[Symbol.iterator]();!(y=(b=x.next()).done);y=!0){var w=b.value;w.match(".*Matrix")&&Dr({table:u,header:n,uniforms:i,uniformName:w,undefinedOnly:a})&&c++}}catch(t){m=!0,_=t}finally{try{y||null==x.return||x.return()}finally{if(m)throw _}}var E=!0,S=!1,A=void 0;try{for(var T,P=l[Symbol.iterator]();!(E=(T=P.next()).done);E=!0){var k=T.value;u[k]||Dr({table:u,header:n,uniforms:i,uniformName:k,undefinedOnly:a})&&c++}}catch(t){S=!0,A=t}finally{try{E||null==P.return||P.return()}finally{if(S)throw A}}var C=0,O={};if(!a)for(var I in i){var M=i[I];u[I]||(C++,O[I]=Er({Type:"NOT USED: ".concat(M)},n,ot(M)))}return{table:u,count:c,unusedTable:O,unusedCount:C}}function Dr(t){var e,n=t.table,r=t.header,i=t.uniforms,o=t.uniformName,a=t.undefinedOnly,s=i[o],u=function(t){return null!=t}(s);return(!a||!u)&&(n[o]=(Er(e={},r,u?ot(s):"N/A"),Er(e,"Uniform Type",u?s:"NOT PROVIDED"),e),!0)}var zr=0,Br=1,Ur=2,Vr=3,Gr=4,Wr=5,Xr=6;function Hr(t){switch(t){case zr:return zr;case Br:case Vr:case Ur:return Br;case Gr:case Wr:case Xr:return Gr;default:return j(!1),0}}function qr(t){return(qr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zr(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function Kr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yr(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:Yr(i,e,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0}function Jr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Qr=35980,$r=35981,ti=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!Zr(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e){return!e||"object"!==qr(e)&&"function"!=typeof e?Jr(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).initialize(r),n.vertexAttributes=cn.getDefaultArray(t),Object.seal(Jr(n)),n._setId(r.id),n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vs,n=t.fs,r=t.defaultUniforms,i=t.varyings,o=t.bufferMode,a=void 0===o?$r:o;return this.vs="string"==typeof e?new $e(this.gl,e):e,this.fs="string"==typeof n?new tn(this.gl,n):n,j(Zr(this.vs,$e),"Program: bad vertex shader"),j(Zr(this.fs,tn),"Program: bad fragment shader"),this.defaultUniforms=r,i?(Y(this.gl),this.varyings=i,this.gl.transformFeedbackVaryings(this.handle,i,a),this.varyingMap=ei(i,a)):this.varyingMap={},this._compileAndLink(),this._isCached=!1,this}},{key:"checkAttributeBindings",value:function(t){var e=t.vertexArray,n=e?e.filledLocations:this.vertexAttributes.filledLocations;for(var r in this._attributeToLocationMap){var i=this._attributeToLocationMap[r];n[i]||this._warnedLocations[i]||(it.a.warn("Program ".concat(this.id,": Attribute ").concat(i,":").concat(r," not supplied"))(),this._warnedLocations[i]=!0)}return this}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:Yr(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"delete",this).call(this,t)}},{key:"reset",value:function(){this.unsetBuffers()}},{key:"use",value:function(){return this.gl.useProgram(this.handle),this}},{key:"draw",value:function(t){var e=this,n=t.drawMode,r=void 0===n?U.a.TRIANGLES:n,i=t.vertexCount,o=t.offset,a=void 0===o?0:o,s=t.start,u=t.end,l=t.isIndexed,c=void 0!==l&&l,h=t.indexType,p=void 0===h?U.a.UNSIGNED_SHORT:h,f=t.isInstanced,d=void 0!==f&&f,v=t.instanceCount,g=void 0===v?0:v,y=t.vertexArray,m=void 0===y?null:y,_=t.transformFeedback,b=void 0===_?null:_,x=t.uniforms,w=void 0===x?{}:x,E=t.samplers,S=void 0===E?{}:E,A=t.parameters,T=void 0===A?{}:A;return(m=m||cn.getDefaultArray(this.gl)).bind((function(){if(e.gl.useProgram(e.handle),b){var t=Hr(r);b.begin(t)}e.setUniforms(w,S),we(e.gl,T,(function(){c&&d?e.ext.drawElementsInstanced(r,i,p,a,g):c&&Z(e.gl)&&!isNaN(s)&&!isNaN(u)?e.gl.drawElementsRange(r,s,u,i,p,a):c?e.gl.drawElements(r,i,p,a):d?e.ext.drawArraysInstanced(r,a,i,g):e.gl.drawArrays(r,a,i)})),b&&b.end()})),this}},{key:"setAttributes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.clear,r=void 0===n||n,i=e.drawParams,o=void 0===i?{}:i;r&&this.vertexAttributes.clearBindings(),o.isInstanced=!1,o.isIndexed=!1,o.indexType=null;for(var a=this._sortBuffersByLocation(t),s=a.locations,u=a.elements,l=0;l<s.length;++l){var c=s[l],h=t[c];h?h.isGeneric?this._setAttributeToGeneric({location:l,array:h.value}):(this._setAttributeToBuffer({location:l,buffer:h.getBuffer(),layout:h}),Object.assign(o,{isInstanced:h.instanced>0})):this.vertexAttributes.disable(l)}if(u){var p=t[u];p.getBuffer().bind(),o.isIndexed=!0,o.indexType=p.type}return this}},{key:"setBuffers",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.clear,r=void 0===n||n,i=e.drawParams,o=void 0===i?{}:i;it.a.deprecated("Program: `setBuffers`","`setAttributes`"),r&&this.vertexAttributes.clearBindings(),o.isInstanced=!1,o.isIndexed=!1,o.indexType=null;for(var a=this._sortBuffersByLocation(t),s=a.locations,u=a.elements,l=0;l<s.length;++l){var c=s[l],h=t[c];h?Zr(h,Ve)?(this._setAttributeToBuffer({location:l,buffer:h,layout:h.layout}),Object.assign(o,{isInstanced:h.layout.instanced>0})):this._setAttributeToGeneric({location:l,array:h}):this.vertexAttributes.disable(l)}if(u){var p=t[u];p.bind(),o.isIndexed=!0,o.indexType=p.layout.type}return this}},{key:"unsetBuffers",value:function(){for(var t=this._attributeCount,e=1;e<t;++e)this.vertexAttributes.disable(e);return this.gl.bindBuffer(U.a.ELEMENT_ARRAY_BUFFER,null),this}},{key:"setUniforms",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in t){var r=t[n],i=this._uniformSetters[n],o=e[n];if(i)if(Zr(r,dr)&&(r=r.texture),Zr(r,xn)){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);var a=r,s=i.textureIndex;a.bind(s),o&&o.bind(s),i(s)}else i(r)}return this}},{key:"uniformBlockBinding",value:function(t,e){Y(this.gl),this.gl.uniformBlockBinding(this.handle,t,e)}},{key:"getAttributeCount",value:function(){return this._getParameter(U.a.ACTIVE_ATTRIBUTES)}},{key:"getAttributeLocation",value:function(t){return this.gl.getAttribLocation(this.handle,t)}},{key:"getAttributeInfo",value:function(t){return this.gl.getActiveAttrib(this.handle,t)}},{key:"getUniformCount",value:function(){return this._getParameter(U.a.ACTIVE_UNIFORMS)}},{key:"getUniformInfo",value:function(t){return this.gl.getActiveUniform(this.handle,t)}},{key:"getUniformLocation",value:function(t){return this.gl.getUniformLocation(this.handle,t)}},{key:"getUniformValue",value:function(t){return this.gl.getUniform(this.handle,t)}},{key:"getActiveUniforms",value:function(t,e){return this.gl.getActiveUniforms(this.handle,t,e)}},{key:"getVarying",value:function(t,e){return this.gl.getTransformFeedbackVarying(t,e)}},{key:"getFragDataLocation",value:function(t){return Y(this.gl),this.gl.getFragDataLocation(this.handle,t)}},{key:"getAttachedShaders",value:function(){return this.gl.getAttachedShaders(this.handle)}},{key:"getUniformBlockIndex",value:function(t){return Y(this.gl),this.gl.getUniformBlockIndex(this.handle,t)}},{key:"getActiveUniformBlockParameter",value:function(t,e){return Y(this.gl),this.gl.getActiveUniformBlockParameter(this.handle,t,e)}},{key:"_setAttributeToGeneric",value:function(t){var e=t.location,n=t.array;this.vertexAttributes.setGeneric({location:e,array:n}),this.vertexAttributes.disable(e,!0)}},{key:"_setAttributeToBuffer",value:function(t){var e=t.location,n=t.buffer,r=t.layout,i=r.instanced?1:0;this.vertexAttributes.setBuffer({location:e,buffer:n,layout:r}),this.vertexAttributes.setDivisor(e,i),this.vertexAttributes.enable(e)}},{key:"_compileAndLink",value:function(){var t=this.gl;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),it.a.time(3,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),it.a.timeEnd(3,"linkProgram for ".concat(this._getName()))(),(t.debug||it.a.priority>0)&&(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,t.LINK_STATUS)))throw new Error("Error linking ".concat(t.getProgramInfoLog(this.handle)));this._queryAttributeLocations(),this._queryUniformLocations()}},{key:"_sortBuffersByLocation",value:function(t){var e=null,n=[];if(rt(t))return{locations:n,elements:e};for(var r in n=new Array(this._attributeCount),t){var i=t[r],o=this._attributeToLocationMap[r];if(void 0===o){if(i.target===U.a.ELEMENT_ARRAY_BUFFER&&e)throw new Error("".concat(this._print(r)," duplicate GL.ELEMENT_ARRAY_BUFFER"));i.target===U.a.ELEMENT_ARRAY_BUFFER?e=r:this._warnedLocations[o]||(it.a.log(2,"".concat(this._print(r)," not used"))(),this._warnedLocations[o]=!0)}else{if(i.target===U.a.ELEMENT_ARRAY_BUFFER)throw new Error("".concat(this._print(r),":").concat(o," ")+"has both location and type gl.ELEMENT_ARRAY_BUFFER");n[o]=r}}return{locations:n,elements:e}}},{key:"_areAllAttributesEnabled",value:function(){for(var t=this._attributeCount,e=0;e<t;++e)if(!this.vertexAttributes.isEnabled(e))return!1;return!0}},{key:"_print",value:function(t){return"Program ".concat(this.id,": Attribute ").concat(t)}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getName",value:function(){var t=this.vs.getName()||this.fs.getName();return t=(t=t.replace(/shader/i,""))?"".concat(t,"-program"):"program"}},{key:"_getOptionsFromHandle",value:function(t){var e=this.gl.getAttachedShaders(t),n={},r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;switch(this.gl.getShaderParameter(this.handle,U.a.SHADER_TYPE)){case U.a.VERTEX_SHADER:n.vs=new $e({handle:u});break;case U.a.FRAGMENT_SHADER:n.fs=new tn({handle:u})}}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}},{key:"_getParameter",value:function(t){return this.gl.getProgramParameter(this.handle,t)}},{key:"_queryAttributeLocations",value:function(){this._attributeToLocationMap={},this._attributeCount=this.getAttributeCount();for(var t=0;t<this._attributeCount;t++){var e=this.getAttributeInfo(t).name;this._attributeToLocationMap[e]=this.getAttributeLocation(e)}this._warnedLocations={}}},{key:"_queryUniformLocations",value:function(){var t=this.gl;this._uniformSetters={},this._uniformCount=this.getUniformCount();for(var e=0;e<this._uniformCount;e++){var n=this.getUniformInfo(e),r=Mr(n.name),i=this.getUniformLocation(r.name);this._uniformSetters[r.name]=Rr(t,i,n,r.isArray)}this._textureIndexCounter=0}},{key:"_setId",value:function(t){if(!t){var e=this._getName();this.id=et(e)}}}])&&Kr(n.prototype,r),i&&Kr(n,i),e}(Le);function ei(t,e){var n={},r=0;j(e===$r||e===Qr);var i=e===$r?1:0,o=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){n[u.value]=r,r+=i}}catch(t){a=!0,s=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}return n}function ni(t){return(ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ri(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ii(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var ai=[U.a.TEXTURE_CUBE_MAP_POSITIVE_X,U.a.TEXTURE_CUBE_MAP_NEGATIVE_X,U.a.TEXTURE_CUBE_MAP_POSITIVE_Y,U.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,U.a.TEXTURE_CUBE_MAP_POSITIVE_Z,U.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];function si(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ui(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ri(this,e),(n=function(t,e){return!e||"object"!==ni(e)&&"function"!=typeof e?oi(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,Object.assign({},r,{target:U.a.TEXTURE_CUBE_MAP})))).initialize(r),Object.seal(oi(n)),n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.format,n=void 0===e?U.a.RGBA:e,r=t.mipmaps,i=void 0===r||r,o=t.width,a=void 0===o?1:o,s=t.height,u=void 0===s?1:s,l=t.type,c=void 0===l?U.a.UNSIGNED_BYTE:l,h=t.dataFormat,p=this._deduceParameters({format:n,type:c,dataFormat:h});c=p.type,h=p.dataFormat;var f=this._deduceImageSize({data:t[U.a.TEXTURE_CUBE_MAP_POSITIVE_X],width:a,height:u});j((a=f.width)===(u=f.height)),this.setCubeMapImageData(t),i&&this.generateMipmap(t),this.opts=t}},{key:"subImage",value:function(t){var e=t.face,n=t.data,r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o,s=t.mipmapLevel,u=void 0===s?0:s;return this._subImage({target:e,data:n,x:i,y:a,mipmapLevel:u})}},{key:"setCubeMapImageData",value:function(t){var e=t.width,n=t.height,r=t.pixels,i=t.data,o=t.border,a=void 0===o?0:o,s=t.format,u=void 0===s?U.a.RGBA:s,l=t.type,c=void 0===l?U.a.UNSIGNED_BYTE:l,h=(t.generateMipmap,this.gl);if(r=r||i,this.bind(),this.width||this.height)for(var p=0;p<ai.length;p++){var f=ai[p];h.texImage2D(f,0,u,e,n,a,u,c,r[f])}else for(var d=0;d<ai.length;d++){var v=ai[d];h.texImage2D(v,0,u,u,c,r[v])}}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.index;return void 0!==e&&this.gl.activeTexture(U.a.TEXTURE0+e),this.gl.bindTexture(U.a.TEXTURE_CUBE_MAP,this.handle),e}},{key:"unbind",value:function(){return this.gl.bindTexture(U.a.TEXTURE_CUBE_MAP,null),this}}])&&ii(n.prototype,r),i&&ii(n,i),e}(xn)).FACES=ai;var li=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};si(this,t);var r=n.id,i=void 0===r?"unnamed-attribute":r,o=n.type,a=n.isIndexed,s=void 0!==a&&a;this.gl=e,this.id=i,this.isIndexed=s,this.target=s?U.a.ELEMENT_ARRAY_BUFFER:U.a.ARRAY_BUFFER,this.type=o,this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(n),Object.seal(this),this._validateAttributeDefinition()}var e,n,r;return e=t,(n=[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,n=t.buffer,r=t.size,i=void 0===r?this.size:r,o=t.offset,a=void 0===o?this.offset||0:o,s=t.stride,u=void 0===s?this.stride||0:s,l=t.normalized,c=void 0===l?this.normalized||!1:l,h=t.integer,p=void 0===h?this.integer||!1:h,f=t.instanced,d=void 0===f?this.instanced||0:f,v=t.isGeneric,g=void 0===v?this.isGeneric||!1:v,y=t.isInstanced;this.size=i,this.offset=a,this.stride=u,this.normalized=c,this.integer=p,this.isGeneric=g,this.instanced=void 0!==y?y?1:0:d,n?(this.externalBuffer=n,this.type=n.type):e&&(this.externalBuffer=null,this.value=e,g||(this.buffer=this.buffer||new Ve(this.gl,{target:this.target,type:this.type}),this.buffer.setData({data:e}),this.type=this.buffer.type))}},{key:"getBuffer",value:function(){return this.isGeneric?null:this.externalBuffer||this.buffer}},{key:"_validateAttributeDefinition",value:function(){j(this.size>=1&&this.size<=4,"Attribute definition for ".concat(this.id," invalid size"))}}])&&ui(e.prototype,n),r&&ui(e,r),t}();function ci(t){return(ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hi(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function pi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function fi(t,e,n){return e&&pi(t.prototype,e),n&&pi(t,n),t}function di(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var vi=function(t){return t},gi=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};hi(this,e),n=function(t,e){return!e||"object"!==ci(e)&&"function"!=typeof e?di(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));var i=r.onComplete,o=void 0===i?vi:i,a=r.onError,s=void 0===a?vi:a;return n.target=null,n.onComplete=o,n.onError=s,n.promise=null,Object.seal(di(n)),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),fi(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.queries,r=void 0!==n&&n,i=e.timers,o=void 0!==i&&i,a=e.timestamps,s=void 0!==a&&a,u=Z(t),l=Ce(t,Se.TIMER_QUERY),c=u||l;if(r&&(c=c&&u),o&&(c=c&&l),s){Dt(t);var h=t.getQuery(36392,34916);c=c&&h>0}return c}}]),fi(e,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.conservative,n=void 0!==e&&e;return this.begin(n?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"getTimestamp",value:function(){he.beginQuery(this,this.onComplete,this.onError);try{this.gl.queryCounter(this.handle,36392)}catch(t){he.rejectQuery(this,'Timer queries require "EXT_disjoint_timer_query" extension')}return this}},{key:"begin",value:function(t){he.beginQuery(this,this.onComplete,this.onError),this.target=t;try{this.gl.beginQuery(this.target,this.handle)}catch(t){he.rejectQuery(this,"Query not supported")}return this}},{key:"end",value:function(){return this.target&&(this.ext.endQuery(this.target),this.target=null),this}},{key:"cancel",value:function(){return this.end(),he.cancelQuery(this),this}},{key:"isResultAvailable",value:function(){return this.gl.getQueryParameter(this.handle,34919)}},{key:"getResult",value:function(){var t=this.gl.getQueryParameter(this.handle,34918);return Number.isFinite(t)?t/1e6:0}},{key:"_createHandle",value:function(){return e.isSupported(this.gl)?this.gl.createQuery():null}},{key:"_deleteHandle",value:function(){he.deleteQuery(this),this.gl.deleteQuery(this.handle)}}],[{key:"poll",value:function(t){he.poll(t)}}]),e}(Le);he.setInvalidator({queryType:gi,errorMessage:"Disjoint GPU operation invalidated timer queries",checkInvalid:function(t){return t.getParameter(36795)}});function yi(t){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mi(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function _i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bi(t,e,n){return e&&_i(t.prototype,e),n&&_i(t,n),t}function xi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var wi,Ei=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return mi(this,e),Y(t),(n=function(t,e){return!e||"object"!==yi(e)&&"function"!=typeof e?xi(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r))).buffers={},Object.seal(xi(n)),n.initialize(r),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),bi(e,null,[{key:"isSupported",value:function(t){return Z(t)}},{key:"isHandle",value:function(t){return this.gl.isTransformFeedback(this.handle)}}]),bi(e,[{key:"initialize",value:function(t){var e=t.buffers,n=void 0===e?{}:e,r=t.varyingMap,i=void 0===r?{}:r;this.bindBuffers(n,{clear:!0,varyingMap:i})}},{key:"bindBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.clear,r=void 0!==n&&n,i=e.varyingMap,o=void 0===i?{}:i;for(var a in r&&(this._unbindBuffers(),this.buffers={}),t){var s=t[a],u=Number.isFinite(Number(a))?Number(a):o[a];j(Number.isFinite(u)),this.buffers[u]=s}}},{key:"begin",value:function(t){return this._bindBuffers(),this.gl.bindTransformFeedback(36386,this.handle),this.gl.beginTransformFeedback(t),this}},{key:"pause",value:function(){return this.gl.pauseTransformFeedback(),this.gl.bindTransformFeedback(36386,null),this._unbindBuffers(),this}},{key:"resume",value:function(){return this._bindBuffers(),this.gl.bindTransformFeedback(36386,this.handle),this.gl.resumeTransformFeedback(),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this.gl.bindTransformFeedback(36386,null),this._unbindBuffers(),this}},{key:"bindBuffer",value:function(t){var e=t.index,n=t.buffer,r=t.offset,i=void 0===r?0:r,o=t.size;return n.unbind(),this.gl.bindTransformFeedback(36386,this.handle),void 0===o?this.gl.bindBufferBase(35982,e,n.handle):this.gl.bindBufferRange(35982,e,n.handle,i,o),this}},{key:"unbindBuffer",value:function(t){var e=t.index;return this.gl.bindTransformFeedback(36386,this.handle),this.gl.bindBufferBase(35982,e,null),this}},{key:"_bindBuffers",value:function(){for(var t in this.buffers)this.bindBuffer({buffer:this.buffers[t],index:Number(t)})}},{key:"_unbindBuffers",value:function(){for(var t in this.buffers)this.unbindBuffer({buffer:this.buffers[t],index:Number(t)})}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}}]),e}(Le);function Si(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ai=5124,Ti=5126,Pi=5125;Si(wi={},Ti,[Ti,1]),Si(wi,35664,[Ti,2]),Si(wi,35665,[Ti,3]),Si(wi,35666,[Ti,4]),Si(wi,Ai,[Ai,1]),Si(wi,35667,[Ai,2]),Si(wi,35668,[Ai,3]),Si(wi,35669,[Ai,4]),Si(wi,Pi,[Pi,1]),Si(wi,36294,[Pi,2]),Si(wi,36295,[Pi,3]),Si(wi,36296,[Pi,4]),Si(wi,35670,[Ti,1]),Si(wi,35671,[Ti,2]),Si(wi,35672,[Ti,3]),Si(wi,35673,[Ti,4]),Si(wi,35674,[Ti,8]),Si(wi,35685,[Ti,8]),Si(wi,35686,[Ti,8]),Si(wi,35675,[Ti,12]),Si(wi,35687,[Ti,12]),Si(wi,35688,[Ti,12]),Si(wi,35676,[Ti,16]),Si(wi,35689,[Ti,16]),Si(wi,35690,[Ti,16]);function ki(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function Ci(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Oi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};function Ii(t){var e="string"==typeof t?Oi[t]||Oi.TRIANGLES:t;return j(e>=0&&e<=Oi.TRIANGLE_FAN,"Illegal drawMode"),e}var Mi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!ki(t,e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.id,r=e.drawMode,i=void 0===r?Oi.TRIANGLES:r,o=e.vertexCount,a=void 0===o?void 0:o,s=e.attributes;this.id=n||et(this.constructor.name),this.drawMode=Ii(i),this.vertexCount=a,this.attributes={},this.needsRedraw=!0,this.userData={},Object.seal(this),s&&this.setAttributes(s)}var e,n,r;return e=t,(n=[{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=t,this}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0!==e&&e,r=!1;return r=r||this.needsRedraw,this.needsRedraw=this.needsRedraw&&!n,r}},{key:"setVertexCount",value:function(t){this.vertexCount=t}},{key:"getVertexCount",value:function(){return void 0!==this.vertexCount?this.vertexCount:this.attributes.indices?this.attributes.indices.value.length:this.attributes.vertices?this.attributes.vertices.value.length/3:!!this.attributes.positions&&this.attributes.positions.value.length/3}},{key:"hasAttribute",value:function(t){return Boolean(this.attributes[t])}},{key:"getAttribute",value:function(t){var e=this.attributes[t];return j(e),e.value}},{key:"getArray",value:function(t){var e=this.attributes[t];return j(e),e.value}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(t){for(var e in t){var n=t[e];n=ArrayBuffer.isView(n)?{value:n}:n,j(ArrayBuffer.isView(n.value),"".concat(this._print(e),": must be typed array or object with value as typed array")),this._autoDetectAttribute(e,n),this.attributes[e]=Object.assign({},n,{instanced:n.instanced||0})}return this.setNeedsRedraw(),this}},{key:"_autoDetectAttribute",value:function(t,e){var n;switch(t){case"indices":n=n||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break;case"indices":e.size=e.size||1,e.isIndexed=void 0===e.isIndexed||e.isIndexed,j(ki(e.value,Uint16Array)||ki(e.value,Uint32Array),'attribute array for "indices" must be of integer type')}j(e.size,"attribute ".concat(t," needs size"))}},{key:"_print",value:function(t){return"Geometry ".concat(this.id," attribute ").concat(t)}}])&&Ci(e.prototype,n),r&&Ci(e,r),t}(),Ri=n(690);function Li(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Fi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ni=function(){function t(e){var n=e.id;e.display;Li(this,t),this.position=new Ri.b,this.rotation=new Ri.b,this.scale=new Ri.b(1,1,1),this.matrix=new Ri.a,this.id=n||et(this.constructor.name),this.display=!0,this.userData={}}var e,n,r;return e=t,(n=[{key:"setPosition",value:function(t){return j(3===t.length,"setPosition requires vector argument"),this.position=t,this}},{key:"setRotation",value:function(t){return j(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}},{key:"setScale",value:function(t){return j(3===t.length,"setScale requires vector argument"),this.scale=t,this}},{key:"setMatrixComponents",value:function(t){var e=t.position,n=t.rotation,r=t.scale,i=t.update,o=void 0===i||i;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),o&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var t=this.position,e=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(n),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.position,n=t.rotation,r=t.scale;return e&&this.setPosition(e),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(t,e){j(t),e=e||this.matrix;var n=new Ri.a(t).multiplyRight(e),r=n.invert(),i=r.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:i}}},{key:"transform",value:function(){if(this.parent){var t=this.parent;this.endPosition.set(this.position.add(t.endPosition)),this.endRotation.set(this.rotation.add(t.endRotation)),this.endScale.set(this.scale.add(t.endScale))}else this.endPosition.set(this.position),this.endRotation.set(this.rotation),this.endScale.set(this.scale);for(var e=this.children,n=0;n<e.length;++n)e[n].transform();return this}}])&&Fi(e.prototype,n),r&&Fi(e,r),t}(),ji="#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",Di="#define SHADER_NAME luma-modular-fragment\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",zi={},Bi=[];function Ui(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,n=void 0!==e&&e,r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){Xi(a.value,{ignoreMultipleRegistrations:n})}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}}function Vi(t){Bi=t}function Gi(t){if("string"!=typeof t){var e=t;return j("string"==typeof e.name),Xi(e,{ignoreMultipleRegistrations:!0}),e}var n=zi[t];return n||j(!1,"Unknown shader module ".concat(t)),n}function Wi(t){return function(t){t=t.concat(Bi);var e={};return function t(e){var n=e.modules,r=e.level,i=e.result;if(r>=5)throw new Error("Possible loop in shader dependency graph");var o=!0;var a=!1;var s=void 0;try{for(var u,l=n[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=Gi(u.value);(void 0===i[c.name]||i[c.name]<r)&&(i[c.name]=r)}}catch(t){a=!0,s=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}var h=!0;var p=!1;var f=void 0;try{for(var d,v=n[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var g=Gi(d.value);g.dependencies&&t({modules:g.dependencies,level:r+1,result:i})}}catch(t){p=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(p)throw f}}return i}({modules:t,level:0,result:e}),Object.keys(e).sort((function(t,n){return e[n]-e[t]}))}(t.map((function(t){return"string"!=typeof t?(Ui([t],{ignoreMultipleRegistrations:!0}),t.name):t})))}function Xi(t,e){var n=e.ignoreMultipleRegistrations,r=void 0!==n&&n;if(j(t.name,"shader module has no name"),!r&&zi[t.name])throw new Error("shader module ".concat(t.name," already registered"));zi[t.name]=t,t.dependencies=t.dependencies||[],t.deprecations=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach((function(t){switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}})),t}(t.deprecations)}function Hi(t,e){var n,r=t.vendor,i=t.renderer;switch(e){case"nvidia":n=r.match(/NVIDIA/i)||i.match(/NVIDIA/i);break;case"intel":n=r.match(/INTEL/i)||i.match(/INTEL/i);break;case"amd":n=r.match(/AMD/i)||i.match(/AMD/i)||r.match(/ATI/i)||i.match(/ATI/i);break;default:n=!1}return n}var qi,Zi;function Ki(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yi="vs",Ji="fs",Qi=(Ki(qi={},Yi,"vertex"),Ki(qi,Ji,"fragment"),qi),$i=(Ki(Zi={},Yi,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),Ki(Zi,Ji,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),Zi),to="#ifdef GL_ES\nprecision highp float;\n#endif\n\n";function eo(t,e){Gi(t).deprecations.forEach((function(t){t.regex.test(e)&&(t.deprecated?it.a.deprecated(t.old,t.new)():it.a.removed(t.old,t.new)())}))}function no(t,e){var n,r=Gi(t);switch(e){case Yi:n=r.vs||r.vertexShader;break;case Ji:n=r.fs||r.fragmentShader;break;default:j(!1)}return"string"!=typeof n?"":"#define MODULE_".concat(t.toUpperCase(),"\n").concat(n,"// END MODULE_").concat(t,"\n\n")}function ro(t,e){var n=e.id,r=e.source,i=e.type,o=e.modules,a=void 0===o?[]:o,s=e.defines,u=void 0===s?{}:s;j("string"==typeof r,"shader source must be a string");var l=r.split("\n"),c="",h=r;0===l[0].indexOf("#version ")&&(c=l[0],h=l.slice(1).join("\n"));var p="".concat(function(t){var e=t.id,n=t.source,r=t.type;return e&&"string"==typeof e&&-1===n.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(Qi[r],"\n\n"):""}({id:n,source:r,type:i}),"\n").concat(function(t){var e="",n=ae(t);return Hi(n,"nvidia")?e+="#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n":Hi(n,"intel")?e+="#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n":Hi(n,"amd")?e+="#define AMD_GPU\n":e+="#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n",e}(t),"\n").concat(function(t){var e="// Defines for shader portability\n#if (__VERSION__ > 120)\n# define attribute in\n# define varying out\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n#else\n// # define in attribute\n// # define out varying\n#endif // __VERSION\n";return ke(t,Se.GLSL_FRAG_DEPTH)&&(e+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),ke(t,Se.GLSL_DERIVATIVES)&&Te(t,Se.GLSL_DERIVATIVES)&&(e+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),ke(t,Se.GLSL_FRAG_DATA)&&(e+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),ke(t,Se.GLSL_TEXTURE_LOD)&&(e+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),e}(t),"\n").concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,n="";for(var r in t)0===e&&(n+="\n// APPLICATION DEFINES\n"),e++,n+="#define ".concat(r.toUpperCase()," ").concat(t[r],"\n");return 0===e&&(n+="\n"),n}(u),"\n").concat(i===Ji?to:"","\n"),f=!1,d=!0,v=!1,g=void 0;try{for(var y,m=a[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){var _=y.value;switch(_){case"inject":f=!0;break;default:eo(_,h),p+=no(_,i)}}}catch(t){v=!0,g=t}finally{try{d||null==m.return||m.return()}finally{if(v)throw g}}return p=c+p+h,f&&p.replace("}s*$",$i),p}function io(t){return function(e){var n={},r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=Gi(a.value),l=u.getUniforms?u.getUniforms(e,n):{};Object.assign(n,l)}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function oo(t){var e={},n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=Gi(s);e[s]=u}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}function ao(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function so(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var uo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.gl,r=e._cachePrograms,i=void 0!==r&&r;ao(this,t),j(n),this.gl=n,this.vertexShaders={},this.fragmentShaders={},this.programs={},this._cachePrograms=i}var e,n,r;return e=t,(n=[{key:"delete",value:function(){return this}},{key:"getVertexShader",value:function(t,e){j("string"==typeof e),j(this._compareContexts(t,this.gl));var n=this.vertexShaders[e];return n||(n=new $e(t,e),this.vertexShaders[e]=n),n}},{key:"getFragmentShader",value:function(t,e){j("string"==typeof e),j(this._compareContexts(t,this.gl));var n=this.fragmentShaders[e];return n||(n=new tn(t,e),this.fragmentShaders[e]=n),n}},{key:"getProgram",value:function(t,e){j(this._compareContexts(t,this.gl)),j("string"==typeof e.vs),j("string"==typeof e.fs),j("string"==typeof e.id);var n=this._getProgramKey(e),r=this.programs[n];return r?(this._resetProgram(r),r):(r=this._createNewProgram(t,e),this._cachePrograms&&this._checkProgramProp(r)&&(r._isCached=!0,this.programs[n]=r),r)}},{key:"_getProgramKey",value:function(t){return"".concat(t.id,"-").concat(t.vs,"-").concat(t.fs)}},{key:"_checkProgramProp",value:function(t){return!t.varyings}},{key:"_createNewProgram",value:function(t,e){var n=e.vs,r=e.fs,i=this.getVertexShader(t,n),o=this.getFragmentShader(t,r);return new ti(this.gl,Object.assign({},e,{vs:i,fs:o}))}},{key:"_resetProgram",value:function(t,e){t.reset()}},{key:"_compareContexts",value:function(t,e){return(t.gl||t)===(e.gl||e)}}])&&so(e.prototype,n),r&&so(e,r),t}(),lo=n(766),co=n.n(lo),ho={},po=function(t){ho[t.id]||(ho[t.id]=t,co.a.listItem("luma.gl",t.id))},fo=function(t,e){if(co.a.isReady()&&!co.a.throttle("luma.gl:".concat(t.id),1e3)){var n=t.geometry?Object.assign({},t.geometry.attributes,t.attributes):t.attributes,r=Object.assign({},t.uniforms,e);co.a.multiUpdate("luma.gl",t.id,[{path:"objects.uniforms",data:r},{path:"objects.attributes",data:n}])}},vo=function t(e,n,r){e&&(n.length>1?t(e[n[0]],n.slice(1),r):e[n[0]]=r)},go=new Map,yo=function(t,e){if(r.b.__SEER_INITIALIZED__&&t){var n=go.get(t);n&&n.forEach((function(t,n){vo(e,n,t)}))}};function mo(t){return(mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bo(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function xo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function wo(t,e){return!e||"object"!==mo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}co.a.listenFor("luma.gl",(function(t){var e=ho[t.itemKey];if(e&&"edit"===t.type&&"uniforms"===t.valuePath[0]){var n=t.valuePath.slice(1);!function(t,e,n){r.b.__SEER_INITIALIZED__&&(go.has(t)||go.set(t,new Map),go.get(t).set(e,n))}(t.itemKey,n,t.value);var i=e.getUniforms();vo(i,n,t.value),e.setUniforms(i)}}));var Eo='Warning: Model constructor: parameter "instanced" renamed to "isInstanced".\nThis will become a hard error in a future version of luma.gl.',So=["renderPickingBuffer","pickingEnabled"],Ao=function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!bo(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),n=wo(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r)),j(q(t)),n.gl=t,n.init(r),n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vs,n=void 0===e?null:e,r=t.fs,i=void 0===r?null:r,o=t.modules,a=void 0===o?null:o,s=t.defines,u=void 0===s?{}:s,l=t.moduleSettings,c=void 0===l?{}:l,h=t.defaultUniforms,p=t.program,f=void 0===p?null:p,d=t.shaderCache,v=void 0===d?null:d,g=t.isInstanced,y=void 0!==g&&g,m=t.instanced,_=t.vertexCount,b=void 0===_?void 0:_,x=t.instanceCount,w=void 0===x?0:x,E=t.drawMode,S=t.uniforms,A=void 0===S?{}:S,T=t.attributes,P=void 0===T?{}:T,k=t.geometry,C=void 0===k?null:k,O=t.pickable,I=void 0===O||O,M=t.pick,R=void 0===M?null:M,L=(t.render,t.onBeforeRender),F=void 0===L?function(){}:L,N=t.onAfterRender,D=void 0===N?function(){}:N,z=t.varyings,B=void 0===z?null:z,V=t.bufferMode,G=void 0===V?U.a.SEPARATE_ATTRIBS:V,W=t.timerQueryEnabled,X=void 0!==W&&W;this._initializeProgram({vs:n,fs:i,modules:a,defines:u,moduleSettings:c,defaultUniforms:h,program:f,shaderCache:v,varyings:B,bufferMode:G}),this.uniforms={},A=Object.assign({},this.program.defaultUniforms,A),this.setUniforms(A),this.setUniforms(this.getModuleUniforms()),this.setUniforms(this.getModuleUniforms(c)),m&&(console.warn(Eo),y=y||m),this._attributes={},this.attributes={},this.samplers={},this.userData={},this.drawParams={},this.dynamic=!1,this.needsRedraw=!0,C&&this.setGeometry(C),this.setAttributes(P),void 0!==E&&(this.drawMode=Ii(E)),void 0!==b&&(this.vertexCount=b),this.isInstanced=y,this.instanceCount=w,this.pickable=Boolean(I),this.pick=R||function(){return!1},this.onBeforeRender=F,this.onAfterRender=D,j(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount"),this.timerQueryEnabled=X&&gi.isSupported(this.gl,{timer:!0}),this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0}}},{key:"delete",value:function(){for(var t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();var e;this.program.delete(),e=this.id,delete ho[e],co.a.deleteItem("luma.gl",e)}},{key:"destroy",value:function(){this.delete()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=t,this}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRedrawFlags,n=void 0!==e&&e,r=!1;return r=r||this.needsRedraw,this.needsRedraw=this.needsRedraw&&!n,this.geometry&&(r=r||this.geometry.getNeedsRedraw({clearRedrawFlags:n})),r}},{key:"setDrawMode",value:function(t){return this.drawMode=Ii(t),this}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"setVertexCount",value:function(t){return j(Number.isFinite(t)),this.vertexCount=t,this}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"setInstanceCount",value:function(t){return j(Number.isFinite(t)),this.instanceCount=t,this}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getProgram",value:function(){return this.program}},{key:"setGeometry",value:function(t){return this.geometry=t,this.vertexCount=t.getVertexCount(),this.drawMode=t.drawMode,this._createBuffersFromAttributeDescriptors(this.geometry.getAttributes()),this.setNeedsRedraw(),this}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return rt(t)?this:(Object.assign(this.attributes,t),this._createBuffersFromAttributeDescriptors(t),this.setNeedsRedraw(),this)}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!1;for(var n in t)if(!Nr(this.uniforms[n],t[n])){e=!0;break}return e&&(Lr(t,this.id),Object.assign(this.uniforms,t),this.setNeedsRedraw()),this}},{key:"updateModuleSettings",value:function(t){var e=this.getModuleUniforms(t);return this.setUniforms(e)}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.moduleSettings,n=void 0===e?null:e,r=t.uniforms,i=void 0===r?{}:r,o=t.attributes,a=void 0===o?{}:o,s=t.samplers,u=void 0===s?{}:s,l=t.parameters,c=void 0===l?{}:l,h=t.settings,p=t.framebuffer,f=void 0===p?null:p,d=t.vertexArray,v=void 0===d?null:d,g=t.transformFeedback,y=void 0===g?null:g;return h&&(it.a.deprecated("settings","parameters")(),c=h),n&&this.updateModuleSettings(n),f&&(c=Object.assign(c,{framebuffer:f})),this.render(i,a,u,y,c,v),f&&f.log({priority:2,message:"Rendered to ".concat(f.id)}),this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;po(this);var a=this.addViewUniforms(t);yo(this.id,a),this.setUniforms(a),this.setAttributes(e),Object.assign(this.samplers,n),it.a.group(2,">>> RENDERING MODEL ".concat(this.id),{collapsed:it.a.priority<=2})(),this.setProgramState({vertexArray:o}),this._logAttributesAndUniforms(2,a),this.onBeforeRender();var s=this.drawParams;s.isInstanced&&!this.isInstanced&&it.a.warn("Found instanced attributes on non-instanced model")();var u=s.isIndexed,l=s.indexType,c=this.isInstanced,h=this.instanceCount;return this._timerQueryStart(),this.program.draw({parameters:i,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:o,transformFeedback:r,isIndexed:u,indexType:l,isInstanced:c,instanceCount:h}),this._timerQueryEnd(),this.onAfterRender(),this.unsetProgramState(),this.setNeedsRedraw(!1),it.a.groupEnd(2,">>> RENDERING MODEL ".concat(this.id))(),this}},{key:"setProgramState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertexArray,n=void 0===e?null:e,r=this.program;return r.use(),this.drawParams={},r.setAttributes(this._attributes,{drawParams:this.drawParams}),r.checkAttributeBindings({vertexArray:n}),r.setUniforms(this.uniforms,this.samplers),this}},{key:"unsetProgramState",value:function(){return this.program.unsetBuffers(),this}},{key:"addViewUniforms",value:function(t){var e=t.camera,n=t.viewMatrix,r=t.modelMatrix,i=e?e.getUniforms():{},o=n?this.getCoordinateUniforms(n,r):{};return Object.assign({},t,i,o)}},{key:"_initializeProgram",value:function(t){var e=t.vs,n=t.fs,r=t.modules,i=t.defines,o=(t.moduleSettings,t.defaultUniforms,t.program),a=t.shaderCache,s=t.varyings,u=t.bufferMode;if(this.getModuleUniforms=function(t){},!o){e||(e=ji),n||(n=Di);var l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.vs,r=e.fs,i=Wi(e.modules||[]);return{gl:t,vs:ro(t,Object.assign({},e,{source:n,type:Yi,modules:i})),fs:ro(t,Object.assign({},e,{source:r,type:Ji,modules:i})),getUniforms:io(i),modules:oo(i)}}(this.gl,{vs:e,fs:n,modules:r,defines:i});e=l.vs,n=l.fs,o=a?a.getProgram(this.gl,{vs:e,fs:n,id:this.id}):new ti(this.gl,{vs:e,fs:n,varyings:s,bufferMode:u});var c=l.getUniforms;this.getModuleUniforms=c||function(t){}}this.program=o,j(bo(this.program,ti),"Model needs a program")}},{key:"_checkForDeprecatedUniforms",value:function(t){So.forEach((function(e){e in t&&it.a.deprecated(e,"use picking shader module and Model class updateModuleSettings()")()}))}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new gi(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getResult();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,it.a.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}},{key:"_createBuffersFromAttributeDescriptors",value:function(t){var e=this.program.gl;for(var n in t){var r=t[n],i=this._attributes[n];bo(r,li)?i=r:bo(r,Ve)?(i=i||new li(e,Object.assign({},r.layout,{id:n}))).update({isGeneric:!1,buffer:r}):i?i.update(r):i=new li(e,r),this._attributes[n]=i}return this}},{key:"_logAttributesAndUniforms",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(it.a.priority>=t){var n=this._getAttributesTable({header:"".concat(this.id," attributes"),program:this.program,attributes:this._attributes});it.a.table(t,n)();var r=jr({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.uniforms,e)}),i=r.table,o=r.unusedTable,a=r.unusedCount;it.a.table(t,i)(),it.a.log(t,"".concat(a||"No"," unused uniforms "),o)()}else{var s=jr({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.uniforms,e),undefinedOnly:!0}),u=s.table,l=s.count;l>0&&it.a.table(t,u)()}fo(this,e)}},{key:"_getAttributesTable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.attributes,n=t.header,r=void 0===n?"Attributes":n,i=(t.instanced,t.program);j(i);var o=i._attributeToLocationMap,a={};for(var s in e){var u=e[s];u.isIndexed&&this._createAttributeEntry(u,"ELEMENT_ARRAY_BUFFER",r)}for(var l in o){var c=e[l],h=o[l];a[l]=this._createAttributeEntry(c,h,r)}for(var p in e){var f=e[p];a[p]||(a[p]=this._createAttributeEntry(f,null,r))}return a}},{key:"_createAttributeEntry",value:function(t,e,n){var r,i,o="NOT PROVIDED",a=0,s="N/A",u="N/A",l="N/A",c="N/A";return t&&null===e&&(e=t.isIndexed?"ELEMENT_ARRAY_BUFFER":"NOT USED"),t&&(o=t.type,a=t.instanced,s=t.size,t.externalBuffer?(c=t.externalBuffer.data,u=(l=t.externalBuffer.bytes)/c.BYTES_PER_ELEMENT):t.value&&(c=t.value,i=c.length/s,u=Math.round(10*i)/10,l=c.length*c.BYTES_PER_ELEMENT)),_o(r={},n,ot(c,{size:s,isInteger:-1!==(o=String(o).replace("Array","")).indexOf("nt")})),_o(r,"Memory Size and Layout","".concat(a?"I ":"P "," ").concat(u," (x").concat(s,"=").concat(l,"bytes ").concat(o,") loc=").concat(e)),r}},{key:"isPickable",value:function(){return this.pickable}},{key:"setPickable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.pickable=Boolean(t),this}},{key:"getGeometry",value:function(){return this.geometry}},{key:"varyingMap",get:function(){return this.program.varyingMap}}])&&xo(n.prototype,r),i&&xo(n,i),e}(Ni);function To(t){return(To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Po(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ko(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Co={preserveDrawingBuffer:!0},Oo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Po(this,t);var n=e.onCreateContext,r=void 0===n?function(t){return ge(t)}:n,i=e.onInitialize,o=void 0===i?function(){}:i,a=e.onRender,s=void 0===a?function(){}:a,u=e.onFinalize,l=void 0===u?function(){}:u,c=e.offScreen,h=void 0!==c&&c,p=e.gl,f=void 0===p?null:p,d=e.glOptions,v=void 0===d?{}:d,g=e.debug,y=void 0!==g&&g,m=e.createFramebuffer,_=void 0!==m&&m,b=e.autoResizeViewport,x=void 0===b||b,w=e.autoResizeDrawingBuffer,E=void 0===w||w,S=e.useDevicePixels,A=void 0===S||S;return"useDevicePixelRatio"in e&&(it.a.deprecated("useDevicePixelRatio","useDevicePixels")(),A=e.useDevicePixelRatio),this.props={onCreateContext:r,onInitialize:o,onRender:s,onFinalize:l,gl:f,glOptions:v,debug:y,createFramebuffer:_},this.gl=f,this.offScreen=h,this.needsRedraw=null,this.setProps({autoResizeViewport:x,autoResizeDrawingBuffer:E,useDevicePixels:A}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._renderFrame=this._renderFrame.bind(this),this}var e,n,r;return e=t,(n=[{key:"setNeedsRedraw",value:function(t){return j("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}},{key:"setProps",value:function(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._stopped=!1,this._animationFrameId||(this._startPromise=ht.then((function(){return t._stopped?null:(t._createWebGLContext(e),t._createFramebuffer(),t._initializeCallbackData(),t._updateCallbackData(),t._resizeCanvasDrawingBuffer(),t._resizeViewport(),t.props.onInitialize(t._callbackData))})).then((function(e){t._stopped||(t._addCallbackData(e||{}),!1===e||t._animationFrameId||(t._animationFrameId=d(t._renderFrame)))}))),this}},{key:"stop",value:function(){return this._animationFrameId&&(this._finalizeCallbackData(),v(this._animationFrameId),this._animationFrameId=null,this._stopped=!0),this}},{key:"setViewParameters",value:function(t){var e=t.autoResizeDrawingBuffer,n=void 0===e||e,r=t.autoResizeCanvas,i=void 0===r||r,o=t.autoResizeViewport,a=void 0===o||o,s=t.useDevicePixels,u=void 0===s||s,l=t.useDevicePixelRatio,c=void 0===l?null:l;return it.a.deprecated("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this.autoResizeViewport=a,this.autoResizeCanvas=i,this.autoResizeDrawingBuffer=n,this.useDevicePixels=u,null!==c&&(it.a.deprecated("useDevicePixelRatio","useDevicePixels")(),this.useDevicePixels=c),this}},{key:"_setupFrame",value:function(){this._onSetupFrame?this._onSetupFrame(this._callbackData):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}},{key:"_renderFrame",value:function(){this._stopped||(this._setupFrame(),this._updateCallbackData(),this.props.onRender(this._callbackData),this.offScreen?this.gl.commit().then(this._renderFrame):this._animationFrameId=d(this._renderFrame))}},{key:"_initializeCallbackData",value:function(){this._callbackData={gl:this.gl,canvas:this.gl.canvas,framebuffer:this.framebuffer,stop:this.stop,useDevicePixels:this.useDevicePixels,needsRedraw:null,tick:0,tock:0}}},{key:"_updateCallbackData",value:function(){var t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;t===this._callbackData.width&&e===this._callbackData.height||this.setNeedsRedraw("drawing buffer resized"),this._callbackData.width=t,this._callbackData.height=e,this._callbackData.aspect=t/e,this._callbackData.needsRedraw=this.needsRedraw,this._callbackData.offScreen=this.offScreen,this._callbackData.needsRedraw=this.needsRedraw,this.needsRedraw=null,this._callbackData.tick++}},{key:"_finalizeCallbackData",value:function(){this.props.onFinalize(this._callbackData)}},{key:"_addCallbackData",value:function(t){"object"===To(t)&&null!==t&&(this._callbackData=Object.assign({},this._callbackData,t))}},{key:"_createWebGLContext",value:function(t){if(t=Object.assign({},t,Co,this.props.glOptions),this.gl=this.props.gl||this.props.onCreateContext(t),!q(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");this.props.debug&&(this.gl=Qt(this.gl)),kt(this.gl)}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas){var n=e.useDevicePixels&&window.devicePixelRatio||1,r="width"in e?e.width:t.canvas.clientWidth,i="height"in e?e.height:t.canvas.clientHeight;return t.canvas.width=r*n,void(t.canvas.height=i*n)}var o=t.getExtension("STACKGL_resize_drawingbuffer");o&&"width"in e&&"height"in e&&o.resize(e.width,e.height)}(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new dr(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}}])&&ko(e.prototype,n),r&&ko(e,r),t}();new Uint8Array([0,0,0]);function Io(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Mo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ro(t){return!0!==t&&t}function Lo(t){var e=t.getBoundingClientRect();return{x:e.left,y:e.top,bbox:e}}function Fo(t){var e=t.which||t.keyCode,n=function(t){var e=jo;for(var n in e)if(e[n]===t)return n;return null}(e),r=e-111;return r>0&&r<13&&(n="f".concat(r)),{code:e,key:n=n||String.fromCharCode(e).toLowerCase(),shift:t.shiftKey,control:t.ctrlKey,alt:t.altKey,meta:t.metaKey}}var No=function(){function t(e,n){Io(this,t),this.scene=n.scene,this.domElem=e,this.pos=Lo(e),this.opt=this.callbacks=n,this.size={width:e.width||e.offsetWidth,height:e.height||e.offsetHeight},this.attachEvents()}var e,n,r;return e=t,(n=[{key:"attachEvents",value:function(){var t=this,e=this.domElem,n=this.opt;if(n.disableContextMenu&&(e.oncontextmenu=function(){return!1}),n.enableMouse){["mouseup","mousedown","mousemove","mouseover","mouseout"].forEach((function(n){e.addEventListener(n,(function(e,r){t[n](t.eventInfo(n,e,r))}),!1)}));var r="";r=document.getBoxObjectFor||null!==window.mozInnerScreenX?"DOMMouseScroll":"mousewheel",e.addEventListener(r,(function(e,n){t.mousewheel(t.eventInfo("mousewheel",e,n))}),!1)}n.enableTouch&&["touchstart","touchmove","touchend"].forEach((function(n){e.addEventListener(n,(function(e,r){t[n](t.eventInfo(n,e,r))}),!1)})),n.enableKeyboard&&["keydown","keyup"].forEach((function(e){document.addEventListener(e,(function(n,r){t[e](t.eventInfo(e,n,r))}),!1)}))}},{key:"eventInfo",value:function(t,e,n){for(var r,i,o,a=this.domElem,s=this.scene,u=this.opt,l=this.getSize(),c=u.relative,h=u.centerOrigin,p=u.cachePosition&&this.pos||Lo(a),f=function(t,e){return e=e||window,t||e.event}(e,n),d=function(t,e){e=e||window,t=t||e.event;var n=e.document;if(n=n.documentElement||n.body,t.touches&&t.touches.length){for(var r,i=[],o=t.touches.length,a=0;a<o;++a)r=t.touches[a],i.push({x:r.pageX||r.clientX+n.scrollLeft,y:r.pageY||r.clientY+n.scrollTop});return i}return[{x:t.pageX||t.clientX+n.scrollLeft,y:t.pageY||t.clientY+n.scrollTop}]}(e,n),v=d[0].x,g=d[0].y,y={},m=0,_=d.length;m<_;++m)r=d[m].x,i=d[m].y,c&&(r-=p.x,i-=p.y,h&&(r-=l.width/2,i-=l.height/2,i*=-1)),d[m].x=r,d[m].y=i;switch(t){case"mousewheel":y.wheel=function(t){return t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3}(f);break;case"keydown":case"keyup":Object.assign(y,Fo(f));break;case"mouseup":y.isRightClick=function(t){return 3===t.which||2===t.button}(f)}return Object.assign(y,{x:d[0].x,y:d[0].y,posArray:d,cache:!1,stop:function(){!function(t){t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1}(f)},getTarget:function(){return o||(o=u.picking&&s.pick(v-p.x,g-p.y)||!0)}}),y.event=f,y}},{key:"getSize",value:function(){if(this.cacheSize)return this.size;var t=this.domElem;return{width:t.width||t.offsetWidth,height:t.height||t.offsetHeight}}},{key:"mouseup",value:function(t){this.moved||(t.isRightClick?this.callbacks.onRightClick(t,this.hovered):this.callbacks.onClick(t,Ro(this.pressed))),this.pressed&&(this.moved?this.callbacks.onDragEnd(t,Ro(this.pressed)):this.callbacks.onDragCancel(t,Ro(this.pressed)),this.pressed=this.moved=!1)}},{key:"mouseout",value:function(t){for(var e=t.relatedTarget,n=this.domElem;e&&e.parentNode;){if(n===e.parentNode)return;e=e.parentNode}this.hovered&&(this.callbacks.onMouseLeave(t,this.hovered),this.hovered=!1),this.pressed&&this.moved&&(this.callbacks.onDragEnd(t),this.pressed=this.moved=!1)}},{key:"mouseover",value:function(t){}},{key:"mousemove",value:function(t){if(this.pressed)return this.moved=!0,void this.callbacks.onDragMove(t,Ro(this.pressed));if(this.hovered){var e=Ro(t.getTarget());e&&e.hash===this.hash?this.callbacks.onMouseMove(t,this.hovered):(this.callbacks.onMouseLeave(t,this.hovered),this.hovered=e,this.hash=e,e&&(this.hash=e.hash,this.callbacks.onMouseEnter(t,this.hovered)))}else this.hovered=Ro(t.getTarget()),this.hash=this.hovered,this.hovered&&(this.hash=this.hovered.hash,this.callbacks.onMouseEnter(t,this.hovered));this.opt.picking||this.callbacks.onMouseMove(t)}},{key:"mousewheel",value:function(t){this.callbacks.onMouseWheel(t)}},{key:"mousedown",value:function(t){this.pressed=t.getTarget(),this.callbacks.onDragStart(t,Ro(this.pressed))}},{key:"touchstart",value:function(t){this.touched=t.getTarget(),this.touchedLastPosition={x:t.x,y:t.y},this.callbacks.onTouchStart(t,Ro(this.touched))}},{key:"touchmove",value:function(t){this.touched&&(this.touchMoved=!0,this.callbacks.onTouchMove(t,Ro(this.touched)))}},{key:"touchend",value:function(t){this.touched&&(this.touchMoved?this.callbacks.onTouchEnd(t,Ro(this.touched)):(t.x=isNaN(t.x)?this.touchedLastPosition.x:t.x,t.y=isNaN(t.y)?this.touchedLastPosition.y:t.y,this.callbacks.onTap(t,Ro(this.touched)),this.callbacks.onTouchCancel(t,Ro(this.touched))),this.touched=this.touchMoved=!1)}},{key:"keydown",value:function(t){this.callbacks.onKeyDown(t)}},{key:"keyup",value:function(t){this.callbacks.onKeyUp(t)}}])&&Mo(e.prototype,n),r&&Mo(e,r),t}();Object.assign(No.prototype,{hovered:!1,pressed:!1,touched:!1,touchedLastPosition:{x:0,y:0},touchMoved:!1,moved:!1});var jo={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,delete:46};function Do(t){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zo(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Bo(t,e){return!e||"object"!==Do(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var Uo={x:[2,0,1],y:[0,1,2],z:[1,2,0]},Vo=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};zo(this,e);for(var n=t.bottomRadius,r=void 0===n?0:n,i=t.topRadius,o=void 0===i?0:i,a=t.height,s=void 0===a?1:a,u=t.nradial,l=void 0===u?10:u,c=t.nvertical,h=void 0===c?10:c,p=t.verticalAxis,f=void 0===p?"y":p,d=t.topCap,v=void 0!==d&&d,g=t.bottomCap,y=void 0!==g&&g,m=(v?2:0)+(y?2:0),_=(l+1)*(h+1+m),b=Math.atan2(r-o,s),x=Math.sin,w=Math.cos,E=Math.PI,S=w(b),A=x(b),T=v?-2:0,P=h+(y?2:0),k=l+1,C=new Float32Array(3*_),O=new Float32Array(3*_),I=new Float32Array(2*_),M=new Uint16Array(l*(h+m)*6),R=Uo[f],L=0,F=0,N=T;N<=P;N++){var j=N/h,D=s*j,z=void 0;N<0?(D=0,j=1,z=r):N>h?(D=s,j=1,z=o):z=r+N/h*(o-r),-2!==N&&N!==h+2||(z=0,j=0),D-=s/2;for(var B=0;B<k;B++){var U=x(B*E*2/l),V=w(B*E*2/l);C[L+R[0]]=U*z,C[L+R[1]]=D,C[L+R[2]]=V*z,O[L+R[0]]=N<0||N>h?0:U*S,O[L+R[1]]=N<0?-1:N>h?1:A,O[L+R[2]]=N<0||N>h?0:V*S,I[F+0]=B/l,I[F+1]=j,F+=2,L+=3}}for(var G=0;G<h+m;G++)for(var W=0;W<l;W++){var X=6*(G*l+W);M[X+0]=k*(G+0)+0+W,M[X+1]=k*(G+0)+1+W,M[X+2]=k*(G+1)+1+W,M[X+3]=k*(G+0)+0+W,M[X+4]=k*(G+1)+1+W,M[X+5]=k*(G+1)+0+W}return Bo(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{attributes:{positions:C,normals:O,texCoords:I,indices:M}})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(Mi);function Go(t){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wo(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Xo(t,e){return!e||"object"!==Go(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var Ho=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Wo(this,e);var n=t.id,r=void 0===n?et("cube-geometry"):n;return Xo(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{id:r,attributes:{indices:new Uint16Array(qo),positions:new Float32Array(Zo),normals:new Float32Array(Ko),texCoords:new Float32Array(Yo)}})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(Mi),qo=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Zo=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Ko=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Yo=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]);function Jo(t){return(Jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qo(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function $o(t,e){return!e||"object"!==Jo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var ta=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Qo(this,e);var n=t.radius,r=void 0===n?1:n;return $o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Object.assign({},t,{bottomRadius:r,topRadius:r})))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(Vo);var ea="";function na(){}function ra(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.urls,n=t.onProgress,r=void 0===n?na:n;j(e.every((function(t){return"string"==typeof t})),"loadImages: {urls} must be array of strings");var i=0;return Promise.all(e.map((function(n){var o=function(t,e){return t=ea?ea+t:t,new Promise((function(n,r){try{var i=new Image;i.onload=function(){return n(i)},i.onerror=function(){return r(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(t){r(t)}}))}(n,t);return o.then((function(t){return r({progress:++i/e.length,count:i,total:e.length,url:n})})),o})))}function ia(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.urls,r=e.onProgress,i=void 0===r?na:r;return j(n.every((function(t){return"string"==typeof t})),"loadTextures: {urls} must be array of strings"),ra(Object.assign({urls:n,onProgress:i},e)).then((function(r){return r.map((function(r,i){var o=Array.isArray(e.parameters)?e.parameters[i]:e.parameters;return o=void 0===o?{}:o,new kn(t,Object.assign({id:n[i]},o,{data:r}))}))}))}var oa={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};function aa(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}var sa="uniform float ONE;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' from.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",ua="".concat(sa,"\n").concat("const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\n/* k_power controls how much range reduction we would like to have\nRange reduction uses the following method:\nassume a = k_power * r + m * log(2), k and m being integers.\nSet k_power = 4 (we can choose other k to trade accuracy with performance.\nwe only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k_power;\n*/\n\nvec2 exp_fp64(vec2 a) {\n  // We need to make sure these two numbers match\n  // as bit-wise shift is not available in GLSL 1.0\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);\n\n  s = sum_fp64(s, t);\n\n\n  // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n//   return r;\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    // We just can't get PI/16 * 3.0 very accurately.\n    // so let's just store it\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\n// Vector functions\n// vec2 functions\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\n\n// vec3 functions\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\n\n// vec4 functions\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"),la={name:"fp64",vs:ua,fs:null,fp64ify:aa,fp64LowPart:function(t){return t-Math.fround(t)},fp64ifyMatrix4:function(t){for(var e=new Float32Array(32),n=0;n<4;++n)for(var r=0;r<4;++r){var i=4*n+r;aa(t[4*r+n],e,2*i)}return e}},ca=("".concat(sa),[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ha={modelMatrix:ca,viewMatrix:ca,projectionMatrix:ca,cameraPositionWorld:[0,0,0]};var pa="varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n";"".concat(pa,"\n\n// Unprefixed uniforms\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n"),"\n".concat(pa);"".concat("  // empty\n","\n").concat("#define LIGHT_MAX 4\n\n/*\n// lighting configuration\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\n// point lights configuration\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\n\n// reflection / refraction configuration\nuniform bool useReflection;\n*/\n\nuniform bool lighting_uEnableLights;\nuniform vec3 lighting_uAmbientColor;\nuniform vec3 lighting_uDirection;\nuniform vec3 lighting_uDirectionalColor;\n\n// point lights configuration\nuniform int  lighting_uPointCount;\nuniform vec3 lighting_uPointLocation[LIGHT_MAX];\nuniform vec3 lighting_uPointColor[LIGHT_MAX];\n\n// reflection / refraction configuration\nuniform bool lighting_uEnableReflections;\n\n// varyings\nvarying vec4 lighting_vPosition;\nvarying vec4 lighting_vNormal;\nvarying vec3 lighting_vColor;\nvarying vec3 lighting_vLightWeighting;\nvarying vec3 lighting_vReflection;\n\nvoid lighting_setPositionAndNormal(vec3 position, vec3 normal) {\n  lighting_vPosition = worldMatrix * vec4(position, 1.);\n  lighting_vNormal = worldInverseTransposeMatrix * vec4(normal, 1.);;\n}\n\nvoid lighting__getLightWeigting() {\n  float directionalLightWeighting = max(dot(lighting_vNormal.xyz, lighting_uDirection), 0.);\n  vec3 pointWeight = vec3(0., 0., 0.);\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec4 mvLightPosition = viewMatrix * vec4(lighting_uPointLocation[i], 1.);\n      vec3 pointLightDirection = normalize(mvLightPosition.xyz - lighting_vPosition.xyz);\n      pointWeight += max(dot(lighting_vNormal.xyz, pointLightDirection), 0.) * pointColor[i];\n     } else {\n       break;\n     }\n   }\n   return ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\n\nvoid lighting_apply(vec3 position, vec3 normal) {\n  lighting_setPositionAndNormal(position, normal);\n\n  // lighting code\n  if(!lighting_uEnableLights) {\n    lighting_vLightWeighting = vec3(1., 1., 1.);\n  } else {\n    lighting_vLightWeighting = lighting__getLightWeighting();\n  }\n}\n\nvoid lighting_set_reflection(vec3 position) {\n    // refraction / reflection code\n  if (lighting_uEnableReflections) {\n    lighting_vReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.))).xyz;\n  } else {\n    lighting_vReflection = vec3(1., 1., 1.);\n  }\n}\n","\n"),"".concat("  // empty\n","\n").concat("#ifdef GL_ES\nprecision highp float;\n#endif\n\n#define LIGHT_MAX 4\n\nvarying vec3 lighting_vLightWeighting;\n\nvec4 lighting_apply(vec4 color) {\n  // set color from texture\n  return vec4(color.rgb * lighting_vLightWeighting, color.a);\n}\n\n// spec-map.fs\n\nuniform mat4 viewMatrix;\n\n\nvarying vec4 lighting_vColor;\nvarying vec4 lighting_vTransformedNormal;\nvarying vec4 lighting_vPosition;\n\nuniform float shininess;\nuniform bool enableSpecularMap;\nuniform bool enableLights;\n\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\n\nuniform vec3 lighting_uPointLocation[LIGHT_MAX];\nuniform vec3 lighting_uPointColor[LIGHT_MAX];\nuniform float lighting_uPointSpecularEnable[LIGHT_MAX];\nuniform vec3 lighting_uPointSpecularColor[LIGHT_MAX];\nuniform int numberPoints;\n\n\nvec3 lighting__calculate_light_weighting() {\n\treturn lighting__calculate_light_weighting(shininess);\n}\n\nvec3 lighting__calculate_light_weighting(shininess) {\n  vec3 normal = vTransformedNormal.xyz;\n  vec3 eyeDirection = normalize(-vPosition.xyz);\n\n  vec3 specularLight = vec3(0., 0., 0.);\n  vec3 diffuseLight = vec3(0., 0., 0.);\n\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec3 transformedPointLocation = (viewMatrix * vec4(lighting_uPointLocation[i], 1.0)).xyz;\n      vec3 lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n      if (lighting_uPointSpecularEnable > 0.) {\n        vec3 reflectionDirection = reflect(-lightDirection, normal);\n        float specularLightWeighting =\n          pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininessVal);\n        specularLight += specularLightWeighting * lighting_uPointSpecularColor[i];\n      }\n\n      float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n      diffuseLight += diffuseLightWeighting * lighting_uPointColor[i];\n    } else {\n      break;\n    }\n  }\n\n  return ambientColor + diffuseLight + specularLight;\n}\n\nvoid lighting_filterColor(fragmentColor) {\n  if (!lighting_enable) {\n  \treturn fragmentColor;\n  } else {\n  \tvec3 lightWeighting = lighting__calculate_light_weighting();\n  \treturn vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);\n  }\n}\n\n// render-tex.fs\n\nuniform vec3 material_uAmbientColor;\nuniform vec3 material_uDiffuseColor;\nuniform vec3 material_uSpecularColor;\nuniform vec3 material_uEmissiveColor;\n\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\n\nuniform mat4 viewMatrix;\n\nvoid apply_lighting(color) {\n  vec3 ambientLightWeighting = ambientColor;\n\n  vec3 normal = vTransformedNormal.xyz;\n  vec3 eyeDirection = normalize(-vPosition.xyz);\n\n  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n\n  for (int i = 0; i < LIGHT_MAX; i++) {\n    if (i < numberPoints) {\n      vec3 transformedPointLocation = (viewMatrix * vec4(pointLocation[i], 1.0)).xyz;\n      vec3 lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n      if (enableSpecularHighlights) {\n        vec3 reflectionDirection = reflect(-lightDirection, normal);\n        float specularLightWeighting =\n          pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n        specularLight += specularLightWeighting * pointSpecularColor[i];\n      }\n\n      float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n      diffuseLight += diffuseLightWeighting * pointColor[i];\n    } else {\n        break;\n    }\n  }\n\n  vec3 matAmbientColor = material_uAmbientColor * color.rgb;\n  vec3 matDiffuseColor = material_uDiffuseColor * color.rgb;\n  vec3 matSpecularColor = material_uSpecularColor * color.rgb;\n  vec3 matEmissiveColor = material_uEmissiveColor * color.rgb;\n  gl_FragColor = vec4(\n    matAmbientColor * ambientLightWeighting\n    + matDiffuseColor * diffuseLightWeighting\n    + matSpecularColor * specularLightWeighting\n    + matEmissiveColor,\n    color.a\n  );\n}\n\n/// frag-lighting\n\n  vec3 lightWeighting;\n  if (!enableLights) {\n    lightWeighting = vec3(1.0, 1.0, 1.0);\n  } else {\n    vec3 lightDirection;\n    float specularLightWeighting = 0.0;\n    float diffuseLightWeighting = 0.0;\n    vec3  specularLight = vec3(0.0, 0.0, 0.0);\n    vec3  diffuseLight = vec3(0.0, 0.0, 0.0);\n\n    vec3 transformedPointLocation;\n    vec3 normal = vTransformedNormal.xyz;\n\n    vec3 eyeDirection = normalize(-vPosition.xyz);\n    vec3 reflectionDirection;\n\n    vec3 pointWeight = vec3(0.0, 0.0, 0.0);\n\n    for (int i = 0; i < LIGHT_MAX; i++) {\n      if (i < numberPoints) {\n        transformedPointLocation = (viewMatrix * vec4(pointLocation[i], 1.0)).xyz;\n        lightDirection = normalize(transformedPointLocation - vPosition.xyz);\n\n        if (enableSpecular[i] > 0.0) {\n          reflectionDirection = reflect(-lightDirection, normal);\n          specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), shininess);\n          specularLight += specularLightWeighting * pointSpecularColor[i];\n        }\n\n        diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);\n        diffuseLight += diffuseLightWeighting * pointColor[i];\n      } else {\n        break;\n      }\n    }\n\n    lightWeighting = ambientColor + diffuseLight + specularLight;\n  }\n\n// reflection / refraction configs\nuniform float reflection;\nuniform float refraction;\n\n///\n  // has cube texture then apply reflection\n  // if (hasTextureCube1) {\n  //   vec3 nReflection = normalize(vReflection);\n  //   vec3 reflectionValue;\n  //   if (refraction > 0.0) {\n  //    reflectionValue = refract(nReflection, vNormal.xyz, refraction);\n  //   } else {\n  //    reflectionValue = -reflect(nReflection, vNormal.xyz);\n  //   }\n\n  //   // TODO(nico): check whether this is right.\n  //   vec4 cubeColor = textureCube(samplerCube1,\n  //       vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\n  //   gl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n  // }\n","\n"),new Float32Array([1,1,2]);var fa={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1};var da={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nvarying vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive; // true during rendering to offscreen picking buffer\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nvarying vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n  return selected ? (picking_uHighlightColor * COLOR_SCALE) : color;\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fa,e={};if(void 0!==t.pickingSelectedColor)if(null===t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{var n=[t.pickingSelectedColor[0],t.pickingSelectedColor[1],t.pickingSelectedColor[2]];e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}return void 0!==t.pickingHighlightColor&&(e.picking_uHighlightColor=t.pickingHighlightColor),void 0!==t.pickingThreshold&&(e.picking_uThreshold=t.pickingThreshold),void 0!==t.pickingActive&&(e.picking_uActive=t.pickingActive?1:0),e}};function va(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ga(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function ya(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ma(t,e,n){return e&&ya(t.prototype,e),n&&ya(t,n),t}var _a=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!ga(t,e))throw new TypeError("Cannot call a class as a function")}(this,t),Y(e),this.gl=e,this.model=null,this._buffersSwapable=!1,this.currentIndex=0,this.sourceBuffers=new Array(2),this.destinationBuffers=new Array(2),this.transformFeedbacks=new Array(2),this._buffersToDelete=[],this.initialize(n),Object.seal(this)}return ma(t,null,[{key:"isSupported",value:function(t){return Z(t)}}]),ma(t,[{key:"delete",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._buffersToDelete[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.delete()}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}this.model.delete()}},{key:"initialize",value:function(t){var e=t.sourceBuffers,n=void 0===e?null:e,r=t.destinationBuffers,i=void 0===r?null:r,o=t.vs,a=void 0===o?null:o,s=t.sourceDestinationMap,u=void 0===s?null:s,l=t.varyings,c=void 0===l?null:l,h=t.drawMode,p=void 0===h?U.a.POINTS:h,f=t.elementCount,d=void 0===f?null:f;j(n&&a&&c&&d),j(i||u),u&&(this.sourceDestinationMap=u,this._buffersSwapable=!0);var v=0;this.varyings=[],this.varyingMap={};var g=!0,y=!1,m=void 0;try{for(var _,b=c[Symbol.iterator]();!(g=(_=b.next()).done);g=!0){var x=_.value;this.varyings[v]=x,this.varyingMap[x]=v,v++}}catch(t){y=!0,m=t}finally{try{g||null==b.return||b.return()}finally{if(y)throw m}}this._bindBuffers({sourceBuffers:n,destinationBuffers:i}),this._buildModel({vs:a,drawMode:p,elementCount:d})}},{key:"update",value:function(t){var e=t.sourceBuffers,n=void 0===e?null:e,r=t.destinationBuffers,i=void 0===r?null:r,o=t.elementCount,a=void 0===o?this.elementCount:o;if(!n&&!i)return it.a.warn("Transform : no buffers updated")(),this;this.model.setVertexCount(a);var s=this.currentIndex,u=this.varyingMap,l=this._buffersSwapable,c=this.transformFeedbacks;for(var h in i)j(ga(i[h],Ve));if(Object.assign(this.sourceBuffers[s],n),Object.assign(this.destinationBuffers[s],i),c[s].bindBuffers(this.destinationBuffers[s],{varyingMap:u}),l){var p=(s+1)%2;for(var f in this.sourceDestinationMap){var d=this.sourceDestinationMap[f];this.sourceBuffers[p][f]=this.destinationBuffers[s][d],this.destinationBuffers[p][d]=this.sourceBuffers[s][f],j(ga(this.destinationBuffers[p][d],Ve))}c[p].bindBuffers(this.destinationBuffers[p],{varyingMap:u})}return this}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.uniforms,n=void 0===e?{}:e,r=this.model,i=this.transformFeedbacks,o=this.sourceBuffers,a=this.currentIndex;r.setAttributes(o[a]),r.draw({transformFeedback:i[a],uniforms:n,parameters:va({},U.a.RASTERIZER_DISCARD,!0)})}},{key:"swapBuffers",value:function(){j(this._buffersSwapable),this.currentIndex=(this.currentIndex+1)%2}},{key:"getBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.destinationBuffers,n=this.currentIndex;return j(t&&e[n][t]),e[n][t]}},{key:"_bindBuffers",value:function(t){var e=t.sourceBuffers,n=void 0===e?null:e,r=t.destinationBuffers,i=void 0===r?null:r,o=this._buffersSwapable;for(var a in i)j(ga(i[a],Ve));if(this.sourceBuffers[0]=Object.assign({},n),this.destinationBuffers[0]=Object.assign({},i),o)for(var s in this.sourceBuffers[1]={},this.destinationBuffers[1]={},this.sourceDestinationMap){var u=this.sourceDestinationMap[s];if(!this.destinationBuffers[0][u]){var l=this.sourceBuffers[0][s],c=l.bytes,h=l.type,p=l.usage,f=l.layout;this.destinationBuffers[0][u]=new Ve(this.gl,{bytes:c,type:h,usage:p,layout:f}),this._buffersToDelete.push(this.destinationBuffers[0][u])}this.sourceBuffers[1][s]=this.destinationBuffers[0][u],this.destinationBuffers[1][u]=this.sourceBuffers[0][s],j(ga(this.destinationBuffers[1][u],Ve))}}},{key:"_buildModel",value:function(t){var e=t.vs,n=t.drawMode,r=t.elementCount,i=this.varyings,o=this.varyingMap,a=this._buffersSwapable,s="void main()\n{\n}\n",u=e.split("\n");0===u[0].indexOf("#version ")&&(s="".concat(u[0],"\n").concat("void main()\n{\n}\n","\n")),this.model=new Ao(this.gl,{vs:e,fs:s,varyings:i,drawMode:n,vertexCount:r}),this.transformFeedbacks[0]=new Ei(this.gl,{buffers:this.destinationBuffers[0],varyingMap:o}),a&&(this.transformFeedbacks[1]=new Ei(this.gl,{buffers:this.destinationBuffers[1],varyingMap:this.varyingMap}))}},{key:"elementCount",get:function(){return this.model.getVertexCount()}}]),t}();U.a;n.d(e,"m",(function(){return ba})),n.d(e,"l",(function(){return ge})),n.d(e,"u",(function(){return xe})),n.d(e,"v",(function(){return we})),n.d(e,"e",(function(){return Se})),n.d(e,"p",(function(){return ke})),n.d(e,"b",(function(){return Ve})),n.d(e,"f",(function(){return dr})),n.d(e,"k",(function(){return kn})),n.d(e,"i",(function(){return Ao})),n.d(e,"a",(function(){return Oo})),n.d(e,"h",(function(){return Mi})),n.d(e,"c",(function(){return Ho})),n.d(e,"d",(function(){return ta})),n.d(e,"q",(function(){return ia})),n.d(e,"j",(function(){return uo})),n.d(e,"s",(function(){return Ui})),n.d(e,"t",(function(){return Vi})),n.d(e,"n",(function(){return oa})),n.d(e,"o",(function(){return la})),n.d(e,"r",(function(){return da})),n.d(e,"g",(function(){return U.a})),n(798);var ba={clearBuffer:Kn,Transform:_a,Attribute:li}},690:function(t,e,n){"use strict";var r={};function i(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function o(t){return Math.round(t/r.EPSILON)*r.EPSILON}function a(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===e?r.precision||4:e;return t=o(t),parseFloat(t.toPrecision(n))}function s(t,e){if(function(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}(t)){for(var n=(i=t).clone?i.clone():new Array(i),r=0;r<n.length;++r)n[r]=e(n[r],r,n);return n}var i;return e(t)}function u(t){return s(t,(function(t){return t/180*Math.PI}))}function l(t){return s(t,(function(t){return 180*t/Math.PI}))}function c(t,e,n){return s(t,(function(t){return Math.max(e,Math.min(n,t))}))}function h(t,e,n){return Array.isArray(t)?t.map((function(t,r){return h(t,e[r],n)})):n*e+(1-n)*t}function p(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!p(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}r.EPSILON=1e-12,r.debug=!0,r.precision=4,r.printTypes=!1,r.printDegrees=!1,r.printRowMajor=!0;var y=function(t){function e(){return d(this,e),g(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(i=[{key:"clone",value:function(){return(new this.constructor).copy(this).check()}},{key:"copy",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t[e];return this.check()}},{key:"set",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=(t<0||arguments.length<=t?void 0:arguments[t])||0;return this.check()}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"toString",value:function(){return this.formatString(r)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+a(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!p(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"inverse",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=1/this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"validate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=t&&t.length===this.ELEMENTS,n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(t[n]);return e}},{key:"check",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if(r.debug&&!this.validate(t))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){return this.scale(t)}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}}])&&v(n.prototype,i),o&&v(n,o),e}(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array));function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var w=function(t,e){if(!t)throw new Error(e)},E=function(t){function e(){return _(this,e),x(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return i(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return i(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]+=i[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]-=i[o];return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]*=i[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]/=i[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"scaleAndAdd",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=this[n]*e+t[n];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return w(t>=0&&t<this.ELEMENTS,"index is out of range"),i(this[t])}},{key:"setComponent",value:function(t,e){return w(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}])&&b(n.prototype,r),o&&b(n,o),e}(y),S=n(860),A=n.n(S);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var O=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return P(this,e),t=C(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r),t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"cross",value:function(t){return A()(this,this,t),this.check()}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 2}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=i(t)}}])&&k(n.prototype,r),o&&k(n,o),e}(E),I=n(861),M=n.n(I),R=n(801),L=n.n(R),F=n(863),N=n.n(F),j=n(864),D=n.n(j),z=n(865),B=n.n(z);function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function W(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var X=[0,0,0],H=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return V(this,e),t=W(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,i),t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"angle",value:function(t){return M()(this,t)}},{key:"cross",value:function(t){return L()(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?X:n;return N()(this,this,r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?X:n;return D()(this,this,r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?X:n;return B()(this,this,r,e),this.check()}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=i(t)}}])&&G(n.prototype,r),o&&G(n,o),e}(E);function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Y(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var J=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Z(this,e),t=Y(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,i,o),t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"applyMatrix4",value:function(t){return t.transformVector(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=i(t)}}])&&K(n.prototype,r),o&&K(n,o),e}(E),Q=n(866),$=n.n(Q),tt=n(867),et=n.n(tt),nt=n(868),rt=n.n(nt),it=n(727),ot=n.n(it),at=n(802),st=n.n(at),ut=n(728),lt=n.n(ut),ct=n(870),ht=n.n(ct),pt=n(764),ft=n.n(pt),dt=n(729),vt=n.n(dt),gt=n(871),yt=n.n(gt),mt=n(730),_t=n.n(mt),bt=n(731),xt=n.n(bt),wt=n(872),Et=n.n(wt),St=n(873),At=n.n(St),Tt=n(735),Pt=n.n(Tt),kt=n(745),Ct=n.n(kt),Ot=n(765),It=n.n(Ot),Mt=n(746),Rt=n.n(Mt);function Lt(t){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Nt(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function jt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zt(t,e){return!e||"object"!==Lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var Bt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Ut(t,e){return t.length===e&&t.every(Number.isFinite)}var Vt=function(t){function e(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return jt(this,e),t=zt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Array.isArray(r[0])&&1===arguments.length?t.copy(r[0]):t.identity(),t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"setRowMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,d=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=i,this[2]=u,this[3]=p,this[4]=e,this[5]=o,this[6]=l,this[7]=f,this[8]=n,this[9]=a,this[10]=c,this[11]=d,this[12]=r,this[13]=s,this[14]=h,this[15]=v,this.check()}},{key:"setColumnMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,d=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=l,this[10]=c,this[11]=h,this[12]=p,this[13]=f,this[14]=d,this[15]=v,this.check()}},{key:"copy",value:function(t){return this.setColumnMajor.apply(this,Nt(t))}},{key:"set",value:function(){return this.setColumnMajor.apply(this,arguments)}},{key:"getElement",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?this[t][e]:this[e][t]}},{key:"setElement",value:function(t,e,n){return arguments.length>3&&void 0!==arguments[3]&&arguments[3],this[e][t]=i(n),this}},{key:"determinant",value:function(){return $()(this)}},{key:"identity",value:function(){return this.copy(Bt)}},{key:"fromQuaternion",value:function(t){return et()(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,o=t.near,a=t.far;return rt()(this,e,n,r,i,o,a),this.check()}},{key:"lookAt",value:function(t){var e=t.eye,n=t.center,r=void 0===n?[0,0,0]:n,i=t.up,o=void 0===i?[0,1,0]:i;return ot()(this,e,r,o),this.check()}},{key:"ortho",value:function(t){var e=t.left,n=t.right,r=t.bottom,i=t.top,o=t.near,a=void 0===o?.1:o,s=t.far,u=void 0===s?500:s;return st()(this,e,n,r,i,a,u),this.check()}},{key:"orthographic",value:function(t){var n=t.fovy,r=void 0===n?45*Math.PI/180:n,i=t.aspect,o=void 0===i?1:i,a=t.focalDistance,s=void 0===a?1:a,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?500:c;if(r>2*Math.PI)throw Error("radians");var p=r/2,f=s*Math.tan(p),d=f*o;return(new e).ortho({left:-d,right:d,bottom:-f,top:f,near:l,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,n=t.fov,r=void 0===n?45*Math.PI/180:n,i=t.aspect,o=void 0===i?1:i,a=t.near,s=void 0===a?.1:a,u=t.far,l=void 0===u?500:u;if((e=e||r)>2*Math.PI)throw Error("radians");return lt()(this,e,o,s,l),this.check()}},{key:"transpose",value:function(){return ht()(this,this),this.check()}},{key:"invert",value:function(){return ft()(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return vt()(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return vt()(this,this,t),this.check()}},{key:"rotateX",value:function(t){return Ct()(this,this,t),this.check()}},{key:"rotateY",value:function(t){return It()(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return Rt()(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=Ft(t,3),n=e[0],r=e[1],i=e[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return yt()(this,this,t,e),this.check()}},{key:"scale",value:function(t){return _t()(this,this,t),this.check()}},{key:"translate",value:function(t){return xt()(this,this,t),this.check()}},{key:"transformVector2",value:function(t,e){return e=e||new O,Et()(e,t,this),Ut(e,2),e}},{key:"transformVector3",value:function(t,e){return e=e||new H,At()(e,t,this),Ut(e,3),e}},{key:"transformVector4",value:function(t,e){return e=e||new J,Pt()(e,t,this),Ut(e,4),e.check()}},{key:"transformVector",value:function(t,e){switch(t.length){case 2:return this.transformVector2(t,e);case 3:return this.transformVector3(t,e);case 4:return this.transformVector4(t,e);default:throw new Error("Illegal vector")}}},{key:"transformDirection",value:function(t,e){return this._transformVector(t,e,0)}},{key:"transformPoint",value:function(t,e){return this._transformVector(t,e,1)}},{key:"_transformVector",value:function(t,e,n){switch(t.length){case 2:e=e||new O,Pt()(e,[t[0],t[1],0,n],this),e.length=2,Ut(e,2);break;case 3:e=e||new H,Pt()(e,[t[0],t[1],t[2],n],this),e.length=3,Ut(e,3);break;case 4:if(Boolean(n)!==Boolean(t[3]))throw new Error("math.gl: Matrix4.transformPoint - invalid vector");e=e||new J,Pt()(e,t,this),Ut(e,4);break;default:throw new Error("Illegal vector")}return e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,n){return this.identity().translate([t,e,n])}},{key:"ELEMENTS",get:function(){return 16}}])&&Dt(n.prototype,r),o&&Dt(n,o),e}(y),Gt=n(874),Wt=n.n(Gt),Xt=n(875),Ht=n.n(Xt),qt=n(876),Zt=n.n(qt),Kt=n(878),Yt=n.n(Kt),Jt=n(880),Qt=n.n(Jt),$t=n(882),te=n.n($t),ee=n(884),ne=n.n(ee),re=n(886),ie=n.n(re),oe=n(887),ae=n.n(oe),se=n(888),ue=n.n(se),le=n(889),ce=n.n(le),he=n(891),pe=n.n(he),fe=n(804),de=n.n(fe),ve=n(892),ge=n.n(ve),ye=n(893),me=n.n(ye),_e=n(894),be=n.n(_e),xe=n(895),we=n.n(xe),Ee=n(896),Se=n.n(Ee),Ae=n(805),Te=n.n(Ae),Pe=n(898),ke=n.n(Pe);function Ce(t){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oe(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Ie(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Me(t,e){return!e||"object"!==Ce(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var Re=[0,0,0,1];var Le=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return Oe(this,e),t=Me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,i,o),t}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),n=e,(r=[{key:"fromMatrix3",value:function(t){return Wt()(this,t),this.check()}},{key:"fromValues",value:function(t,e,n,r){return this.set(t,e,n,r)}},{key:"identity",value:function(){return Ht()(this),this.check()}},{key:"length",value:function(){return Zt()(this)}},{key:"squaredLength",value:function(t){return Yt()(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return Qt()(this,t)}},{key:"rotationTo",value:function(t,e){return te()(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return ne()(this,t),this.check()}},{key:"calculateW",value:function(){return ie()(this,this),this.check()}},{key:"conjugate",value:function(){return ae()(this,this),this.check()}},{key:"invert",value:function(){return ue()(this,this),this.check()}},{key:"lerp",value:function(t,e,n){return ce()(this,t,e,n),this.check()}},{key:"multiply",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.multiply only takes one argument");return pe()(this,this,e),this.check()}},{key:"normalize",value:function(){return de()(this,this),this.check()}},{key:"rotateX",value:function(t){return ge()(this,this,t),this.check()}},{key:"rotateY",value:function(t){return me()(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return be()(this,this,t),this.check()}},{key:"scale",value:function(t){return we()(this,this,t),this.check()}},{key:"set",value:function(t,e,n,r){return Se()(this,t,e,n,r),this.check()}},{key:"setAxisAngle",value:function(t,e){return Te()(this,t,e),this.check()}},{key:"slerp",value:function(t){var e=t.start,n=void 0===e?Re:e,r=t.target,i=t.ratio;return ke()(this,n,r,i),this.check()}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=i(t)}}])&&Ie(n.prototype,r),o&&Ie(n,o),e}(y),Fe=n(803),Ne=n.n(Fe);function je(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function De(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Be=6371e3,Ue=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.phi,r=e.theta,i=e.radius,o=e.bearing,a=e.pitch,s=(e.altitude,e.radiusScale),u=void 0===s?Be:s;De(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(n)||Number.isFinite(r)?(this.phi=n||0,this.theta=r||0):(Number.isFinite(o)||Number.isFinite(a))&&(this.bearing=o||0,this.pitch=a||0),this.radius=i||1,this.radiusScale=u||1,this.check()}var e,n,i;return e=t,(n=[{key:"toString",value:function(){return this.formatString(r)}},{key:"formatString",value:function(t){var e=t.printTypes,n=(t.printDegrees,a);return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}},{key:"equals",value:function(t){return p(this.radius,t.radius)&&p(this.theta,t.theta)&&p(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=je(t,3),n=e[0],r=e[1],i=e[2];this.radius=1+i/this.radiusScale,this.phi=u(r),this.theta=u(n)}},{key:"fromVector3",value:function(t){return this.radius=Ne()(t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(c(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new H(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-l(this.phi)},set:function(t){this.phi=Math.PI-u(t)}},{key:"pitch",get:function(){return l(this.theta)},set:function(t){this.theta=u(t)}},{key:"longitude",get:function(){return l(this.phi)}},{key:"latitude",get:function(){return l(this.theta)}},{key:"lng",get:function(){return l(this.phi)}},{key:"lat",get:function(){return l(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}])&&ze(e.prototype,n),i&&ze(e,i),t}();function Ve(t){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ge(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function We(t,e){return!e||"object"!==Ve(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function He(t,e,n){return e&&Xe(t.prototype,e),n&&Xe(t,n),t}var qe="Unknown Euler angle order";var Ze=function(t){function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;(Ge(this,e),t=We(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),arguments.length>0&&Array.isArray(arguments[0]))?(n=t).fromVector3.apply(n,arguments):t.set(r,i,o,a);return t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),He(e,[{key:"ELEMENTS",get:function(){return 4}}],[{key:"rotationOrder",value:function(t){return e.RotationOrders[t]}},{key:"ZYX",get:function(){return 0}},{key:"YXZ",get:function(){return 1}},{key:"XZY",get:function(){return 2}},{key:"ZXY",get:function(){return 3}},{key:"YZX",get:function(){return 4}},{key:"XYZ",get:function(){return 5}},{key:"RollPitchYaw",get:function(){return 0}},{key:"DefaultOrder",get:function(){return e.ZYX}},{key:"RotationOrders",get:function(){return["ZYX","YXZ","XZY","ZXY","YZX","XYZ"]}}]),He(e,[{key:"copy",value:function(t){for(var e=0;e<3;++e)this[e]=t[e];return this[3]=Number.isFinite(t[3])||this.order,this.check()}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;return this[0]=t,this[1]=e,this[2]=n,this[3]=Number.isFinite(r)?r:this[3],this.check()}},{key:"validate",value:function(){return(t=this[3])>=0&&t<6&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2]);var t}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}},{key:"toArray4",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}},{key:"toVector3",value:function(t){return t?t.set(this[0],this[1],this[2]):new H(this[0],this[1],this[2])}},{key:"fromVector3",value:function(t,e){return this.set(t[0],t[1],t[2],Number.isFinite(e)?e:this[3])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[0+e],this[1]=t[1+e],this[2]=t[2+e],void 0!==t[3]&&(this[3]=t[3]),this.check()}},{key:"fromRollPitchYaw",value:function(t,n,r){return this.set(t,n,r,e.ZYX)}},{key:"fromQuaternion",value:function(t,e){return this._fromRotationMatrix(Vt.fromQuaternion(t),e),this.check()}},{key:"fromRotationMatrix",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DefaultOrder;return this._fromRotationMatrix(t,n),this.check()}},{key:"getRotationMatrix",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Vt;return this._getRotationMatrix(t),t}},{key:"getQuaternion",value:function(){var t=new Le;switch(this[4]){case e.XYZ:return t.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case e.YXZ:return t.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case e.ZXY:return t.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case e.ZYX:return t.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case e.YZX:return t.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case e.XZY:return t.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(qe)}}},{key:"_fromRotationMatrix",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DefaultOrder,r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],u=r[5],l=r[9],h=r[2],p=r[6],f=r[10];switch(n=n||this[3]){case e.XYZ:this[1]=Math.asin(c(a,-1,1)),Math.abs(a)<.99999?(this[0]=Math.atan2(-l,f),this[2]=Math.atan2(-o,i)):(this[0]=Math.atan2(p,u),this[2]=0);break;case e.YXZ:this[0]=Math.asin(-c(l,-1,1)),Math.abs(l)<.99999?(this[1]=Math.atan2(a,f),this[2]=Math.atan2(s,u)):(this[1]=Math.atan2(-h,i),this[2]=0);break;case e.ZXY:this[0]=Math.asin(c(p,-1,1)),Math.abs(p)<.99999?(this[1]=Math.atan2(-h,f),this[2]=Math.atan2(-o,u)):(this[1]=0,this[2]=Math.atan2(s,i));break;case e.ZYX:this[1]=Math.asin(-c(h,-1,1)),Math.abs(h)<.99999?(this[0]=Math.atan2(p,f),this[2]=Math.atan2(s,i)):(this[0]=0,this[2]=Math.atan2(-o,u));break;case e.YZX:this[2]=Math.asin(c(s,-1,1)),Math.abs(s)<.99999?(this[0]=Math.atan2(-l,u),this[1]=Math.atan2(-h,i)):(this[0]=0,this[1]=Math.atan2(a,f));break;case e.XZY:this[2]=Math.asin(-c(o,-1,1)),Math.abs(o)<.99999?(this[0]=Math.atan2(p,u),this[1]=Math.atan2(a,i)):(this[0]=Math.atan2(-l,f),this[1]=0);break;default:throw new Error(qe)}return this[3]=n,this}},{key:"_getRotationMatrix",value:function(){var t=new Vt,n=this.x,r=this.y,i=this.z,o=Math.cos(n),a=Math.cos(r),s=Math.cos(i),u=Math.sin(n),l=Math.sin(r),c=Math.sin(i);switch(this[3]){case e.XYZ:var h=o*s,p=o*c,f=u*s,d=u*c;t[0]=a*s,t[4]=-a*c,t[8]=l,t[1]=p+f*l,t[5]=h-d*l,t[9]=-u*a,t[2]=d-h*l,t[6]=f+p*l,t[10]=o*a;break;case e.YXZ:var v=a*s,g=a*c,y=l*s,m=l*c;t[0]=v+m*u,t[4]=y*u-g,t[8]=o*l,t[1]=o*c,t[5]=o*s,t[9]=-u,t[2]=g*u-y,t[6]=m+v*u,t[10]=o*a;break;case e.ZXY:var _=a*s,b=a*c,x=l*s,w=l*c;t[0]=_-w*u,t[4]=-o*c,t[8]=x+b*u,t[1]=b+x*u,t[5]=o*s,t[9]=w-_*u,t[2]=-o*l,t[6]=u,t[10]=o*a;break;case e.ZYX:var E=o*s,S=o*c,A=u*s,T=u*c;t[0]=a*s,t[4]=A*l-S,t[8]=E*l+T,t[1]=a*c,t[5]=T*l+E,t[9]=S*l-A,t[2]=-l,t[6]=u*a,t[10]=o*a;break;case e.YZX:var P=o*a,k=o*l,C=u*a,O=u*l;t[0]=a*s,t[4]=O-P*c,t[8]=C*c+k,t[1]=c,t[5]=o*s,t[9]=-u*s,t[2]=-l*s,t[6]=k*c+C,t[10]=P-O*c;break;case e.XZY:var I=o*a,M=o*l,R=u*a,L=u*l;t[0]=a*s,t[4]=-c,t[8]=l*s,t[1]=I*c+L,t[5]=o*s,t[9]=M*c-R,t[2]=R*c-M,t[6]=u*s,t[10]=L*c+I;break;default:throw new Error(qe)}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"alpha",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"beta",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"gamma",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"phi",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"theta",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"psi",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"roll",get:function(){return this[0]},set:function(t){return this[0]=i(t)}},{key:"pitch",get:function(){return this[1]},set:function(t){return this[1]=i(t)}},{key:"yaw",get:function(){return this[2]},set:function(t){return this[2]=i(t)}},{key:"order",get:function(){return this[3]},set:function(t){return this[3]=function(t){if(t<0&&t>=6)throw new Error(qe);return t}(t)}}]),e}(y);function Ke(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Je=function(){function t(e){var n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.z,s=void 0===a?0:a,u=e.roll,l=void 0===u?0:u,c=e.pitch,h=void 0===c?0:c,p=e.yaw,f=void 0===p?0:p;Ke(this,t),this.position=new H(r,o,s),this.orientation=new Ze(l,h,f,Ze.RollPitchYaw)}var e,n,r;return e=t,(n=[{key:"getPosition",value:function(){return this.position}},{key:"getOrientation",value:function(){return this.orientation}},{key:"getTransformationMatrix",value:function(){var t=Math.sin(this.roll),e=Math.sin(this.pitch),n=Math.sin(this.yaw),r=Math.cos(this.roll),i=Math.cos(this.pitch),o=Math.cos(this.yaw);return(new Vt).setRowMajor(o*i,-n*r+o*e*t,n*t+o*e*r,this.x,n*i,o*r+n*e*t,-o*t+n*e*r,this.y,-e,i*t,i*r,this.z,0,0,0,1)}},{key:"getTransformationMatrixFromPose",value:function(t){return(new Vt).multiplyRight(this.getTransformationMatrix()).multiplyRight(t.getTransformationMatrix().invert())}},{key:"getTransformationMatrixToPose",value:function(t){return(new Vt).multiplyRight(t.getTransformationMatrix()).multiplyRight(this.getTransformationMatrix().invert())}},{key:"x",get:function(){return this.position.x},set:function(t){return this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){return this.position.y=t}},{key:"z",get:function(){return this.position.z},set:function(t){return this.position.z=t}},{key:"roll",get:function(){return this.orientation.roll},set:function(t){return this.orientation.roll=t}},{key:"pitch",get:function(){return this.orientation.pitch},set:function(t){return this.orientation.pitch=t}},{key:"yaw",get:function(){return this.orientation.yaw},set:function(t){return this.orientation.yaw=t}}])&&Ye(e.prototype,n),r&&Ye(e,r),t}();function Qe(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function $e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var tn=function(){function t(e){Qe(this,t),this.points=e,this.isClosed=p(this.points[this.points.length-1],this.points[0]),Object.freeze(this)}var e,n,r;return e=t,(n=[{key:"getSignedArea",value:function(){var t=0;return this.forEachSegment((function(e,n){t+=(e[0]+n[0])*(e[1]-n[1])})),t/2}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(t){for(var e=this.points.length,n=0;n<e-1;n++)t(this.points[n],this.points[n+1],n,n+1);this.isPolygon&&!this.isClosed()&&t(this.points[e-1],this.points[0],e-1,0)}}])&&$e(e.prototype,n),r&&$e(e,r),t}();n.d(e,"e",(function(){return en})),n.d(e,"b",(function(){return H})),n.d(e,"a",(function(){return Vt})),n.d(e,"c",(function(){return c})),n.d(e,"f",(function(){return h})),n.d(e,"d",(function(){return p}));var en={SphericalCoordinates:Ue,Euler:Ze,Pose:Je,Polygon:tn}},691:function(t,e){t.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},692:function(t,e,n){"use strict";function r(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}n.d(e,"a",(function(){return r}))},694:function(t,e,n){"use strict";var r=n(744);e.a=new r.Log({id:"deck"})},695:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(138);function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Object(r.a)(t,e)}},696:function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return r}))},697:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)})(t)}var o=n(209);function a(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?Object(o.a)(t):e}n.d(e,"a",(function(){return a}))},699:function(t,e,n){"use strict";var r=n(685),i=n(689),o="#define SHADER_NAME arc-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function h(t){return(h=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=i.o.fp64LowPart,d=[0,0,0,255],v={fp64:!1,getSourcePosition:function(t){return t.sourcePosition},getTargetPosition:function(t){return t.targetPosition},getSourceColor:function(t){return t.color||d},getTargetColor:function(t){return t.color||d},getStrokeWidth:1},g=function(t){function e(t){s(this,e);var n=null;return Number.isFinite(t.strokeWidth)&&(r.log.deprecated("ArcLayer: `strokeWidth`","`getStrokeWidth`"),n={getStrokeWidth:t.strokeWidth}),l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}var n,a,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");p(t.prototype,e&&e.prototype),e&&p(t,e)}(e,t),n=e,(a=[{key:"getShaders",value:function(){return this.is64bitEnabled()?{vs:"#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_to_clipspace_fp64(next_pos_modelspace);\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:o,modules:["project64","picking"]}:{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(instancePositions.xy);\n  vec2 target = project_position(instancePositions.zw);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  // if it's the first point, use next - current as direction\n  // otherwise use current - prev\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_to_clipspace(vec4(nextPos, 1.0));\n\n  // extrude\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:o,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instanceSourceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getSourceColor",defaultValue:d},instanceTargetColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getTargetColor",defaultValue:d},instanceWidths:{size:1,transition:!0,accessor:"getStrokeWidth",defaultValue:1}})}},{key:"updateAttribute",value:function(t){var e=t.props,n=t.oldProps;if(t.changeFlags,e.fp64!==n.fp64){var i=this.getAttributeManager();i.invalidateAll(),e.fp64&&e.coordinateSystem===r.COORDINATE_SYSTEM.LNGLAT?i.addInstanced({instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low}}):i.remove(["instancePositions64Low"])}}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)})}this.updateAttribute({props:n,oldProps:r,changeFlags:i})}},{key:"_getModel",value:function(t){for(var e=[],n=0;n<50;n++)e=e.concat([n,-1,0,n,1,0]);var r=new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLE_STRIP,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return r.setUniforms({numSegments:50}),r}},{key:"calculateInstancePositions",value:function(t){var e=this.props,n=e.data,r=e.getSourcePosition,i=e.getTargetPosition,o=t.value,a=t.size,s=0,u=!0,l=!1,c=void 0;try{for(var h,p=n[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value,d=r(f),v=i(f);o[s+0]=d[0],o[s+1]=d[1],o[s+2]=v[0],o[s+3]=v[1],s+=a}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}}},{key:"calculateInstancePositions64Low",value:function(t){var e=this.props,n=e.data,r=e.getSourcePosition,i=e.getTargetPosition,o=t.value,a=t.size,s=0,u=!0,l=!1,c=void 0;try{for(var h,p=n[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var d=h.value,v=r(d),g=i(d);o[s+0]=f(v[0]),o[s+1]=f(v[1]),o[s+2]=f(g[0]),o[s+3]=f(g[1]),s+=a}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}}}])&&u(n.prototype,a),h&&u(n,h),e}(r.Layer);g.layerName="ArcLayer",g.defaultProps=v;function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function x(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t,e,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function S(t){return(S=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T=i.o.fp64LowPart,P=[0,0,0,255],k=i.g.LINEAR_MIPMAP_LINEAR,C=i.g.LINEAR,O={iconAtlas:null,iconMapping:{},sizeScale:1,fp64:!1,getPosition:function(t){return t.position},getIcon:function(t){return t.icon},getColor:function(t){return t.color||P},getSize:function(t){return t.size||1},getAngle:function(t){return t.angle||0}},I=function(t){function e(){return function(t,e){if(!b(t,e))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");A(t.prototype,e&&e.prototype),e&&A(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return{vs:'#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * sizeScale * instanceScale;\n  pixelOffset.y *= -1.0;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0));\n  gl_Position += project_pixel_to_clipspace(pixelOffset);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = instanceColors / 255.;\n\n  vColorMode = instanceColorModes;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n',fs:"#define SHADER_NAME icon-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * mix(1.0, vColor.a, vColorMode);\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",update:this.calculateInstanceOffsets},instanceIconFrames:{size:4,accessor:"getIcon",update:this.calculateInstanceIconFrames},instanceColorModes:{size:1,type:i.g.UNSIGNED_BYTE,accessor:"getIcon",update:this.calculateInstanceColorMode},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:P},instanceAngles:{size:1,transition:!0,accessor:"getAngle",defaultValue:0}})}},{key:"updateState",value:function(t){var n=this,r=t.oldProps,o=t.props,a=t.changeFlags;E(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:o,oldProps:r,changeFlags:a});var s,u=o.iconAtlas,l=o.iconMapping;if(r.iconMapping!==l){var c=this.getAttributeManager();c.invalidate("instanceOffsets"),c.invalidate("instanceIconFrames"),c.invalidate("instanceColorModes")}if(r.iconAtlas!==u&&(b(u,i.k)?(u.setParameters((_(s={},i.g.TEXTURE_MIN_FILTER,k),_(s,i.g.TEXTURE_MAG_FILTER,C),s)),this.setState({iconsTexture:u})):"string"==typeof u&&Object(i.q)(this.context.gl,{urls:[u]}).then((function(t){var e,r=m(t,1)[0];r.setParameters((_(e={},i.g.TEXTURE_MIN_FILTER,k),_(e,i.g.TEXTURE_MAG_FILTER,C),e)),n.setState({iconsTexture:r})}))),o.fp64!==r.fp64){var h=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(h)}),this.state.attributeManager.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props.sizeScale,r=this.state.iconsTexture;r&&this.state.model.render(Object.assign({},e,{iconsTexture:r,iconsTextureDim:[r.width,r.height],sizeScale:n}))}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getPosition,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value);o[a++]=T(p[0]),o[a++]=T(p[1])}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}else t.value=new Float32Array(2)}},{key:"calculateInstanceOffsets",value:function(t){var e=this.props,n=e.data,r=e.iconMapping,i=e.getIcon,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=n[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=r[i(c.value)]||{};o[a++]=p.width/2-p.anchorX||0,o[a++]=p.height/2-p.anchorY||0}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}},{key:"calculateInstanceColorMode",value:function(t){var e=this.props,n=e.data,r=e.iconMapping,i=e.getIcon,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=n[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value),f=r[p]&&r[p].mask;o[a++]=f?1:0}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}},{key:"calculateInstanceIconFrames",value:function(t){var e=this.props,n=e.data,r=e.iconMapping,i=e.getIcon,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=n[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=r[i(c.value)]||{};o[a++]=p.x||0,o[a++]=p.y||0,o[a++]=p.width||0,o[a++]=p.height||0}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}}])&&x(n.prototype,r),o&&x(n,o),e}(r.Layer);I.layerName="IconLayer",I.defaultProps=O;function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function N(t,e,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=j(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function j(t){return(j=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var z=i.o.fp64LowPart,B=[0,0,0,255],U={fp64:!1,getSourcePosition:function(t){return t.sourcePosition},getTargetPosition:function(t){return t.targetPosition},getColor:function(t){return t.color||B},getStrokeWidth:1},V=function(t){function e(t){R(this,e);var n=null;return Number.isFinite(t.strokeWidth)&&(r.log.deprecated("LineLayer: `strokeWidth`","`getStrokeWidth`"),n={getStrokeWidth:t.strokeWidth}),F(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");D(t.prototype,e&&e.prototype),e&&D(t,e)}(e,t),n=e,(o=[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\n\nvarying vec4 vColor;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * instanceWidths / 2.0;\n  vec2 offset_clipspace = project_pixel_to_clipspace(offset_screenspace).xy;\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  // Position\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourceTargetPositions64xyLow.xy, vec3(0.));\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceSourceTargetPositions64xyLow.zw, vec3(0.));\n\n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n\n  // extrude\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceSourceTargetPositions64xyLow:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstanceSourceTargetPositions64xyLow},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getStrokeWidth",defaultValue:1}})}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(N(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.state.attributeManager.invalidateAll()}}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstanceSourceTargetPositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getSourcePosition,o=n.getTargetPosition,a=t.value,s=t.size,u=0,l=!0,c=!1,h=void 0;try{for(var p,f=r[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var d=p.value,v=i(d),g=o(d);a[u+0]=z(v[0]),a[u+1]=z(v[1]),a[u+2]=z(g[0]),a[u+3]=z(g[1]),u+=s}}catch(t){c=!0,h=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}}else t.value=new Float32Array(4)}}])&&L(n.prototype,o),a&&L(n,a),e}(r.Layer);V.layerName="LineLayer",V.defaultProps=U;function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function H(t,e){return!e||"object"!==G(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t,e,n){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Z(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Z(t){return(Z=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Y=i.o.fp64LowPart,J=[0,0,0,255],Q={radiusPixels:10,fp64:!1,getPosition:function(t){return t.position},getNormal:function(t){return t.normal},getColor:function(t){return t.color||J},lightSettings:{}},$=function(t){function e(){return W(this,e),H(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");K(t.prototype,e&&e.prototype),e&&K(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n\n  // Find the center of the point and add the current vertex\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_worldspace);\n  gl_Position += project_pixel_to_clipspace(positions.xy * radiusPixels);\n\n  // Apply lighting\n  float lightWeight = lighting_getLightWeight(position_worldspace.xyz, // the w component is always 1.0\n    project_normal(instanceNormals));\n\n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(lightWeight * instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","lighting","picking"]}}},{key:"initializeState",value:function(){this.state.attributeManager.addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:[0,0,1]},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]}})}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(q(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.state.attributeManager.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props.radiusPixels;this.state.model.render(Object.assign({},e,{radiusPixels:n}))}},{key:"_getModel",value:function(t){for(var e=[],n=0;n<3;n++){var r=n/3*Math.PI*2;e.push(2*Math.cos(r),2*Math.sin(r),0)}return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLES,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getPosition,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value);o[a++]=Y(p[0]),o[a++]=Y(p[1])}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}else t.value=new Float32Array(2)}}])&&X(n.prototype,r),o&&X(n,o),e}(r.Layer);$.layerName="PointCloudLayer",$.defaultProps=Q;function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rt(t,e){return!e||"object"!==tt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t,e,n){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ot(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ot(t){return(ot=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function at(t,e){return(at=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var st=i.o.fp64LowPart,ut=[0,0,0,255],lt={radiusScale:1,radiusMinPixels:0,radiusMaxPixels:Number.MAX_SAFE_INTEGER,strokeWidth:1,outline:!1,fp64:!1,getPosition:function(t){return t.position},getRadius:function(t){return t.radius||1},getColor:function(t){return t.color||ut}},ct=function(t){function e(){return et(this,e),rt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");at(t.prototype,e&&e.prototype),e&&at(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float outline;\nuniform float strokeWidth;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  // Multiply out radius and clamp to limits\n  float outerRadiusPixels = clamp(\n    project_scale(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n\n  // outline is centered at the radius\n  // outer radius needs to offset by half stroke width\n  outerRadiusPixels += outline * strokeWidth / 2.0;\n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  // 0 - solid circle, 1 - stroke with lineWidth=0\n  innerUnitRadius = outline * (1.0 - strokeWidth / outerRadiusPixels);\n\n  vec3 offset = positions * outerRadiusPixels;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n\n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0 || distToCenter < innerUnitRadius) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.state.attributeManager.addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:i.g.UNSIGNED_BYTE,accessor:"getColor",defaultValue:[0,0,0,255]}})}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(it(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.state.attributeManager.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.radiusScale,i=n.radiusMinPixels,o=n.radiusMaxPixels,a=n.outline,s=n.strokeWidth;this.state.model.render(Object.assign({},e,{outline:a?1:0,strokeWidth:s,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:o}))}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign(this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLE_FAN,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getPosition,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value);o[a++]=st(p[0]),o[a++]=st(p[1])}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}else t.value=new Float32Array(2)}}])&&nt(n.prototype,r),o&&nt(n,o),e}(r.Layer);ct.layerName="ScatterplotLayer",ct.defaultProps=lt;var ht=n(690);function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ft(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vt(t,e){return!e||"object"!==pt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gt(t,e,n){return(gt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function yt(t){return(yt=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function mt(t,e){return(mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _t=r.experimental.defaultColorRange,bt=r.experimental.quantizeScale,xt=[0,0,0,255],wt=[0,255,0,255],Et={cellSizePixels:100,colorDomain:null,colorRange:_t,getPosition:function(t){return t.position},getWeight:function(t){return 1}},St=function(t){function e(){return ft(this,e),vt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");mt(t.prototype,e&&e.prototype),e&&mt(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader\n\nattribute vec3 vertices;\nattribute vec3 instancePositions;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec4 color = instanceColors / 255.;\n\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + vertices * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:["picking"]}}},{key:"initializeState",value:function(){var t=this.getAttributeManager(),e=this.context.gl;t.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceColors}}),this.setState({model:this._getModel(e)})}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var n=t.oldProps,r=t.props,i=t.changeFlags;gt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:r,oldProps:n,changeFlags:i}),(r.cellSizePixels!==n.cellSizePixels||i.viewportChanged)&&this.updateCell()}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props.parameters,r=void 0===n?{}:n,i=this.state,o=i.model,a=i.cellScale;e=Object.assign({},e,{cellScale:a}),o.draw({uniforms:e,parameters:Object.assign({depthTest:!1,depthMask:!1},r)})}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLE_FAN,attributes:{vertices:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"updateCell",value:function(){var t=this.context.viewport,e=t.width,n=t.height,r=this.props.cellSizePixels,i=new Float32Array([(r-2)/e*2,-(r-2)/n*2,1]),o=Math.ceil(e/r),a=Math.ceil(n/r);this.setState({cellScale:i,numCol:o,numRow:a,numInstances:o*a}),this.getAttributeManager().invalidateAll()}},{key:"calculateInstancePositions",value:function(t,e){for(var n=e.numInstances,r=this.context.viewport,i=r.width,o=r.height,a=this.props.cellSizePixels,s=this.state.numCol,u=t.value,l=t.size,c=0;c<n;c++){var h=c%s,p=Math.floor(c/s);u[c*l+0]=h*a/i*2-1,u[c*l+1]=1-p*a/o*2,u[c*l+2]=0}}},{key:"calculateInstanceColors",value:function(t){var e=this.props,n=e.data,r=e.cellSizePixels,i=e.getPosition,o=e.getWeight,a=this.state,s=a.numCol,u=a.numRow,l=a.numInstances,c=t.value,h=t.size,p=new Array(l),f=0;p.fill(0);var d=!0,v=!1,g=void 0;try{for(var y,m=n[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){var _=y.value,b=this.project(i(_)),x=Math.floor(b[0]/r),w=Math.floor(b[1]/r);if(x>=0&&x<s&&w>=0&&w<u){var E=x+w*s;p[E]+=o(_),p[E]>f&&(f=p[E])}}}catch(t){v=!0,g=t}finally{try{d||null==m.return||m.return()}finally{if(v)throw g}}this.setState({maxCount:f});for(var S=0;S<l;S++){var A=this._getColor(p[S],f),T=S*h;c[T+0]=A[0],c[T+1]=A[1],c[T+2]=A[2],c[T+3]=A[3]}}},{key:"_getColor",value:function(t,e){var n,r=this.props,i=r.minColor,o=r.maxColor,a=r.colorRange;if(this._shouldUseMinMax()){var s=t/e;return n=Object(ht.f)(i||xt,o||wt,s)}var u=this.props.colorDomain||[1,e];return t<u[0]||t>u[1]?[0,0,0,0]:((n=bt(u,a,t))[3]=Number.isFinite(n[3])?n[3]:255,n)}},{key:"_shouldUseMinMax",value:function(){var t=this.props,e=t.minColor,n=t.maxColor,r=t.colorDomain,i=t.colorRange;return!(!e&&!n)||!r&&!i}}])&&dt(n.prototype,r),o&&dt(n,o),e}(r.Layer);St.layerName="ScreenGridLayer",St.defaultProps=Et;function At(t){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function kt(t,e){return!e||"object"!==At(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ct(t,e,n){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ot(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Ot(t){return(Ot=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function It(t,e){return(It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Mt=i.o.fp64LowPart,Rt=[255,0,255,255],Lt=function(t){function e(){return Tt(this,e),kt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");It(t.prototype,e&&e.prototype),e&&It(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME grid-cell-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Custom uniforms\nuniform float extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter\n#define ELEVATION_SCALE 0.8\n\n// Result\nvarying vec4 vColor;\n\nvoid main(void) {\n\n  // if ahpha == 0.0 or z < 0.0, do not render element\n  float noRender = float(instanceColors.a == 0.0 || instanceElevations < 0.0);\n  float finalCellSize = project_scale(cellSize) * mix(1.0, 0.0, noRender);\n\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = instanceElevations  * (positions.z + 1.0) *\n      ELEVATION_SCALE * elevationScale;\n  }\n\n  // cube geometry vertics are between -1 to 1, scale and transform it to between 0, 1\n  vec3 extrudedPosition = vec3(instancePositions.xy, elevation);\n  vec2 extrudedPosition64xyLow = instancePositions64xyLow;\n  vec3 offset = vec3(\n    (positions.x * coverage + 1.0) / 2.0 * finalCellSize,\n    (positions.y * coverage - 1.0) / 2.0 * finalCellSize,\n    1.0);\n\n  // extrude positions\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(extrudedPosition, extrudedPosition64xyLow, offset, position_worldspace);\n\n  float lightWeight = 1.0;\n\n  if (extruded > 0.5) {\n    lightWeight = lighting_getLightWeight(\n      position_worldspace.xyz, // the w component is always 1.0\n      normals\n    );\n  }\n\n  vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n  vec4 color = vec4(lightWeightedColor, instanceColors.a * opacity) / 255.0;\n  vColor = color;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME grid-cell-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:Rt}})}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(Ct(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.state.attributeManager.invalidateAll()}}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.c,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.cellSize,i=n.extruded,o=n.elevationScale,a=n.coverage;this.state.model.render(Object.assign({},e,{cellSize:r,extruded:i,elevationScale:o,coverage:a}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getPosition,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value);o[a++]=Mt(p[0]),o[a++]=Mt(p[1])}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}else t.value=new Float32Array(2)}}])&&Pt(n.prototype,r),o&&Pt(n,o),e}(r.Layer);Lt.layerName="GridCellLayer",Lt.defaultProps={cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},extruded:!0,fp64:!1,getPosition:function(t){return t.position},getElevation:function(t){return t.elevation},getColor:function(t){return t.color},lightSettings:{}};var Ft=6378e3;function Nt(t,e,n){var r=function(){for(var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=1/0,o=-1/0,a=0;a<e.length;a++)t=r(e[a])[1],Number.isFinite(t)&&(i=t<i?t:i,o=t>o?t:o);var s=function(t,e){var n=(a=t,a/Ft*(180/Math.PI)),r=(i=e,o=t,o/Ft*(180/Math.PI)/Math.cos(i*Math.PI/180));var i,o;var a;return{yOffset:n,xOffset:r}}(n,(i+o)/2);if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};return{gridHash:e.reduce((function(t,e){var n=r(e)[1],i=r(e)[0];if(!Number.isFinite(n)||!Number.isFinite(i))return t;var o=Math.floor((n+90)/s.yOffset),a=Math.floor((i+180)/s.xOffset),u="".concat(o,"-").concat(a);return t[u]=t[u]||{count:0,points:[]},t[u].count+=1,t[u].points.push(e),t}),{}),gridOffset:s}}(t,e,n),i=r.gridHash,o=r.gridOffset;return{gridOffset:o,layerData:function(t,e){return Object.keys(t).reduce((function(n,r,i){var o=r.split("-"),a=parseInt(o[0],10),s=parseInt(o[1],10);return n.push(Object.assign({index:i,position:[e.xOffset*s-180,e.yOffset*a-90]},t[r])),n}),[])}(i,o)}}function jt(t){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function zt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bt(t,e){return!e||"object"!==jt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ut(t,e,n){return(Ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Vt(t){return(Vt=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function Gt(t,e){return(Gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Wt=r.experimental.BinSorter,Xt=r.experimental.defaultColorRange,Ht=r.experimental.getQuantizeScale,qt=r.experimental.getLinearScale;function Zt(){}var Kt={colorDomain:null,colorRange:Xt,getColorValue:function(t){return t.length},lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:Zt,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:function(t){return t.length},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:Zt,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:function(t){return t.position},extruded:!1,fp64:!1,lightSettings:{}},Yt=function(t){function e(){return Dt(this,e),Bt(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Gt(t.prototype,e&&e.prototype),e&&Gt(t,e)}(e,t),n=e,(r=[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Zt,elevationScaleFunc:Zt,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,n=t.oldProps,r=t.props,i=t.changeFlags,o=this.needsReProjectPoints(n,r);i.dataChanged||o?this.getLayerData():(this.getDimensionChanges(n,r)||[]).forEach((function(t){return"function"==typeof t&&t.apply(e)}))}},{key:"needsReProjectPoints",value:function(t,e){return t.cellSize!==e.cellSize}},{key:"getDimensionUpdaters",value:function(){return{getColor:[{id:"value",triggers:["getColorValue"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var n=this.state.dimensionUpdaters,r=[];for(var i in n){var o=n[i].find((function(n){return n.triggers.some((function(n){return t[n]!==e[n]}))}));o&&r.push(o.updater)}return r.length?r:null}},{key:"getPickingInfo",value:function(t){var e=t.info,n=this.state,r=n.sortedColorBins,i=n.sortedElevationBins,o=null;if(e.picked&&e.index>-1){var a=this.state.layerData[e.index],s=r.binMap[a.index]&&r.binMap[a.index].value,u=i.binMap[a.index]&&i.binMap[a.index].value;o=Object.assign({colorValue:s,elevationValue:u},a)}return Object.assign(e,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,n={},r=function(r){n[r]={};var i=!0,o=!1,a=void 0;try{for(var s,u=e[r][Symbol.iterator]();!(i=(s=u.next()).done);i=!0)s.value.triggers.forEach((function(e){n[r][e]=t.props[e]}))}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}};for(var i in e)r(i);return n}},{key:"getLayerData",value:function(){var t=this.props,e=Nt(t.data,t.cellSize,t.getPosition).layerData;this.setState({layerData:e}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.props.getColorValue,e=new Wt(this.state.layerData||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.props.getElevationValue,e=new Wt(this.state.layerData||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,n=t.upperPercentile,r=t.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,n]),"function"==typeof r&&r(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,n=t.elevationUpperPercentile,r=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,n]),"function"==typeof r&&r(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Ht(e,t)}},{key:"getElevationScale",value:function(){var t=this.props.elevationRange,e=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=qt(e,t)}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,n=e.sortedColorBins,r=e.colorScaleFunc,i=e.colorValueDomain,o=n.binMap[t.index]&&n.binMap[t.index].value,a=this.props.colorDomain||i,s=o>=a[0]&&o<=a[a.length-1]?r(o):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,n=e.sortedElevationBins,r=e.elevationScaleFunc,i=e.elevationValueDomain,o=n.binMap[t.index]&&n.binMap[t.index].value,a=this.props.elevationDomain||i;return o>=a[0]&&o<=a[a.length-1]?r(o):-1}},{key:"getSubLayerProps",value:function(){var t=this.props,n=t.elevationScale,r=t.fp64,i=t.extruded,o=t.cellSize,a=t.coverage,s=t.lightSettings,u=t.transitions;return Ut(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSubLayerProps",this).call(this,{id:"grid-cell",data:this.state.layerData,fp64:r,cellSize:o,coverage:a,lightSettings:s,elevationScale:n,extruded:i,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:u&&{getColor:u.getColorValue,getElevation:u.getElevationValue},updateTriggers:this.getUpdateTriggers()})}},{key:"getSubLayerClass",value:function(){return Lt}},{key:"renderLayers",value:function(){return new(this.getSubLayerClass())(this.getSubLayerProps())}}])&&zt(n.prototype,r),i&&zt(n,i),e}(r.CompositeLayer);Yt.layerName="GridLayer",Yt.defaultProps=Kt;function Jt(t){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qt(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function $t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function te(t,e){return!e||"object"!==Jt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ee(t,e,n){return(ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ne(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ne(t){return(ne=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function re(t,e){return(re=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ie=i.o.fp64LowPart,oe=[255,0,255,255],ae=function(t){function e(t){Qt(this,e);var n=!1;return t.hexagonVertices||t.radius&&Number.isFinite(t.angle)?t.hexagonVertices&&(!Array.isArray(t.hexagonVertices)||t.hexagonVertices.length<6)&&(r.log.once(0,"HexagonCellLayer: hexagonVertices needs to be an array of 6 points")(),n=!0):(r.log.once(0,"HexagonCellLayer: Either hexagonVertices or radius and angle are needed to calculate primitive hexagon.")(),n=!0),n&&(r.log.once(0,"Now using 1000 meter as default radius, 0 as default angle")(),t.radius=1e3,t.angle=0),te(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");re(t.prototype,e&&e.prototype),e&&re(t,e)}(e,t),n=e,(o=[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME hexagon-cell-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec2 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\n// Custom uniforms\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform float extruded;\nuniform float coverage;\nuniform float elevationScale;\n\n// Result\nvarying vec4 vColor;\n\n// A magic number to scale elevation so that 1 unit approximate to 1 meter.\n#define ELEVATION_SCALE 0.8\n\nvoid main(void) {\n\n  // rotate primitive position and normal\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n\n  // calculate elevation, if 3d not enabled set to 0\n  // cylindar gemoetry height are between -0.5 to 0.5, transform it to between 0, 1\n  float elevation = 0.0;\n\n  if (extruded > 0.5) {\n    elevation = instanceElevations * (positions.z + 0.5) *\n      ELEVATION_SCALE * elevationScale;\n  }\n\n  // if ahpha == 0.0 or z < 0.0, do not render element\n  float noRender = float(instanceColors.a == 0.0 || instanceElevations < 0.0);\n  float dotRadius = project_scale(radius) * mix(coverage, 0.0, noRender);\n\n  // project center of hexagon\n  vec3 centroidPosition = vec3(instancePositions, elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 offset = vec3(rotationMatrix * positions.xy * dotRadius, 0.);\n\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, offset, position_worldspace);\n\n  // Light calculations\n  // Worldspace is the linear space after Mercator projection\n\n  vec3 normals_worldspace = vec3(rotationMatrix * normals.xy, normals.z);\n\n  float lightWeight = 1.0;\n\n  if (extruded > 0.5) {\n    lightWeight = lighting_getLightWeight(\n      position_worldspace.xyz, // the w component is always 1.0\n      normals_worldspace\n    );\n  }\n\n  vec3 lightWeightedColor = lightWeight * instanceColors.rgb;\n\n  // opacity-multiplied instance color\n  vColor = vec4(lightWeightedColor, opacity * instanceColors.a) / 255.0;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME hexagon-cell-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:2,transition:!0,accessor:"getCentroid"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getCentroid",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:oe}})}},{key:"updateState",value:function(t){var n=t.props,r=t.oldProps,i=t.changeFlags;if(ee(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:n,oldProps:r,changeFlags:i}),n.fp64!==r.fp64){var o=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(o)}),this.state.attributeManager.invalidateAll()}n.hexagonVertices===r.hexagonVertices&&n.radius===r.radius&&n.angle===r.angle||this.updateRadiusAngle()}},{key:"updateRadiusAngle",value:function(){var t=this.props,e=t.angle,n=t.radius,r=this.props.hexagonVertices;if(Array.isArray(r)&&r.length>=6){var i=this.props.hexagonVertices,o=i[0],a=i[3],s=this.context.viewport.getDistanceScales().pixelsPerMeter,u=this.projectFlat(o),l=this.projectFlat(a),c=u[0]-l[0],h=u[1]-l[1],p=Math.sqrt(c*c+h*h);e=Math.acos(c/p)*-Math.sign(h)+Math.PI/2,n=p/2/s[0]}this.setState({angle:e,radius:n})}},{key:"getCylinderGeometry",value:function(t){return new i.d({radius:t,topRadius:t,bottomRadius:t,topCap:!0,bottomCap:!0,height:1,verticalAxis:"z",nradial:6,nvertical:1})}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:this.getCylinderGeometry(1),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.elevationScale,i=n.extruded,o=n.coverage,a=this.state,s=a.radius,u=a.angle;this.state.model.render(Object.assign({},e,{radius:s,angle:u,extruded:i,coverage:o,elevationScale:r}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.is64bitEnabled();if(t.isGeneric=!e,e){var n=this.props,r=n.data,i=n.getCentroid,o=t.value,a=0,s=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=i(c.value);o[a++]=ie(p[0]),o[a++]=ie(p[1])}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}}else t.value=new Float32Array(2)}}])&&$t(n.prototype,o),a&&$t(n,a),e}(r.Layer);ae.layerName="HexagonCellLayer",ae.defaultProps={hexagonVertices:null,radius:null,angle:null,coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},extruded:!0,fp64:!1,getCentroid:function(t){return t.centroid},getColor:function(t){return t.color},getElevation:function(t){return t.elevation},lightSettings:{}};var se=Math.PI/3,ue=[0,se,2*se,3*se,4*se,5*se];function le(t){return t[0]}function ce(t){return t[1]}var he=function(){var t,e,n,r=0,i=0,o=1,a=1,s=le,u=ce;function l(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=t[r],r,t))&&!isNaN(h=+u.call(null,l,r,t))){var l,c,h,p=Math.round(h/=n),f=Math.round(c=c/e-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var v=c-f,g=f+(c<f?-1:1)/2,y=p+(h<p?-1:1),m=c-g,_=h-y;v*v+d*d>m*m+_*_&&(f=g+(1&p?1:-1)/2,p=y)}var b=f+"-"+p,x=i[b];x?x.push(l):(o.push(x=i[b]=[l]),x.x=(f+(1&p)/2)*e,x.y=p*n)}return o}function c(t){var e=0,n=0;return ue.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/e),c=u*n;c<a+t;c+=n,++u)for(var h=l*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map((function(t){return"M"+t+"m"+e})).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(r){return arguments.length?(e=2*(t=+r)*Math.sin(se),n=1.5*t,l):t},l.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],l):[o-r,a-i]},l.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],l):[[r,i],[o,a]]},l.radius(1)};function pe(t){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fe(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function de(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ve(t,e){return!e||"object"!==pe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ge(t,e,n){return(ge="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ye(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ye(t){return(ye=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function me(t,e){return(me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _e=r.experimental.BinSorter,be=r.experimental.getQuantizeScale,xe=r.experimental.getLinearScale;function we(){}var Ee={colorDomain:null,colorRange:r.experimental.defaultColorRange,getColorValue:function(t){return t.length},lowerPercentile:0,upperPercentile:100,onSetColorDomain:we,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:function(t){return t.length},elevationLowerPercentile:0,elevationUpperPercentile:100,elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:we,radius:1e3,coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){var n=t.data,r=t.radius,i=t.getPosition,o=function(t,e){var n=e.getDistanceScales().pixelsPerMeter;return t*n[0]}(r,e),a=n.map((function(t){return Object.assign({screenCoord:e.projectFlat(i(t))},t)}));return{hexagons:he().radius(o).x((function(t){return t.screenCoord[0]})).y((function(t){return t.screenCoord[1]}))(a).map((function(t,n){return{centroid:e.unprojectFlat([t.x,t.y]),points:t,index:n}}))}},getPosition:function(t){return t.position},fp64:!1,lightSettings:{}},Se=function(t){function e(t){return fe(this,e),t.hexagonAggregator||t.radius||(r.log.once(0,"HexagonLayer: Default hexagonAggregator requires radius prop to be set, Now using 1000 meter as default")(),t.radius=Ee.radius),Number.isFinite(t.upperPercentile)&&(t.upperPercentile>100||t.upperPercentile<0)&&(r.log.once(0,"HexagonLayer: upperPercentile should be between 0 and 100. Assign to 100 by default")(),t.upperPercentile=Ee.upperPercentile),Number.isFinite(t.lowerPercentile)&&(t.lowerPercentile>100||t.lowerPercentile<0)&&(r.log.once(0,"HexagonLayer: lowerPercentile should be between 0 and 100. Assign to 0 by default")(),t.lowerPercentile=Ee.upperPercentile),t.lowerPercentile>=t.upperPercentile&&(r.log.once(0,"HexagonLayer: lowerPercentile should not be bigger than upperPercentile. Assign to 0 by default")(),t.lowerPercentile=Ee.lowerPercentile),ve(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");me(t.prototype,e&&e.prototype),e&&me(t,e)}(e,t),n=e,(i=[{key:"initializeState",value:function(){this.state={hexagons:[],hexagonVertices:null,sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:we,elevationScaleFunc:we,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,n=t.oldProps,r=t.props,i=t.changeFlags,o=this.getDimensionChanges(n,r);i.dataChanged||this.needsReProjectPoints(n,r)?this.getHexagons():o&&o.forEach((function(t){return"function"==typeof t&&t.apply(e)}))}},{key:"needsReProjectPoints",value:function(t,e){return t.radius!==e.radius||t.hexagonAggregator!==e.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getColor:[{id:"value",triggers:["getColorValue"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var n=this.state.dimensionUpdaters,r=[];for(var i in n){var o=n[i].find((function(n){return n.triggers.some((function(n){return t[n]!==e[n]}))}));o&&r.push(o.updater)}return r.length?r:null}},{key:"getHexagons",value:function(){var t=this.props.hexagonAggregator,e=this.context.viewport,n=t(this.props,e),r=n.hexagons,i=n.hexagonVertices;this.setState({hexagons:r,hexagonVertices:i}),this.getSortedBins()}},{key:"getPickingInfo",value:function(t){var e=t.info,n=this.state,r=n.sortedColorBins,i=n.sortedElevationBins,o=null;if(e.picked&&e.index>-1){var a=this.state.hexagons[e.index],s=r.binMap[a.index]&&r.binMap[a.index].value,u=i.binMap[a.index]&&i.binMap[a.index].value;o=Object.assign({colorValue:s,elevationValue:u},a)}return Object.assign(e,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,n={},r=function(r){n[r]={};var i=!0,o=!1,a=void 0;try{for(var s,u=e[r][Symbol.iterator]();!(i=(s=u.next()).done);i=!0)s.value.triggers.forEach((function(e){n[r][e]=t.props[e]}))}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}};for(var i in e)r(i);return n}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.props.getColorValue,e=new _e(this.state.hexagons||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.props.getElevationValue,e=new _e(this.state.hexagons||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,n=t.upperPercentile,r=t.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,n]),"function"==typeof r&&r(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,n=t.elevationUpperPercentile,r=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,n]),"function"==typeof r&&r(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=be(e,t)}},{key:"getElevationScale",value:function(){var t=this.props.elevationRange,e=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=xe(e,t)}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,n=e.sortedColorBins,r=e.colorScaleFunc,i=e.colorValueDomain,o=n.binMap[t.index]&&n.binMap[t.index].value,a=this.props.colorDomain||i,s=o>=a[0]&&o<=a[a.length-1]?r(o):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,n=e.sortedElevationBins,r=e.elevationScaleFunc,i=e.elevationValueDomain,o=n.binMap[t.index]&&n.binMap[t.index].value,a=this.props.elevationDomain||i;return o>=a[0]&&o<=a[a.length-1]?r(o):-1}},{key:"getSubLayerProps",value:function(){var t=this.props,n=t.radius,r=t.elevationScale,i=t.extruded,o=t.coverage,a=t.lightSettings,s=t.fp64,u=t.transitions;return ge(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSubLayerProps",this).call(this,{id:"hexagon-cell",data:this.state.hexagons,fp64:s,hexagonVertices:this.state.hexagonVertices,radius:n,elevationScale:r,angle:Math.PI/2,extruded:i,coverage:o,lightSettings:a,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:u&&{getColor:u.getColorValue,getElevation:u.getElevationValue},updateTriggers:this.getUpdateTriggers()})}},{key:"getSubLayerClass",value:function(){return ae}},{key:"renderLayers",value:function(){return new(this.getSubLayerClass())(this.getSubLayerProps())}}])&&de(n.prototype,i),o&&de(n,o),e}(r.CompositeLayer);Se.layerName="HexagonLayer",Se.defaultProps=Ee;var Ae="#define SHADER_NAME path-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying float vPathPosition;\nvarying float vPathLength;\n\n// mod doesn't work correctly for negative numbers\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\n// if given position is in the gap part of the dashed line\n// dashArray.x: solid stroke length, relative to width\n// dashArray.y: gap length, relative to width\n// alignMode:\n// 0 - no adjustment\n// o----     ----     ----     ---- o----     -o----     ----     o\n// 1 - stretch to fit, draw half dash at each end for nicer joints\n// o--    ----    ----    ----    --o--      --o--     ----     --o\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition >= 0.0 &&\n    vPathPosition <= vPathLength &&\n    mod2(vPathPosition + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  // if joint is rounded, test distance from the corner\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 1., 0., 1.);\n    // return;\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 0., 1., 1.);\n    // return;\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    // Enable to debug joints\n    // gl_FragColor = vec4(0., 1., 1., 1.);\n    // return;\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n";function Te(t){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function ke(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ce(t,e){return!e||"object"!==Te(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Oe(t,e,n){return(Oe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ie(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Ie(t){return(Ie=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function Me(t,e){return(Me=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Re=i.o.fp64LowPart,Le=[0,0,0,255],Fe={widthScale:1,widthMinPixels:0,widthMaxPixels:Number.MAX_SAFE_INTEGER,rounded:!1,miterLimit:4,fp64:!1,dashJustified:!1,getPath:function(t){return t.path},getColor:function(t){return t.color||Le},getWidth:function(t){return t.width||1},getDashArray:null},Ne=function(t){var e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]},je=function(t){function e(){return Pe(this,e),Ce(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Me(t.prototype,e&&e.prototype),e&&Me(t,e)}(e,t),n=e,(o=[{key:"getShaders",value:function(){return this.is64bitEnabled()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying float vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst float PIXEL_EPSILON = 0.1;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n\n  // when two points are closer than PIXEL_EPSILON in pixels,\n  // assume they are the same point to avoid precision issue\n  lenA = lenA > PIXEL_EPSILON ? lenA : 0.0;\n  lenB = lenB > PIXEL_EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  // do not bevel if line segment is too short\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  // trim if inside corner extends further than the line segment\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  // using a small number as the limit for determining if the lenA or lenB is 0\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n\n  // 0: center, 1: side\n  cornerPosition = isCap * (1.0 - positions.z);\n\n  // start of path: use next - curr\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  // end of path: use curr - prev\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n\n  // extend out a triangle to envelope the round cap\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  // Generate variables for dash calculation\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = dot(offsetFromStartOfPath, dir);\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  // Calculate current position 64bit\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_scale(currPosition.z);\n\n  // Calculate previous position\n\n  vec3 prevPosition = mix(-instanceLeftDeltas, vec3(0.0), isEnd) + instanceStartPositions;\n\n  // Calculate prev position 64bit\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, instanceStartEndPositions64xyLow.xy, projected_prev_position);\n\n  // Calculate next positions\n  vec3 nextPosition = mix(vec3(0.0), instanceRightDeltas, isEnd) + instanceEndPositions;\n\n  // Calculate next position 64bit\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, instanceStartEndPositions64xyLow.zw, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:Ae,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftDeltas;\nattribute vec3 instanceRightDeltas;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying float vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst float PIXEL_EPSILON = 0.1;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\n// calculate line join positions\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  float width\n) {\n  vec2 deltaA = currPoint.xy - prevPoint.xy;\n  vec2 deltaB = nextPoint.xy - currPoint.xy;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  // when two points are closer than PIXEL_EPSILON in pixels,\n  // assume they are the same point to avoid precision issue\n  lenA = lenA > PIXEL_EPSILON ? lenA : 0.0;\n  lenB = lenB > PIXEL_EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n\n  // tangent of the corner\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  // direction of the corner\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  // width offset from current position\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n\n  // cap super sharp angles\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n\n  // do not bevel if line segment is too short\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n\n  // trim if inside corner extends further than the line segment\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / width / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n\n  // special treatment for start cap and end cap\n  // TODO - This has an issue. len is always positive because it is length.\n  // Step returns zero if -lenA<0, so practically this is a comparison of\n  // lenA with zero, with lots of problems because of the -lenA. Can we use EPSILON?\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n\n  // 0: center, 1: side\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n\n  // start of path: use next - curr\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n\n  // end of path: use curr - prev\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n\n  // extend out a triangle to envelope the round cap\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n\n  // Generate variables for dash calculation\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  // vec2 offsetFromStartOfPath = isEnd ? vCornerOffset + deltaA / width : vCornerOffset;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA / width;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = dot(offsetFromStartOfPath, dir);\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\n\n// calculate line join positions\n// extract params from attributes and uniforms\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  // relative position to the corner:\n  // -1: inside (smaller side of the angle)\n  // 0: center\n  // 1: outside (bigger side of the angle)\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  float width = clamp(project_scale(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    width\n  );\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(-instanceLeftDeltas, vec3(0.0), isEnd) + instanceStartPositions;\n  prevPosition = project_position(prevPosition);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  currPosition = project_position(currPosition);\n\n  vec3 nextPosition = mix(vec3(0.0), instanceRightDeltas, isEnd) + instanceEndPositions;\n  nextPosition = project_position(nextPosition);\n\n  vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n\n  gl_Position = project_to_clipspace(vec4(pos, 1.0));\n}\n",fs:Ae,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,update:this.calculateStartPositions},instanceEndPositions:{size:3,update:this.calculateEndPositions},instanceLeftDeltas:{size:3,update:this.calculateLeftDeltas},instanceRightDeltas:{size:3,update:this.calculateRightDeltas},instanceStrokeWidths:{size:1,accessor:"getWidth",update:this.calculateStrokeWidths,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray",update:this.calculateDashArrays},instanceColors:{size:4,type:i.g.UNSIGNED_BYTE,accessor:"getColor",update:this.calculateColors,defaultValue:Le},instancePickingColors:{size:3,type:i.g.UNSIGNED_BYTE,update:this.calculatePickingColors}})}},{key:"updateAttribute",value:function(t){var e=t.props,n=t.oldProps;if(t.changeFlags,e.fp64!==n.fp64){var i=this.getAttributeManager();i.invalidateAll(),e.fp64&&e.coordinateSystem===r.COORDINATE_SYSTEM.LNGLAT?i.addInstanced({instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow}}):i.remove(["instanceStartEndPositions64xyLow"])}}},{key:"updateState",value:function(t){var n=t.oldProps,r=t.props,i=t.changeFlags;Oe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,{props:r,oldProps:n,changeFlags:i});var o=this.props.getPath,a=this.getAttributeManager();if(r.fp64!==n.fp64){var s=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(s)})}if(this.updateAttribute({props:r,oldProps:n,changeFlags:i}),i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){var u=r.data.map(o),l=u.reduce((function(t,e){return t+e.length-1}),0);this.setState({paths:u,numInstances:l}),a.invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.rounded,i=n.miterLimit,o=n.widthScale,a=n.widthMinPixels,s=n.widthMaxPixels,u=n.dashJustified;this.state.model.render(Object.assign({},e,{jointType:Number(r),alignMode:Number(u),widthScale:o,miterLimit:i,widthMinPixels:a,widthMaxPixels:s}))}},{key:"_getModel",value:function(t){return new i.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new i.h({drawMode:i.g.TRIANGLES,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_getPathLength",value:function(t){return t.length}},{key:"calculateStartPositions",value:function(t){var e=this.state.paths,n=t.value,r=0;e.forEach((function(t){for(var e=t.length-1,i=0;i<e;i++){var o=t[i];n[r++]=o[0],n[r++]=o[1],n[r++]=o[2]||0}}))}},{key:"calculateEndPositions",value:function(t){var e=this.state.paths,n=t.value,r=0;e.forEach((function(t){for(var e=1;e<t.length;e++){var i=t[e];n[r++]=i[0],n[r++]=i[1],n[r++]=i[2]||0}}))}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(t){var e=this.state.paths,n=t.value,r=0;e.forEach((function(t){for(var e=t.length-1,i=0;i<e;i++){var o=t[i],a=t[i+1];n[r++]=Re(o[0]),n[r++]=Re(o[1]),n[r++]=Re(a[0]),n[r++]=Re(a[1])}}))}},{key:"calculateLeftDeltas",value:function(t){var e=this.state.paths,n=t.value,r=0;e.forEach((function(t){for(var e=t.length-1,i=Ne(t)?t[t.length-2]:t[0],o=0;o<e;o++){var a=t[o];n[r++]=a[0]-i[0],n[r++]=a[1]-i[1],n[r++]=a[2]-i[2]||0,i=a}}))}},{key:"calculateRightDeltas",value:function(t){var e=this.state.paths,n=t.value,r=0;e.forEach((function(t){for(var e=1;e<t.length;e++){var i=t[e],o=t[e+1];o||(o=Ne(t)?t[1]:i),n[r++]=o[0]-i[0],n[r++]=o[1]-i[1],n[r++]=o[2]-i[2]||0}}))}},{key:"calculateStrokeWidths",value:function(t){var e=this,n=this.props,r=n.data,i=n.getWidth,o=this.state.paths,a=t.value,s=0;o.forEach((function(t,n){for(var o=i(r[n],n),u=e._getPathLength(t),l=1;l<u;l++)a[s++]=o}))}},{key:"calculateDashArrays",value:function(t){var e=this,n=this.props,r=n.data,i=n.getDashArray;if(i){var o=this.state.paths,a=t.value,s=0;o.forEach((function(t,n){for(var o=i(r[n],n),u=e._getPathLength(t),l=1;l<u;l++)a[s++]=o[0],a[s++]=o[1]}))}}},{key:"calculateColors",value:function(t){var e=this,n=this.props,r=n.data,i=n.getColor,o=this.state.paths,a=t.value,s=0;o.forEach((function(t,n){var o=i(r[n],n);isNaN(o[3])&&(o[3]=255);for(var u=e._getPathLength(t),l=1;l<u;l++)a[s++]=o[0],a[s++]=o[1],a[s++]=o[2],a[s++]=o[3]}))}},{key:"calculatePickingColors",value:function(t){var e=this,n=this.state.paths,r=t.value,i=0;n.forEach((function(t,n){for(var o=e.encodePickingColor(n),a=e._getPathLength(t),s=1;s<a;s++)r[i++]=o[0],r[i++]=o[1],r[i++]=o[2]}))}}])&&ke(n.prototype,o),a&&ke(n,a),e}(r.Layer);je.layerName="PathLayer",je.defaultProps=Fe;var De=n(905),ze=n.n(De),Be=r.experimental.flattenVertices;function Ue(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function Ve(t){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).dimensions;return Ue(t)?[t]:t}function Ge(t){return Ue(t)?t.length:t.reduce((function(t,e){return t+e.length}),0)}function We(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var He=r.experimental.fillArray,qe=i.o.fp64LowPart;var Ze=[0,0,0,255],Ke=function(){function t(e){var n=e.polygons,r=e.IndexType;We(this,t);var i=function(t){return t.reduce((function(t,e){return t+Ge(e)}),0)}(n=n.map((function(t){return Ve(t)})));if(this.polygons=n,this.pointCount=i,this.IndexType=r,r===Uint16Array&&i>65535)throw new Error("Vertex count exceeds browser's limit");this.attributes={pickingColors:Qe({polygons:n,pointCount:i})}}var e,n,r;return e=t,(n=[{key:"updatePositions",value:function(t){var e=t.fp64,n=t.extruded,r=this.attributes,i=this.polygons,o=this.pointCount;r.positions=r.positions||new Float32Array(3*o),r.nextPositions=r.nextPositions||new Float32Array(3*o),e&&(r.positions64xyLow=r.positions64xyLow||new Float32Array(2*o),r.nextPositions64xyLow=r.nextPositions64xyLow||new Float32Array(2*o)),function(t){var e=t.cache,n=e.positions,r=e.positions64xyLow,i=e.nextPositions,o=e.nextPositions64xyLow,a=t.polygons,s=t.extruded,u=t.fp64,l=0,c=0,h=null,p=function(){h&&(i[3*c]=h.x,i[3*c+1]=h.y,i[3*c+2]=h.z,u&&(o[2*c]=h.xLow,o[2*c+1]=h.yLow),c++),h=null};a.forEach((function(t,e){!function(t,e){Ue(t)?t.forEach(e):t.forEach((function(t){t.forEach(e)}))}(t,(function(t,e){var a,f,d=t[0],v=t[1],g=t[2]||0;n[3*l]=d,n[3*l+1]=v,n[3*l+2]=g,u&&(a=qe(d),f=qe(v),r[2*l]=a,r[2*l+1]=f),l++,s&&e>0&&(i[3*c]=d,i[3*c+1]=v,i[3*c+2]=g,u&&(o[2*c]=a,o[2*c+1]=f),c++),0===e&&(p(),function(t,e,n,r,i){s&&(h={x:t,y:e,z:n,xLow:r,yLow:i})}(d,v,g,a,f))}))})),p()}({cache:r,polygons:i,extruded:n,fp64:e})}},{key:"indices",value:function(){return function(t){var e=t.polygons,n=t.IndexType,r=void 0===n?Uint32Array:n,i=3*function(t){return t.reduce((function(t,e){return t+function(t){var e=0,n=!0,r=!0,i=!1,o=void 0;try{for(var a,s=Ve(t)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value.length;e+=n?u>=3?u-2:0:u+1,n=!1}}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return e}(e)}),0)}(e),o=function(t){var e=new Array(t.length+1);e[0]=0;var n=0;return t.forEach((function(t,r){n+=Ge(t),e[r+1]=n})),e}(e),a=new r(i),s=0;return e.forEach((function(t,e){var n,r,i,u=!0,l=!1,c=void 0;try{for(var h,p=(n=t,r=void 0,i=void 0,r=function(t){var e=null;if(t.length>1){var n=0;e=[],t.forEach((function(t){n+=t.length,e.push(n)})),e.pop()}return e}(n),i=Be(n,{dimensions:2,result:[]}),ze()(i,r,2))[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;a[s++]=f+o[e]}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}})),a}({polygons:this.polygons,IndexType:this.IndexType})}},{key:"positions",value:function(){return this.attributes.positions}},{key:"positions64xyLow",value:function(){return this.attributes.positions64xyLow}},{key:"nextPositions",value:function(){return this.attributes.nextPositions}},{key:"nextPositions64xyLow",value:function(){return this.attributes.nextPositions64xyLow}},{key:"elevations",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.key,n=void 0===e?"elevations":e,r=t.getElevation,i=void 0===r?function(t){return 100}:r,o=this.attributes,a=this.polygons,s=this.pointCount,u=Ye({cache:o[n],polygons:a,pointCount:s,getElevation:i});return o[n]=u,u}},{key:"colors",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.key,n=void 0===e?"colors":e,r=t.getColor,i=void 0===r?function(t){return Ze}:r,o=this.attributes,a=this.polygons,s=this.pointCount,u=Je({cache:o[n],polygons:a,pointCount:s,getColor:i});return o[n]=u,u}},{key:"pickingColors",value:function(){return this.attributes.pickingColors}}])&&Xe(e.prototype,n),r&&Xe(e,r),t}();function Ye(t){var e=t.cache,n=t.polygons,r=t.pointCount,i=t.getElevation,o=e||new Float32Array(r),a=0;return n.forEach((function(t,e){var n=i(e),r=Ge(t);He({target:o,source:[n],start:a,count:r}),a+=r})),o}function Je(t){var e=t.cache,n=t.polygons,r=t.pointCount,i=t.getColor,o=e||new Uint8ClampedArray(4*r),a=0;return n.forEach((function(t,e){var n=i(e);isNaN(n[3])&&(n[3]=255);var r=Ge(t);He({target:o,source:n,start:a,count:r}),a+=n.length*r})),o}function Qe(t){var e=t.polygons,n=t.pointCount,r=new Uint8ClampedArray(3*n),i=0;return e.forEach((function(t,e){var n,o=(n=e,[255&++n,n>>8&255,n>>16&255]),a=Ge(t);He({target:r,source:o,start:i,count:a}),i+=o.length*a})),r}function $e(t){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function en(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nn(t,e){return!e||"object"!==$e(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function rn(t,e,n){return(rn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=on(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function on(t){return(on=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function an(t,e){return(an=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var sn=[0,0,0,255],un=[0,0,0,255],ln={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:1,getPolygon:function(t){return t.polygon},getElevation:function(t){return t.elevation||0},getFillColor:function(t){return t.fillColor||un},getLineColor:function(t){return t.lineColor||sn},lightSettings:{}},cn=new Float32Array([0,1,0,0,1,1,1,0]),hn=new Float32Array([1,1,0,1,0,0,1,0]),pn={TOP:null,SIDE:{instanced:1},WIRE:{instanced:1}},fn={TOP:{indices:"indices",positions:"positions",positions64xyLow:"positions64xyLow",elevations:"elevations",colors:"fillColors",pickingColors:"pickingColors"},SIDE:{positions:"positions",positions64xyLow:"positions64xyLow",nextPositions:"nextPositions",nextPositions64xyLow:"nextPositions64xyLow",elevations:"elevations",colors:"fillColors",pickingColors:"pickingColors"},WIRE:{positions:"positions",positions64xyLow:"positions64xyLow",nextPositions:"nextPositions",nextPositions64xyLow:"nextPositions64xyLow",elevations:"elevations",colors:"lineColors",pickingColors:"pickingColors"}},dn=function(t){function e(){return tn(this,e),nn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");an(t.prototype,e&&e.prototype),e&&an(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec2 vertexPositions;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float elevations;\nattribute vec4 colors;\nattribute vec3 pickingColors;\n\nuniform float isSideVertex;\nuniform float extruded;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n\n  if (isSideVertex > 0.5) {\n    pos = mix(positions, nextPositions, vertexPositions.x);\n    pos64xyLow = mix(positions64xyLow, nextPositions64xyLow, vertexPositions.x);\n  } else {\n    pos = positions;\n    pos64xyLow = positions64xyLow;\n  }\n  if (extruded > 0.5) {\n    pos.z += elevations * vertexPositions.y;\n  }\n  pos.z *= elevationScale;\n\n  vec4 position_worldspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_worldspace);\n\n  float lightWeight = 1.0;\n  \n  if (extruded > 0.5) {\n    if (isSideVertex > 0.5) {\n      normal = vec3(positions.y - nextPositions.y, nextPositions.x - positions.x, 0.0);\n      normal = project_normal(normal);\n    } else {\n      normal = vec3(0.0, 0.0, 1.0);\n    }\n\n    lightWeight = lighting_getLightWeight(position_worldspace.xyz, normal);\n  }\n\n  vec3 lightWeightedColor = lightWeight * colors.rgb;\n  vColor = vec4(lightWeightedColor, colors.a * opacity) / 255.0;\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(pickingColors);\n}\n",fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.is64bitEnabled()?"project64":"project32","lighting","picking"]}}},{key:"initializeState",value:function(){var t=this.context.gl;this.setState({numInstances:0,IndexType:Object(i.p)(t,i.e.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array}),this.getAttributeManager().add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,accessor:["extruded","fp64"],update:this.calculatePositions,noAlloc:!0},positions64xyLow:{size:2,accessor:"fp64",update:this.calculatePositionsLow},nextPositions:{size:3,accessor:["extruded","fp64"],update:this.calculateNextPositions,noAlloc:!0},nextPositions64xyLow:{size:2,accessor:"fp64",update:this.calculateNextPositionsLow},elevations:{size:1,accessor:["extruded","getElevation"],update:this.calculateElevations,noAlloc:!0},fillColors:{alias:"colors",size:4,type:i.g.UNSIGNED_BYTE,accessor:"getFillColor",update:this.calculateFillColors,defaultValue:un,noAlloc:!0},lineColors:{alias:"colors",size:4,type:i.g.UNSIGNED_BYTE,accessor:"getLineColor",update:this.calculateLineColors,defaultValue:sn,noAlloc:!0},pickingColors:{size:3,type:i.g.UNSIGNED_BYTE,update:this.calculatePickingColors,noAlloc:!0}})}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,r=n.extruded,i=n.elevationScale,o=Object.assign({},e,{extruded:r?1:0,elevationScale:i});this.state.models.forEach((function(t){t.render(o)}))}},{key:"updateState",value:function(t){rn(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,t),this.updateGeometry(t);var n=t.props,r=t.oldProps;(n.fp64!==r.fp64||n.filled!==r.filled||n.extruded!==r.extruded||n.wireframe!==r.wireframe)&&(this.state.models&&this.state.models.forEach((function(t){return t.delete()})),this.setState(Object.assign({modelsChanged:!0},this._getModels(this.context.gl)))),n.extruded!==r.extruded&&this.state.attributeManager.invalidate("extruded"),n.fp64!==r.fp64&&this.state.attributeManager.invalidate("fp64")}},{key:"updateGeometry",value:function(t){var e=t.props,n=t.oldProps,r=t.changeFlags,i=r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon);if(i){var o=e.data.map(e.getPolygon);this.setState({polygonTesselator:this._getPolygonTesselator(o,this.state.IndexType)}),this.state.attributeManager.invalidateAll()}(i||e.extruded!==n.extruded||e.fp64!==n.fp64)&&this.state.polygonTesselator.updatePositions({fp64:e.fp64,extruded:e.extruded})}},{key:"updateAttributes",value:function(t){var e=this.state,n=e.attributeManager,r=e.modelsChanged;if(n.update({data:t.data,numInstances:0,props:t,buffers:t,context:this,ignoreUnknownAttributes:!0}),r)this._updateAttributes(n.getAttributes()),this.setState({modelsChanged:!1});else{var i=n.getChangedAttributes({clearChangedFlags:!0});this._updateAttributes(i)}}},{key:"_getPolygonTesselator",value:function(t,e){return new Ke({polygons:t,IndexType:this.state.IndexType})}},{key:"_updateAttributes",value:function(t){var e=this.state.modelsByName;for(var n in e){var r=e[n];"TOP"===n?r.setVertexCount(this.state.numVertex):r.setInstanceCount(this.state.numInstances);var i=fn[n],o=pn[n],a={};for(var s in i){var u=t[i[s]];u&&(a[s]=o?Object.assign({},u,o,{buffer:u.getBuffer()}):u)}r.setAttributes(a)}}},{key:"_getModels",value:function(t){var e=this.props,n=e.id,r=e.filled,o=e.extruded,a=e.wireframe,s={};return r&&(s.TOP=new i.i(t,Object.assign({},this.getShaders(),{id:"".concat(n,"-top"),geometry:new i.h({drawMode:i.g.TRIANGLES,attributes:{vertexPositions:{size:2,isGeneric:!0,value:new Float32Array([0,1])},nextPositions:{size:3,isGeneric:!0,value:new Float32Array(3)},nextPositions64xyLow:{size:2,isGeneric:!0,value:new Float32Array(2)}}}),uniforms:{isSideVertex:0},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))),r&&o&&(s.SIDE=new i.i(t,Object.assign({},this.getShaders(),{id:"".concat(n,"-side"),geometry:new i.h({drawMode:i.g.TRIANGLE_STRIP,vertexCount:4,attributes:{vertexPositions:{size:2,value:cn}}}),uniforms:{isSideVertex:1},isInstanced:1,shaderCache:this.context.shaderCache}))),o&&a&&(s.WIRE=new i.i(t,Object.assign({},this.getShaders(),{id:"".concat(n,"-wire"),geometry:new i.h({drawMode:i.g.LINE_STRIP,vertexCount:4,attributes:{vertexPositions:{size:2,value:hn}}}),uniforms:{isSideVertex:1},isInstanced:1,shaderCache:this.context.shaderCache}))),{models:[s.WIRE,s.SIDE,s.TOP].filter(Boolean),modelsByName:s}}},{key:"calculateIndices",value:function(t){t.value=this.state.polygonTesselator.indices();var e=t.value.length/t.size;this.setState({numVertex:e})}},{key:"calculatePositions",value:function(t){t.value=this.state.polygonTesselator.positions();var e=t.value.length/t.size;this.setState({numInstances:e})}},{key:"calculatePositionsLow",value:function(t){var e=this.is64bitEnabled();t.isGeneric=!e,t.value=e?this.state.polygonTesselator.positions64xyLow():new Float32Array(2)}},{key:"calculateNextPositions",value:function(t){t.value=this.state.polygonTesselator.nextPositions()}},{key:"calculateNextPositionsLow",value:function(t){var e=this.is64bitEnabled();t.isGeneric=!e,t.value=e?this.state.polygonTesselator.nextPositions64xyLow():new Float32Array(2)}},{key:"calculateElevations",value:function(t){var e=this,n=this.props,r=n.extruded,i=n.getElevation;if(r&&"function"==typeof i)t.isGeneric=!1,t.value=this.state.polygonTesselator.elevations({getElevation:function(t){return i(e.props.data[t])}});else{var o=r?i:0;t.isGeneric=!0,t.value=new Float32Array([o])}}},{key:"calculateFillColors",value:function(t){var e=this;t.value=this.state.polygonTesselator.colors({key:"fillColors",getColor:function(t){return e.props.getFillColor(e.props.data[t])}})}},{key:"calculateLineColors",value:function(t){var e=this;t.value=this.state.polygonTesselator.colors({key:"lineColors",getColor:function(t){return e.props.getLineColor(e.props.data[t])}})}},{key:"calculatePickingColors",value:function(t){t.value=this.state.polygonTesselator.pickingColors()}}])&&en(n.prototype,r),o&&en(n,o),e}(r.Layer);function vn(t){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function yn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mn(t,e){return!e||"object"!==vn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _n(t,e){return(_n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}dn.layerName="SolidPolygonLayer",dn.defaultProps=ln;var bn=[0,0,0,255],xn=[0,0,0,255],wn={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:function(t){return t.polygon},getFillColor:function(t){return t.fillColor||xn},getLineColor:function(t){return t.lineColor||bn},getLineWidth:function(t){return t.lineWidth||1},getLineDashArray:null,getElevation:function(t){return t.elevation||1e3},lightSettings:{}},En=function(t){function e(){return gn(this,e),mn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");_n(t.prototype,e&&e.prototype),e&&_n(t,e)}(e,t),n=e,(r=[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(t){var e=this,n=(t.oldProps,t.props,t.changeFlags);if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){var r=this.props,i=r.data,o=r.getPolygon;this.state.paths=[],i.forEach((function(t){Ve(o(t)).forEach((function(n){return e.state.paths.push({path:n,object:t})}))}))}}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object.object||e.object})}},{key:"_getAccessor",value:function(t){return"function"==typeof t?function(e){return t(e.object)}:t}},{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.stroked,r=t.filled,i=t.extruded,o=t.wireframe,a=t.elevationScale,s=this.props,u=s.lineWidthScale,l=s.lineWidthMinPixels,c=s.lineWidthMaxPixels,h=s.lineJointRounded,p=s.lineMiterLimit,f=s.lineDashJustified,d=s.fp64,v=this.props,g=v.getFillColor,y=v.getLineColor,m=v.getLineWidth,_=v.getLineDashArray,b=v.getElevation,x=v.getPolygon,w=v.updateTriggers,E=v.lightSettings,S=this.state.paths,A=e&&e.length>0,T=A&&new dn(this.getSubLayerProps({id:"fill",updateTriggers:{getElevation:w.getElevation,getFillColor:w.getFillColor,getLineColor:w.getLineColor}}),{data:e,extruded:i,elevationScale:a,fp64:d,filled:r,wireframe:o,getPolygon:x,getElevation:b,getFillColor:g,getLineColor:y,lightSettings:E});return[!i&&T,!i&&n&&A&&new je(this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:w.getLineWidth,getColor:w.getLineColor,getDashArray:w.getLineDashArray}}),{data:S,fp64:d,widthScale:u,widthMinPixels:l,widthMaxPixels:c,rounded:h,miterLimit:p,dashJustified:f,getPath:function(t){return t.path},getColor:this._getAccessor(y),getWidth:this._getAccessor(m),getDashArray:this._getAccessor(_)}),i&&T]}}])&&yn(n.prototype,r),i&&yn(n,i),e}(r.CompositeLayer);function Sn(t,e){if(!t)throw new Error("deck.gl: ".concat(e))}function An(t){var e=[],n=[],r=[],i=[];return t.forEach((function(t){Sn(t&&t.geometry,"GeoJSON does not have geometry");var o=t.geometry,a=o.type,s=o.coordinates,u=t.properties;switch(function(t,e){var n=Tn[t];Sn(n,"Unknown GeoJSON type ".concat(t));for(;e&&--n>0;)e=e[0];Sn(e&&Number.isFinite(e[0]),"".concat(t," coordinates are malformed"))}(a,s),a){case"Point":e.push(t);break;case"MultiPoint":s.forEach((function(n){e.push({geometry:{coordinates:n},properties:u,feature:t})}));break;case"LineString":n.push(t);break;case"MultiLineString":s.forEach((function(e){n.push({geometry:{coordinates:e},properties:u,feature:t})}));break;case"Polygon":r.push(t),s.forEach((function(e){i.push({geometry:{coordinates:e},properties:u,feature:t})}));break;case"MultiPolygon":s.forEach((function(e){r.push({geometry:{coordinates:e},properties:u,feature:t}),e.forEach((function(e){i.push({geometry:{coordinates:e},properties:u,feature:t})}))}))}})),{pointFeatures:e,lineFeatures:n,polygonFeatures:r,polygonOutlineFeatures:i}}En.layerName="PolygonLayer",En.defaultProps=wn;var Tn={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Pn(t){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function Cn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function On(t,e){return!e||"object"!==Pn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function In(t,e){return(In=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Mn=[0,0,0,255],Rn=[0,0,0,255],Ln={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,fp64:!1,getLineColor:function(t){return t.properties&&t.properties.lineColor||Mn},getFillColor:function(t){return t.properties&&t.properties.fillColor||Rn},getRadius:function(t){return t.properties&&(t.properties.radius||t.properties.size)||1},getLineWidth:function(t){return t.properties&&t.properties.lineWidth||1},getElevation:function(t){return t.properties&&t.properties.elevation||1e3},subLayers:{PointLayer:ct,LineLayer:je,PolygonLayer:dn},lightSettings:{}},Fn=function(t){return t.geometry.coordinates},Nn=function(t){function e(){return kn(this,e),On(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");In(t.prototype,e&&e.prototype),e&&In(t,e)}(e,t),n=e,(r=[{key:"initializeState",value:function(){this.state={features:{}}}},{key:"updateState",value:function(t){t.oldProps;var e=t.props;if(t.changeFlags.dataChanged){var n=function(t){if(Array.isArray(t))return t;switch(Sn(t.type,"GeoJSON does not have type"),t.type){case"GeometryCollection":return Sn(Array.isArray(t.geometries),"GeoJSON does not have geometries array"),t.geometries.map((function(t){return{geometry:t}}));case"Feature":return[t];case"FeatureCollection":return Sn(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(e.data);this.state.features=An(n)}}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object.feature||e.object})}},{key:"renderLayers",value:function(){var t=this.state.features,e=t.pointFeatures,n=t.lineFeatures,r=t.polygonFeatures,i=t.polygonOutlineFeatures,o=this.props,a=o.stroked,s=o.filled,u=o.extruded,l=o.wireframe,c=o.subLayers,h=o.lightSettings,p=this.props,f=p.lineWidthScale,d=p.lineWidthMinPixels,v=p.lineWidthMaxPixels,g=p.lineJointRounded,y=p.lineMiterLimit,m=p.pointRadiusScale,_=p.pointRadiusMinPixels,b=p.pointRadiusMaxPixels,x=p.elevationScale,w=p.fp64,E=this.props,S=E.getLineColor,A=E.getFillColor,T=E.getRadius,P=E.getLineWidth,k=E.getElevation,C=E.updateTriggers,O=e&&e.length>0,I=n&&n.length>0,M=i&&i.length>0,R=r&&r.length>0&&new c.PolygonLayer(this.getSubLayerProps({id:"polygon-fill",updateTriggers:{getElevation:C.getElevation,getFillColor:C.getFillColor,getLineColor:C.getLineColor}}),{data:r,fp64:w,extruded:u,elevationScale:x,filled:s,wireframe:l,lightSettings:h,getPolygon:Fn,getElevation:k,getFillColor:A,getLineColor:S});return[!u&&R,!u&&a&&M&&new c.LineLayer(this.getSubLayerProps({id:"polygon-outline",updateTriggers:{getColor:C.getLineColor,getWidth:C.getLineWidth}}),{data:i,fp64:w,widthScale:f,widthMinPixels:d,widthMaxPixels:v,rounded:g,miterLimit:y,getPath:Fn,getColor:S,getWidth:P}),I&&new c.LineLayer(this.getSubLayerProps({id:"line-paths",updateTriggers:{getColor:C.getLineColor,getWidth:C.getLineWidth}}),{data:n,fp64:w,widthScale:f,widthMinPixels:d,widthMaxPixels:v,rounded:g,miterLimit:y,getPath:Fn,getColor:S,getWidth:P}),O&&new c.PointLayer(this.getSubLayerProps({id:"points",updateTriggers:{getColor:C.getFillColor,getRadius:C.getRadius}}),{data:e,fp64:w,radiusScale:m,radiusMinPixels:_,radiusMaxPixels:b,getPosition:Fn,getColor:A,getRadius:T}),u&&R]}}])&&Cn(n.prototype,r),i&&Cn(n,i),e}(r.CompositeLayer);Nn.layerName="GeoJsonLayer",Nn.defaultProps=Ln;function jn(t){return(jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dn(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bn(t,e){return!e||"object"!==jn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Un(t,e,n){return(Un="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vn(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Vn(t){return(Vn=Object.getPrototypeOf||function(t){return t.__proto__})(t)}function Gn(t,e){return(Gn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Wn=function(t){function e(){return Dn(this,e),Bn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Gn(t.prototype,e&&e.prototype),e&&Gn(t,e)}(e,t),n=e,(r=[{key:"getShaders",value:function(){return Object.assign({},Un(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getShaders",this).call(this),{vs:'#define SHADER_NAME multi-icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\n// the following three attributes are for the multi-icon layer\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : instanceSizes / iconSize.y;\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * sizeScale * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0));\n  gl_Position += project_pixel_to_clipspace(pixelOffset);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = instanceColors / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  vColorMode = instanceColorModes;\n}\n'})}},{key:"initializeState",value:function(){Un(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(t){Un(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateState",this).call(this,t);var n=t.changeFlags;n.updateTriggersChanged&&(n.updateTriggersChanged.getAnchorX||n.updateTriggersChanged.getAnchorY)&&this.getAttributeManager().invalidate("instanceOffsets")}},{key:"calculateInstanceOffsets",value:function(t){var e=this.props,n=e.data,r=e.iconMapping,i=e.getIcon,o=e.getAnchorX,a=e.getAnchorY,s=e.getLengthOfQueue,u=e.getShiftInQueue,l=t.value,c=0,h=!0,p=!1,f=void 0;try{for(var d,v=n[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var g=d.value,y=r[i(g)]||{},m=s(g),_=u(g);l[c++]=(o(g)-1)*m/2+y.width/2+_||0,l[c++]=y.height/2*a(g)||0}}catch(t){p=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(p)throw f}}}}])&&zn(n.prototype,r),i&&zn(n,i),e}(I);function Xn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Wn.layerName="MultiIconLayer",Wn.defaultProps={getShiftInQueue:function(t){return t.shift||0},getLengthOfQueue:function(t){return t.len||1},getAnchorX:function(t){return t.anchorX||0},getAnchorY:function(t){return t.anchorY||0},getPixelOffset:function(t){return t.pixelOffset||[0,0]}};for(var Hn=10242,qn=10243,Zn=33071,Kn=1024,Yn=64,Jn=4,Qn=[],$n=32;$n<128;$n++)Qn.push(String.fromCharCode($n));function tr(t,e,n,r){t.font="".concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline=r?"top":"hanging",t.textAlign="left"}function er(t){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nr(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function rr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ir(t,e){return!e||"object"!==er(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function or(t,e){return(or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ar={start:1,middle:0,end:-1},sr={top:1,center:0,bottom:-1},ur=[0,0,0,255],lr={fp64:!1,sizeScale:1,fontFamily:"Monaco, monospace",characterSet:Qn,getText:function(t){return t.text},getPosition:function(t){return t.position},getColor:function(t){return t.color||ur},getSize:function(t){return t.size||32},getAngle:function(t){return t.angle||0},getTextAnchor:function(t){return t.textAnchor||"middle"},getAlignmentBaseline:function(t){return t.alignmentBaseline||"center"},getPixelOffset:function(t){return t.offset||t.pixelOffset||[0,0]}},cr=function(t){function e(){return nr(this,e),ir(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");or(t.prototype,e&&e.prototype),e&&or(t,e)}(e,t),n=e,(o=[{key:"updateState",value:function(t){var e=t.props,n=t.oldProps,r=t.changeFlags,i=n.fontFamily!==e.fontFamily||n.characterSet!==e.characterSet;i&&this.updateFontAtlas(e.fontFamily,e.characterSet),(r.dataChanged||i||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this.transformStringToLetters()}},{key:"updateFontAtlas",value:function(t,e){var n=function(t,e){var n,r=e.fontFamily,o=e.characterSet,a=void 0===o?Qn:o,s=e.fontSize,u=void 0===s?Yn:s,l=e.padding,c=void 0===l?Jn:l,h=document.createElement("canvas"),p=h.getContext("2d");tr(p,r,u,!0);var f=0,d=0,v=p.measureText(a[0]).fontBoundingBoxDescent,g=v||u,y=Boolean(v),m={};for(var _ in Array.from(a).forEach((function(t){var e=p.measureText(t).width;d+e>Kn&&(d=0,f++),m[t]={x:d,y:f*(g+c),width:e,height:g,mask:!0},d+=e+c})),h.width=Kn,h.height=(f+1)*(g+c),tr(p,r,u,y),m)p.fillText(_,m[_].x,m[_].y);return{scale:g/u,mapping:m,texture:new i.k(t,{pixels:h,parameters:(n={},Xn(n,Hn,Zn),Xn(n,qn,Zn),n)})}}(this.context.gl,{fontFamily:t,characterSet:e}),r=n.scale,o=n.mapping,a=n.texture;this.setState({scale:r,iconAtlas:a,iconMapping:o})}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object.object})}},{key:"transformStringToLetters",value:function(){var t=this.props,e=t.data,n=t.getText,i=this.state.iconMapping;if(e&&0!==e.length){var o=[];e.forEach((function(t){var e=n(t);if(e){var a=Array.from(e),s=[0],u=0;a.forEach((function(n,a){var l={text:n,index:a,offsets:s,len:e.length,object:t},c=i[n];c?u+=c.width:(r.log.warn("Missing character: ".concat(n))(),u+=32),s.push(u),o.push(l)}))}})),this.setState({data:o})}}},{key:"getLetterOffset",value:function(t){return t.offsets[t.index]}},{key:"getTextLength",value:function(t){return t.offsets[t.offsets.length-1]}},{key:"_getAccessor",value:function(t){return"function"==typeof t?function(e){return t(e.object)}:t}},{key:"getAnchorXFromTextAnchor",value:function(t){return function(e){var n="function"==typeof t?t(e.object):t;if(!ar.hasOwnProperty(n))throw new Error("Invalid text anchor parameter: ".concat(n));return ar[n]}}},{key:"getAnchorYFromAlignmentBaseline",value:function(t){return function(e){var n="function"==typeof t?t(e.object):t;if(!sr.hasOwnProperty(n))throw new Error("Invalid alignment baseline parameter: ".concat(n));return sr[n]}}},{key:"renderLayers",value:function(){var t=this,e=this.state,n=e.data,r=e.scale,i=e.iconAtlas,o=e.iconMapping;if(!o||!i||!n)return null;var a=this.props,s=a.getPosition,u=a.getColor,l=a.getSize,c=a.getAngle,h=a.getTextAnchor,p=a.getAlignmentBaseline,f=a.getPixelOffset,d=a.fp64,v=a.sizeScale,g=a.transitions,y=a.updateTriggers;return[new Wn(this.getSubLayerProps({id:"text-multi-icon-layer",data:n,iconAtlas:i,iconMapping:o,getIcon:function(t){return t.text},getPosition:function(t){return s(t.object)},getShiftInQueue:function(e){return t.getLetterOffset(e)},getLengthOfQueue:function(e){return t.getTextLength(e)},getColor:this._getAccessor(u),getSize:this._getAccessor(l),getAngle:this._getAccessor(c),getAnchorX:this.getAnchorXFromTextAnchor(h),getAnchorY:this.getAnchorYFromAlignmentBaseline(p),getPixelOffset:this._getAccessor(f),fp64:d,sizeScale:v*r,transitions:g&&{getPosition:g.getPosition,getAngle:g.getAngle,getColor:g.getColor,getSize:g.getSize,getPixelOffset:y.getPixelOffset},updateTriggers:{getPosition:y.getPosition,getAngle:y.getAngle,getColor:y.getColor,getSize:y.getSize,getPixelOffset:y.getPixelOffset,getAnchorX:y.getTextAnchor,getAnchorY:y.getAlignmentBaseline}}))]}}])&&rr(n.prototype,o),a&&rr(n,a),e}(r.CompositeLayer);cr.layerName="TextLayer",cr.defaultProps=lr;var hr=n(750),pr=n.n(hr);n.d(e,"a",(function(){return g})),n.d(e,"g",(function(){return ct})),n.d(e,"h",(function(){return St})),n.d(e,"c",(function(){return Yt})),n.d(e,"d",(function(){return Se})),n.d(e,"e",(function(){return je})),n.d(e,"f",(function(){return En})),n.d(e,"b",(function(){return Nn})),n.d(e,"i",(function(){return pr.a}));var fr={},dr=r.experimental.OrbitController,vr=r.experimental.FirstPersonController,gr=r.experimental.FirstPersonViewport,yr=r.experimental.OrbitViewport,mr=r.experimental.ThirdPersonViewport,_r=r.experimental.TRANSITION_EVENTS,br=r.experimental.LinearInterpolator,xr=r.experimental.ViewportFlyToInterpolator,wr=r.experimental.EffectManager,Er=r.experimental.Effect;Object.assign(fr,{OrbitController:dr,FirstPersonController:vr,FirstPersonViewport:gr,OrbitViewport:yr,ThirdPersonViewport:mr,TRANSITION_EVENTS:_r,LinearInterpolator:br,ViewportFlyToInterpolator:xr,EffectManager:wr,Effect:Er});var Sr=r.experimental.BinSorter,Ar=r.experimental.linearScale,Tr=r.experimental.getLinearScale,Pr=r.experimental.quantizeScale,kr=r.experimental.getQuantizeScale,Cr=r.experimental.defaultColorRange,Or=r.experimental.flattenVertices,Ir=r.experimental.fillArray,Mr=r.experimental.ReflectionEffect;Object.assign(fr,{BinSorter:Sr,linearScale:Ar,getLinearScale:Tr,quantizeScale:Pr,getQuantizeScale:kr,defaultColorRange:Cr,flattenVertices:Or,fillArray:Ir,ReflectionEffect:Mr}),Object.assign(fr,{ViewportController:hr.ViewportController})},701:function(t,e,n){"use strict";n.r(e);var r=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},i=function(t){var e;return 1===t.length&&(e=t,t=function(t,n){return r(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}};var o=i(r),a=o.right,s=o.left,u=a,l=function(t,e){null==e&&(e=c);for(var n=0,r=t.length-1,i=t[0],o=new Array(r<0?0:r);n<r;)o[n]=e(i,i=t[++n]);return o};function c(t,e){return[t,e]}var h=function(t,e,n){var r,i,o,a,s=t.length,u=e.length,l=new Array(s*u);for(null==n&&(n=c),r=o=0;r<s;++r)for(a=t[r],i=0;i<u;++i,++o)l[o]=n(a,e[i]);return l},p=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},f=function(t){return null===t?NaN:+t},d=function(t,e){var n,r,i=t.length,o=0,a=-1,s=0,u=0;if(null==e)for(;++a<i;)isNaN(n=f(t[a]))||(u+=(r=n-s)*(n-(s+=r/++o)));else for(;++a<i;)isNaN(n=f(e(t[a],a,t)))||(u+=(r=n-s)*(n-(s+=r/++o)));if(o>1)return u/(o-1)},v=function(t,e){var n=d(t,e);return n?Math.sqrt(n):n},g=function(t,e){var n,r,i,o=t.length,a=-1;if(null==e){for(;++a<o;)if(null!=(n=t[a])&&n>=n)for(r=i=n;++a<o;)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++a<o;)if(null!=(n=e(t[a],a,t))&&n>=n)for(r=i=n;++a<o;)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]},y=Array.prototype,m=y.slice,_=y.map,b=function(t){return function(){return t}},x=function(t){return t},w=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o},E=Math.sqrt(50),S=Math.sqrt(10),A=Math.sqrt(2),T=function(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=P(t,e,n))||!isFinite(a))return[];if(a>0)for(t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(t+s)*a;else for(t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(t-s)/a;return r&&o.reverse(),o};function P(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=E?10:o>=S?5:o>=A?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=E?10:o>=S?5:o>=A?2:1)}function k(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=E?i*=10:o>=S?i*=5:o>=A&&(i*=2),e<t?-i:i}var C=function(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1},O=function(){var t=x,e=g,n=C;function r(r){var i,o,a=r.length,s=new Array(a);for(i=0;i<a;++i)s[i]=t(r[i],i,r);var l=e(s),c=l[0],h=l[1],p=n(s,c,h);Array.isArray(p)||(p=k(c,h,p),p=w(Math.ceil(c/p)*p,h,p));for(var f=p.length;p[0]<=c;)p.shift(),--f;for(;p[f-1]>h;)p.pop(),--f;var d,v=new Array(f+1);for(i=0;i<=f;++i)(d=v[i]=[]).x0=i>0?p[i-1]:c,d.x1=i<f?p[i]:h;for(i=0;i<a;++i)c<=(o=s[i])&&o<=h&&v[u(p,o,0,f)].push(r[i]);return v}return r.value=function(e){return arguments.length?(t="function"==typeof e?e:b(e),r):t},r.domain=function(t){return arguments.length?(e="function"==typeof t?t:b([t[0],t[1]]),r):e},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?b(m.call(t)):b(t),r):n},r},I=function(t,e,n){if(null==n&&(n=f),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}},M=function(t,e,n){return t=_.call(t,f).sort(r),Math.ceil((n-e)/(2*(I(t,.75)-I(t,.25))*Math.pow(t.length,-1/3)))},R=function(t,e,n){return Math.ceil((n-e)/(3.5*v(t)*Math.pow(t.length,-1/3)))},L=function(t,e){var n,r,i=t.length,o=-1;if(null==e){for(;++o<i;)if(null!=(n=t[o])&&n>=n)for(r=n;++o<i;)null!=(n=t[o])&&n>r&&(r=n)}else for(;++o<i;)if(null!=(n=e(t[o],o,t))&&n>=n)for(r=n;++o<i;)null!=(n=e(t[o],o,t))&&n>r&&(r=n);return r},F=function(t,e){var n,r=t.length,i=r,o=-1,a=0;if(null==e)for(;++o<r;)isNaN(n=f(t[o]))?--i:a+=n;else for(;++o<r;)isNaN(n=f(e(t[o],o,t)))?--i:a+=n;if(i)return a/i},N=function(t,e){var n,i=t.length,o=-1,a=[];if(null==e)for(;++o<i;)isNaN(n=f(t[o]))||a.push(n);else for(;++o<i;)isNaN(n=f(e(t[o],o,t)))||a.push(n);return I(a.sort(r),.5)},j=function(t){for(var e,n,r,i=t.length,o=-1,a=0;++o<i;)a+=t[o].length;for(n=new Array(a);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--a]=r[e];return n},D=function(t,e){var n,r,i=t.length,o=-1;if(null==e){for(;++o<i;)if(null!=(n=t[o])&&n>=n)for(r=n;++o<i;)null!=(n=t[o])&&r>n&&(r=n)}else for(;++o<i;)if(null!=(n=e(t[o],o,t))&&n>=n)for(r=n;++o<i;)null!=(n=e(t[o],o,t))&&r>n&&(r=n);return r},z=function(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r},B=function(t,e){if(n=t.length){var n,i,o=0,a=0,s=t[a];for(null==e&&(e=r);++o<n;)(e(i=t[o],s)<0||0!==e(s,s))&&(s=i,a=o);return 0===e(s,s)?a:void 0}},U=function(t,e,n){for(var r,i,o=(null==n?t.length:n)-(e=null==e?0:+e);o;)i=Math.random()*o--|0,r=t[o+e],t[o+e]=t[i+e],t[i+e]=r;return t},V=function(t,e){var n,r=t.length,i=-1,o=0;if(null==e)for(;++i<r;)(n=+t[i])&&(o+=n);else for(;++i<r;)(n=+e(t[i],i,t))&&(o+=n);return o},G=function(t){if(!(i=t.length))return[];for(var e=-1,n=D(t,W),r=new Array(n);++e<n;)for(var i,o=-1,a=r[e]=new Array(i);++o<i;)a[o]=t[o][e];return r};function W(t){return t.length}var X=function(){return G(arguments)};n.d(e,"bisect",(function(){return u})),n.d(e,"bisectRight",(function(){return a})),n.d(e,"bisectLeft",(function(){return s})),n.d(e,"ascending",(function(){return r})),n.d(e,"bisector",(function(){return i})),n.d(e,"cross",(function(){return h})),n.d(e,"descending",(function(){return p})),n.d(e,"deviation",(function(){return v})),n.d(e,"extent",(function(){return g})),n.d(e,"histogram",(function(){return O})),n.d(e,"thresholdFreedmanDiaconis",(function(){return M})),n.d(e,"thresholdScott",(function(){return R})),n.d(e,"thresholdSturges",(function(){return C})),n.d(e,"max",(function(){return L})),n.d(e,"mean",(function(){return F})),n.d(e,"median",(function(){return N})),n.d(e,"merge",(function(){return j})),n.d(e,"min",(function(){return D})),n.d(e,"pairs",(function(){return l})),n.d(e,"permute",(function(){return z})),n.d(e,"quantile",(function(){return I})),n.d(e,"range",(function(){return w})),n.d(e,"scan",(function(){return B})),n.d(e,"shuffle",(function(){return U})),n.d(e,"sum",(function(){return V})),n.d(e,"ticks",(function(){return T})),n.d(e,"tickIncrement",(function(){return P})),n.d(e,"tickStep",(function(){return k})),n.d(e,"transpose",(function(){return G})),n.d(e,"variance",(function(){return d})),n.d(e,"zip",(function(){return X}))},708:function(t,e,n){"use strict";function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(e,"a",(function(){return r}))},713:function(t,e,n){(function(t,r){var i;(function(){var o,a=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",l="__lodash_hash_undefined__",c=500,h="__lodash_placeholder__",p=1,f=2,d=4,v=1,g=2,y=1,m=2,_=4,b=8,x=16,w=32,E=64,S=128,A=256,T=512,P=30,k="...",C=800,O=16,I=1,M=2,R=1/0,L=9007199254740991,F=17976931348623157e292,N=NaN,j=4294967295,D=j-1,z=j>>>1,B=[["ary",S],["bind",y],["bindKey",m],["curry",b],["curryRight",x],["flip",T],["partial",w],["partialRight",E],["rearg",A]],U="[object Arguments]",V="[object Array]",G="[object AsyncFunction]",W="[object Boolean]",X="[object Date]",H="[object DOMException]",q="[object Error]",Z="[object Function]",K="[object GeneratorFunction]",Y="[object Map]",J="[object Number]",Q="[object Null]",$="[object Object]",tt="[object Proxy]",et="[object RegExp]",nt="[object Set]",rt="[object String]",it="[object Symbol]",ot="[object Undefined]",at="[object WeakMap]",st="[object WeakSet]",ut="[object ArrayBuffer]",lt="[object DataView]",ct="[object Float32Array]",ht="[object Float64Array]",pt="[object Int8Array]",ft="[object Int16Array]",dt="[object Int32Array]",vt="[object Uint8Array]",gt="[object Uint8ClampedArray]",yt="[object Uint16Array]",mt="[object Uint32Array]",_t=/\b__p \+= '';/g,bt=/\b(__p \+=) '' \+/g,xt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wt=/&(?:amp|lt|gt|quot|#39);/g,Et=/[&<>"']/g,St=RegExp(wt.source),At=RegExp(Et.source),Tt=/<%-([\s\S]+?)%>/g,Pt=/<%([\s\S]+?)%>/g,kt=/<%=([\s\S]+?)%>/g,Ct=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,It=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mt=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(Mt.source),Lt=/^\s+|\s+$/g,Ft=/^\s+/,Nt=/\s+$/,jt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Dt=/\{\n\/\* \[wrapped with (.+)\] \*/,zt=/,? & /,Bt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ut=/\\(\\)?/g,Vt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gt=/\w*$/,Wt=/^[-+]0x[0-9a-f]+$/i,Xt=/^0b[01]+$/i,Ht=/^\[object .+?Constructor\]$/,qt=/^0o[0-7]+$/i,Zt=/^(?:0|[1-9]\d*)$/,Kt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yt=/($^)/,Jt=/['\n\r\u2028\u2029\\]/g,Qt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",$t="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+$t+"]",ne="["+Qt+"]",re="\\d+",ie="[\\u2700-\\u27bf]",oe="[a-z\\xdf-\\xf6\\xf8-\\xff]",ae="[^\\ud800-\\udfff"+$t+re+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",se="\\ud83c[\\udffb-\\udfff]",ue="[^\\ud800-\\udfff]",le="(?:\\ud83c[\\udde6-\\uddff]){2}",ce="[\\ud800-\\udbff][\\udc00-\\udfff]",he="[A-Z\\xc0-\\xd6\\xd8-\\xde]",pe="(?:"+oe+"|"+ae+")",fe="(?:"+he+"|"+ae+")",de="(?:"+ne+"|"+se+")"+"?",ve="[\\ufe0e\\ufe0f]?"+de+("(?:\\u200d(?:"+[ue,le,ce].join("|")+")[\\ufe0e\\ufe0f]?"+de+")*"),ge="(?:"+[ie,le,ce].join("|")+")"+ve,ye="(?:"+[ue+ne+"?",ne,le,ce,te].join("|")+")",me=RegExp("['â]","g"),_e=RegExp(ne,"g"),be=RegExp(se+"(?="+se+")|"+ye+ve,"g"),xe=RegExp([he+"?"+oe+"+(?:['â](?:d|ll|m|re|s|t|ve))?(?="+[ee,he,"$"].join("|")+")",fe+"+(?:['â](?:D|LL|M|RE|S|T|VE))?(?="+[ee,he+pe,"$"].join("|")+")",he+"?"+pe+"+(?:['â](?:d|ll|m|re|s|t|ve))?",he+"+(?:['â](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re,ge].join("|"),"g"),we=RegExp("[\\u200d\\ud800-\\udfff"+Qt+"\\ufe0e\\ufe0f]"),Ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Se=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ae=-1,Te={};Te[ct]=Te[ht]=Te[pt]=Te[ft]=Te[dt]=Te[vt]=Te[gt]=Te[yt]=Te[mt]=!0,Te[U]=Te[V]=Te[ut]=Te[W]=Te[lt]=Te[X]=Te[q]=Te[Z]=Te[Y]=Te[J]=Te[$]=Te[et]=Te[nt]=Te[rt]=Te[at]=!1;var Pe={};Pe[U]=Pe[V]=Pe[ut]=Pe[lt]=Pe[W]=Pe[X]=Pe[ct]=Pe[ht]=Pe[pt]=Pe[ft]=Pe[dt]=Pe[Y]=Pe[J]=Pe[$]=Pe[et]=Pe[nt]=Pe[rt]=Pe[it]=Pe[vt]=Pe[gt]=Pe[yt]=Pe[mt]=!0,Pe[q]=Pe[Z]=Pe[at]=!1;var ke={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ce=parseFloat,Oe=parseInt,Ie="object"==typeof t&&t&&t.Object===Object&&t,Me="object"==typeof self&&self&&self.Object===Object&&self,Re=Ie||Me||Function("return this")(),Le=e&&!e.nodeType&&e,Fe=Le&&"object"==typeof r&&r&&!r.nodeType&&r,Ne=Fe&&Fe.exports===Le,je=Ne&&Ie.process,De=function(){try{var t=Fe&&Fe.require&&Fe.require("util").types;return t||je&&je.binding&&je.binding("util")}catch(t){}}(),ze=De&&De.isArrayBuffer,Be=De&&De.isDate,Ue=De&&De.isMap,Ve=De&&De.isRegExp,Ge=De&&De.isSet,We=De&&De.isTypedArray;function Xe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function He(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t)}return r}function qe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function Ze(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ke(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ye(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Je(t,e){return!!(null==t?0:t.length)&&un(t,e,0)>-1}function Qe(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function $e(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function tn(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function en(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function nn(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function rn(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var on=pn("length");function an(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function sn(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function un(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):sn(t,cn,n)}function ln(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function cn(t){return t!=t}function hn(t,e){var n=null==t?0:t.length;return n?vn(t,e)/n:N}function pn(t){return function(e){return null==e?o:e[t]}}function fn(t){return function(e){return null==t?o:t[e]}}function dn(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function vn(t,e){for(var n,r=-1,i=t.length;++r<i;){var a=e(t[r]);a!==o&&(n=n===o?a:n+a)}return n}function gn(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function yn(t){return function(e){return t(e)}}function mn(t,e){return $e(e,(function(e){return t[e]}))}function _n(t,e){return t.has(e)}function bn(t,e){for(var n=-1,r=t.length;++n<r&&un(e,t[n],0)>-1;);return n}function xn(t,e){for(var n=t.length;n--&&un(e,t[n],0)>-1;);return n}var wn=fn({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),En=fn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Sn(t){return"\\"+ke[t]}function An(t){return we.test(t)}function Tn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function Pn(t,e){return function(n){return t(e(n))}}function kn(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n];a!==e&&a!==h||(t[n]=h,o[i++]=n)}return o}function Cn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function On(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function In(t){return An(t)?function(t){var e=be.lastIndex=0;for(;be.test(t);)++e;return e}(t):on(t)}function Mn(t){return An(t)?function(t){return t.match(be)||[]}(t):function(t){return t.split("")}(t)}var Rn=fn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ln=function t(e){var n,r=(e=null==e?Re:Ln.defaults(Re.Object(),e,Ln.pick(Re,Se))).Array,i=e.Date,Qt=e.Error,$t=e.Function,te=e.Math,ee=e.Object,ne=e.RegExp,re=e.String,ie=e.TypeError,oe=r.prototype,ae=$t.prototype,se=ee.prototype,ue=e["__core-js_shared__"],le=ae.toString,ce=se.hasOwnProperty,he=0,pe=(n=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",fe=se.toString,de=le.call(ee),ve=Re._,ge=ne("^"+le.call(ce).replace(Mt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ye=Ne?e.Buffer:o,be=e.Symbol,we=e.Uint8Array,ke=ye?ye.allocUnsafe:o,Ie=Pn(ee.getPrototypeOf,ee),Me=ee.create,Le=se.propertyIsEnumerable,Fe=oe.splice,je=be?be.isConcatSpreadable:o,De=be?be.iterator:o,on=be?be.toStringTag:o,fn=function(){try{var t=zo(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),Fn=e.clearTimeout!==Re.clearTimeout&&e.clearTimeout,Nn=i&&i.now!==Re.Date.now&&i.now,jn=e.setTimeout!==Re.setTimeout&&e.setTimeout,Dn=te.ceil,zn=te.floor,Bn=ee.getOwnPropertySymbols,Un=ye?ye.isBuffer:o,Vn=e.isFinite,Gn=oe.join,Wn=Pn(ee.keys,ee),Xn=te.max,Hn=te.min,qn=i.now,Zn=e.parseInt,Kn=te.random,Yn=oe.reverse,Jn=zo(e,"DataView"),Qn=zo(e,"Map"),$n=zo(e,"Promise"),tr=zo(e,"Set"),er=zo(e,"WeakMap"),nr=zo(ee,"create"),rr=er&&new er,ir={},or=ha(Jn),ar=ha(Qn),sr=ha($n),ur=ha(tr),lr=ha(er),cr=be?be.prototype:o,hr=cr?cr.valueOf:o,pr=cr?cr.toString:o;function fr(t){if(ks(t)&&!ys(t)&&!(t instanceof yr)){if(t instanceof gr)return t;if(ce.call(t,"__wrapped__"))return pa(t)}return new gr(t)}var dr=function(){function t(){}return function(e){if(!Ps(e))return{};if(Me)return Me(e);t.prototype=e;var n=new t;return t.prototype=o,n}}();function vr(){}function gr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}function yr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=j,this.__views__=[]}function mr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _r(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function br(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xr(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new br;++e<n;)this.add(t[e])}function wr(t){var e=this.__data__=new _r(t);this.size=e.size}function Er(t,e){var n=ys(t),r=!n&&gs(t),i=!n&&!r&&xs(t),o=!n&&!r&&!i&&Ns(t),a=n||r||i||o,s=a?gn(t.length,re):[],u=s.length;for(var l in t)!e&&!ce.call(t,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Ho(l,u))||s.push(l);return s}function Sr(t){var e=t.length;return e?t[xi(0,e-1)]:o}function Ar(t,e){return ua(no(t),Lr(e,0,t.length))}function Tr(t){return ua(no(t))}function Pr(t,e,n){(n===o||fs(t[e],n))&&(n!==o||e in t)||Mr(t,e,n)}function kr(t,e,n){var r=t[e];ce.call(t,e)&&fs(r,n)&&(n!==o||e in t)||Mr(t,e,n)}function Cr(t,e){for(var n=t.length;n--;)if(fs(t[n][0],e))return n;return-1}function Or(t,e,n,r){return zr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function Ir(t,e){return t&&ro(e,iu(e),t)}function Mr(t,e,n){"__proto__"==e&&fn?fn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Rr(t,e){for(var n=-1,i=e.length,a=r(i),s=null==t;++n<i;)a[n]=s?o:$s(t,e[n]);return a}function Lr(t,e,n){return t==t&&(n!==o&&(t=t<=n?t:n),e!==o&&(t=t>=e?t:e)),t}function Fr(t,e,n,r,i,a){var s,u=e&p,l=e&f,c=e&d;if(n&&(s=i?n(t,r,i,a):n(t)),s!==o)return s;if(!Ps(t))return t;var h=ys(t);if(h){if(s=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&ce.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!u)return no(t,s)}else{var v=Vo(t),g=v==Z||v==K;if(xs(t))return Yi(t,u);if(v==$||v==U||g&&!i){if(s=l||g?{}:Wo(t),!u)return l?function(t,e){return ro(t,Uo(t),e)}(t,function(t,e){return t&&ro(e,ou(e),t)}(s,t)):function(t,e){return ro(t,Bo(t),e)}(t,Ir(s,t))}else{if(!Pe[v])return i?t:{};s=function(t,e,n){var r=t.constructor;switch(e){case ut:return Ji(t);case W:case X:return new r(+t);case lt:return function(t,e){var n=e?Ji(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case ct:case ht:case pt:case ft:case dt:case vt:case gt:case yt:case mt:return Qi(t,n);case Y:return new r;case J:case rt:return new r(t);case et:return function(t){var e=new t.constructor(t.source,Gt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case nt:return new r;case it:return i=t,hr?ee(hr.call(i)):{}}var i}(t,v,u)}}a||(a=new wr);var y=a.get(t);if(y)return y;a.set(t,s),Rs(t)?t.forEach((function(r){s.add(Fr(r,e,n,r,t,a))})):Cs(t)&&t.forEach((function(r,i){s.set(i,Fr(r,e,n,i,t,a))}));var m=h?o:(c?l?Mo:Io:l?ou:iu)(t);return qe(m||t,(function(r,i){m&&(r=t[i=r]),kr(s,i,Fr(r,e,n,i,t,a))})),s}function Nr(t,e,n){var r=n.length;if(null==t)return!r;for(t=ee(t);r--;){var i=n[r],a=e[i],s=t[i];if(s===o&&!(i in t)||!a(s))return!1}return!0}function jr(t,e,n){if("function"!=typeof t)throw new ie(u);return ia((function(){t.apply(o,n)}),e)}function Dr(t,e,n,r){var i=-1,o=Je,s=!0,u=t.length,l=[],c=e.length;if(!u)return l;n&&(e=$e(e,yn(n))),r?(o=Qe,s=!1):e.length>=a&&(o=_n,s=!1,e=new xr(e));t:for(;++i<u;){var h=t[i],p=null==n?h:n(h);if(h=r||0!==h?h:0,s&&p==p){for(var f=c;f--;)if(e[f]===p)continue t;l.push(h)}else o(e,p,r)||l.push(h)}return l}fr.templateSettings={escape:Tt,evaluate:Pt,interpolate:kt,variable:"",imports:{_:fr}},fr.prototype=vr.prototype,fr.prototype.constructor=fr,gr.prototype=dr(vr.prototype),gr.prototype.constructor=gr,yr.prototype=dr(vr.prototype),yr.prototype.constructor=yr,mr.prototype.clear=function(){this.__data__=nr?nr(null):{},this.size=0},mr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mr.prototype.get=function(t){var e=this.__data__;if(nr){var n=e[t];return n===l?o:n}return ce.call(e,t)?e[t]:o},mr.prototype.has=function(t){var e=this.__data__;return nr?e[t]!==o:ce.call(e,t)},mr.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nr&&e===o?l:e,this},_r.prototype.clear=function(){this.__data__=[],this.size=0},_r.prototype.delete=function(t){var e=this.__data__,n=Cr(e,t);return!(n<0)&&(n==e.length-1?e.pop():Fe.call(e,n,1),--this.size,!0)},_r.prototype.get=function(t){var e=this.__data__,n=Cr(e,t);return n<0?o:e[n][1]},_r.prototype.has=function(t){return Cr(this.__data__,t)>-1},_r.prototype.set=function(t,e){var n=this.__data__,r=Cr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},br.prototype.clear=function(){this.size=0,this.__data__={hash:new mr,map:new(Qn||_r),string:new mr}},br.prototype.delete=function(t){var e=jo(this,t).delete(t);return this.size-=e?1:0,e},br.prototype.get=function(t){return jo(this,t).get(t)},br.prototype.has=function(t){return jo(this,t).has(t)},br.prototype.set=function(t,e){var n=jo(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},xr.prototype.add=xr.prototype.push=function(t){return this.__data__.set(t,l),this},xr.prototype.has=function(t){return this.__data__.has(t)},wr.prototype.clear=function(){this.__data__=new _r,this.size=0},wr.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},wr.prototype.get=function(t){return this.__data__.get(t)},wr.prototype.has=function(t){return this.__data__.has(t)},wr.prototype.set=function(t,e){var n=this.__data__;if(n instanceof _r){var r=n.__data__;if(!Qn||r.length<a-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new br(r)}return n.set(t,e),this.size=n.size,this};var zr=ao(qr),Br=ao(Zr,!0);function Ur(t,e){var n=!0;return zr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function Vr(t,e,n){for(var r=-1,i=t.length;++r<i;){var a=t[r],s=e(a);if(null!=s&&(u===o?s==s&&!Fs(s):n(s,u)))var u=s,l=a}return l}function Gr(t,e){var n=[];return zr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function Wr(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=Xo),i||(i=[]);++o<a;){var s=t[o];e>0&&n(s)?e>1?Wr(s,e-1,n,r,i):tn(i,s):r||(i[i.length]=s)}return i}var Xr=so(),Hr=so(!0);function qr(t,e){return t&&Xr(t,e,iu)}function Zr(t,e){return t&&Hr(t,e,iu)}function Kr(t,e){return Ye(e,(function(e){return Ss(t[e])}))}function Yr(t,e){for(var n=0,r=(e=Hi(e,t)).length;null!=t&&n<r;)t=t[ca(e[n++])];return n&&n==r?t:o}function Jr(t,e,n){var r=e(t);return ys(t)?r:tn(r,n(t))}function Qr(t){return null==t?t===o?ot:Q:on&&on in ee(t)?function(t){var e=ce.call(t,on),n=t[on];try{t[on]=o;var r=!0}catch(t){}var i=fe.call(t);r&&(e?t[on]=n:delete t[on]);return i}(t):function(t){return fe.call(t)}(t)}function $r(t,e){return t>e}function ti(t,e){return null!=t&&ce.call(t,e)}function ei(t,e){return null!=t&&e in ee(t)}function ni(t,e,n){for(var i=n?Qe:Je,a=t[0].length,s=t.length,u=s,l=r(s),c=1/0,h=[];u--;){var p=t[u];u&&e&&(p=$e(p,yn(e))),c=Hn(p.length,c),l[u]=!n&&(e||a>=120&&p.length>=120)?new xr(u&&p):o}p=t[0];var f=-1,d=l[0];t:for(;++f<a&&h.length<c;){var v=p[f],g=e?e(v):v;if(v=n||0!==v?v:0,!(d?_n(d,g):i(h,g,n))){for(u=s;--u;){var y=l[u];if(!(y?_n(y,g):i(t[u],g,n)))continue t}d&&d.push(g),h.push(v)}}return h}function ri(t,e,n){var r=null==(t=ea(t,e=Hi(e,t)))?t:t[ca(Ea(e))];return null==r?o:Xe(r,t,n)}function ii(t){return ks(t)&&Qr(t)==U}function oi(t,e,n,r,i){return t===e||(null==t||null==e||!ks(t)&&!ks(e)?t!=t&&e!=e:function(t,e,n,r,i,a){var s=ys(t),u=ys(e),l=s?V:Vo(t),c=u?V:Vo(e),h=(l=l==U?$:l)==$,p=(c=c==U?$:c)==$,f=l==c;if(f&&xs(t)){if(!xs(e))return!1;s=!0,h=!1}if(f&&!h)return a||(a=new wr),s||Ns(t)?Co(t,e,n,r,i,a):function(t,e,n,r,i,o,a){switch(n){case lt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ut:return!(t.byteLength!=e.byteLength||!o(new we(t),new we(e)));case W:case X:case J:return fs(+t,+e);case q:return t.name==e.name&&t.message==e.message;case et:case rt:return t==e+"";case Y:var s=Tn;case nt:var u=r&v;if(s||(s=Cn),t.size!=e.size&&!u)return!1;var l=a.get(t);if(l)return l==e;r|=g,a.set(t,e);var c=Co(s(t),s(e),r,i,o,a);return a.delete(t),c;case it:if(hr)return hr.call(t)==hr.call(e)}return!1}(t,e,l,n,r,i,a);if(!(n&v)){var d=h&&ce.call(t,"__wrapped__"),y=p&&ce.call(e,"__wrapped__");if(d||y){var m=d?t.value():t,_=y?e.value():e;return a||(a=new wr),i(m,_,n,r,a)}}if(!f)return!1;return a||(a=new wr),function(t,e,n,r,i,a){var s=n&v,u=Io(t),l=u.length,c=Io(e).length;if(l!=c&&!s)return!1;var h=l;for(;h--;){var p=u[h];if(!(s?p in e:ce.call(e,p)))return!1}var f=a.get(t);if(f&&a.get(e))return f==e;var d=!0;a.set(t,e),a.set(e,t);var g=s;for(;++h<l;){p=u[h];var y=t[p],m=e[p];if(r)var _=s?r(m,y,p,e,t,a):r(y,m,p,t,e,a);if(!(_===o?y===m||i(y,m,n,r,a):_)){d=!1;break}g||(g="constructor"==p)}if(d&&!g){var b=t.constructor,x=e.constructor;b!=x&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x)&&(d=!1)}return a.delete(t),a.delete(e),d}(t,e,n,r,i,a)}(t,e,n,r,oi,i))}function ai(t,e,n,r){var i=n.length,a=i,s=!r;if(null==t)return!a;for(t=ee(t);i--;){var u=n[i];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++i<a;){var l=(u=n[i])[0],c=t[l],h=u[1];if(s&&u[2]){if(c===o&&!(l in t))return!1}else{var p=new wr;if(r)var f=r(c,h,l,t,e,p);if(!(f===o?oi(h,c,v|g,r,p):f))return!1}}return!0}function si(t){return!(!Ps(t)||(e=t,pe&&pe in e))&&(Ss(t)?ge:Ht).test(ha(t));var e}function ui(t){return"function"==typeof t?t:null==t?Ou:"object"==typeof t?ys(t)?di(t[0],t[1]):fi(t):zu(t)}function li(t){if(!Jo(t))return Wn(t);var e=[];for(var n in ee(t))ce.call(t,n)&&"constructor"!=n&&e.push(n);return e}function ci(t){if(!Ps(t))return function(t){var e=[];if(null!=t)for(var n in ee(t))e.push(n);return e}(t);var e=Jo(t),n=[];for(var r in t)("constructor"!=r||!e&&ce.call(t,r))&&n.push(r);return n}function hi(t,e){return t<e}function pi(t,e){var n=-1,i=_s(t)?r(t.length):[];return zr(t,(function(t,r,o){i[++n]=e(t,r,o)})),i}function fi(t){var e=Do(t);return 1==e.length&&e[0][2]?$o(e[0][0],e[0][1]):function(n){return n===t||ai(n,t,e)}}function di(t,e){return Zo(t)&&Qo(e)?$o(ca(t),e):function(n){var r=$s(n,t);return r===o&&r===e?tu(n,t):oi(e,r,v|g)}}function vi(t,e,n,r,i){t!==e&&Xr(e,(function(a,s){if(i||(i=new wr),Ps(a))!function(t,e,n,r,i,a,s){var u=na(t,n),l=na(e,n),c=s.get(l);if(c)return void Pr(t,n,c);var h=a?a(u,l,n+"",t,e,s):o,p=h===o;if(p){var f=ys(l),d=!f&&xs(l),v=!f&&!d&&Ns(l);h=l,f||d||v?ys(u)?h=u:bs(u)?h=no(u):d?(p=!1,h=Yi(l,!0)):v?(p=!1,h=Qi(l,!0)):h=[]:Is(l)||gs(l)?(h=u,gs(u)?h=Ws(u):Ps(u)&&!Ss(u)||(h=Wo(l))):p=!1}p&&(s.set(l,h),i(h,l,r,a,s),s.delete(l));Pr(t,n,h)}(t,e,s,n,vi,r,i);else{var u=r?r(na(t,s),a,s+"",t,e,i):o;u===o&&(u=a),Pr(t,s,u)}}),ou)}function gi(t,e){var n=t.length;if(n)return Ho(e+=e<0?n:0,n)?t[e]:o}function yi(t,e,n){var r=-1;return e=$e(e.length?e:[Ou],yn(No())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(pi(t,(function(t,n,i){return{criteria:$e(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;for(;++r<a;){var u=$i(i[r],o[r]);if(u){if(r>=s)return u;var l=n[r];return u*("desc"==l?-1:1)}}return t.index-e.index}(t,e,n)}))}function mi(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],s=Yr(t,a);n(s,a)&&Ti(o,Hi(a,t),s)}return o}function _i(t,e,n,r){var i=r?ln:un,o=-1,a=e.length,s=t;for(t===e&&(e=no(e)),n&&(s=$e(t,yn(n)));++o<a;)for(var u=0,l=e[o],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==t&&Fe.call(s,u,1),Fe.call(t,u,1);return t}function bi(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;Ho(i)?Fe.call(t,i,1):Di(t,i)}}return t}function xi(t,e){return t+zn(Kn()*(e-t+1))}function wi(t,e){var n="";if(!t||e<1||e>L)return n;do{e%2&&(n+=t),(e=zn(e/2))&&(t+=t)}while(e);return n}function Ei(t,e){return oa(ta(t,e,Ou),t+"")}function Si(t){return Sr(fu(t))}function Ai(t,e){var n=fu(t);return ua(n,Lr(e,0,n.length))}function Ti(t,e,n,r){if(!Ps(t))return t;for(var i=-1,a=(e=Hi(e,t)).length,s=a-1,u=t;null!=u&&++i<a;){var l=ca(e[i]),c=n;if(i!=s){var h=u[l];(c=r?r(h,l,u):o)===o&&(c=Ps(h)?h:Ho(e[i+1])?[]:{})}kr(u,l,c),u=u[l]}return t}var Pi=rr?function(t,e){return rr.set(t,e),t}:Ou,ki=fn?function(t,e){return fn(t,"toString",{configurable:!0,enumerable:!1,value:Pu(e),writable:!0})}:Ou;function Ci(t){return ua(fu(t))}function Oi(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var a=r(o);++i<o;)a[i]=t[i+e];return a}function Ii(t,e){var n;return zr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function Mi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=z){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!Fs(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Ri(t,e,Ou,n)}function Ri(t,e,n,r){e=n(e);for(var i=0,a=null==t?0:t.length,s=e!=e,u=null===e,l=Fs(e),c=e===o;i<a;){var h=zn((i+a)/2),p=n(t[h]),f=p!==o,d=null===p,v=p==p,g=Fs(p);if(s)var y=r||v;else y=c?v&&(r||f):u?v&&f&&(r||!d):l?v&&f&&!d&&(r||!g):!d&&!g&&(r?p<=e:p<e);y?i=h+1:a=h}return Hn(a,D)}function Li(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],s=e?e(a):a;if(!n||!fs(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function Fi(t){return"number"==typeof t?t:Fs(t)?N:+t}function Ni(t){if("string"==typeof t)return t;if(ys(t))return $e(t,Ni)+"";if(Fs(t))return pr?pr.call(t):"";var e=t+"";return"0"==e&&1/t==-R?"-0":e}function ji(t,e,n){var r=-1,i=Je,o=t.length,s=!0,u=[],l=u;if(n)s=!1,i=Qe;else if(o>=a){var c=e?null:Eo(t);if(c)return Cn(c);s=!1,i=_n,l=new xr}else l=e?[]:u;t:for(;++r<o;){var h=t[r],p=e?e(h):h;if(h=n||0!==h?h:0,s&&p==p){for(var f=l.length;f--;)if(l[f]===p)continue t;e&&l.push(p),u.push(h)}else i(l,p,n)||(l!==u&&l.push(p),u.push(h))}return u}function Di(t,e){return null==(t=ea(t,e=Hi(e,t)))||delete t[ca(Ea(e))]}function zi(t,e,n,r){return Ti(t,e,n(Yr(t,e)),r)}function Bi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Oi(t,r?0:o,r?o+1:i):Oi(t,r?o+1:0,r?i:o)}function Ui(t,e){var n=t;return n instanceof yr&&(n=n.value()),en(e,(function(t,e){return e.func.apply(e.thisArg,tn([t],e.args))}),n)}function Vi(t,e,n){var i=t.length;if(i<2)return i?ji(t[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=t[o],u=-1;++u<i;)u!=o&&(a[o]=Dr(a[o]||s,t[u],e,n));return ji(Wr(a,1),e,n)}function Gi(t,e,n){for(var r=-1,i=t.length,a=e.length,s={};++r<i;){var u=r<a?e[r]:o;n(s,t[r],u)}return s}function Wi(t){return bs(t)?t:[]}function Xi(t){return"function"==typeof t?t:Ou}function Hi(t,e){return ys(t)?t:Zo(t,e)?[t]:la(Xs(t))}var qi=Ei;function Zi(t,e,n){var r=t.length;return n=n===o?r:n,!e&&n>=r?t:Oi(t,e,n)}var Ki=Fn||function(t){return Re.clearTimeout(t)};function Yi(t,e){if(e)return t.slice();var n=t.length,r=ke?ke(n):new t.constructor(n);return t.copy(r),r}function Ji(t){var e=new t.constructor(t.byteLength);return new we(e).set(new we(t)),e}function Qi(t,e){var n=e?Ji(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function $i(t,e){if(t!==e){var n=t!==o,r=null===t,i=t==t,a=Fs(t),s=e!==o,u=null===e,l=e==e,c=Fs(e);if(!u&&!c&&!a&&t>e||a&&s&&l&&!u&&!c||r&&s&&l||!n&&l||!i)return 1;if(!r&&!a&&!c&&t<e||c&&n&&i&&!r&&!a||u&&n&&i||!s&&i||!l)return-1}return 0}function to(t,e,n,i){for(var o=-1,a=t.length,s=n.length,u=-1,l=e.length,c=Xn(a-s,0),h=r(l+c),p=!i;++u<l;)h[u]=e[u];for(;++o<s;)(p||o<a)&&(h[n[o]]=t[o]);for(;c--;)h[u++]=t[o++];return h}function eo(t,e,n,i){for(var o=-1,a=t.length,s=-1,u=n.length,l=-1,c=e.length,h=Xn(a-u,0),p=r(h+c),f=!i;++o<h;)p[o]=t[o];for(var d=o;++l<c;)p[d+l]=e[l];for(;++s<u;)(f||o<a)&&(p[d+n[s]]=t[o++]);return p}function no(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function ro(t,e,n,r){var i=!n;n||(n={});for(var a=-1,s=e.length;++a<s;){var u=e[a],l=r?r(n[u],t[u],u,n,t):o;l===o&&(l=t[u]),i?Mr(n,u,l):kr(n,u,l)}return n}function io(t,e){return function(n,r){var i=ys(n)?He:Or,o=e?e():{};return i(n,t,No(r,2),o)}}function oo(t){return Ei((function(e,n){var r=-1,i=n.length,a=i>1?n[i-1]:o,s=i>2?n[2]:o;for(a=t.length>3&&"function"==typeof a?(i--,a):o,s&&qo(n[0],n[1],s)&&(a=i<3?o:a,i=1),e=ee(e);++r<i;){var u=n[r];u&&t(e,u,r,a)}return e}))}function ao(t,e){return function(n,r){if(null==n)return n;if(!_s(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=ee(n);(e?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function so(t){return function(e,n,r){for(var i=-1,o=ee(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function uo(t){return function(e){var n=An(e=Xs(e))?Mn(e):o,r=n?n[0]:e.charAt(0),i=n?Zi(n,1).join(""):e.slice(1);return r[t]()+i}}function lo(t){return function(e){return en(Su(gu(e).replace(me,"")),t,"")}}function co(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=dr(t.prototype),r=t.apply(n,e);return Ps(r)?r:n}}function ho(t){return function(e,n,r){var i=ee(e);if(!_s(e)){var a=No(n,3);e=iu(e),n=function(t){return a(i[t],t,i)}}var s=t(e,n,r);return s>-1?i[a?e[s]:s]:o}}function po(t){return Oo((function(e){var n=e.length,r=n,i=gr.prototype.thru;for(t&&e.reverse();r--;){var a=e[r];if("function"!=typeof a)throw new ie(u);if(i&&!s&&"wrapper"==Lo(a))var s=new gr([],!0)}for(r=s?r:n;++r<n;){var l=Lo(a=e[r]),c="wrapper"==l?Ro(a):o;s=c&&Ko(c[0])&&c[1]==(S|b|w|A)&&!c[4].length&&1==c[9]?s[Lo(c[0])].apply(s,c[3]):1==a.length&&Ko(a)?s[l]():s.thru(a)}return function(){var t=arguments,r=t[0];if(s&&1==t.length&&ys(r))return s.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))}function fo(t,e,n,i,a,s,u,l,c,h){var p=e&S,f=e&y,d=e&m,v=e&(b|x),g=e&T,_=d?o:co(t);return function y(){for(var m=arguments.length,b=r(m),x=m;x--;)b[x]=arguments[x];if(v)var w=Fo(y),E=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(b,w);if(i&&(b=to(b,i,a,v)),s&&(b=eo(b,s,u,v)),m-=E,v&&m<h){var S=kn(b,w);return xo(t,e,fo,y.placeholder,n,b,S,l,c,h-m)}var A=f?n:this,T=d?A[t]:t;return m=b.length,l?b=function(t,e){var n=t.length,r=Hn(e.length,n),i=no(t);for(;r--;){var a=e[r];t[r]=Ho(a,n)?i[a]:o}return t}(b,l):g&&m>1&&b.reverse(),p&&c<m&&(b.length=c),this&&this!==Re&&this instanceof y&&(T=_||co(T)),T.apply(A,b)}}function vo(t,e){return function(n,r){return function(t,e,n,r){return qr(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function go(t,e){return function(n,r){var i;if(n===o&&r===o)return e;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=Ni(n),r=Ni(r)):(n=Fi(n),r=Fi(r)),i=t(n,r)}return i}}function yo(t){return Oo((function(e){return e=$e(e,yn(No())),Ei((function(n){var r=this;return t(e,(function(t){return Xe(t,r,n)}))}))}))}function mo(t,e){var n=(e=e===o?" ":Ni(e)).length;if(n<2)return n?wi(e,t):e;var r=wi(e,Dn(t/In(e)));return An(e)?Zi(Mn(r),0,t).join(""):r.slice(0,t)}function _o(t){return function(e,n,i){return i&&"number"!=typeof i&&qo(e,n,i)&&(n=i=o),e=Bs(e),n===o?(n=e,e=0):n=Bs(n),function(t,e,n,i){for(var o=-1,a=Xn(Dn((e-t)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=t,t+=n;return s}(e,n,i=i===o?e<n?1:-1:Bs(i),t)}}function bo(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Gs(e),n=Gs(n)),t(e,n)}}function xo(t,e,n,r,i,a,s,u,l,c){var h=e&b;e|=h?w:E,(e&=~(h?E:w))&_||(e&=~(y|m));var p=[t,e,i,h?a:o,h?s:o,h?o:a,h?o:s,u,l,c],f=n.apply(o,p);return Ko(t)&&ra(f,p),f.placeholder=r,aa(f,t,e)}function wo(t){var e=te[t];return function(t,n){if(t=Gs(t),(n=null==n?0:Hn(Us(n),292))&&Vn(t)){var r=(Xs(t)+"e").split("e");return+((r=(Xs(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Eo=tr&&1/Cn(new tr([,-0]))[1]==R?function(t){return new tr(t)}:Fu;function So(t){return function(e){var n=Vo(e);return n==Y?Tn(e):n==nt?On(e):function(t,e){return $e(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ao(t,e,n,i,a,s,l,c){var p=e&m;if(!p&&"function"!=typeof t)throw new ie(u);var f=i?i.length:0;if(f||(e&=~(w|E),i=a=o),l=l===o?l:Xn(Us(l),0),c=c===o?c:Us(c),f-=a?a.length:0,e&E){var d=i,v=a;i=a=o}var g=p?o:Ro(t),T=[t,e,n,i,a,d,v,s,l,c];if(g&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<(y|m|S),a=r==S&&n==b||r==S&&n==A&&t[7].length<=e[8]||r==(S|A)&&e[7].length<=e[8]&&n==b;if(!o&&!a)return t;r&y&&(t[2]=e[2],i|=n&y?0:_);var s=e[3];if(s){var u=t[3];t[3]=u?to(u,s,e[4]):s,t[4]=u?kn(t[3],h):e[4]}(s=e[5])&&(u=t[5],t[5]=u?eo(u,s,e[6]):s,t[6]=u?kn(t[5],h):e[6]);(s=e[7])&&(t[7]=s);r&S&&(t[8]=null==t[8]?e[8]:Hn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(T,g),t=T[0],e=T[1],n=T[2],i=T[3],a=T[4],!(c=T[9]=T[9]===o?p?0:t.length:Xn(T[9]-f,0))&&e&(b|x)&&(e&=~(b|x)),e&&e!=y)P=e==b||e==x?function(t,e,n){var i=co(t);return function a(){for(var s=arguments.length,u=r(s),l=s,c=Fo(a);l--;)u[l]=arguments[l];var h=s<3&&u[0]!==c&&u[s-1]!==c?[]:kn(u,c);return(s-=h.length)<n?xo(t,e,fo,a.placeholder,o,u,h,o,o,n-s):Xe(this&&this!==Re&&this instanceof a?i:t,this,u)}}(t,e,c):e!=w&&e!=(y|w)||a.length?fo.apply(o,T):function(t,e,n,i){var o=e&y,a=co(t);return function e(){for(var s=-1,u=arguments.length,l=-1,c=i.length,h=r(c+u),p=this&&this!==Re&&this instanceof e?a:t;++l<c;)h[l]=i[l];for(;u--;)h[l++]=arguments[++s];return Xe(p,o?n:this,h)}}(t,e,n,i);else var P=function(t,e,n){var r=e&y,i=co(t);return function e(){return(this&&this!==Re&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return aa((g?Pi:ra)(P,T),t,e)}function To(t,e,n,r){return t===o||fs(t,se[n])&&!ce.call(r,n)?e:t}function Po(t,e,n,r,i,a){return Ps(t)&&Ps(e)&&(a.set(e,t),vi(t,e,o,Po,a),a.delete(e)),t}function ko(t){return Is(t)?o:t}function Co(t,e,n,r,i,a){var s=n&v,u=t.length,l=e.length;if(u!=l&&!(s&&l>u))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var h=-1,p=!0,f=n&g?new xr:o;for(a.set(t,e),a.set(e,t);++h<u;){var d=t[h],y=e[h];if(r)var m=s?r(y,d,h,e,t,a):r(d,y,h,t,e,a);if(m!==o){if(m)continue;p=!1;break}if(f){if(!rn(e,(function(t,e){if(!_n(f,e)&&(d===t||i(d,t,n,r,a)))return f.push(e)}))){p=!1;break}}else if(d!==y&&!i(d,y,n,r,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function Oo(t){return oa(ta(t,o,ma),t+"")}function Io(t){return Jr(t,iu,Bo)}function Mo(t){return Jr(t,ou,Uo)}var Ro=rr?function(t){return rr.get(t)}:Fu;function Lo(t){for(var e=t.name+"",n=ir[e],r=ce.call(ir,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Fo(t){return(ce.call(fr,"placeholder")?fr:t).placeholder}function No(){var t=fr.iteratee||Iu;return t=t===Iu?ui:t,arguments.length?t(arguments[0],arguments[1]):t}function jo(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Do(t){for(var e=iu(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Qo(i)]}return e}function zo(t,e){var n=function(t,e){return null==t?o:t[e]}(t,e);return si(n)?n:o}var Bo=Bn?function(t){return null==t?[]:(t=ee(t),Ye(Bn(t),(function(e){return Le.call(t,e)})))}:Vu,Uo=Bn?function(t){for(var e=[];t;)tn(e,Bo(t)),t=Ie(t);return e}:Vu,Vo=Qr;function Go(t,e,n){for(var r=-1,i=(e=Hi(e,t)).length,o=!1;++r<i;){var a=ca(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&Ts(i)&&Ho(a,i)&&(ys(t)||gs(t))}function Wo(t){return"function"!=typeof t.constructor||Jo(t)?{}:dr(Ie(t))}function Xo(t){return ys(t)||gs(t)||!!(je&&t&&t[je])}function Ho(t,e){var n=typeof t;return!!(e=null==e?L:e)&&("number"==n||"symbol"!=n&&Zt.test(t))&&t>-1&&t%1==0&&t<e}function qo(t,e,n){if(!Ps(n))return!1;var r=typeof e;return!!("number"==r?_s(n)&&Ho(e,n.length):"string"==r&&e in n)&&fs(n[e],t)}function Zo(t,e){if(ys(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Fs(t))||(Ot.test(t)||!Ct.test(t)||null!=e&&t in ee(e))}function Ko(t){var e=Lo(t),n=fr[e];if("function"!=typeof n||!(e in yr.prototype))return!1;if(t===n)return!0;var r=Ro(n);return!!r&&t===r[0]}(Jn&&Vo(new Jn(new ArrayBuffer(1)))!=lt||Qn&&Vo(new Qn)!=Y||$n&&"[object Promise]"!=Vo($n.resolve())||tr&&Vo(new tr)!=nt||er&&Vo(new er)!=at)&&(Vo=function(t){var e=Qr(t),n=e==$?t.constructor:o,r=n?ha(n):"";if(r)switch(r){case or:return lt;case ar:return Y;case sr:return"[object Promise]";case ur:return nt;case lr:return at}return e});var Yo=ue?Ss:Gu;function Jo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||se)}function Qo(t){return t==t&&!Ps(t)}function $o(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==o||t in ee(n)))}}function ta(t,e,n){return e=Xn(e===o?t.length-1:e,0),function(){for(var i=arguments,o=-1,a=Xn(i.length-e,0),s=r(a);++o<a;)s[o]=i[e+o];o=-1;for(var u=r(e+1);++o<e;)u[o]=i[o];return u[e]=n(s),Xe(t,this,u)}}function ea(t,e){return e.length<2?t:Yr(t,Oi(e,0,-1))}function na(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ra=sa(Pi),ia=jn||function(t,e){return Re.setTimeout(t,e)},oa=sa(ki);function aa(t,e,n){var r=e+"";return oa(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(jt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return qe(B,(function(n){var r="_."+n[0];e&n[1]&&!Je(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(Dt);return e?e[1].split(zt):[]}(r),n)))}function sa(t){var e=0,n=0;return function(){var r=qn(),i=O-(r-n);if(n=r,i>0){if(++e>=C)return arguments[0]}else e=0;return t.apply(o,arguments)}}function ua(t,e){var n=-1,r=t.length,i=r-1;for(e=e===o?r:e;++n<e;){var a=xi(n,i),s=t[a];t[a]=t[n],t[n]=s}return t.length=e,t}var la=function(t){var e=ss(t,(function(t){return n.size===c&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(It,(function(t,n,r,i){e.push(r?i.replace(Ut,"$1"):n||t)})),e}));function ca(t){if("string"==typeof t||Fs(t))return t;var e=t+"";return"0"==e&&1/t==-R?"-0":e}function ha(t){if(null!=t){try{return le.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function pa(t){if(t instanceof yr)return t.clone();var e=new gr(t.__wrapped__,t.__chain__);return e.__actions__=no(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var fa=Ei((function(t,e){return bs(t)?Dr(t,Wr(e,1,bs,!0)):[]})),da=Ei((function(t,e){var n=Ea(e);return bs(n)&&(n=o),bs(t)?Dr(t,Wr(e,1,bs,!0),No(n,2)):[]})),va=Ei((function(t,e){var n=Ea(e);return bs(n)&&(n=o),bs(t)?Dr(t,Wr(e,1,bs,!0),o,n):[]}));function ga(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Us(n);return i<0&&(i=Xn(r+i,0)),sn(t,No(e,3),i)}function ya(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==o&&(i=Us(n),i=n<0?Xn(r+i,0):Hn(i,r-1)),sn(t,No(e,3),i,!0)}function ma(t){return(null==t?0:t.length)?Wr(t,1):[]}function _a(t){return t&&t.length?t[0]:o}var ba=Ei((function(t){var e=$e(t,Wi);return e.length&&e[0]===t[0]?ni(e):[]})),xa=Ei((function(t){var e=Ea(t),n=$e(t,Wi);return e===Ea(n)?e=o:n.pop(),n.length&&n[0]===t[0]?ni(n,No(e,2)):[]})),wa=Ei((function(t){var e=Ea(t),n=$e(t,Wi);return(e="function"==typeof e?e:o)&&n.pop(),n.length&&n[0]===t[0]?ni(n,o,e):[]}));function Ea(t){var e=null==t?0:t.length;return e?t[e-1]:o}var Sa=Ei(Aa);function Aa(t,e){return t&&t.length&&e&&e.length?_i(t,e):t}var Ta=Oo((function(t,e){var n=null==t?0:t.length,r=Rr(t,e);return bi(t,$e(e,(function(t){return Ho(t,n)?+t:t})).sort($i)),r}));function Pa(t){return null==t?t:Yn.call(t)}var ka=Ei((function(t){return ji(Wr(t,1,bs,!0))})),Ca=Ei((function(t){var e=Ea(t);return bs(e)&&(e=o),ji(Wr(t,1,bs,!0),No(e,2))})),Oa=Ei((function(t){var e=Ea(t);return e="function"==typeof e?e:o,ji(Wr(t,1,bs,!0),o,e)}));function Ia(t){if(!t||!t.length)return[];var e=0;return t=Ye(t,(function(t){if(bs(t))return e=Xn(t.length,e),!0})),gn(e,(function(e){return $e(t,pn(e))}))}function Ma(t,e){if(!t||!t.length)return[];var n=Ia(t);return null==e?n:$e(n,(function(t){return Xe(e,o,t)}))}var Ra=Ei((function(t,e){return bs(t)?Dr(t,e):[]})),La=Ei((function(t){return Vi(Ye(t,bs))})),Fa=Ei((function(t){var e=Ea(t);return bs(e)&&(e=o),Vi(Ye(t,bs),No(e,2))})),Na=Ei((function(t){var e=Ea(t);return e="function"==typeof e?e:o,Vi(Ye(t,bs),o,e)})),ja=Ei(Ia);var Da=Ei((function(t){var e=t.length,n=e>1?t[e-1]:o;return n="function"==typeof n?(t.pop(),n):o,Ma(t,n)}));function za(t){var e=fr(t);return e.__chain__=!0,e}function Ba(t,e){return e(t)}var Ua=Oo((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return Rr(e,t)};return!(e>1||this.__actions__.length)&&r instanceof yr&&Ho(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:Ba,args:[i],thisArg:o}),new gr(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(o),t}))):this.thru(i)}));var Va=io((function(t,e,n){ce.call(t,n)?++t[n]:Mr(t,n,1)}));var Ga=ho(ga),Wa=ho(ya);function Xa(t,e){return(ys(t)?qe:zr)(t,No(e,3))}function Ha(t,e){return(ys(t)?Ze:Br)(t,No(e,3))}var qa=io((function(t,e,n){ce.call(t,n)?t[n].push(e):Mr(t,n,[e])}));var Za=Ei((function(t,e,n){var i=-1,o="function"==typeof e,a=_s(t)?r(t.length):[];return zr(t,(function(t){a[++i]=o?Xe(e,t,n):ri(t,e,n)})),a})),Ka=io((function(t,e,n){Mr(t,n,e)}));function Ya(t,e){return(ys(t)?$e:pi)(t,No(e,3))}var Ja=io((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Qa=Ei((function(t,e){if(null==t)return[];var n=e.length;return n>1&&qo(t,e[0],e[1])?e=[]:n>2&&qo(e[0],e[1],e[2])&&(e=[e[0]]),yi(t,Wr(e,1),[])})),$a=Nn||function(){return Re.Date.now()};function ts(t,e,n){return e=n?o:e,e=t&&null==e?t.length:e,Ao(t,S,o,o,o,o,e)}function es(t,e){var n;if("function"!=typeof e)throw new ie(u);return t=Us(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=o),n}}var ns=Ei((function(t,e,n){var r=y;if(n.length){var i=kn(n,Fo(ns));r|=w}return Ao(t,r,e,n,i)})),rs=Ei((function(t,e,n){var r=y|m;if(n.length){var i=kn(n,Fo(rs));r|=w}return Ao(e,r,t,n,i)}));function is(t,e,n){var r,i,a,s,l,c,h=0,p=!1,f=!1,d=!0;if("function"!=typeof t)throw new ie(u);function v(e){var n=r,a=i;return r=i=o,h=e,s=t.apply(a,n)}function g(t){var n=t-c;return c===o||n>=e||n<0||f&&t-h>=a}function y(){var t=$a();if(g(t))return m(t);l=ia(y,function(t){var n=e-(t-c);return f?Hn(n,a-(t-h)):n}(t))}function m(t){return l=o,d&&r?v(t):(r=i=o,s)}function _(){var t=$a(),n=g(t);if(r=arguments,i=this,c=t,n){if(l===o)return function(t){return h=t,l=ia(y,e),p?v(t):s}(c);if(f)return Ki(l),l=ia(y,e),v(c)}return l===o&&(l=ia(y,e)),s}return e=Gs(e)||0,Ps(n)&&(p=!!n.leading,a=(f="maxWait"in n)?Xn(Gs(n.maxWait)||0,e):a,d="trailing"in n?!!n.trailing:d),_.cancel=function(){l!==o&&Ki(l),h=0,r=c=i=l=o},_.flush=function(){return l===o?s:m($a())},_}var os=Ei((function(t,e){return jr(t,1,e)})),as=Ei((function(t,e,n){return jr(t,Gs(e)||0,n)}));function ss(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ie(u);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(ss.Cache||br),n}function us(t){if("function"!=typeof t)throw new ie(u);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ss.Cache=br;var ls=qi((function(t,e){var n=(e=1==e.length&&ys(e[0])?$e(e[0],yn(No())):$e(Wr(e,1),yn(No()))).length;return Ei((function(r){for(var i=-1,o=Hn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return Xe(t,this,r)}))})),cs=Ei((function(t,e){var n=kn(e,Fo(cs));return Ao(t,w,o,e,n)})),hs=Ei((function(t,e){var n=kn(e,Fo(hs));return Ao(t,E,o,e,n)})),ps=Oo((function(t,e){return Ao(t,A,o,o,o,e)}));function fs(t,e){return t===e||t!=t&&e!=e}var ds=bo($r),vs=bo((function(t,e){return t>=e})),gs=ii(function(){return arguments}())?ii:function(t){return ks(t)&&ce.call(t,"callee")&&!Le.call(t,"callee")},ys=r.isArray,ms=ze?yn(ze):function(t){return ks(t)&&Qr(t)==ut};function _s(t){return null!=t&&Ts(t.length)&&!Ss(t)}function bs(t){return ks(t)&&_s(t)}var xs=Un||Gu,ws=Be?yn(Be):function(t){return ks(t)&&Qr(t)==X};function Es(t){if(!ks(t))return!1;var e=Qr(t);return e==q||e==H||"string"==typeof t.message&&"string"==typeof t.name&&!Is(t)}function Ss(t){if(!Ps(t))return!1;var e=Qr(t);return e==Z||e==K||e==G||e==tt}function As(t){return"number"==typeof t&&t==Us(t)}function Ts(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=L}function Ps(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ks(t){return null!=t&&"object"==typeof t}var Cs=Ue?yn(Ue):function(t){return ks(t)&&Vo(t)==Y};function Os(t){return"number"==typeof t||ks(t)&&Qr(t)==J}function Is(t){if(!ks(t)||Qr(t)!=$)return!1;var e=Ie(t);if(null===e)return!0;var n=ce.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&le.call(n)==de}var Ms=Ve?yn(Ve):function(t){return ks(t)&&Qr(t)==et};var Rs=Ge?yn(Ge):function(t){return ks(t)&&Vo(t)==nt};function Ls(t){return"string"==typeof t||!ys(t)&&ks(t)&&Qr(t)==rt}function Fs(t){return"symbol"==typeof t||ks(t)&&Qr(t)==it}var Ns=We?yn(We):function(t){return ks(t)&&Ts(t.length)&&!!Te[Qr(t)]};var js=bo(hi),Ds=bo((function(t,e){return t<=e}));function zs(t){if(!t)return[];if(_s(t))return Ls(t)?Mn(t):no(t);if(De&&t[De])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[De]());var e=Vo(t);return(e==Y?Tn:e==nt?Cn:fu)(t)}function Bs(t){return t?(t=Gs(t))===R||t===-R?(t<0?-1:1)*F:t==t?t:0:0===t?t:0}function Us(t){var e=Bs(t),n=e%1;return e==e?n?e-n:e:0}function Vs(t){return t?Lr(Us(t),0,j):0}function Gs(t){if("number"==typeof t)return t;if(Fs(t))return N;if(Ps(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ps(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Lt,"");var n=Xt.test(t);return n||qt.test(t)?Oe(t.slice(2),n?2:8):Wt.test(t)?N:+t}function Ws(t){return ro(t,ou(t))}function Xs(t){return null==t?"":Ni(t)}var Hs=oo((function(t,e){if(Jo(e)||_s(e))ro(e,iu(e),t);else for(var n in e)ce.call(e,n)&&kr(t,n,e[n])})),qs=oo((function(t,e){ro(e,ou(e),t)})),Zs=oo((function(t,e,n,r){ro(e,ou(e),t,r)})),Ks=oo((function(t,e,n,r){ro(e,iu(e),t,r)})),Ys=Oo(Rr);var Js=Ei((function(t,e){t=ee(t);var n=-1,r=e.length,i=r>2?e[2]:o;for(i&&qo(e[0],e[1],i)&&(r=1);++n<r;)for(var a=e[n],s=ou(a),u=-1,l=s.length;++u<l;){var c=s[u],h=t[c];(h===o||fs(h,se[c])&&!ce.call(t,c))&&(t[c]=a[c])}return t})),Qs=Ei((function(t){return t.push(o,Po),Xe(su,o,t)}));function $s(t,e,n){var r=null==t?o:Yr(t,e);return r===o?n:r}function tu(t,e){return null!=t&&Go(t,e,ei)}var eu=vo((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=fe.call(e)),t[e]=n}),Pu(Ou)),nu=vo((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=fe.call(e)),ce.call(t,e)?t[e].push(n):t[e]=[n]}),No),ru=Ei(ri);function iu(t){return _s(t)?Er(t):li(t)}function ou(t){return _s(t)?Er(t,!0):ci(t)}var au=oo((function(t,e,n){vi(t,e,n)})),su=oo((function(t,e,n,r){vi(t,e,n,r)})),uu=Oo((function(t,e){var n={};if(null==t)return n;var r=!1;e=$e(e,(function(e){return e=Hi(e,t),r||(r=e.length>1),e})),ro(t,Mo(t),n),r&&(n=Fr(n,p|f|d,ko));for(var i=e.length;i--;)Di(n,e[i]);return n}));var lu=Oo((function(t,e){return null==t?{}:function(t,e){return mi(t,e,(function(e,n){return tu(t,n)}))}(t,e)}));function cu(t,e){if(null==t)return{};var n=$e(Mo(t),(function(t){return[t]}));return e=No(e),mi(t,n,(function(t,n){return e(t,n[0])}))}var hu=So(iu),pu=So(ou);function fu(t){return null==t?[]:mn(t,iu(t))}var du=lo((function(t,e,n){return e=e.toLowerCase(),t+(n?vu(e):e)}));function vu(t){return Eu(Xs(t).toLowerCase())}function gu(t){return(t=Xs(t))&&t.replace(Kt,wn).replace(_e,"")}var yu=lo((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),mu=lo((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),_u=uo("toLowerCase");var bu=lo((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var xu=lo((function(t,e,n){return t+(n?" ":"")+Eu(e)}));var wu=lo((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Eu=uo("toUpperCase");function Su(t,e,n){return t=Xs(t),(e=n?o:e)===o?function(t){return Ee.test(t)}(t)?function(t){return t.match(xe)||[]}(t):function(t){return t.match(Bt)||[]}(t):t.match(e)||[]}var Au=Ei((function(t,e){try{return Xe(t,o,e)}catch(t){return Es(t)?t:new Qt(t)}})),Tu=Oo((function(t,e){return qe(e,(function(e){e=ca(e),Mr(t,e,ns(t[e],t))})),t}));function Pu(t){return function(){return t}}var ku=po(),Cu=po(!0);function Ou(t){return t}function Iu(t){return ui("function"==typeof t?t:Fr(t,p))}var Mu=Ei((function(t,e){return function(n){return ri(n,t,e)}})),Ru=Ei((function(t,e){return function(n){return ri(t,n,e)}}));function Lu(t,e,n){var r=iu(e),i=Kr(e,r);null!=n||Ps(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Kr(e,iu(e)));var o=!(Ps(n)&&"chain"in n&&!n.chain),a=Ss(t);return qe(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=no(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,tn([this.value()],arguments))})})),t}function Fu(){}var Nu=yo($e),ju=yo(Ke),Du=yo(rn);function zu(t){return Zo(t)?pn(ca(t)):function(t){return function(e){return Yr(e,t)}}(t)}var Bu=_o(),Uu=_o(!0);function Vu(){return[]}function Gu(){return!1}var Wu=go((function(t,e){return t+e}),0),Xu=wo("ceil"),Hu=go((function(t,e){return t/e}),1),qu=wo("floor");var Zu,Ku=go((function(t,e){return t*e}),1),Yu=wo("round"),Ju=go((function(t,e){return t-e}),0);return fr.after=function(t,e){if("function"!=typeof e)throw new ie(u);return t=Us(t),function(){if(--t<1)return e.apply(this,arguments)}},fr.ary=ts,fr.assign=Hs,fr.assignIn=qs,fr.assignInWith=Zs,fr.assignWith=Ks,fr.at=Ys,fr.before=es,fr.bind=ns,fr.bindAll=Tu,fr.bindKey=rs,fr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return ys(t)?t:[t]},fr.chain=za,fr.chunk=function(t,e,n){e=(n?qo(t,e,n):e===o)?1:Xn(Us(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var a=0,s=0,u=r(Dn(i/e));a<i;)u[s++]=Oi(t,a,a+=e);return u},fr.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},fr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return tn(ys(n)?no(n):[n],Wr(e,1))},fr.cond=function(t){var e=null==t?0:t.length,n=No();return t=e?$e(t,(function(t){if("function"!=typeof t[1])throw new ie(u);return[n(t[0]),t[1]]})):[],Ei((function(n){for(var r=-1;++r<e;){var i=t[r];if(Xe(i[0],this,n))return Xe(i[1],this,n)}}))},fr.conforms=function(t){return function(t){var e=iu(t);return function(n){return Nr(n,t,e)}}(Fr(t,p))},fr.constant=Pu,fr.countBy=Va,fr.create=function(t,e){var n=dr(t);return null==e?n:Ir(n,e)},fr.curry=function t(e,n,r){var i=Ao(e,b,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},fr.curryRight=function t(e,n,r){var i=Ao(e,x,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},fr.debounce=is,fr.defaults=Js,fr.defaultsDeep=Qs,fr.defer=os,fr.delay=as,fr.difference=fa,fr.differenceBy=da,fr.differenceWith=va,fr.drop=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,(e=n||e===o?1:Us(e))<0?0:e,r):[]},fr.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,0,(e=r-(e=n||e===o?1:Us(e)))<0?0:e):[]},fr.dropRightWhile=function(t,e){return t&&t.length?Bi(t,No(e,3),!0,!0):[]},fr.dropWhile=function(t,e){return t&&t.length?Bi(t,No(e,3),!0):[]},fr.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&qo(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=Us(n))<0&&(n=-n>i?0:i+n),(r=r===o||r>i?i:Us(r))<0&&(r+=i),r=n>r?0:Vs(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},fr.filter=function(t,e){return(ys(t)?Ye:Gr)(t,No(e,3))},fr.flatMap=function(t,e){return Wr(Ya(t,e),1)},fr.flatMapDeep=function(t,e){return Wr(Ya(t,e),R)},fr.flatMapDepth=function(t,e,n){return n=n===o?1:Us(n),Wr(Ya(t,e),n)},fr.flatten=ma,fr.flattenDeep=function(t){return(null==t?0:t.length)?Wr(t,R):[]},fr.flattenDepth=function(t,e){return(null==t?0:t.length)?Wr(t,e=e===o?1:Us(e)):[]},fr.flip=function(t){return Ao(t,T)},fr.flow=ku,fr.flowRight=Cu,fr.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},fr.functions=function(t){return null==t?[]:Kr(t,iu(t))},fr.functionsIn=function(t){return null==t?[]:Kr(t,ou(t))},fr.groupBy=qa,fr.initial=function(t){return(null==t?0:t.length)?Oi(t,0,-1):[]},fr.intersection=ba,fr.intersectionBy=xa,fr.intersectionWith=wa,fr.invert=eu,fr.invertBy=nu,fr.invokeMap=Za,fr.iteratee=Iu,fr.keyBy=Ka,fr.keys=iu,fr.keysIn=ou,fr.map=Ya,fr.mapKeys=function(t,e){var n={};return e=No(e,3),qr(t,(function(t,r,i){Mr(n,e(t,r,i),t)})),n},fr.mapValues=function(t,e){var n={};return e=No(e,3),qr(t,(function(t,r,i){Mr(n,r,e(t,r,i))})),n},fr.matches=function(t){return fi(Fr(t,p))},fr.matchesProperty=function(t,e){return di(t,Fr(e,p))},fr.memoize=ss,fr.merge=au,fr.mergeWith=su,fr.method=Mu,fr.methodOf=Ru,fr.mixin=Lu,fr.negate=us,fr.nthArg=function(t){return t=Us(t),Ei((function(e){return gi(e,t)}))},fr.omit=uu,fr.omitBy=function(t,e){return cu(t,us(No(e)))},fr.once=function(t){return es(2,t)},fr.orderBy=function(t,e,n,r){return null==t?[]:(ys(e)||(e=null==e?[]:[e]),ys(n=r?o:n)||(n=null==n?[]:[n]),yi(t,e,n))},fr.over=Nu,fr.overArgs=ls,fr.overEvery=ju,fr.overSome=Du,fr.partial=cs,fr.partialRight=hs,fr.partition=Ja,fr.pick=lu,fr.pickBy=cu,fr.property=zu,fr.propertyOf=function(t){return function(e){return null==t?o:Yr(t,e)}},fr.pull=Sa,fr.pullAll=Aa,fr.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,No(n,2)):t},fr.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,o,n):t},fr.pullAt=Ta,fr.range=Bu,fr.rangeRight=Uu,fr.rearg=ps,fr.reject=function(t,e){return(ys(t)?Ye:Gr)(t,us(No(e,3)))},fr.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=No(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return bi(t,i),n},fr.rest=function(t,e){if("function"!=typeof t)throw new ie(u);return Ei(t,e=e===o?e:Us(e))},fr.reverse=Pa,fr.sampleSize=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Us(e),(ys(t)?Ar:Ai)(t,e)},fr.set=function(t,e,n){return null==t?t:Ti(t,e,n)},fr.setWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:Ti(t,e,n,r)},fr.shuffle=function(t){return(ys(t)?Tr:Ci)(t)},fr.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&qo(t,e,n)?(e=0,n=r):(e=null==e?0:Us(e),n=n===o?r:Us(n)),Oi(t,e,n)):[]},fr.sortBy=Qa,fr.sortedUniq=function(t){return t&&t.length?Li(t):[]},fr.sortedUniqBy=function(t,e){return t&&t.length?Li(t,No(e,2)):[]},fr.split=function(t,e,n){return n&&"number"!=typeof n&&qo(t,e,n)&&(e=n=o),(n=n===o?j:n>>>0)?(t=Xs(t))&&("string"==typeof e||null!=e&&!Ms(e))&&!(e=Ni(e))&&An(t)?Zi(Mn(t),0,n):t.split(e,n):[]},fr.spread=function(t,e){if("function"!=typeof t)throw new ie(u);return e=null==e?0:Xn(Us(e),0),Ei((function(n){var r=n[e],i=Zi(n,0,e);return r&&tn(i,r),Xe(t,this,i)}))},fr.tail=function(t){var e=null==t?0:t.length;return e?Oi(t,1,e):[]},fr.take=function(t,e,n){return t&&t.length?Oi(t,0,(e=n||e===o?1:Us(e))<0?0:e):[]},fr.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?Oi(t,(e=r-(e=n||e===o?1:Us(e)))<0?0:e,r):[]},fr.takeRightWhile=function(t,e){return t&&t.length?Bi(t,No(e,3),!1,!0):[]},fr.takeWhile=function(t,e){return t&&t.length?Bi(t,No(e,3)):[]},fr.tap=function(t,e){return e(t),t},fr.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new ie(u);return Ps(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),is(t,e,{leading:r,maxWait:e,trailing:i})},fr.thru=Ba,fr.toArray=zs,fr.toPairs=hu,fr.toPairsIn=pu,fr.toPath=function(t){return ys(t)?$e(t,ca):Fs(t)?[t]:no(la(Xs(t)))},fr.toPlainObject=Ws,fr.transform=function(t,e,n){var r=ys(t),i=r||xs(t)||Ns(t);if(e=No(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:Ps(t)&&Ss(o)?dr(Ie(t)):{}}return(i?qe:qr)(t,(function(t,r,i){return e(n,t,r,i)})),n},fr.unary=function(t){return ts(t,1)},fr.union=ka,fr.unionBy=Ca,fr.unionWith=Oa,fr.uniq=function(t){return t&&t.length?ji(t):[]},fr.uniqBy=function(t,e){return t&&t.length?ji(t,No(e,2)):[]},fr.uniqWith=function(t,e){return e="function"==typeof e?e:o,t&&t.length?ji(t,o,e):[]},fr.unset=function(t,e){return null==t||Di(t,e)},fr.unzip=Ia,fr.unzipWith=Ma,fr.update=function(t,e,n){return null==t?t:zi(t,e,Xi(n))},fr.updateWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:zi(t,e,Xi(n),r)},fr.values=fu,fr.valuesIn=function(t){return null==t?[]:mn(t,ou(t))},fr.without=Ra,fr.words=Su,fr.wrap=function(t,e){return cs(Xi(e),t)},fr.xor=La,fr.xorBy=Fa,fr.xorWith=Na,fr.zip=ja,fr.zipObject=function(t,e){return Gi(t||[],e||[],kr)},fr.zipObjectDeep=function(t,e){return Gi(t||[],e||[],Ti)},fr.zipWith=Da,fr.entries=hu,fr.entriesIn=pu,fr.extend=qs,fr.extendWith=Zs,Lu(fr,fr),fr.add=Wu,fr.attempt=Au,fr.camelCase=du,fr.capitalize=vu,fr.ceil=Xu,fr.clamp=function(t,e,n){return n===o&&(n=e,e=o),n!==o&&(n=(n=Gs(n))==n?n:0),e!==o&&(e=(e=Gs(e))==e?e:0),Lr(Gs(t),e,n)},fr.clone=function(t){return Fr(t,d)},fr.cloneDeep=function(t){return Fr(t,p|d)},fr.cloneDeepWith=function(t,e){return Fr(t,p|d,e="function"==typeof e?e:o)},fr.cloneWith=function(t,e){return Fr(t,d,e="function"==typeof e?e:o)},fr.conformsTo=function(t,e){return null==e||Nr(t,e,iu(e))},fr.deburr=gu,fr.defaultTo=function(t,e){return null==t||t!=t?e:t},fr.divide=Hu,fr.endsWith=function(t,e,n){t=Xs(t),e=Ni(e);var r=t.length,i=n=n===o?r:Lr(Us(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},fr.eq=fs,fr.escape=function(t){return(t=Xs(t))&&At.test(t)?t.replace(Et,En):t},fr.escapeRegExp=function(t){return(t=Xs(t))&&Rt.test(t)?t.replace(Mt,"\\$&"):t},fr.every=function(t,e,n){var r=ys(t)?Ke:Ur;return n&&qo(t,e,n)&&(e=o),r(t,No(e,3))},fr.find=Ga,fr.findIndex=ga,fr.findKey=function(t,e){return an(t,No(e,3),qr)},fr.findLast=Wa,fr.findLastIndex=ya,fr.findLastKey=function(t,e){return an(t,No(e,3),Zr)},fr.floor=qu,fr.forEach=Xa,fr.forEachRight=Ha,fr.forIn=function(t,e){return null==t?t:Xr(t,No(e,3),ou)},fr.forInRight=function(t,e){return null==t?t:Hr(t,No(e,3),ou)},fr.forOwn=function(t,e){return t&&qr(t,No(e,3))},fr.forOwnRight=function(t,e){return t&&Zr(t,No(e,3))},fr.get=$s,fr.gt=ds,fr.gte=vs,fr.has=function(t,e){return null!=t&&Go(t,e,ti)},fr.hasIn=tu,fr.head=_a,fr.identity=Ou,fr.includes=function(t,e,n,r){t=_s(t)?t:fu(t),n=n&&!r?Us(n):0;var i=t.length;return n<0&&(n=Xn(i+n,0)),Ls(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&un(t,e,n)>-1},fr.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Us(n);return i<0&&(i=Xn(r+i,0)),un(t,e,i)},fr.inRange=function(t,e,n){return e=Bs(e),n===o?(n=e,e=0):n=Bs(n),function(t,e,n){return t>=Hn(e,n)&&t<Xn(e,n)}(t=Gs(t),e,n)},fr.invoke=ru,fr.isArguments=gs,fr.isArray=ys,fr.isArrayBuffer=ms,fr.isArrayLike=_s,fr.isArrayLikeObject=bs,fr.isBoolean=function(t){return!0===t||!1===t||ks(t)&&Qr(t)==W},fr.isBuffer=xs,fr.isDate=ws,fr.isElement=function(t){return ks(t)&&1===t.nodeType&&!Is(t)},fr.isEmpty=function(t){if(null==t)return!0;if(_s(t)&&(ys(t)||"string"==typeof t||"function"==typeof t.splice||xs(t)||Ns(t)||gs(t)))return!t.length;var e=Vo(t);if(e==Y||e==nt)return!t.size;if(Jo(t))return!li(t).length;for(var n in t)if(ce.call(t,n))return!1;return!0},fr.isEqual=function(t,e){return oi(t,e)},fr.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:o)?n(t,e):o;return r===o?oi(t,e,o,n):!!r},fr.isError=Es,fr.isFinite=function(t){return"number"==typeof t&&Vn(t)},fr.isFunction=Ss,fr.isInteger=As,fr.isLength=Ts,fr.isMap=Cs,fr.isMatch=function(t,e){return t===e||ai(t,e,Do(e))},fr.isMatchWith=function(t,e,n){return n="function"==typeof n?n:o,ai(t,e,Do(e),n)},fr.isNaN=function(t){return Os(t)&&t!=+t},fr.isNative=function(t){if(Yo(t))throw new Qt(s);return si(t)},fr.isNil=function(t){return null==t},fr.isNull=function(t){return null===t},fr.isNumber=Os,fr.isObject=Ps,fr.isObjectLike=ks,fr.isPlainObject=Is,fr.isRegExp=Ms,fr.isSafeInteger=function(t){return As(t)&&t>=-L&&t<=L},fr.isSet=Rs,fr.isString=Ls,fr.isSymbol=Fs,fr.isTypedArray=Ns,fr.isUndefined=function(t){return t===o},fr.isWeakMap=function(t){return ks(t)&&Vo(t)==at},fr.isWeakSet=function(t){return ks(t)&&Qr(t)==st},fr.join=function(t,e){return null==t?"":Gn.call(t,e)},fr.kebabCase=yu,fr.last=Ea,fr.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==o&&(i=(i=Us(n))<0?Xn(r+i,0):Hn(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):sn(t,cn,i,!0)},fr.lowerCase=mu,fr.lowerFirst=_u,fr.lt=js,fr.lte=Ds,fr.max=function(t){return t&&t.length?Vr(t,Ou,$r):o},fr.maxBy=function(t,e){return t&&t.length?Vr(t,No(e,2),$r):o},fr.mean=function(t){return hn(t,Ou)},fr.meanBy=function(t,e){return hn(t,No(e,2))},fr.min=function(t){return t&&t.length?Vr(t,Ou,hi):o},fr.minBy=function(t,e){return t&&t.length?Vr(t,No(e,2),hi):o},fr.stubArray=Vu,fr.stubFalse=Gu,fr.stubObject=function(){return{}},fr.stubString=function(){return""},fr.stubTrue=function(){return!0},fr.multiply=Ku,fr.nth=function(t,e){return t&&t.length?gi(t,Us(e)):o},fr.noConflict=function(){return Re._===this&&(Re._=ve),this},fr.noop=Fu,fr.now=$a,fr.pad=function(t,e,n){t=Xs(t);var r=(e=Us(e))?In(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return mo(zn(i),n)+t+mo(Dn(i),n)},fr.padEnd=function(t,e,n){t=Xs(t);var r=(e=Us(e))?In(t):0;return e&&r<e?t+mo(e-r,n):t},fr.padStart=function(t,e,n){t=Xs(t);var r=(e=Us(e))?In(t):0;return e&&r<e?mo(e-r,n)+t:t},fr.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Zn(Xs(t).replace(Ft,""),e||0)},fr.random=function(t,e,n){if(n&&"boolean"!=typeof n&&qo(t,e,n)&&(e=n=o),n===o&&("boolean"==typeof e?(n=e,e=o):"boolean"==typeof t&&(n=t,t=o)),t===o&&e===o?(t=0,e=1):(t=Bs(t),e===o?(e=t,t=0):e=Bs(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Kn();return Hn(t+i*(e-t+Ce("1e-"+((i+"").length-1))),e)}return xi(t,e)},fr.reduce=function(t,e,n){var r=ys(t)?en:dn,i=arguments.length<3;return r(t,No(e,4),n,i,zr)},fr.reduceRight=function(t,e,n){var r=ys(t)?nn:dn,i=arguments.length<3;return r(t,No(e,4),n,i,Br)},fr.repeat=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Us(e),wi(Xs(t),e)},fr.replace=function(){var t=arguments,e=Xs(t[0]);return t.length<3?e:e.replace(t[1],t[2])},fr.result=function(t,e,n){var r=-1,i=(e=Hi(e,t)).length;for(i||(i=1,t=o);++r<i;){var a=null==t?o:t[ca(e[r])];a===o&&(r=i,a=n),t=Ss(a)?a.call(t):a}return t},fr.round=Yu,fr.runInContext=t,fr.sample=function(t){return(ys(t)?Sr:Si)(t)},fr.size=function(t){if(null==t)return 0;if(_s(t))return Ls(t)?In(t):t.length;var e=Vo(t);return e==Y||e==nt?t.size:li(t).length},fr.snakeCase=bu,fr.some=function(t,e,n){var r=ys(t)?rn:Ii;return n&&qo(t,e,n)&&(e=o),r(t,No(e,3))},fr.sortedIndex=function(t,e){return Mi(t,e)},fr.sortedIndexBy=function(t,e,n){return Ri(t,e,No(n,2))},fr.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=Mi(t,e);if(r<n&&fs(t[r],e))return r}return-1},fr.sortedLastIndex=function(t,e){return Mi(t,e,!0)},fr.sortedLastIndexBy=function(t,e,n){return Ri(t,e,No(n,2),!0)},fr.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=Mi(t,e,!0)-1;if(fs(t[n],e))return n}return-1},fr.startCase=xu,fr.startsWith=function(t,e,n){return t=Xs(t),n=null==n?0:Lr(Us(n),0,t.length),e=Ni(e),t.slice(n,n+e.length)==e},fr.subtract=Ju,fr.sum=function(t){return t&&t.length?vn(t,Ou):0},fr.sumBy=function(t,e){return t&&t.length?vn(t,No(e,2)):0},fr.template=function(t,e,n){var r=fr.templateSettings;n&&qo(t,e,n)&&(e=o),t=Xs(t),e=Zs({},e,r,To);var i,a,s=Zs({},e.imports,r.imports,To),u=iu(s),l=mn(s,u),c=0,h=e.interpolate||Yt,p="__p += '",f=ne((e.escape||Yt).source+"|"+h.source+"|"+(h===kt?Vt:Yt).source+"|"+(e.evaluate||Yt).source+"|$","g"),d="//# sourceURL="+(ce.call(e,"sourceURL")?(e.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++Ae+"]")+"\n";t.replace(f,(function(e,n,r,o,s,u){return r||(r=o),p+=t.slice(c,u).replace(Jt,Sn),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e})),p+="';\n";var v=ce.call(e,"variable")&&e.variable;v||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(_t,""):p).replace(bt,"$1").replace(xt,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Au((function(){return $t(u,d+"return "+p).apply(o,l)}));if(g.source=p,Es(g))throw g;return g},fr.times=function(t,e){if((t=Us(t))<1||t>L)return[];var n=j,r=Hn(t,j);e=No(e),t-=j;for(var i=gn(r,e);++n<t;)e(n);return i},fr.toFinite=Bs,fr.toInteger=Us,fr.toLength=Vs,fr.toLower=function(t){return Xs(t).toLowerCase()},fr.toNumber=Gs,fr.toSafeInteger=function(t){return t?Lr(Us(t),-L,L):0===t?t:0},fr.toString=Xs,fr.toUpper=function(t){return Xs(t).toUpperCase()},fr.trim=function(t,e,n){if((t=Xs(t))&&(n||e===o))return t.replace(Lt,"");if(!t||!(e=Ni(e)))return t;var r=Mn(t),i=Mn(e);return Zi(r,bn(r,i),xn(r,i)+1).join("")},fr.trimEnd=function(t,e,n){if((t=Xs(t))&&(n||e===o))return t.replace(Nt,"");if(!t||!(e=Ni(e)))return t;var r=Mn(t);return Zi(r,0,xn(r,Mn(e))+1).join("")},fr.trimStart=function(t,e,n){if((t=Xs(t))&&(n||e===o))return t.replace(Ft,"");if(!t||!(e=Ni(e)))return t;var r=Mn(t);return Zi(r,bn(r,Mn(e))).join("")},fr.truncate=function(t,e){var n=P,r=k;if(Ps(e)){var i="separator"in e?e.separator:i;n="length"in e?Us(e.length):n,r="omission"in e?Ni(e.omission):r}var a=(t=Xs(t)).length;if(An(t)){var s=Mn(t);a=s.length}if(n>=a)return t;var u=n-In(r);if(u<1)return r;var l=s?Zi(s,0,u).join(""):t.slice(0,u);if(i===o)return l+r;if(s&&(u+=l.length-u),Ms(i)){if(t.slice(u).search(i)){var c,h=l;for(i.global||(i=ne(i.source,Xs(Gt.exec(i))+"g")),i.lastIndex=0;c=i.exec(h);)var p=c.index;l=l.slice(0,p===o?u:p)}}else if(t.indexOf(Ni(i),u)!=u){var f=l.lastIndexOf(i);f>-1&&(l=l.slice(0,f))}return l+r},fr.unescape=function(t){return(t=Xs(t))&&St.test(t)?t.replace(wt,Rn):t},fr.uniqueId=function(t){var e=++he;return Xs(t)+e},fr.upperCase=wu,fr.upperFirst=Eu,fr.each=Xa,fr.eachRight=Ha,fr.first=_a,Lu(fr,(Zu={},qr(fr,(function(t,e){ce.call(fr.prototype,e)||(Zu[e]=t)})),Zu),{chain:!1}),fr.VERSION="4.17.15",qe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){fr[t].placeholder=fr})),qe(["drop","take"],(function(t,e){yr.prototype[t]=function(n){n=n===o?1:Xn(Us(n),0);var r=this.__filtered__&&!e?new yr(this):this.clone();return r.__filtered__?r.__takeCount__=Hn(n,r.__takeCount__):r.__views__.push({size:Hn(n,j),type:t+(r.__dir__<0?"Right":"")}),r},yr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),qe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=n==I||3==n;yr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:No(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),qe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");yr.prototype[t]=function(){return this[n](1).value()[0]}})),qe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");yr.prototype[t]=function(){return this.__filtered__?new yr(this):this[n](1)}})),yr.prototype.compact=function(){return this.filter(Ou)},yr.prototype.find=function(t){return this.filter(t).head()},yr.prototype.findLast=function(t){return this.reverse().find(t)},yr.prototype.invokeMap=Ei((function(t,e){return"function"==typeof t?new yr(this):this.map((function(n){return ri(n,t,e)}))})),yr.prototype.reject=function(t){return this.filter(us(No(t)))},yr.prototype.slice=function(t,e){t=Us(t);var n=this;return n.__filtered__&&(t>0||e<0)?new yr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==o&&(n=(e=Us(e))<0?n.dropRight(-e):n.take(e-t)),n)},yr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},yr.prototype.toArray=function(){return this.take(j)},qr(yr.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=fr[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);i&&(fr.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,u=e instanceof yr,l=s[0],c=u||ys(e),h=function(t){var e=i.apply(fr,tn([t],s));return r&&p?e[0]:e};c&&n&&"function"==typeof l&&1!=l.length&&(u=c=!1);var p=this.__chain__,f=!!this.__actions__.length,d=a&&!p,v=u&&!f;if(!a&&c){e=v?e:new yr(this);var g=t.apply(e,s);return g.__actions__.push({func:Ba,args:[h],thisArg:o}),new gr(g,p)}return d&&v?t.apply(this,s):(g=this.thru(h),d?r?g.value()[0]:g.value():g)})})),qe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=oe[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);fr.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(ys(i)?i:[],t)}return this[n]((function(n){return e.apply(ys(n)?n:[],t)}))}})),qr(yr.prototype,(function(t,e){var n=fr[e];if(n){var r=n.name+"";ce.call(ir,r)||(ir[r]=[]),ir[r].push({name:e,func:n})}})),ir[fo(o,m).name]=[{name:"wrapper",func:o}],yr.prototype.clone=function(){var t=new yr(this.__wrapped__);return t.__actions__=no(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=no(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=no(this.__views__),t},yr.prototype.reverse=function(){if(this.__filtered__){var t=new yr(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},yr.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=ys(t),r=e<0,i=n?t.length:0,o=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Hn(e,t+a);break;case"takeRight":t=Xn(t,e-a)}}return{start:t,end:e}}(0,i,this.__views__),a=o.start,s=o.end,u=s-a,l=r?s:a-1,c=this.__iteratees__,h=c.length,p=0,f=Hn(u,this.__takeCount__);if(!n||!r&&i==u&&f==u)return Ui(t,this.__actions__);var d=[];t:for(;u--&&p<f;){for(var v=-1,g=t[l+=e];++v<h;){var y=c[v],m=y.iteratee,_=y.type,b=m(g);if(_==M)g=b;else if(!b){if(_==I)continue t;break t}}d[p++]=g}return d},fr.prototype.at=Ua,fr.prototype.chain=function(){return za(this)},fr.prototype.commit=function(){return new gr(this.value(),this.__chain__)},fr.prototype.next=function(){this.__values__===o&&(this.__values__=zs(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?o:this.__values__[this.__index__++]}},fr.prototype.plant=function(t){for(var e,n=this;n instanceof vr;){var r=pa(n);r.__index__=0,r.__values__=o,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},fr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof yr){var e=t;return this.__actions__.length&&(e=new yr(this)),(e=e.reverse()).__actions__.push({func:Ba,args:[Pa],thisArg:o}),new gr(e,this.__chain__)}return this.thru(Pa)},fr.prototype.toJSON=fr.prototype.valueOf=fr.prototype.value=function(){return Ui(this.__wrapped__,this.__actions__)},fr.prototype.first=fr.prototype.head,De&&(fr.prototype[De]=function(){return this}),fr}();Re._=Ln,(i=function(){return Ln}.call(e,n,e,r))===o||(r.exports=i)}).call(this)}).call(this,n(23),n(75)(t))},723:function(t,e,n){"use strict";var r=n(689),i=n(729),o=n.n(i),a=n(735),s=n.n(a),u=n(732),l=n(767),c=n(694),h=n(692),p=n(792),f=[0,0,0,0],d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],v=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],g=[0,0,0],y=[0,0,0],m=Object(l.a)((function(t){var e=t.viewport,n=t.devicePixelRatio,r=t.coordinateSystem,i=t.coordinateOrigin,a=e.zoom;Object(h.a)(a>=0);var l=function(t){var e,n=t.viewport,r=t.coordinateSystem,i=t.coordinateOrigin,a=t.coordinateZoom,l=n.viewMatrixUncentered,c=n.viewMatrix,h=n.projectionMatrix,v=n.viewProjectionMatrix;switch(r){case u.a.IDENTITY:case u.a.LNGLAT:e=f;break;case u.a.LNGLAT_OFFSETS:case u.a.METER_OFFSETS:var g=Object(p.g)(i,Math.pow(2,a));e=s()([],[g[0],g[1],0,1],v),c=l||c,v=o()([],h,c),v=o()([],v,d);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:c,viewProjectionMatrix:v,projectionCenter:e,cameraPos:n.cameraPosition}}({coordinateSystem:r,coordinateOrigin:i,coordinateZoom:a,viewport:e}),c=l.projectionCenter,v=l.viewProjectionMatrix,y=l.cameraPos;Object(h.a)(v,"Viewport missing modelViewProjectionMatrix");var m=e.getDistanceScales(),_=[e.width*n,e.height*n],b={project_uCoordinateSystem:r,project_uCenter:c,project_uViewportSize:_,project_uDevicePixelRatio:n,project_uFocalDistance:e.focalDistance||1,project_uPixelsPerMeter:m.pixelsPerMeter,project_uPixelsPerDegree:m.pixelsPerDegree,project_uPixelsPerUnit:m.pixelsPerMeter,project_uPixelsPerUnit2:g,project_uScale:e.scale,project_uViewProjectionMatrix:v,project_uCameraPosition:y};if(r===u.a.METER_OFFSETS){var x=e.getDistanceScales(i);b.project_uPixelsPerUnit=x.pixelsPerMeter,b.project_uPixelsPerUnit2=x.pixelsPerMeter2}if(r===u.a.LNGLAT_OFFSETS){var w=e.getDistanceScales(i);b.project_uPixelsPerUnit=w.pixelsPerDegree,b.project_uPixelsPerUnit2=w.pixelsPerDegree2}return b}));var _={};e.a={name:"project",dependencies:[r.n],vs:"".concat('// EXTERNAL CONSTANTS: these must match JavaScript constants in "src/core/lib/constants.js"\nconst float COORDINATE_SYSTEM_IDENTITY = 0.;\nconst float COORDINATE_SYSTEM_LNG_LAT = 1.;\nconst float COORDINATE_SYSTEM_METER_OFFSETS = 2.;\nconst float COORDINATE_SYSTEM_LNGLAT_OFFSETS = 3.;\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform vec3 project_uPixelsPerMeter;\nuniform vec3 project_uPixelsPerDegree;\nuniform vec3 project_uPixelsPerUnit;\nuniform vec3 project_uPixelsPerUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\n\n//\n// Scaling offsets - scales meters to "pixels"\n// Note the scalar version of project_scale is for scaling the z component only\n//\nfloat project_scale(float meters) {\n  return meters * project_uPixelsPerMeter.z;\n}\n\nvec2 project_scale(vec2 meters) {\n  return meters * project_uPixelsPerMeter.xy;\n}\n\nvec3 project_scale(vec3 meters) {\n  return meters * project_uPixelsPerMeter;\n}\n\nvec4 project_scale(vec4 meters) {\n  return vec4(meters.xyz * project_uPixelsPerMeter, meters.w);\n}\n\n//\n// Projecting normal - transform deltas from current coordinate system to\n// normals in the worldspace\n//\nvec3 project_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uPixelsPerDegree);\n  }\n  // Apply model matrix\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uPixelsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  vec3 pixelsPerUnit = project_uPixelsPerUnit + project_uPixelsPerUnit2 * offset.y;\n  return vec4(offset.xyz * pixelsPerUnit, offset.w);\n}\n\n//\n// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]\n//\nvec2 project_mercator_(vec2 lnglat) {\n  return vec2(\n    radians(lnglat.x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\n//\n// Projects lnglats (or meter offsets, depending on mode) to pixels\n//\nvec4 project_position(vec4 position) {\n  // TODO - why not simply subtract center and fall through?\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n\n  // METER_OFFSETS or IDENTITY\n  // Apply model matrix\n  vec4 position_modelspace = project_uModelMatrix * position;\n  return project_offset_(position_modelspace);\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0));\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0));\n  return projected_position.xy;\n}\n\n//\n// Projects from "world" coordinates to clip space.\n// Uses project_uViewProjectionMatrix\n//\nvec4 project_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    // Needs to be divided with project_uPixelsPerMeter\n    position.w *= project_uPixelsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\n\n// Returns a clip space offset that corresponds to a given number of **non-device** pixels\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio;\n  return vec4(offset * project_uFocalDistance, 0.0, 0.0);\n}\n').concat("float scale(float position) {\n  return project_scale(position);\n}\n\nvec2 scale(vec2 position) {\n  return project_scale(position);\n}\n\nvec3 scale(vec3 position) {\n  return project_scale(position);\n}\n\nvec4 scale(vec4 position) {\n  return project_scale(position);\n}\n\nvec2 preproject(vec2 position) {\n  return project_position(position);\n}\n\nvec3 preproject(vec3 position) {\n  return project_position(position);\n}\n\nvec4 preproject(vec4 position) {\n  return project_position(position);\n}\n\nvec4 project(vec4 position) {\n  return project_to_clipspace(position);\n}\n"),getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return t.viewport?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,n=t.devicePixelRatio,r=void 0===n?1:n,i=t.modelMatrix,o=void 0===i?null:i,a=t.coordinateSystem,s=void 0===a?u.a.LNGLAT:a,l=t.coordinateOrigin,p=void 0===l?y:l,f=t.projectionMode,d=t.positionOrigin;return Object(h.a)(e),void 0!==f&&c.a.removed("projectionMode","coordinateSystem"),void 0!==d&&c.a.removed("positionOrigin","coordinateOrigin"),Object.assign({project_uModelMatrix:o||v},m({viewport:e,devicePixelRatio:r,coordinateSystem:s,coordinateOrigin:p}))}(t):{}},deprecations:[{type:"uniform vec3",old:"selectedPickingColor",new:"luma.gl's picking module"},{type:"uniform float",old:"renderPickingBuffer",new:"luma.gl's picking module"},{type:"uniform float",old:"pickingEnabled",new:"luma.gl's picking module"},{type:"uniform float",old:"projectionMode",new:"project_uCoordinateSystem"},{type:"uniform vec4",old:"projectionCenter",new:"project_uCenter"},{type:"uniform vec2",old:"projectionOrigin"},{type:"uniform mat4",old:"modelMatrix",new:"project_uModelMatrix"},{type:"uniform mat4",old:"viewMatrix"},{type:"uniform mat4",old:"projectionMatrix",new:"project_uViewProjectionMatrix"},{type:"uniform vec3",old:"projectionPixelsPerUnit",new:"project_uPixelsPerUnit"},{type:"uniform float",old:"projectionScale",new:"project_uScale"},{type:"uniform vec2",old:"viewportSize",new:"project_uViewportSize"},{type:"uniform float",old:"devicePixelRatio",new:"project_uDevicePixelRatio"},{type:"uniform vec3",old:"cameraPos",new:"project_uCameraPosition"},{type:"function",old:"scale",new:"project_scale",deprecated:1},{type:"function",old:"preproject",new:"project_position",deprecated:1},{type:"function",old:"project",new:"project_to_clipspace",deprecated:1}]}},725:function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="object"!==(void 0===t?"undefined":r(t))||"[object process]"!=t+""||t.browser,o="undefined"==typeof window?n:window,a="undefined"==typeof document?{}:document,s=void 0===n?window:n,u="object"===(void 0===t?"undefined":r(t))?t:{};e.window=o,e.document=a,e.global=s,e.process=u,e.console=console,e.isBrowser=i,e.VERSION="1.0.4"}).call(this,n(211),n(23))},726:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},i=r.window||r.self||r.global,o=r.global||r.self||r.window}).call(this,n(23))},727:function(t,e,n){var r=n(869);t.exports=function(t,e,n,i){var o,a,s,u,l,c,h,p,f,d,v=e[0],g=e[1],y=e[2],m=i[0],_=i[1],b=i[2],x=n[0],w=n[1],E=n[2];if(Math.abs(v-x)<1e-6&&Math.abs(g-w)<1e-6&&Math.abs(y-E)<1e-6)return r(t);h=v-x,p=g-w,f=y-E,d=1/Math.sqrt(h*h+p*p+f*f),o=_*(f*=d)-b*(p*=d),a=b*(h*=d)-m*f,s=m*p-_*h,(d=Math.sqrt(o*o+a*a+s*s))?(o*=d=1/d,a*=d,s*=d):(o=0,a=0,s=0);u=p*s-f*a,l=f*o-h*s,c=h*a-p*o,(d=Math.sqrt(u*u+l*l+c*c))?(u*=d=1/d,l*=d,c*=d):(u=0,l=0,c=0);return t[0]=o,t[1]=u,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=p,t[7]=0,t[8]=s,t[9]=c,t[10]=f,t[11]=0,t[12]=-(o*v+a*g+s*y),t[13]=-(u*v+l*g+c*y),t[14]=-(h*v+p*g+f*y),t[15]=1,t}},728:function(t,e){t.exports=function(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t}},729:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],g=e[13],y=e[14],m=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*v,t[1]=_*i+b*u+x*p+w*g,t[2]=_*o+b*l+x*f+w*y,t[3]=_*a+b*c+x*d+w*m,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*r+b*s+x*h+w*v,t[5]=_*i+b*u+x*p+w*g,t[6]=_*o+b*l+x*f+w*y,t[7]=_*a+b*c+x*d+w*m,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*r+b*s+x*h+w*v,t[9]=_*i+b*u+x*p+w*g,t[10]=_*o+b*l+x*f+w*y,t[11]=_*a+b*c+x*d+w*m,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*r+b*s+x*h+w*v,t[13]=_*i+b*u+x*p+w*g,t[14]=_*o+b*l+x*f+w*y,t[15]=_*a+b*c+x*d+w*m,t}},730:function(t,e){t.exports=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},731:function(t,e){t.exports=function(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],g=n[1],y=n[2];e===t?(t[12]=e[0]*v+e[4]*g+e[8]*y+e[12],t[13]=e[1]*v+e[5]*g+e[9]*y+e[13],t[14]=e[2]*v+e[6]*g+e[10]*y+e[14],t[15]=e[3]*v+e[7]*g+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*v+s*g+h*y+e[12],t[13]=i*v+u*g+p*y+e[13],t[14]=o*v+l*g+f*y+e[14],t[15]=a*v+c*g+d*y+e[15]);return t}},732:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r={LNGLAT:1,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0}},734:function(t,e,n){"use strict";(function(t){var r=n(859);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=!("object"===(void 0===t?"undefined":i(t))&&"[object process]"===String(t)&&!t.browser)||r.a;e.a=o}).call(this,n(211))},735:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}},744:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.experimental=e.Stats=e.COLOR=e.Log=e.VERSION=void 0;var r=n(725);Object.defineProperty(e,"VERSION",{enumerable:!0,get:function(){return r.VERSION}});var i=n(852);Object.defineProperty(e,"Log",{enumerable:!0,get:function(){return l(i).default}});var o=n(797);Object.defineProperty(e,"COLOR",{enumerable:!0,get:function(){return o.COLOR}});var a=n(856);Object.defineProperty(e,"Stats",{enumerable:!0,get:function(){return l(a).default}}),n(857);var s=n(858),u=l(i);function l(t){return t&&t.__esModule?t:{default:t}}e.experimental={enableDOMLogging:s.enableDOMLogging};e.default=new u.default({id:"probe.gl"})},745:function(t,e){t.exports=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t}},746:function(t,e){t.exports=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t}},747:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o}));var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},748:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return c}));var r=n(806),i=n.n(r),o=n(735),a=n.n(o);function s(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function u(t,e){var n=a()([],e,t);return i()(n,n,1/n[3]),n}function l(t,e){var n=t%e;return n<0?e+n:n}function c(t,e,n){return n*e+(1-n)*t}},749:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"e",(function(){return s})),n.d(e,"b",(function(){return u})),n.d(e,"d",(function(){return l})),n.d(e,"g",(function(){return p}));var r=n(747);function i(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function o(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function a(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function l(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}var c,h,p=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t};c=new r.a(2),r.a!=Float32Array&&(c[0]=0,c[1]=0),h=c},750:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"DeckGL",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"ViewportController",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"autobind",{enumerable:!0,get:function(){return o.default}});var r=a(n(906)),i=a(n(908)),o=a(n(812));function a(t){return t&&t.__esModule?t:{default:t}}},757:function(t,e,n){"use strict";var r=n(723),i=n(732),o=n(735),a=n.n(o),s=n(900),u=n.n(s);function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(t,e){var n=l(e.projectFlat(t),2);return[n[0],n[1],(t[2]||0)*e.distanceScales.pixelsPerMeter[2]]}function h(t,e){var n,r=e.viewport,o=e.coordinateSystem,s=e.coordinateOrigin,h=e.modelMatrix,p=e.fromCoordinateSystem,f=e.fromCoordinateOrigin,d=l(t,3),v=d[0],g=d[1],y=d[2];if(h){var m=l(a()([],[v,g,y,1],h),3);v=m[0],g=m[1],y=m[2]}switch(void 0===p&&(p=o),void 0===f&&(f=s),p){case i.a.LNGLAT:n=c([v,g,y],r);break;case i.a.LNGLAT_OFFSETS:n=c([v+f[0],g+f[1],y+(f[2]||0)],r);break;case i.a.METER_OFFSETS:n=c(r.addMetersToLngLat(f,[v,g,y]),r);break;default:n=[v,g,y]}switch(o){case i.a.LNGLAT_OFFSETS:case i.a.METER_OFFSETS:var _=c(s,r);u()(n,n,_),n[1]=-n[1]}return n}var p=n(767),f=(e.a={name:"lighting",dependencies:[r.a],vs:"#define MAX_NUM_OF_LIGHTS 5\n\n// TODO these should be using lighting_ prefix\nuniform vec3 lighting_lightPositions[MAX_NUM_OF_LIGHTS];\nuniform vec2 lighting_lightStrengths[MAX_NUM_OF_LIGHTS];\nuniform float lighting_ambientRatio;\nuniform float lighting_diffuseRatio;\nuniform float lighting_specularRatio;\nuniform int lighting_numberOfLights;\n\nfloat lighting_getLightWeight(vec3 position_worldspace_vec3, vec3 normals_worldspace) {\n  float lightWeight = 0.0;\n\n  vec3 normals_worldspace_vec3 = normals_worldspace.xyz;\n\n  vec3 camera_pos_worldspace = project_uCameraPosition;\n  vec3 view_direction = normalize(camera_pos_worldspace - position_worldspace_vec3);\n\n  for (int i = 0; i < MAX_NUM_OF_LIGHTS; i++) {\n    if (i >= lighting_numberOfLights) {\n      break;\n    }\n    vec3 light_position_worldspace = lighting_lightPositions[i];\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace_vec3);\n\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normals_worldspace_vec3);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normals_worldspace_vec3, halfway_direction), 0.0);\n      specular = pow(specular_angle, 32.0);\n    }\n    lambertian = max(lambertian, 0.0);\n    lightWeight += (lighting_ambientRatio + lambertian * lighting_diffuseRatio + specular * lighting_specularRatio) *\n      lighting_lightStrengths[i].x;\n  }\n\n  return lightWeight;\n}\n\n// DEPRECATED - Backwards compatibility\n\nfloat getLightWeight(vec3 position_worldspace_vec3, vec3 normals_worldspace) {\n  return lighting_getLightWeight(position_worldspace_vec3, normals_worldspace);\n}\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;if(!t.lightSettings)return{};var e=t.lightSettings,n=e.numberOfLights,r=void 0===n?1:n,o=e.lightsPosition,a=void 0===o?d:o,s=e.lightsStrength,u=void 0===s?v:s,l=e.coordinateSystem,c=void 0===l?i.a.LNGLAT:l,h=e.coordinateOrigin,p=void 0===h?_:h,x=e.modelMatrix,w=void 0===x?null:x,E=e.ambientRatio,S=void 0===E?g:E,A=e.diffuseRatio,T=void 0===A?y:A,P=e.specularRatio,k=void 0===P?m:P;return{lighting_lightPositions:b({lightsPosition:a,numberOfLights:r,viewport:t.viewport,modelMatrix:w,coordinateSystem:t.coordinateSystem,coordinateOrigin:t.coordinateOrigin,fromCoordinateSystem:c,fromCoordinateOrigin:p}),lighting_lightStrengths:u,lighting_ambientRatio:S,lighting_diffuseRatio:T,lighting_specularRatio:k,lighting_numberOfLights:r}},deprecations:[{type:"function",old:"getLightWeight",new:"lighting_getLightWeight",deprecated:!0}]},{}),d=[-122.45,37.75,8e3],v=[2,0],g=.4,y=.6,m=.8,_=[0,0,0],b=Object(p.a)((function(t){for(var e=t.lightsPosition,n=t.numberOfLights,r=t.viewport,i=t.modelMatrix,o=t.coordinateSystem,a=t.coordinateOrigin,s=t.fromCoordinateSystem,u=t.fromCoordinateOrigin,l={viewport:r,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,fromCoordinateSystem:s,fromCoordinateOrigin:u},c=[],p=0;p<n;p++){var f=h(e.slice(3*p,3*p+3),l);c[3*p]=f[0],c[3*p+1]=f[1],c[3*p+2]=f[2]}return c}))},758:function(t,e,n){"use strict";var r=n(689),i=n(723),o=n(767),a=r.o.fp64ify,s=r.o.fp64ifyMatrix4,u=(e.a={name:"project64",dependencies:[i.a,r.o],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\n\n// longitude: lnglat_fp64.xy; latitude: lnglat_fp64.zw\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 worldPosition\n) {\n  // This is the local offset to the instance position\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_scale(position.z);\n\n  // Apply web mercator projection (depends on coordinate system imn use)\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 worldPosition64[4];\n  worldPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  worldPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  worldPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  worldPosition64[3] = vec2(1.0, 0.0);\n\n  worldPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_to_clipspace_fp64(worldPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 worldPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, worldPosition\n  );\n}\n",getUniforms:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.project_uViewProjectionMatrix,n=t.project_uScale;if(e&&n)return u({project_uViewProjectionMatrix:e,project_uScale:n});return{}},deprecations:[{type:"uniform vec2",old:"projectionFP64[16]",new:"project_uViewProjectionMatrixFP64"},{type:"uniform vec2",old:"projectionScaleFP64",new:"project64_uScale"}]},Object(o.a)((function(t){var e=t.project_uViewProjectionMatrix,n=t.project_uScale,r=s(e),i=a(n);return{project_uViewProjectionMatrixFP64:r,project64_uViewProjectionMatrix:r,project64_uScale:i}})))},759:function(t,e,n){"use strict";var r=n(747);var i,o;i=new r.a(4),r.a!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),o=i;function a(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(t,e){var n=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}([],e,t);return function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n}(n,n,1/n[3]),n}function u(t,e){var n=t%e;return n<0?e+n:n}function l(t,e,n){return n*e+(1-n)*t}n.d(e,"a",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return l}))},761:function(t,e,n){"use strict";var r=n(744);e.a=new r.Log({id:"luma"}).enable()},764:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],g=e[14],y=e[15],m=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*v-h*d,A=c*g-p*d,T=c*y-f*d,P=h*g-p*v,k=h*y-f*v,C=p*y-f*g,O=m*C-_*k+b*P+x*T-w*A+E*S;if(!O)return null;return O=1/O,t[0]=(s*C-u*k+l*P)*O,t[1]=(i*k-r*C-o*P)*O,t[2]=(v*E-g*w+y*x)*O,t[3]=(p*w-h*E-f*x)*O,t[4]=(u*T-a*C-l*A)*O,t[5]=(n*C-i*T+o*A)*O,t[6]=(g*b-d*E-y*_)*O,t[7]=(c*E-p*b+f*_)*O,t[8]=(a*k-s*T+l*S)*O,t[9]=(r*T-n*k-o*S)*O,t[10]=(d*w-v*b+y*m)*O,t[11]=(h*b-c*w-f*m)*O,t[12]=(s*A-a*P-u*S)*O,t[13]=(n*P-r*A+i*S)*O,t[14]=(v*_-d*x-g*m)*O,t[15]=(c*x-h*_+p*m)*O,t}},765:function(t,e){t.exports=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=o*i-l*r,t[1]=a*i-c*r,t[2]=s*i-h*r,t[3]=u*i-p*r,t[8]=o*r+l*i,t[9]=a*r+c*i,t[10]=s*r+h*i,t[11]=u*r+p*i,t}},766:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i="undefined"!=typeof window&&window.addEventListener,o=new Map,a=function(){return i&&window.__SEER_INITIALIZED__},s=function(t,e){var n=o.get(t),r=Date.now();return!!(n&&r-n<e)||(o.set(t,r),!1)},u=function(t){return function(e,n){if(!n||"object"!==(void 0===n?"undefined":r(n))||!t.has(n))return t.add(n),Object.prototype.toString.call(n).slice(8,-1).includes("Array")?Array.prototype.slice.call(n,0,20):n}},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i&&a()){var n=new Set,r=JSON.stringify(e,u(n));try{window.postMessage({type:t,payload:r,source:"seer-agent"},"*")}catch(t){if(s("seer-log",2e3))return;console.log(t)}}},c=new Map,h=function(t){if(t&&t.data&&"seer-core"===t.data.source){var e=t.data,n=e.type,r=e.payload,i=c.get(n);i&&i.forEach((function(t){return t(r)}))}},p=function(){i&&!window.__SEER_LISTENER__&&(window.addEventListener("message",h),window.__SEER_LISTENER__=!0)};e.default={send:l,throttle:s,isReady:a,list:function(t,e){return l("LIST",{key:t,data:e})},listItem:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l("LIST_ITEM",{key:t,itemKey:e,data:n})},updateItem:function(t,e,n,r){return l("UPDATE_ITEM",{key:t,itemKey:e,path:n,data:r})},multiUpdate:function(t,e,n){return l("MULTI_UPDATE_ITEM",{key:t,itemKey:e,array:n})},deleteItem:function(t,e){return l("DELETE_ITEM",{key:t,itemKey:e})},addLog:function(t,e,n){return l("ADD_LOG",{key:t,itemKey:e,msg:n})},listeners:c,listenFor:function(t,e){if(i){if(!t||!e)throw new Error("Please provide a type and callback");c.has(t)||c.set(t,[]),window.__SEER_LISTENER__||p(),c.get(t).push(e)}},removeListener:function(t){c.forEach((function(e,n){c.set(n,e.filter((function(e){return e!==t})))}))},init:p,clean:function(){i&&window.__SEER_LISTENER__&&(window.removeEventListener("message",h),delete window.__SEER_LISTENER__)}}},767:function(t,e,n){"use strict";function r(t,e){if(t===e)return!0;if(Array.isArray(t)){var n=t.length;if(!e||e.length!==n)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function i(t){var e,n={};return function(i){for(var o in i)if(!r(i[o],n[o])){e=t(i),n=i;break}return e}}n.d(e,"a",(function(){return i}))},768:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return a})),n.d(e,"c",(function(){return u}));var r={};function i(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function o(t){return Math.round(t/r.EPSILON)*r.EPSILON}function a(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===e?r.precision||4:e;return t=o(t),parseFloat(t.toPrecision(n))}function s(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function u(t,e){if(s(t)&&s(e)){if(t===e)return!0;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!u(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}r.EPSILON=1e-12,r.debug=!0,r.precision=4,r.printTypes=!1,r.printDegrees=!1,r.printRowMajor=!0},769:function(module,exports){var indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},Object_keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)e.push(n);return e},forEach=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(t,e,n){Object.defineProperty(t,e,{writable:!0,enumerable:!1,configurable:!0,value:n})}}catch(t){return function(t,e,n){t[e]=n}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(t){if(!(this instanceof Script))return new Script(t);this.code=t};Script.prototype.runInContext=function(t){if(!(t instanceof Context))throw new TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var n=e.contentWindow,r=n.eval,i=n.execScript;!r&&i&&(i.call(n,"null"),r=n.eval),forEach(Object_keys(t),(function(e){n[e]=t[e]})),forEach(globals,(function(e){t[e]&&(n[e]=t[e])}));var o=Object_keys(n),a=r.call(n,this.code);return forEach(Object_keys(n),(function(e){(e in t||-1===indexOf(o,e))&&(t[e]=n[e])})),forEach(globals,(function(e){e in t||defineProp(t,e,n[e])})),document.body.removeChild(e),a},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(t){var e=Script.createContext(t),n=this.runInContext(e);return t&&forEach(Object_keys(e),(function(n){t[n]=e[n]})),n},forEach(Object_keys(Script.prototype),(function(t){exports[t]=Script[t]=function(e){var n=Script(e);return n[t].apply(n,[].slice.call(arguments,1))}})),exports.isContext=function(t){return t instanceof Context},exports.createScript=function(t){return exports.Script(t)},exports.createContext=Script.createContext=function(t){var e=new Context;return"object"==typeof t&&forEach(Object_keys(t),(function(n){e[n]=t[n]})),e}},770:function(t,e,n){(function(t,n){var r;!function(){var i="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||this||{},o=i._,a=Array.prototype,s=Object.prototype,u="undefined"!=typeof Symbol?Symbol.prototype:null,l=a.push,c=a.slice,h=s.toString,p=s.hasOwnProperty,f=Array.isArray,d=Object.keys,v=Object.create,g=function(){},y=function(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)};e.nodeType?i._=y:(!n.nodeType&&n.exports&&(e=n.exports=y),e._=y),y.VERSION="1.9.1";var m,_=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}},b=function(t,e,n){return y.iteratee!==m?y.iteratee(t,e):null==t?y.identity:y.isFunction(t)?_(t,e,n):y.isObject(t)&&!y.isArray(t)?y.matcher(t):y.property(t)};y.iteratee=m=function(t,e){return b(t,e,1/0)};var x=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var o=Array(e+1);for(i=0;i<e;i++)o[i]=arguments[i];return o[e]=r,t.apply(this,o)}},w=function(t){if(!y.isObject(t))return{};if(v)return v(t);g.prototype=t;var e=new g;return g.prototype=null,e},E=function(t){return function(e){return null==e?void 0:e[t]}},S=function(t,e){return null!=t&&p.call(t,e)},A=function(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0},T=Math.pow(2,53)-1,P=E("length"),k=function(t){var e=P(t);return"number"==typeof e&&e>=0&&e<=T};y.each=y.forEach=function(t,e,n){var r,i;if(e=_(e,n),k(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=y.keys(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t},y.map=y.collect=function(t,e,n){e=b(e,n);for(var r=!k(t)&&y.keys(t),i=(r||t).length,o=Array(i),a=0;a<i;a++){var s=r?r[a]:a;o[a]=e(t[s],s,t)}return o};var C=function(t){var e=function(e,n,r,i){var o=!k(e)&&y.keys(e),a=(o||e).length,s=t>0?0:a-1;for(i||(r=e[o?o[s]:s],s+=t);s>=0&&s<a;s+=t){var u=o?o[s]:s;r=n(r,e[u],u,e)}return r};return function(t,n,r,i){var o=arguments.length>=3;return e(t,_(n,i,4),r,o)}};y.reduce=y.foldl=y.inject=C(1),y.reduceRight=y.foldr=C(-1),y.find=y.detect=function(t,e,n){var r=(k(t)?y.findIndex:y.findKey)(t,e,n);if(void 0!==r&&-1!==r)return t[r]},y.filter=y.select=function(t,e,n){var r=[];return e=b(e,n),y.each(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r},y.reject=function(t,e,n){return y.filter(t,y.negate(b(e)),n)},y.every=y.all=function(t,e,n){e=b(e,n);for(var r=!k(t)&&y.keys(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(!e(t[a],a,t))return!1}return!0},y.some=y.any=function(t,e,n){e=b(e,n);for(var r=!k(t)&&y.keys(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(e(t[a],a,t))return!0}return!1},y.contains=y.includes=y.include=function(t,e,n,r){return k(t)||(t=y.values(t)),("number"!=typeof n||r)&&(n=0),y.indexOf(t,e,n)>=0},y.invoke=x((function(t,e,n){var r,i;return y.isFunction(e)?i=e:y.isArray(e)&&(r=e.slice(0,-1),e=e[e.length-1]),y.map(t,(function(t){var o=i;if(!o){if(r&&r.length&&(t=A(t,r)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))})),y.pluck=function(t,e){return y.map(t,y.property(e))},y.where=function(t,e){return y.filter(t,y.matcher(e))},y.findWhere=function(t,e){return y.find(t,y.matcher(e))},y.max=function(t,e,n){var r,i,o=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,u=(t=k(t)?t:y.values(t)).length;s<u;s++)null!=(r=t[s])&&r>o&&(o=r);else e=b(e,n),y.each(t,(function(t,n,r){((i=e(t,n,r))>a||i===-1/0&&o===-1/0)&&(o=t,a=i)}));return o},y.min=function(t,e,n){var r,i,o=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var s=0,u=(t=k(t)?t:y.values(t)).length;s<u;s++)null!=(r=t[s])&&r<o&&(o=r);else e=b(e,n),y.each(t,(function(t,n,r){((i=e(t,n,r))<a||i===1/0&&o===1/0)&&(o=t,a=i)}));return o},y.shuffle=function(t){return y.sample(t,1/0)},y.sample=function(t,e,n){if(null==e||n)return k(t)||(t=y.values(t)),t[y.random(t.length-1)];var r=k(t)?y.clone(t):y.values(t),i=P(r);e=Math.max(Math.min(e,i),0);for(var o=i-1,a=0;a<e;a++){var s=y.random(a,o),u=r[a];r[a]=r[s],r[s]=u}return r.slice(0,e)},y.sortBy=function(t,e,n){var r=0;return e=b(e,n),y.pluck(y.map(t,(function(t,n,i){return{value:t,index:r++,criteria:e(t,n,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")};var O=function(t,e){return function(n,r,i){var o=e?[[],[]]:{};return r=b(r,i),y.each(n,(function(e,i){var a=r(e,i,n);t(o,e,a)})),o}};y.groupBy=O((function(t,e,n){S(t,n)?t[n].push(e):t[n]=[e]})),y.indexBy=O((function(t,e,n){t[n]=e})),y.countBy=O((function(t,e,n){S(t,n)?t[n]++:t[n]=1}));var I=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;y.toArray=function(t){return t?y.isArray(t)?c.call(t):y.isString(t)?t.match(I):k(t)?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:k(t)?t.length:y.keys(t).length},y.partition=O((function(t,e,n){t[n?0:1].push(e)}),!0),y.first=y.head=y.take=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[0]:y.initial(t,t.length-e)},y.initial=function(t,e,n){return c.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},y.last=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[t.length-1]:y.rest(t,Math.max(0,t.length-e))},y.rest=y.tail=y.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},y.compact=function(t){return y.filter(t,Boolean)};var M=function(t,e,n,r){for(var i=(r=r||[]).length,o=0,a=P(t);o<a;o++){var s=t[o];if(k(s)&&(y.isArray(s)||y.isArguments(s)))if(e)for(var u=0,l=s.length;u<l;)r[i++]=s[u++];else M(s,e,n,r),i=r.length;else n||(r[i++]=s)}return r};y.flatten=function(t,e){return M(t,e,!1)},y.without=x((function(t,e){return y.difference(t,e)})),y.uniq=y.unique=function(t,e,n,r){y.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=b(n,r));for(var i=[],o=[],a=0,s=P(t);a<s;a++){var u=t[a],l=n?n(u,a,t):u;e&&!n?(a&&o===l||i.push(u),o=l):n?y.contains(o,l)||(o.push(l),i.push(u)):y.contains(i,u)||i.push(u)}return i},y.union=x((function(t){return y.uniq(M(t,!0,!0))})),y.intersection=function(t){for(var e=[],n=arguments.length,r=0,i=P(t);r<i;r++){var o=t[r];if(!y.contains(e,o)){var a;for(a=1;a<n&&y.contains(arguments[a],o);a++);a===n&&e.push(o)}}return e},y.difference=x((function(t,e){return e=M(e,!0,!0),y.filter(t,(function(t){return!y.contains(e,t)}))})),y.unzip=function(t){for(var e=t&&y.max(t,P).length||0,n=Array(e),r=0;r<e;r++)n[r]=y.pluck(t,r);return n},y.zip=x(y.unzip),y.object=function(t,e){for(var n={},r=0,i=P(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n};var R=function(t){return function(e,n,r){n=b(n,r);for(var i=P(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(n(e[o],o,e))return o;return-1}};y.findIndex=R(1),y.findLastIndex=R(-1),y.sortedIndex=function(t,e,n,r){for(var i=(n=b(n,r,1))(e),o=0,a=P(t);o<a;){var s=Math.floor((o+a)/2);n(t[s])<i?o=s+1:a=s}return o};var L=function(t,e,n){return function(r,i,o){var a=0,s=P(r);if("number"==typeof o)t>0?a=o>=0?o:Math.max(o+s,a):s=o>=0?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=e(c.call(r,a,s),y.isNaN))>=0?o+a:-1;for(o=t>0?a:s-1;o>=0&&o<s;o+=t)if(r[o]===i)return o;return-1}};y.indexOf=L(1,y.findIndex,y.sortedIndex),y.lastIndexOf=L(-1,y.findLastIndex),y.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i},y.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(c.call(t,r,r+=e));return n};var F=function(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=w(t.prototype),a=t.apply(o,i);return y.isObject(a)?a:o};y.bind=x((function(t,e,n){if(!y.isFunction(t))throw new TypeError("Bind must be called on a function");var r=x((function(i){return F(t,r,e,this,n.concat(i))}));return r})),y.partial=x((function(t,e){var n=y.partial.placeholder,r=function(){for(var i=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===n?arguments[i++]:e[s];for(;i<arguments.length;)a.push(arguments[i++]);return F(t,r,this,this,a)};return r})),y.partial.placeholder=y,y.bindAll=x((function(t,e){var n=(e=M(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=y.bind(t[r],t)}})),y.memoize=function(t,e){var n=function(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return S(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},y.delay=x((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),y.defer=y.partial(y.delay,y,1),y.throttle=function(t,e,n){var r,i,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:y.now(),r=null,a=t.apply(i,o),r||(i=o=null)},l=function(){var l=y.now();s||!1!==n.leading||(s=l);var c=e-(l-s);return i=this,o=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),s=l,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(u,c)),a};return l.cancel=function(){clearTimeout(r),s=0,r=i=o=null},l},y.debounce=function(t,e,n){var r,i,o=function(e,n){r=null,n&&(i=t.apply(e,n))},a=x((function(a){if(r&&clearTimeout(r),n){var s=!r;r=setTimeout(o,e),s&&(i=t.apply(this,a))}else r=y.delay(o,e,this,a);return i}));return a.cancel=function(){clearTimeout(r),r=null},a},y.wrap=function(t,e){return y.partial(e,t)},y.negate=function(t){return function(){return!t.apply(this,arguments)}},y.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},y.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},y.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},y.once=y.partial(y.before,2),y.restArguments=x;var N=!{toString:null}.propertyIsEnumerable("toString"),j=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],D=function(t,e){var n=j.length,r=t.constructor,i=y.isFunction(r)&&r.prototype||s,o="constructor";for(S(t,o)&&!y.contains(e,o)&&e.push(o);n--;)(o=j[n])in t&&t[o]!==i[o]&&!y.contains(e,o)&&e.push(o)};y.keys=function(t){if(!y.isObject(t))return[];if(d)return d(t);var e=[];for(var n in t)S(t,n)&&e.push(n);return N&&D(t,e),e},y.allKeys=function(t){if(!y.isObject(t))return[];var e=[];for(var n in t)e.push(n);return N&&D(t,e),e},y.values=function(t){for(var e=y.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r},y.mapObject=function(t,e,n){e=b(e,n);for(var r=y.keys(t),i=r.length,o={},a=0;a<i;a++){var s=r[a];o[s]=e(t[s],s,t)}return o},y.pairs=function(t){for(var e=y.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},y.invert=function(t){for(var e={},n=y.keys(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e},y.functions=y.methods=function(t){var e=[];for(var n in t)y.isFunction(t[n])&&e.push(n);return e.sort()};var z=function(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],a=t(o),s=a.length,u=0;u<s;u++){var l=a[u];e&&void 0!==n[l]||(n[l]=o[l])}return n}};y.extend=z(y.allKeys),y.extendOwn=y.assign=z(y.keys),y.findKey=function(t,e,n){e=b(e,n);for(var r,i=y.keys(t),o=0,a=i.length;o<a;o++)if(e(t[r=i[o]],r,t))return r};var B,U,V=function(t,e,n){return e in n};y.pick=x((function(t,e){var n={},r=e[0];if(null==t)return n;y.isFunction(r)?(e.length>1&&(r=_(r,e[1])),e=y.allKeys(t)):(r=V,e=M(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var a=e[i],s=t[a];r(s,a,t)&&(n[a]=s)}return n})),y.omit=x((function(t,e){var n,r=e[0];return y.isFunction(r)?(r=y.negate(r),e.length>1&&(n=e[1])):(e=y.map(M(e,!1,!1),String),r=function(t,n){return!y.contains(e,n)}),y.pick(t,r,n)})),y.defaults=z(y.allKeys,!0),y.create=function(t,e){var n=w(t);return e&&y.extendOwn(n,e),n},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t},y.isMatch=function(t,e){var n=y.keys(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var a=n[o];if(e[a]!==i[a]||!(a in i))return!1}return!0},B=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var i=typeof t;return("function"===i||"object"===i||"object"==typeof e)&&U(t,e,n,r)},U=function(t,e,n,r){t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var i=h.call(t);if(i!==h.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return u.valueOf.call(t)===u.valueOf.call(e)}var o="[object Array]"===i;if(!o){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,s=e.constructor;if(a!==s&&!(y.isFunction(a)&&a instanceof a&&y.isFunction(s)&&s instanceof s)&&"constructor"in t&&"constructor"in e)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===t)return r[l]===e;if(n.push(t),r.push(e),o){if((l=t.length)!==e.length)return!1;for(;l--;)if(!B(t[l],e[l],n,r))return!1}else{var c,p=y.keys(t);if(l=p.length,y.keys(e).length!==l)return!1;for(;l--;)if(c=p[l],!S(e,c)||!B(t[c],e[c],n,r))return!1}return n.pop(),r.pop(),!0},y.isEqual=function(t,e){return B(t,e)},y.isEmpty=function(t){return null==t||(k(t)&&(y.isArray(t)||y.isString(t)||y.isArguments(t))?0===t.length:0===y.keys(t).length)},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=f||function(t){return"[object Array]"===h.call(t)},y.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},y.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],(function(t){y["is"+t]=function(e){return h.call(e)==="[object "+t+"]"}})),y.isArguments(arguments)||(y.isArguments=function(t){return S(t,"callee")});var G=i.document&&i.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof G&&(y.isFunction=function(t){return"function"==typeof t||!1}),y.isFinite=function(t){return!y.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&isNaN(t)},y.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===h.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){if(!y.isArray(e))return S(t,e);for(var n=e.length,r=0;r<n;r++){var i=e[r];if(null==t||!p.call(t,i))return!1;t=t[i]}return!!n},y.noConflict=function(){return i._=o,this},y.identity=function(t){return t},y.constant=function(t){return function(){return t}},y.noop=function(){},y.property=function(t){return y.isArray(t)?function(e){return A(e,t)}:E(t)},y.propertyOf=function(t){return null==t?function(){}:function(e){return y.isArray(e)?A(t,e):t[e]}},y.matcher=y.matches=function(t){return t=y.extendOwn({},t),function(e){return y.isMatch(e,t)}},y.times=function(t,e,n){var r=Array(Math.max(0,t));e=_(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},y.now=Date.now||function(){return(new Date).getTime()};var W={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},X=y.invert(W),H=function(t){var e=function(e){return t[e]},n="(?:"+y.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}};y.escape=H(W),y.unescape=H(X),y.result=function(t,e,n){y.isArray(e)||(e=[e]);var r=e.length;if(!r)return y.isFunction(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=y.isFunction(o)?o.call(t):o}return t};var q=0;y.uniqueId=function(t){var e=++q+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Z=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Y=/\\|'|\r|\n|\u2028|\u2029/g,J=function(t){return"\\"+K[t]};y.template=function(t,e,n){!e&&n&&(e=n),e=y.defaults({},e,y.templateSettings);var r,i=RegExp([(e.escape||Z).source,(e.interpolate||Z).source,(e.evaluate||Z).source].join("|")+"|$","g"),o=0,a="__p+='";t.replace(i,(function(e,n,r,i,s){return a+=t.slice(o,s).replace(Y,J),o=s+e.length,n?a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(a+="';\n"+i+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var s=function(t){return r.call(this,t,y)},u=e.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s},y.chain=function(t){var e=y(t);return e._chain=!0,e};var Q=function(t,e){return t._chain?y(e).chain():e};y.mixin=function(t){return y.each(y.functions(t),(function(e){var n=y[e]=t[e];y.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),Q(this,n.apply(y,t))}})),y},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=a[t];y.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],Q(this,n)}})),y.each(["concat","join","slice"],(function(t){var e=a[t];y.prototype[t]=function(){return Q(this,e.apply(this._wrapped,arguments))}})),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return String(this._wrapped)},void 0===(r=function(){return y}.apply(e,[]))||(n.exports=r)}()}).call(this,n(23),n(75)(t))},771:function(t,e,n){"use strict";n.d(e,"i",(function(){return g})),n.d(e,"f",(function(){return y})),n.d(e,"d",(function(){return m})),n.d(e,"g",(function(){return _})),n.d(e,"a",(function(){return b})),n.d(e,"c",(function(){return x})),n.d(e,"b",(function(){return w})),n.d(e,"h",(function(){return E})),n.d(e,"e",(function(){return S}));var r=n(708),i=n(759),o=n(814),a=n(749),s=n(808),u=n(813),l=Math.PI,c=l/4,h=l/180,p=180/l,f=512,d=4003e4,v=1.5;function g(t){return Math.pow(2,t)}function y(t){return Math.log2(t)}function m(t,e){var n=Object(r.a)(t,2),i=n[0],o=n[1];Object(u.a)(Number.isFinite(i)&&Number.isFinite(e)),Object(u.a)(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");var a=o*h;return[(e*=f)*(i*h+l)/(2*l),e*(l-Math.log(Math.tan(c+.5*a)))/(2*l)]}function _(t,e){var n=Object(r.a)(t,2),i=n[0],o=n[1],a=i/(e*=f)*(2*l)-l,s=2*(Math.atan(Math.exp(l-o/e*(2*l)))-c);return[a*p,s*p]}function b(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:g(r),Object(u.a)(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},l=f*i,c=Math.cos(e*h),p=l/360,v=p/c,y=l/d/c;if(s.pixelsPerMeter=[y,-y,y],s.metersPerPixel=[1/y,-1/y,1/y],s.pixelsPerDegree=[p,-v,y],s.degreesPerPixel=[1/p,-1/v,1/y],a){var m=h*Math.tan(e*h)/c,_=p*m/2,b=l/d*m,x=b/v*y;s.pixelsPerDegree2=[0,-_,b],s.pixelsPerMeter2=[x,0,x]}return s}function x(t){var e=t.height,n=t.pitch,r=t.bearing,a=t.altitude,u=t.center,l=void 0===u?null:u,c=t.flipY,p=void 0!==c&&c,f=Object(i.a)();return o.h(f,f,[0,0,-a]),o.g(f,f,[1,1,1/e]),o.e(f,f,-n*h),o.f(f,f,r*h),p&&o.g(f,f,[1,-1,1]),l&&o.h(f,f,s.c([],l)),f}function w(t){var e=t.width,n=t.height,r=t.pitch,i=function(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?v:r,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,u=void 0===s?1:s,l=t.farZMultiplier,c=void 0===l?1:l,p=a*h,f=Math.atan(.5/i),d=Math.sin(f)*i/Math.sin(Math.PI/2-p-f),g=Math.cos(Math.PI/2-p)*d+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:u,far:g*c}}({width:e,height:n,altitude:t.altitude,pitch:r,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),a=i.fov,s=i.aspect,u=i.near,l=i.far;return o.d([],a,s,u,l)}function E(t,e){var n=Object(r.a)(t,3),o=n[0],a=n[1],s=n[2],l=void 0===s?0:s;return Object(u.a)(Number.isFinite(o)&&Number.isFinite(a)&&Number.isFinite(l)),Object(i.d)(e,[o,a,l,1])}function S(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Object(r.a)(t,3),s=o[0],l=o[1],c=o[2];if(Object(u.a)(Number.isFinite(s)&&Number.isFinite(l),"invalid pixel coordinate"),Number.isFinite(c))return Object(i.d)(e,[s,l,c,1]);var h=Object(i.d)(e,[s,l,0,1]),p=Object(i.d)(e,[s,l,1,1]),f=h[2],d=p[2],v=f===d?0:((n||0)-f)/(d-f);return a.d([],h,p,v)}},772:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}));var r="undefined"!=typeof window?window:t,i=(void 0!==t||window,"undefined"!=typeof document?document:{})}).call(this,n(23))},773:function(t,e,n){var r=n(914);"string"==typeof r&&(r=[[t.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(334)(r,i);r.locals&&(t.exports=r.locals)},791:function(t,e,n){"use strict";var r=n(686),i=n(697),o=n(208),a=n(209),s=n(687),u=n(695),l=n(696),c=n(0),h=n(2),p=n.n(h);function f(t){if(!t)return null;if("string"==typeof t)return t;t.toJS&&(t=t.toJS());var e=t.layers.reduce((function(t,e){return Object.assign(t,Object(l.a)({},e.id,e))}),{});return t.layers=t.layers.map((function(t){delete(t=Object.assign({},t)).interactive;var n=e[t.ref];return n&&(delete t.ref,void 0!==n.type&&(t.type=n.type),void 0!==n.source&&(t.source=n.source),void 0!==n["source-layer"]&&(t["source-layer"]=n["source-layer"]),void 0!==n.minzoom&&(t.minzoom=n.minzoom),void 0!==n.maxzoom&&(t.maxzoom=n.maxzoom),void 0!==n.filter&&(t.filter=n.filter),void 0!==n.layout&&(t.layout=t.layout||{},t.layout=Object.assign({},t.layout,n.layout))),t})),t}var d=n(849),v=n(912),g=n(913),y=n(815),m=n.n(y),_=n(708),b=n(759),x=85.05113,w=-85.05113;var E=1e-9;function S(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function A(t,e){if(t===e)return!0;if(S(t)&&S(e)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!A(t[n],e[n]))return!1;return!0}return Math.abs(t-e)<=E}function T(t,e,n){return Math.max(e,Math.min(n,t))}function P(t,e,n){return S(t)?t.map((function(t,r){return P(t,e[r],n)})):n*e+(1-n)*t}function k(t,e){if(!t)throw new Error(e||"react-map-gl: assertion failed.")}var C=function(){function t(){Object(r.a)(this,t),Object(l.a)(this,"propNames",[])}return Object(s.a)(t,[{key:"arePropsEqual",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var o,a=(this.propNames||[])[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(!A(t[s],e[s]))return!1}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return!0}},{key:"initializeProps",value:function(t,e){return{start:t,end:e}}},{key:"interpolateProps",value:function(t,e,n){k(!1,"interpolateProps is not implemented")}}]),t}(),O=n(771),I=n(749),M=.01,R=["longitude","latitude","zoom"],L={curve:1.414,speed:1.2};function F(t,e,n){var r=(n=Object.assign({},L,n)).curve,i=t.zoom,o=[t.longitude,t.latitude],a=Object(O.i)(i),s=e.zoom,u=[e.longitude,e.latitude],l=Object(O.i)(s-i),c=Object(O.d)(o,a),h=Object(O.d)(u,a),p=I.g([],h,c),f=Math.max(t.width,t.height),d=f/l,v=I.c(p),g=r*r,y=(d*d-f*f+g*g*v*v)/(2*f*g*v),m=(d*d-f*f-g*g*v*v)/(2*d*g*v),_=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(m*m+1)-m);return{startZoom:i,startCenterXY:c,uDelta:p,w0:f,u1:v,S:(b-_)/r,rho:r,rho2:g,r0:_,r1:b}}var N={longitude:1,bearing:1};function j(t){return Number.isFinite(t)||Array.isArray(t)}function D(t,e,n){return function(t){return t in N}(t)&&Math.abs(n-e)>180&&(n=n<0?n+360:n-360),n}var z=["longitude","latitude","zoom","bearing","pitch"],B=["latitude","longitude","zoom","width","height"],U=["bearing","pitch"],V=(function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"propNames",z),n}Object(u.a)(e,t),Object(s.a)(e,[{key:"initializeProps",value:function(t,e){for(var n={},r={},i=0,o=B;i<o.length;i++){var a=o[i],s=t[a],u=e[a];k(j(s)&&j(u),"".concat(a," must be supplied for transition")),n[a]=s,r[a]=D(a,s,u)}for(var l=0,c=U;l<c.length;l++){var h=c[l],p=t[h]||0,f=e[h]||0;n[h]=p,r[h]=D(h,p,f)}return{start:n,end:r}}},{key:"interpolateProps",value:function(t,e,n){for(var r=function(t,e,n){var r={},i=F(t,e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),o=i.startZoom,a=i.startCenterXY,s=i.uDelta,u=i.w0,l=i.u1,c=i.S,h=i.rho,p=i.rho2,f=i.r0;if(Math.abs(l)<M){for(var d=0;d<R.length;d++){var v=R[d],g=t[v],y=e[v];r[v]=Object(b.b)(g,y,n)}return r}var m=n*c,_=Math.cosh(f)/Math.cosh(f+h*m),x=u*((Math.cosh(f)*Math.tanh(f+h*m)-Math.sinh(f))/p)/l,w=1/_,E=o+Object(O.f)(w),S=I.f([],s,x);I.a(S,S,a),I.f(S,S,w);var A=Object(O.g)(S,Object(O.i)(E));return r.longitude=A[0],r.latitude=A[1],r.zoom=E,r}(t,e,n),i=0,o=U;i<o.length;i++){var a=o[i];r[a]=P(t[a],e[a],n)}return r}}])}(C),["longitude","latitude","zoom","bearing","pitch"]),G=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,e),t=Object(i.a)(this,Object(o.a)(e).call(this)),Object(l.a)(Object(a.a)(t),"around",void 0),Array.isArray(n)&&(n={transitionProps:n}),t.propNames=n.transitionProps||V,n.around&&(t.around=n.around),t}return Object(u.a)(e,t),Object(s.a)(e,[{key:"initializeProps",value:function(t,e){var n={},r={};if(this.around){n.around=this.around;var i=new d.a(t).unproject(this.around);Object.assign(r,e,{around:new d.a(e).project(i),aroundLngLat:i})}var o=!0,a=!1,s=void 0;try{for(var u,l=this.propNames[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value,h=t[c],p=e[c];k(j(h)&&j(p),"".concat(c," must be supplied for transition")),n[c]=h,r[c]=D(c,h,p)}}catch(t){a=!0,s=t}finally{try{o||null==l.return||l.return()}finally{if(a)throw s}}return{start:n,end:r}}},{key:"interpolateProps",value:function(t,e,n){var r={},i=!0,o=!1,a=void 0;try{for(var s,u=this.propNames[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;r[l]=P(t[l],e[l],n)}}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}if(e.around){var c=new d.a(Object.assign({},e,r)).getMapCenterByLngLatPosition({lngLat:e.aroundLngLat,pos:P(t.around,e.around,n)}),h=Object(_.a)(c,2),p=h[0],f=h[1];r.longitude=p,r.latitude=f}return r}}]),e}(C),W={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},X={pitch:0,bearing:0,altitude:1.5},H=function(){function t(e){var n=e.width,i=e.height,o=e.latitude,a=e.longitude,s=e.zoom,u=e.bearing,c=void 0===u?X.bearing:u,h=e.pitch,p=void 0===h?X.pitch:h,f=e.altitude,d=void 0===f?X.altitude:f,v=e.maxZoom,g=void 0===v?W.maxZoom:v,y=e.minZoom,m=void 0===y?W.minZoom:y,_=e.maxPitch,b=void 0===_?W.maxPitch:_,x=e.minPitch,w=void 0===x?W.minPitch:x,E=e.transitionDuration,S=e.transitionEasing,A=e.transitionInterpolator,T=e.transitionInterruption,P=e.startPanLngLat,C=e.startZoomLngLat,O=e.startBearing,I=e.startPitch,M=e.startZoom;Object(r.a)(this,t),Object(l.a)(this,"_viewportProps",void 0),Object(l.a)(this,"_interactiveState",void 0),k(Number.isFinite(n),"`width` must be supplied"),k(Number.isFinite(i),"`height` must be supplied"),k(Number.isFinite(a),"`longitude` must be supplied"),k(Number.isFinite(o),"`latitude` must be supplied"),k(Number.isFinite(s),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:n,height:i,latitude:o,longitude:a,zoom:s,bearing:c,pitch:p,altitude:d,maxZoom:g,minZoom:m,maxPitch:b,minPitch:w,transitionDuration:E,transitionEasing:S,transitionInterpolator:A,transitionInterruption:T}),this._interactiveState={startPanLngLat:P,startZoomLngLat:C,startBearing:O,startPitch:I,startZoom:M}}return Object(s.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,n=t.startPos,r=this._interactiveState.startPanLngLat||this._unproject(n);if(!r)return this;var i=this._calculateNewLngLat({startPanLngLat:r,pos:e}),o=Object(_.a)(i,2),a=o[0],s=o[1];return this._getUpdatedMapState({longitude:a,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedMapState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,n=void 0===e?0:e,r=t.deltaScaleY,i=void 0===r?0:r,o=this._interactiveState,a=o.startBearing,s=o.startPitch;if(!Number.isFinite(a)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:n,deltaScaleY:i,startBearing:a||0,startPitch:s||0}),l=u.pitch,c=u.bearing;return this._getUpdatedMapState({bearing:c,pitch:l})}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,n=t.startPos,r=t.scale;k(r>0,"`scale` must be a positive number");var i=this._interactiveState,o=i.startZoom,a=i.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,a=this._unproject(n)||this._unproject(e)),k(a,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:r,startZoom:o||0}),u=new d.a(Object.assign({},this._viewportProps,{zoom:s})).getMapCenterByLngLatPosition({lngLat:a,pos:e}),l=Object(_.a)(u,2),c=l[0],h=l[1];return this._getUpdatedMapState({zoom:s,longitude:c,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(e){return new t(Object.assign({},this._viewportProps,this._interactiveState,e))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=T(r,n,e);var i=t.maxPitch,o=t.minPitch,a=t.pitch;return t.pitch=T(a,o,i),Object.assign(t,function(t){var e=t.width,n=t.height,r=t.longitude,i=t.latitude,o=t.zoom,a=t.pitch,s=void 0===a?0:a,u=t.bearing,l=void 0===u?0:u;(r<-180||r>180)&&(r=Object(b.c)(r+180,360)-180),(l<-180||l>180)&&(l=Object(b.c)(l+180,360)-180);var c=new d.a({width:e,height:n,longitude:r,latitude:i,zoom:o}),h=c.project([r,x])[1],p=c.project([r,w])[1],f=0;return p-h<n&&(o+=Math.log2(n/(p-h)),h=(c=new d.a({width:e,height:n,longitude:r,latitude:i,zoom:o})).project([r,x])[1],p=c.project([r,w])[1]),h>0?f=h:p<n&&(f=p-n),f&&(i=c.unproject([e/2,n/2+f])[1]),{width:e,height:n,longitude:r,latitude:i,zoom:o,pitch:s,bearing:l}}(t)),t}},{key:"_unproject",value:function(t){var e=new d.a(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,n=t.pos;return new d.a(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,n=t.startZoom,r=this._viewportProps,i=r.maxZoom,o=r.minZoom;return T(n+Math.log2(e),o,i)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,i=t.startPitch;n=T(n,-1,1);var o=this._viewportProps,a=o.minPitch,s=o.maxPitch,u=i;return n>0?u=i+n*(s-i):n<0&&(u=i-n*(a-i)),{pitch:u,bearing:r+180*e}}}]),t}();var q=Object(c.createContext)({viewport:null,map:null,mapContainer:null,onViewportChange:null,onViewStateChange:null,eventManager:null,isDragging:!1}),Z="A valid API access token is required to use Mapbox data";var K=401,Y={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},J=Object.assign({},g.a.propTypes,{width:p.a.oneOfType([p.a.number,p.a.string]),height:p.a.oneOfType([p.a.number,p.a.string]),onResize:p.a.func,preventStyleDiffing:p.a.bool,disableTokenWarning:p.a.bool,visible:p.a.bool,className:p.a.string,style:p.a.object,visibilityConstraints:p.a.object}),Q=Object.assign({},g.a.defaultProps,{preventStyleDiffing:!1,disableTokenWarning:!1,visible:!0,onResize:function(){},className:"",style:null,visibilityConstraints:W}),$=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"state",{accessTokenInvalid:!1}),Object(l.a)(Object(a.a)(n),"_mapbox",null),Object(l.a)(Object(a.a)(n),"_map",null),Object(l.a)(Object(a.a)(n),"_mapboxMapRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_mapContainerRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_queryParams",{}),Object(l.a)(Object(a.a)(n),"_width",0),Object(l.a)(Object(a.a)(n),"_height",0),Object(l.a)(Object(a.a)(n),"getMap",(function(){return n._map})),Object(l.a)(Object(a.a)(n),"queryRenderedFeatures",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n._map.queryRenderedFeatures(t,e)})),Object(l.a)(Object(a.a)(n),"_mapboxMapError",(function(t){(t.error&&t.error.status||t.status)!==K||n.state.accessTokenInvalid||(console.error(Z),n.setState({accessTokenInvalid:!0})),n.props.onError(t)})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){if(e.supported()){var t=this.props.mapStyle;this._mapbox=new g.a(Object.assign({},this.props,{mapboxgl:m.a,width:this._width,height:this._height,container:this._mapboxMapRef.current,onError:this._mapboxMapError,mapStyle:f(t)})),this._map=this._mapbox.getMap()}}},{key:"componentDidUpdate",value:function(t){this._mapbox&&(this._updateMapStyle(t,this.props),this._updateMapProps(this.props))}},{key:"componentWillUnmount",value:function(){this._mapbox&&(this._mapbox.finalize(),this._mapbox=null,this._map=null)}},{key:"_updateMapSize",value:function(t,e){this._width===t&&this._height===e||(this._width=t,this._height=e,this._updateMapProps(this.props))}},{key:"_updateMapStyle",value:function(t,e){var n=e.mapStyle;n!==t.mapStyle&&this._map.setStyle(f(n),{diff:!this.props.preventStyleDiffing})}},{key:"_updateMapProps",value:function(t){this._mapbox&&this._mapbox.setProps(Object.assign({},t,{width:this._width,height:this._height}))}},{key:"_renderNoTokenWarning",value:function(){if(this.state.accessTokenInvalid&&!this.props.disableTokenWarning){return Object(c.createElement)("div",{key:"warning",id:"no-token-warning",style:{position:"absolute",left:0,top:0}},[Object(c.createElement)("h3",{key:"header"},Z),Object(c.createElement)("div",{key:"text"},"For information on setting up your basemap, read"),Object(c.createElement)("a",{key:"link",href:"https://uber.github.io/react-map-gl/#/Documentation/getting-started/about-mapbox-tokens"},"Note on Map Tokens")])}return null}},{key:"_renderOverlays",value:function(t){var e=this,n=t.width,r=void 0===n?Number(this.props.width):n,i=t.height,o=void 0===i?Number(this.props.height):i;return this._updateMapSize(r,o),Object(c.createElement)(q.Consumer,null,(function(t){var n=Object.assign({},t,{viewport:new d.a(Object.assign({},e.props,e.props.viewState,{width:r,height:o})),map:e._map,mapContainer:t.mapContainer||e._mapContainerRef.current});return Object(c.createElement)(q.Provider,{value:n},Object(c.createElement)("div",{key:"map-overlays",className:"overlays",style:Y,children:e.props.children}))}))}},{key:"render",value:function(){var t=this.props,e=t.className,n=t.width,r=t.height,i=t.style,o=t.visibilityConstraints,a=Object.assign({position:"relative"},i,{width:n,height:r}),s=this.props.visible&&function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;for(var r in n){var i=r.slice(0,3),o=(e=r.slice(3))[0].toLowerCase()+e.slice(1);if("min"===i&&t[o]<n[r])return!1;if("max"===i&&t[o]>n[r])return!1}return!0}(this.props.viewState||this.props,o),u=Object.assign({},Y,{visibility:s?"inherit":"hidden"});return Object(c.createElement)("div",{key:"map-container",style:a,ref:this._mapContainerRef,children:[Object(c.createElement)("div",{key:"map-mapbox",ref:this._mapboxMapRef,style:u,className:e}),Object(c.createElement)(v.a,{key:"autosizer",disableWidth:Number.isFinite(n),disableHeight:Number.isFinite(r),onResize:this.props.onResize},this._renderOverlays.bind(this)),this._renderNoTokenWarning()]})}}],[{key:"supported",value:function(){return m.a&&m.a.supported()}}]),e}(c.PureComponent);Object(l.a)($,"propTypes",J),Object(l.a)($,"defaultProps",Q);var tt=function(){};var et=1,nt=2,rt=3,it=4,ot={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new G,transitionInterruption:et,onTransitionStart:tt,onTransitionInterrupt:tt,onTransitionEnd:tt,onViewportChange:tt,onStateChange:tt},at=function(){function t(e,n){var i=this;Object(r.a)(this,t),Object(l.a)(this,"props",void 0),Object(l.a)(this,"state",void 0),Object(l.a)(this,"time",void 0),Object(l.a)(this,"time",void 0),Object(l.a)(this,"_animationFrame",null),Object(l.a)(this,"_onTransitionFrame",(function(){i._animationFrame=requestAnimationFrame(i._onTransitionFrame),i._updateViewport()})),e&&(this.props=e),this.time=n||Date.now}return Object(s.a)(t,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var e=this.props;if(this.props=t,this._shouldIgnoreViewportChange(e,t))return!1;if(this._isTransitionEnabled(t)){var n=Object.assign({},e),r=Object.assign({},t);if(this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this.state.interruption===nt?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===it)){var i=this.time(),o=(i-this.state.startTime)/this.state.duration;r.transitionDuration=this.state.duration-(i-this.state.startTime),r.transitionEasing=function(t,e){var n=t(e);return function(r){return 1/(1-n)*(t(r*(1-e)+e)-n)}}(this.state.easing,o),r.transitionInterpolator=n.transitionInterpolator}return r.onTransitionStart(),this._triggerTransition(n,r),!0}return this._isTransitionInProgress()&&(e.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return Boolean(this._animationFrame)}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&Boolean(t.transitionInterpolator)}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.state.propsInTransition&&this.state.interpolator.arePropsEqual(t,this.state.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return!t||(this._isTransitionInProgress()?this.state.interruption===rt||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e))}},{key:"_triggerTransition",value:function(t,e){k(this._isTransitionEnabled(e),"Transition is not enabled"),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=e.transitionInterpolator.initializeProps(t,e),r={inTransition:!0,isZooming:t.zoom!==e.zoom,isPanning:t.longitude!==e.longitude||t.latitude!==e.latitude,isRotating:t.bearing!==e.bearing||t.pitch!==e.pitch};this.state={duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startTime:this.time(),startProps:n.start,endProps:n.end,animation:null,propsInTransition:{},interactionState:r},this._onTransitionFrame(),this.props.onStateChange(r)}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.props.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),e=this.state,n=e.startTime,r=e.duration,i=e.easing,o=e.interpolator,a=e.startProps,s=e.endProps,u=!1,l=(t-n)/r;l>=1&&(l=1,u=!0),l=i(l);var c=o.interpolateProps(a,s,l),h=new H(Object.assign({},this.props,c));this.state.propsInTransition=h.getViewportProps(),this.props.onViewportChange(this.state.propsInTransition,this.state.interactionState,this.props),u&&(this._endTransition(),this.props.onTransitionEnd())}}]),t}();Object(l.a)(at,"defaultProps",ot);var st=n(845);var ut={transitionDuration:0},lt={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new G,transitionInterruption:et},ct=["wheel"],ht=["panstart","panmove","panend"],pt=["pinchstart","pinchmove","pinchend","pinchcancel"],ft=["doubletap"],dt=["keydown"],vt=function(){function t(){var e=this;Object(r.a)(this,t),Object(l.a)(this,"events",[]),Object(l.a)(this,"mapState",void 0),Object(l.a)(this,"onViewportChange",void 0),Object(l.a)(this,"onStateChange",void 0),Object(l.a)(this,"mapStateProps",void 0),Object(l.a)(this,"eventManager",void 0),Object(l.a)(this,"scrollZoom",!0),Object(l.a)(this,"dragPan",!0),Object(l.a)(this,"dragRotate",!0),Object(l.a)(this,"doubleClickZoom",!0),Object(l.a)(this,"touchZoom",!0),Object(l.a)(this,"touchRotate",!1),Object(l.a)(this,"keyboard",!0),Object(l.a)(this,"_state",{isDragging:!1}),Object(l.a)(this,"_events",{}),Object(l.a)(this,"_transitionManager",new at),Object(l.a)(this,"setState",(function(t){Object.assign(e._state,t),e.onStateChange&&e.onStateChange(e._state)})),this.handleEvent=this.handleEvent.bind(this),this._onWheelEnd=function(t,e){var n,r,i,o=function(){return i=null,t.apply(n,r)};return function(){n=this,r=arguments,i&&clearTimeout(i),i=setTimeout(o,e)}}(this._onWheelEnd,100)}return Object(s.a)(t,[{key:"handleEvent",value:function(t){switch(this.mapState=this.getMapState(),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchcancel":case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=t.offsetCenter;return[e.x,e.y]}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.mapState?this.mapState.getViewportProps():{},i=Object.assign({},t.getViewportProps(),e),o=Object.keys(i).some((function(t){return r[t]!==i[t]}));o&&this.onViewportChange(i,n,r),this.setState(Object.assign({},t.getInteractiveState(),n))}},{key:"getMapState",value:function(t){return new H(Object.assign({},this.mapStateProps,this._state,t))}},{key:"setOptions",value:function(t){var e=t.onViewportChange,n=t.onStateChange,r=t.eventManager,i=void 0===r?this.eventManager:r,o=t.isInteractive,a=void 0===o||o,s=t.scrollZoom,u=void 0===s?this.scrollZoom:s,l=t.dragPan,c=void 0===l?this.dragPan:l,h=t.dragRotate,p=void 0===h?this.dragRotate:h,f=t.doubleClickZoom,d=void 0===f?this.doubleClickZoom:f,v=t.touchZoom,g=void 0===v?this.touchZoom:v,y=t.touchRotate,m=void 0===y?this.touchRotate:y,_=t.keyboard,b=void 0===_?this.keyboard:_;this.onViewportChange=e,this.onStateChange=n,this.mapStateProps&&this.mapStateProps.height===t.height||this.updateViewport(new H(t)),this.mapStateProps=t,this._transitionManager.processViewportChange(Object.assign({},t,{onStateChange:this.setState})),this.eventManager!==i&&(this.eventManager=i,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(ct,a&&u),this.toggleEvents(ht,a&&(c||p)),this.toggleEvents(pt,a&&(g||m)),this.toggleEvents(ft,a&&d),this.toggleEvents(dt,a&&b),this.scrollZoom=u,this.dragPan=c,this.dragRotate=p,this.doubleClickZoom=d,this.touchZoom=g,this.touchRotate=m,this.keyboard=b}},{key:"toggleEvents",value:function(t,e){var n=this;this.eventManager&&t.forEach((function(t){n._events[t]!==e&&(n._events[t]=e,e?n.eventManager.on(t,n.handleEvent):n.eventManager.off(t,n.handleEvent))}))}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t),n=this.mapState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(n,ut,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isFunctionKeyPressed(t)||t.rightButton?this._onPanRotate(t):this._onPanMove(t)}},{key:"_onPanEnd",value:function(t){var e=this.mapState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isRotating:!1}),!0}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),n=this.mapState.pan({pos:e});return this.updateViewport(n,ut,{isPanning:!0}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,n=t.deltaY,r=this.getCenter(t),i=Object(_.a)(r,2)[1],o=i-n,a=this.mapState.getViewportProps(),s=a.width,u=a.height,l=e/s,c=0;n>0?Math.abs(u-o)>5&&(c=n/(o-u)*1.2):n<0&&o>5&&(c=1-i/o),c=Math.min(1,Math.max(-1,c));var h=this.mapState.rotate({deltaScaleX:l,deltaScaleY:c});return this.updateViewport(h,ut,{isRotating:!0}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t),n=t.delta,r=2/(1+Math.exp(-Math.abs(.01*n)));n<0&&0!==r&&(r=1/r);var i=this.mapState.zoom({pos:e,scale:r});return this.updateViewport(i,ut,{isZooming:!0}),this._onWheelEnd(),!0}},{key:"_onWheelEnd",value:function(){this.setState({isZooming:!1})}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t),n=this.mapState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(n,ut,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.mapState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);e=e.zoom({pos:r,scale:n})}if(this.touchRotate){var i=t.rotation,o=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(i-o)/180})}return this.updateViewport(e,ut,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),!0}},{key:"_onPinchEnd",value:function(t){var e=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t),n=this.isFunctionKeyPressed(t),r=this.mapState.zoom({pos:e,scale:n?.5:2});return this.updateViewport(r,Object.assign({},lt,{transitionInterpolator:new G({around:e})})),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,n=this.isFunctionKeyPressed(t),r=this.mapStateProps;switch(t.srcEvent.keyCode){case 189:e=n?this.getMapState({zoom:r.zoom-2}):this.getMapState({zoom:r.zoom-1});break;case 187:e=n?this.getMapState({zoom:r.zoom+2}):this.getMapState({zoom:r.zoom+1});break;case 37:e=n?this.getMapState({bearing:r.bearing-15}):this.mapState.pan({pos:[100,0],startPos:[0,0]});break;case 39:e=n?this.getMapState({bearing:r.bearing+15}):this.mapState.pan({pos:[-100,0],startPos:[0,0]});break;case 38:e=n?this.getMapState({pitch:r.pitch+10}):this.mapState.pan({pos:[0,100],startPos:[0,0]});break;case 40:e=n?this.getMapState({pitch:r.pitch-10}):this.mapState.pan({pos:[0,-100],startPos:[0,0]});break;default:return!1}return this.updateViewport(e,lt)}}]),t}(),gt=[{old:"onChangeViewport",new:"onViewportChange"},{old:"perspectiveEnabled",new:"dragRotate"},{old:"onHoverFeatures",new:"onHover"},{old:"onClickFeatures",new:"onClick"},{old:"touchZoomRotate",new:"touchZoom, touchRotate"},{old:"mapControls",new:"controller"}];function yt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};gt.forEach((function(e){if(t.hasOwnProperty(e.old)){var n=(r=e.old,"react-map-gl: `".concat(r,"` is removed."));e.new&&(n="".concat(n," ").concat(function(t){return"Use `".concat(t,"` instead.")}(e.new))),console.warn(n)}var r}))}var mt=Object.assign({},$.propTypes,{maxZoom:p.a.number,minZoom:p.a.number,maxPitch:p.a.number,minPitch:p.a.number,onViewStateChange:p.a.func,onViewportChange:p.a.func,onInteractionStateChange:p.a.func,transitionDuration:p.a.number,transitionInterpolator:p.a.object,transitionInterruption:p.a.number,transitionEasing:p.a.func,onTransitionStart:p.a.func,onTransitionInterrupt:p.a.func,onTransitionEnd:p.a.func,scrollZoom:p.a.bool,dragPan:p.a.bool,dragRotate:p.a.bool,doubleClickZoom:p.a.bool,touchZoom:p.a.bool,touchRotate:p.a.bool,keyboard:p.a.bool,onHover:p.a.func,onClick:p.a.func,onDblClick:p.a.func,onContextMenu:p.a.func,onMouseDown:p.a.func,onMouseMove:p.a.func,onMouseUp:p.a.func,onTouchStart:p.a.func,onTouchMove:p.a.func,onTouchEnd:p.a.func,onMouseEnter:p.a.func,onMouseLeave:p.a.func,onMouseOut:p.a.func,onWheel:p.a.func,touchAction:p.a.string,clickRadius:p.a.number,interactiveLayerIds:p.a.array,getCursor:p.a.func,controller:p.a.instanceOf(vt)}),_t=Object.assign({},$.defaultProps,W,at.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(t){return t.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",clickRadius:0,getCursor:function(t){var e=t.isDragging,n=t.isHovering;return e?"grabbing":n?"pointer":"grab"}}),bt=function(t){function e(t){var n;return Object(r.a)(this,e),n=Object(i.a)(this,Object(o.a)(e).call(this,t)),Object(l.a)(Object(a.a)(n),"state",{isLoaded:!1,isDragging:!1,isHovering:!1}),Object(l.a)(Object(a.a)(n),"_controller",void 0),Object(l.a)(Object(a.a)(n),"_eventManager",void 0),Object(l.a)(Object(a.a)(n),"_interactiveContext",void 0),Object(l.a)(Object(a.a)(n),"_width",0),Object(l.a)(Object(a.a)(n),"_height",0),Object(l.a)(Object(a.a)(n),"_eventCanvasRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_staticMapRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"getMap",(function(){return n._staticMapRef.current?n._staticMapRef.current.getMap():null})),Object(l.a)(Object(a.a)(n),"queryRenderedFeatures",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.getMap();return r&&r.queryRenderedFeatures(t,e)})),Object(l.a)(Object(a.a)(n),"_onInteractionStateChange",(function(t){var e=t.isDragging,r=void 0!==e&&e;r!==n.state.isDragging&&(n._updateInteractiveContext({isDragging:r}),n.setState({isDragging:r}));var i=n.props.onInteractionStateChange;i&&i(t)})),Object(l.a)(Object(a.a)(n),"_onResize",(function(t){var e=t.width,r=t.height;n._width=e,n._height=r,n._setControllerProps(n.props),n.props.onResize({width:e,height:r})})),Object(l.a)(Object(a.a)(n),"_onViewportChange",(function(t,e,r){var i=n.props,o=i.onViewStateChange,a=i.onViewportChange;o&&o({viewState:t,interactionState:e,oldViewState:r}),a&&a(t,e,r)})),Object(l.a)(Object(a.a)(n),"_onLoad",(function(t){n.setState({isLoaded:!0}),n.props.onLoad(t)})),Object(l.a)(Object(a.a)(n),"_onEvent",(function(t,e){var r=n.props[t];r&&r(n._normalizeEvent(e))})),Object(l.a)(Object(a.a)(n),"_onPointerDown",(function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchStart",t);break;default:n._onEvent("onMouseDown",t)}})),Object(l.a)(Object(a.a)(n),"_onPointerUp",(function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchEnd",t);break;default:n._onEvent("onMouseUp",t)}})),Object(l.a)(Object(a.a)(n),"_onPointerMove",(function(t){switch(t.pointerType){case"touch":n._onEvent("onTouchMove",t);break;default:n._onEvent("onMouseMove",t)}if(!n.state.isDragging){var e,r=n.props,i=r.onHover,o=r.interactiveLayerIds;t=n._normalizeEvent(t),n.state.isLoaded&&(o||i)&&(e=n._getFeatures({pos:t.point,radius:n.props.clickRadius})),i&&(t.features=e,i(t));var a=Boolean(o&&e&&e.length>0),s=a&&!n.state.isHovering,u=!a&&n.state.isHovering;s&&n._onEvent("onMouseEnter",t),u&&n._onEvent("onMouseLeave",t),(s||u)&&n.setState({isHovering:a})}})),Object(l.a)(Object(a.a)(n),"_onClick",(function(t){var e=n.props,r=e.onClick,i=e.onNativeClick,o=e.onDblClick,a=e.doubleClickZoom,s=[],u=o||a;switch(t.type){case"anyclick":s.push(i),u||s.push(r);break;case"click":u&&s.push(r)}(s=s.filter(Boolean)).length&&((t=n._normalizeEvent(t)).features=n._getFeatures({pos:t.point,radius:n.props.clickRadius}),s.forEach((function(e){return e(t)})))})),yt(t),n._controller=t.controller||new vt,n._eventManager=new st.EventManager(null,{touchAction:t.touchAction}),n._updateInteractiveContext({isDragging:!1,eventManager:n._eventManager}),n}return Object(u.a)(e,t),Object(s.a)(e,null,[{key:"supported",value:function(){return $.supported()}}]),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._eventManager,e=this._eventCanvasRef.current;t.setElement(e),t.on({pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerup:this._onPointerUp,pointerleave:this._onEvent.bind(this,"onMouseOut"),click:this._onClick,anyclick:this._onClick,dblclick:this._onEvent.bind(this,"onDblClick"),wheel:this._onEvent.bind(this,"onWheel"),contextmenu:this._onEvent.bind(this,"onContextMenu")}),this._setControllerProps(this.props),this._updateInteractiveContext({mapContainer:e})}},{key:"componentWillUnmount",value:function(){this._eventManager.destroy()}},{key:"_setControllerProps",value:function(t){t=Object.assign({},t,t.viewState,{isInteractive:Boolean(t.onViewStateChange||t.onViewportChange),onViewportChange:this._onViewportChange,onStateChange:this._onInteractionStateChange,eventManager:this._eventManager,width:this._width,height:this._height}),this._controller.setOptions(t);var e=this._interactiveContext;e.onViewportChange=t.onViewportChange,e.onViewStateChange=t.onViewStateChange}},{key:"_getFeatures",value:function(t){var e,n=t.pos,r=t.radius,i={},o=this.getMap();if(this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds),r){var a=r,s=[[n[0]-a,n[1]+a],[n[0]+a,n[1]-a]];e=o&&o.queryRenderedFeatures(s,i)}else e=o&&o.queryRenderedFeatures(n,i);return e}},{key:"_updateInteractiveContext",value:function(t){this._interactiveContext=Object.assign({},this._interactiveContext,t)}},{key:"_normalizeEvent",value:function(t){if(t.lngLat)return t;var e=t.offsetCenter,n=[e.x,e.y],r=new d.a(Object.assign({},this.props,{width:this._width,height:this._height}));return t.point=n,t.lngLat=r.unproject(n),t}},{key:"render",value:function(){this._setControllerProps(this.props);var t=this.props,e=t.width,n=t.height,r=t.style,i=t.getCursor,o=Object.assign({position:"relative"},r,{width:e,height:n,cursor:i(this.state)});return Object(c.createElement)(q.Provider,{value:this._interactiveContext},Object(c.createElement)("div",{key:"event-canvas",ref:this._eventCanvasRef,style:o},Object(c.createElement)($,Object.assign({},this.props,{width:"100%",height:"100%",style:null,onResize:this._onResize,onLoad:this._onLoad,ref:this._staticMapRef,children:this.props.children}))))}}]),e}(c.PureComponent);Object(l.a)(bt,"propTypes",mt),Object(l.a)(bt,"defaultProps",_t);var xt={captureScroll:p.a.bool,captureDrag:p.a.bool,captureClick:p.a.bool,captureDoubleClick:p.a.bool},wt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"_context",{}),Object(l.a)(Object(a.a)(n),"_events",null),Object(l.a)(Object(a.a)(n),"_containerRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_onScroll",(function(t){n.props.captureScroll&&t.stopPropagation()})),Object(l.a)(Object(a.a)(n),"_onDragStart",(function(t){n.props.captureDrag&&t.stopPropagation()})),Object(l.a)(Object(a.a)(n),"_onDblClick",(function(t){n.props.captureDoubleClick&&t.stopPropagation()})),Object(l.a)(Object(a.a)(n),"_onClick",(function(t){n.props.captureClick&&t.stopPropagation()})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._containerRef.current;if(t){var e=this._context.eventManager;e&&(this._events={wheel:this._onScroll,panstart:this._onDragStart,anyclick:this._onClick,click:this._onClick,dblclick:this._onDblClick},e.on(this._events,t))}}},{key:"componentWillUnmount",value:function(){var t=this._context.eventManager;t&&this._events&&t.off(this._events)}},{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){var t=this;return Object(c.createElement)(q.Consumer,null,(function(e){return t._context=e,t._render()}))}}]),e}(c.PureComponent);function Et(t,e,n){return(Et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(o.a)(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}Object(l.a)(wt,"propTypes",xt),Object(l.a)(wt,"defaultProps",{captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0});var St=Object.assign({},wt.propTypes,{draggable:p.a.bool,onDrag:p.a.func,onDragEnd:p.a.func,onDragStart:p.a.func,offsetLeft:p.a.number,offsetTop:p.a.number}),At=Object.assign({},wt.defaultProps,{draggable:!1,offsetLeft:0,offsetTop:0}),Tt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"state",{dragPos:null,dragOffset:null}),Object(l.a)(Object(a.a)(n),"_dragEvents",null),Object(l.a)(Object(a.a)(n),"_onDragStart",(function(t){var e=n.props,r=e.draggable,i=e.captureDrag;if((r||i)&&t.stopPropagation(),r){var o=n._getDragEventPosition(t),a=n._getDragEventOffset(t);n.setState({dragPos:o,dragOffset:a}),n._setupDragEvents();var s=n.props.onDragStart;if(s&&a){var u=Object.assign({},t);u.lngLat=n._getDragLngLat(o,a),s(u)}}})),Object(l.a)(Object(a.a)(n),"_onDrag",(function(t){t.stopPropagation();var e=n._getDragEventPosition(t);n.setState({dragPos:e});var r=n.props.onDrag,i=n.state.dragOffset;if(r&&i){var o=Object.assign({},t);o.lngLat=n._getDragLngLat(e,i),r(o)}})),Object(l.a)(Object(a.a)(n),"_onDragEnd",(function(t){var e=n.state,r=e.dragPos,i=e.dragOffset;t.stopPropagation(),n.setState({dragPos:null,dragOffset:null}),n._removeDragEvents();var o=n.props.onDragEnd;if(o&&r&&i){var a=Object.assign({},t);a.lngLat=n._getDragLngLat(r,i),o(a)}})),Object(l.a)(Object(a.a)(n),"_onDragCancel",(function(t){t.stopPropagation(),n.setState({dragPos:null,dragOffset:null}),n._removeDragEvents()})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentWillUnmount",value:function(){Et(Object(o.a)(e.prototype),"componentWillUnmount",this).call(this),this._removeDragEvents()}},{key:"_setupDragEvents",value:function(){var t=this._context.eventManager;t&&(this._dragEvents={panmove:this._onDrag,panend:this._onDragEnd,pancancel:this._onDragCancel},t.on(this._dragEvents))}},{key:"_removeDragEvents",value:function(){var t=this._context.eventManager;t&&this._dragEvents&&(t.off(this._dragEvents),this._dragEvents=null)}},{key:"_getDragEventPosition",value:function(t){var e=t.offsetCenter;return[e.x,e.y]}},{key:"_getDragEventOffset",value:function(t){var e=t.center,n=e.x,r=e.y,i=this._containerRef.current;if(i){var o=i.getBoundingClientRect();return[o.left-n,o.top-r]}return null}},{key:"_getDraggedPosition",value:function(t,e){return[t[0]+e[0],t[1]+e[1]]}},{key:"_getDragLngLat",value:function(t,e){var n=this.props,r=n.offsetLeft,i=n.offsetTop,o=this._getDraggedPosition(t,e),a=Object(_.a)(o,2),s=a[0],u=a[1];return this._context.viewport.unproject([s-r,u-i])}}]),e}(wt);Object(l.a)(Tt,"propTypes",St),Object(l.a)(Tt,"defaultProps",At);var Pt=Object.assign({},Tt.propTypes,{className:p.a.string,longitude:p.a.number.isRequired,latitude:p.a.number.isRequired}),kt=Object.assign({},Tt.defaultProps,{className:""}),Ct=function(t){function e(){return Object(r.a)(this,e),Object(i.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_getPosition",value:function(){var t=this.props,e=t.longitude,n=t.latitude,r=t.offsetLeft,i=t.offsetTop,o=this.state,a=o.dragPos,s=o.dragOffset;if(a&&s)return this._getDraggedPosition(a,s);var u=this._context.viewport.project([e,n]),l=Object(_.a)(u,2),c=l[0],h=l[1];return[c+=r,h+=i]}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.draggable,r=this.state.dragPos,i=this._getPosition(),o=Object(_.a)(i,2),a={position:"absolute",left:o[0],top:o[1],cursor:n?r?"grabbing":"grab":"auto"};return Object(c.createElement)("div",{className:"mapboxgl-marker ".concat(e),ref:this._containerRef,style:a,children:this.props.children})}}]),e}(Tt);Object(l.a)(Ct,"propTypes",Pt),Object(l.a)(Ct,"defaultProps",kt);var Ot={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},It=Object.keys(Ot);var Mt=Object.assign({},wt.propTypes,{className:p.a.string,longitude:p.a.number.isRequired,latitude:p.a.number.isRequired,altitude:p.a.number,offsetLeft:p.a.number,offsetTop:p.a.number,tipSize:p.a.number,closeButton:p.a.bool,closeOnClick:p.a.bool,anchor:p.a.oneOf(Object.keys(Ot)),dynamicPosition:p.a.bool,sortByDepth:p.a.bool,onClose:p.a.func}),Rt=Object.assign({},wt.defaultProps,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}}),Lt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"_closeOnClick",!1),Object(l.a)(Object(a.a)(n),"_contentRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_onClick",(function(t){if(n.props.captureClick&&t.stopPropagation(),n.props.closeOnClick||"mapboxgl-popup-close-button"===t.target.className){n.props.onClose();var e=n._context.eventManager;e&&e.once("click",(function(t){return t.stopPropagation()}),t.target)}})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){Et(Object(o.a)(e.prototype),"componentDidMount",this).call(this),this.forceUpdate()}},{key:"_getPosition",value:function(t,e){var n=this._context.viewport,r=this.props,i=r.anchor,o=r.dynamicPosition,a=r.tipSize,s=this._contentRef.current;return s&&o?function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=t.selfWidth,a=t.selfHeight,s=t.anchor,u=t.padding,l=void 0===u?0:u,c=Ot[s],h=c.x,p=c.y,f=n-p*a,d=f+a;if(f<l)for(;f<l&&p>=.5;)p-=.5,f+=.5*a;else if(d>i-l)for(;d>i-l&&p<=.5;)p+=.5,d-=.5*a;var v=e-h*o,g=v+o,y=.5;if(.5===p&&(h=Math.floor(h),y=1),v<l)for(;v<l&&h>=y;)h-=y,v+=y*o;else if(g>r-l)for(;g>r-l&&h<=1-y;)h+=y,g-=y*o;return It.find((function(t){var e=Ot[t];return e.x===h&&e.y===p}))||s}({x:t,y:e,anchor:i,padding:a,width:n.width,height:n.height,selfWidth:s.clientWidth,selfHeight:s.clientHeight}):i}},{key:"_getContainerStyle",value:function(t,e,n,r){var i=this._context.viewport,o=this.props,a=o.offsetLeft,s=o.offsetTop,u=o.sortByDepth,l=Ot[r],c=t+a,h=e+s,p={position:"absolute",transform:"\n        translate(".concat(100*-l.x,"%, ").concat(100*-l.y,"%)\n        translate(").concat(c,"px, ").concat(h,"px)\n      "),display:void 0,zIndex:void 0};return u?(n>1||n<-1||t<0||t>i.width||e<0||e>i.height?p.display="none":p.zIndex=Math.floor((1-n)/2*1e5),p):p}},{key:"_renderTip",value:function(t){var e=this.props.tipSize;return Object(c.createElement)("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:e}})}},{key:"_renderContent",value:function(){var t=this.props,e=t.closeButton,n=t.children,r=this._context.eventManager?null:this._onClick;return Object(c.createElement)("div",{key:"content",ref:this._contentRef,className:"mapboxgl-popup-content",onClick:r},[e&&Object(c.createElement)("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button"},"Ã"),n])}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.longitude,r=t.latitude,i=t.altitude,o=this._context.viewport.project([n,r,i]),a=Object(_.a)(o,3),s=a[0],u=a[1],l=a[2],h=this._getPosition(s,u),p=this._getContainerStyle(s,u,l,h);return Object(c.createElement)("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(h," ").concat(e),style:p,ref:this._containerRef},[this._renderTip(h),this._renderContent()])}}]),e}(wt);Object(l.a)(Lt,"propTypes",Mt),Object(l.a)(Lt,"defaultProps",Rt);var Ft,Nt=n(772),jt=Object.assign({},wt.propTypes,{className:p.a.string,container:p.a.object}),Dt=Object.assign({},wt.defaultProps,{className:"",container:null}),zt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"state",{isFullscreen:!1,showButton:!1}),Object(l.a)(Object(a.a)(n),"_mapboxFullscreenControl",null),Object(l.a)(Object(a.a)(n),"_onFullscreenChange",(function(){var t=!n._mapboxFullscreenControl._fullscreen;n._mapboxFullscreenControl._fullscreen=t,n.setState({isFullscreen:t})})),Object(l.a)(Object(a.a)(n),"_onClickFullscreen",(function(){n._mapboxFullscreenControl._onClickFullscreen()})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.container||this._context.mapContainer;this._mapboxFullscreenControl=new m.a.FullscreenControl({container:t}),this.setState({showButton:this._mapboxFullscreenControl._checkFullscreenSupport()}),Nt.a.addEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"componentWillUnmount",value:function(){Nt.a.removeEventListener(this._mapboxFullscreenControl._fullscreenchange,this._onFullscreenChange)}},{key:"_renderButton",value:function(t,e,n){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:n})}},{key:"_render",value:function(){if(!this.state.showButton)return null;var t=this.props.className,e=this.state.isFullscreen?"shrink":"fullscreen";return Object(c.createElement)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(t),ref:this._containerRef},[this._renderButton(e,"Toggle fullscreen",this._onClickFullscreen)])}}]),e}(wt);Object(l.a)(zt,"propTypes",jt),Object(l.a)(zt,"defaultProps",Dt);var Bt=Object.assign({},at.defaultProps,{transitionDuration:500}),Ut=function(){},Vt=Object.assign({},wt.propTypes,{className:p.a.string,style:p.a.object,positionOptions:p.a.object,fitBoundsOptions:p.a.object,trackUserLocation:p.a.bool,showUserLocation:p.a.bool,onViewStateChange:p.a.func,onViewportChange:p.a.func}),Gt=Object.assign({},wt.defaultProps,{className:"",style:{},positionOptions:null,fitBoundsOptions:null,trackUserLocation:!1,showUserLocation:!0}),Wt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),h=0;h<s;h++)u[h]=arguments[h];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"state",{supportsGeolocation:!1,markerPosition:null}),Object(l.a)(Object(a.a)(n),"_mapboxGeolocateControl",null),Object(l.a)(Object(a.a)(n),"_geolocateButtonRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_markerRef",Object(c.createRef)()),Object(l.a)(Object(a.a)(n),"_setupMapboxGeolocateControl",(function(t){if(t){var e={};["positionOptions","fitBoundsOptions","trackUserLocation","showUserLocation"].forEach((function(t){t in n.props&&null!==n.props[t]&&(e[t]=n.props[t])})),n._mapboxGeolocateControl=new m.a.GeolocateControl(e),n._mapboxGeolocateControl._watchState="OFF",n._mapboxGeolocateControl._geolocateButton=n._geolocateButtonRef.current,n._mapboxGeolocateControl._updateMarker=n._updateMarker,n._mapboxGeolocateControl._updateCamera=n._updateCamera,n._mapboxGeolocateControl._setup=!0}else console.warn("Geolocation support is not available, the GeolocateControl will not be visible.")})),Object(l.a)(Object(a.a)(n),"_onClickGeolocate",(function(){return n._mapboxGeolocateControl.trigger()})),Object(l.a)(Object(a.a)(n),"_updateMarker",(function(t){t&&n.setState({markerPosition:t.coords})})),Object(l.a)(Object(a.a)(n),"_getBounds",(function(t){var e=new m.a.LngLat(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=e.toBounds(n);return[[r._ne.lng,r._ne.lat],[r._sw.lng,r._sw.lat]]})),Object(l.a)(Object(a.a)(n),"_updateCamera",(function(t){var e=n._context.viewport,r=n._getBounds(t),i=new d.a(e).fitBounds(r),o=i.longitude,a=i.latitude,s=i.zoom,u=Object.assign({},e,{longitude:o,latitude:a,zoom:s}),l=new H(u),c=Object.assign({},l.getViewportProps(),Bt),h=n.props.onViewportChange||n._context.onViewportChange||Ut;(n.props.onViewStateChange||n._context.onViewStateChange||Ut)({viewState:c}),h(c)})),Object(l.a)(Object(a.a)(n),"_renderButton",(function(t,e,r){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),ref:n._geolocateButtonRef,type:"button",title:e,onClick:r})})),Object(l.a)(Object(a.a)(n),"_renderMarker",(function(){var t=n.props.showUserLocation,e=n.state.markerPosition;return t&&e?Object(c.createElement)(Ct,{key:"location-maker",ref:n._markerRef,className:"mapboxgl-user-location-dot",longitude:e.longitude,latitude:e.latitude,onContextMenu:function(t){return t.preventDefault()},captureDrag:!1,captureDoubleClick:!1}):null})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this;(void 0!==Ft?Promise.resolve(Ft):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then((function(t){return Ft="denied"!==t.state})):(Ft=Boolean(window.navigator.geolocation),Promise.resolve(Ft))).then((function(e){t.setState({supportsGeolocation:e}),t._setupMapboxGeolocateControl(e)}))}},{key:"componentDidUpdate",value:function(){var t=this._markerRef.current;this._mapboxGeolocateControl&&t&&(this._mapboxGeolocateControl._dotElement=t._containerRef.current)}},{key:"componentWillUnmount",value:function(){var t=this._mapboxGeolocateControl._geolocationWatchID;void 0!==t&&(window.navigator.geolocation.clearWatch(t),this._mapboxGeolocateControl._geolocationWatchID=void 0)}},{key:"_render",value:function(){if(!this.state.supportsGeolocation)return null;var t=this.props,e=t.className,n=t.style;return Object(c.createElement)("div",null,[this._renderMarker(),Object(c.createElement)("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(e),ref:this._containerRef,style:n,onContextMenu:function(t){return t.preventDefault()}},this._renderButton("geolocate","Geolocate",this._onClickGeolocate))])}}]),e}(wt);Object(l.a)(Wt,"propTypes",Vt),Object(l.a)(Wt,"defaultProps",Gt);var Xt=function(){},Ht=Object.assign({},wt.propTypes,{className:p.a.string,onViewStateChange:p.a.func,onViewportChange:p.a.func,showCompass:p.a.bool,showZoom:p.a.bool}),qt=Object.assign({},wt.defaultProps,{className:"",showCompass:!0,showZoom:!0}),Zt=function(t){function e(t){var n;return Object(r.a)(this,e),n=Object(i.a)(this,Object(o.a)(e).call(this,t)),Object(l.a)(Object(a.a)(n),"_onZoomIn",(function(){n._updateViewport({zoom:n._context.viewport.zoom+1})})),Object(l.a)(Object(a.a)(n),"_onZoomOut",(function(){n._updateViewport({zoom:n._context.viewport.zoom-1})})),Object(l.a)(Object(a.a)(n),"_onResetNorth",(function(){n._updateViewport({bearing:0,pitch:0})})),yt(t),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_updateViewport",value:function(t){var e=this._context.viewport,n=new H(Object.assign({},e,t)),r=Object.assign({},n.getViewportProps(),lt),i=this.props.onViewportChange||this._context.onViewportChange||Xt;(this.props.onViewStateChange||this._context.onViewStateChange||Xt)({viewState:r}),i(r)}},{key:"_renderCompass",value:function(){var t=this._context.viewport.bearing;return Object(c.createElement)("span",{className:"mapboxgl-ctrl-compass-arrow",style:{transform:"rotate(".concat(-t,"deg)")}})}},{key:"_renderButton",value:function(t,e,n,r){return Object(c.createElement)("button",{key:t,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(t),type:"button",title:e,onClick:n,children:r})}},{key:"_render",value:function(){var t=this.props,e=t.className,n=t.showCompass,r=t.showZoom;return Object(c.createElement)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group ".concat(e),ref:this._containerRef},[r&&this._renderButton("zoom-in","Zoom In",this._onZoomIn),r&&this._renderButton("zoom-out","Zoom Out",this._onZoomOut),n&&this._renderButton("compass","Reset North",this._onResetNorth,this._renderCompass())])}}]),e}(wt);Object(l.a)(Zt,"propTypes",Ht),Object(l.a)(Zt,"defaultProps",qt);var Kt=Object.assign({},wt.propTypes,{redraw:p.a.func.isRequired}),Yt=function(t){function e(){var t,n;Object(r.a)(this,e);for(var s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];return n=Object(i.a)(this,(t=Object(o.a)(e)).call.apply(t,[this].concat(u))),Object(l.a)(Object(a.a)(n),"_canvas",void 0),Object(l.a)(Object(a.a)(n),"_ctx",void 0),Object(l.a)(Object(a.a)(n),"_redraw",(function(){var t=n._ctx;if(t){var e=Nt.b.devicePixelRatio||1;t.save(),t.scale(e,e);var r=n._context,i=r.viewport,o=r.isDragging;n.props.redraw({width:i.width,height:i.height,ctx:t,isDragging:o,project:i.project.bind(i),unproject:i.unproject.bind(i)}),t.restore()}})),n}return Object(u.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){var t=this._containerRef.current;t&&(this._canvas=t,this._ctx=t.getContext("2d")),this._redraw()}},{key:"_render",value:function(){var t=Nt.b.devicePixelRatio||1,e=this._context.viewport,n=e.width,r=e.height;return this._redraw(),Object(c.createElement)("canvas",{ref:this._containerRef,width:n*t,height:r*t,style:{width:"".concat(n,"px"),height:"".concat(r,"px"),position:"absolute",left:0,top:0}})}}]),e}(wt);Object(l.a)(Yt,"propTypes",Kt),Object(l.a)(Yt,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var Jt=Object.assign({},wt.propTypes,{redraw:p.a.func.isRequired,style:p.a.object}),Qt=function(t){function e(){return Object(r.a)(this,e),Object(i.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_render",value:function(){var t=this._context,e=t.viewport,n=t.isDragging,r=Object.assign({position:"absolute",left:0,top:0,width:e.width,height:e.height},this.props.style);return Object(c.createElement)("div",{ref:this._containerRef,style:r},this.props.redraw({width:e.width,height:e.height,isDragging:n,project:e.project.bind(e),unproject:e.unproject.bind(e)}))}}]),e}(wt);Object(l.a)(Qt,"propTypes",Jt),Object(l.a)(Qt,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1});var $t=Object.assign({},wt.propTypes,{redraw:p.a.func.isRequired,style:p.a.object}),te=function(t){function e(){return Object(r.a)(this,e),Object(i.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(s.a)(e,[{key:"_render",value:function(){var t=this._context,e=t.viewport,n=t.isDragging,r=Object.assign({position:"absolute",left:0,top:0},this.props.style);return Object(c.createElement)("svg",{width:e.width,height:e.height,ref:this._containerRef,style:r},this.props.redraw({width:e.width,height:e.height,isDragging:n,project:e.project.bind(e),unproject:e.unproject.bind(e)}))}}]),e}(wt);Object(l.a)(te,"propTypes",$t),Object(l.a)(te,"defaultProps",{captureScroll:!1,captureDrag:!1,captureClick:!1,captureDoubleClick:!1}),n.d(e,"a",(function(){return bt}))},792:function(t,e,n){"use strict";var r=n(708),i=n(686),o=n(687),a=n(697),s=n(208),u=n(695),l=n(850),c=n(768),h=n(808),p=[0,0,0],f=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(i.a)(this,e),t=Object(a.a)(this,Object(s.a)(e).call(this,3)),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,r,o),t}return Object(u.a)(e,t),Object(o.a)(e,[{key:"angle",value:function(t){return h.a(this,t)}},{key:"cross",value:function(t){return h.b(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?p:n;return h.d(this,this,r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?p:n;return h.e(this,this,r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,n=t.origin,r=void 0===n?p:n;return h.f(this,this,r,e),this.check()}},{key:"operation",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t.apply(void 0,[this,this].concat(n)),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Object(c.a)(t)}}]),e}(l.a),d=n(748),v=n(728),g=n.n(v),y=n(730),m=n.n(y),_=n(731),b=n.n(_),x=n(745),w=n.n(x),E=n(746),S=n.n(E),A=n(899),T=n.n(A),P=n(807);n.d(e,"l",(function(){return F})),n.d(e,"i",(function(){return N})),n.d(e,"g",(function(){return j})),n.d(e,"j",(function(){return D})),n.d(e,"b",(function(){return z})),n.d(e,"a",(function(){return B})),n.d(e,"f",(function(){return U})),n.d(e,"e",(function(){return V})),n.d(e,"d",(function(){return G})),n.d(e,"c",(function(){return W})),n.d(e,"k",(function(){return X})),n.d(e,"h",(function(){return H}));var k=Math.PI,C=k/4,O=k/180,I=180/k,M=512,R=4003e4,L=1.5;function F(t){return Math.pow(2,t)}function N(t){return Math.log2(t)}function j(t,e){var n=Object(r.a)(t,2),i=n[0],o=n[1]*O;return[(e*=M)*(i*O+k)/(2*k),e*(k-Math.log(Math.tan(C+.5*o)))/(2*k)]}function D(t,e){var n=Object(r.a)(t,2),i=n[0],o=n[1],a=i/(e*=M)*(2*k)-k,s=2*(Math.atan(Math.exp(k-o/e*(2*k)))-C);return[a*I,s*I]}function z(t){var e=t.latitude;Object(P.a)(Number.isFinite(e));var n=Math.cos(e*O);return N(R*n)-9}function B(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:F(r),Object(P.a)(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=M*i,l=Math.cos(e*O),c=u/360,h=c/l,p=u/R/l;if(s.pixelsPerMeter=[p,p,p],s.metersPerPixel=[1/p,1/p,1/p],s.pixelsPerDegree=[c,h,p],s.degreesPerPixel=[1/c,1/h,1/p],a){var f=O*Math.tan(e*O)/l,d=c*f/2,v=u/R*f,g=v/h*p;s.pixelsPerDegree2=[0,d,v],s.pixelsPerMeter2=[g,0,g]}return s}function U(t){var e=t.longitude,n=t.latitude,r=t.zoom,i=t.scale,o=t.meterOffset,a=t.distanceScales,s=void 0===a?null:a,u=j([e,n],i=void 0!==i?i:F(r)),l=new f(u[0],u[1],0);if(o){s=s||B({latitude:n,longitude:e,scale:i});var c=new f(o).scale(s.pixelsPerMeter).scale([1,-1,1]);l.add(c)}return l}function V(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,l=Object(d.a)();return b()(l,l,[0,0,-i]),m()(l,l,[1,1,1/e]),w()(l,l,-n*O),S()(l,l,r*O),u&&m()(l,l,[1,-1,1]),a&&b()(l,l,new f(a).negate()),l}function G(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?L:r,o=t.pitch,a=void 0===o?0:o,s=t.farZMultiplier,u=void 0===s?1:s,l=a*O,c=Math.atan(.5/i),h=Math.sin(c)*i/Math.sin(Math.PI/2-l-c),p=Math.cos(Math.PI/2-l)*h+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:.1,far:p*u}}function W(t){var e=t.width,n=t.height,r=t.pitch,i=t.altitude,o=t.farZMultiplier,a=G({width:e,height:n,altitude:i,pitch:r,farZMultiplier:void 0===o?10:o}),s=a.fov,u=a.aspect,l=a.near,c=a.far;return g()([],s,u,l,c)}function X(t,e){var n=Object(r.a)(t,3),i=n[0],o=n[1],a=n[2],s=void 0===a?0:a;return Object(P.a)(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(s)),Object(d.d)(e,[i,o,s,1])}function H(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object(r.a)(t,3),o=i[0],a=i[1],s=i[2];if(Object(P.a)(Number.isFinite(o)&&Number.isFinite(a)),Number.isFinite(s))return Object(d.d)(e,[o,a,s,1]);var u=Object(d.d)(e,[o,a,0,1]),l=Object(d.d)(e,[o,a,1,1]),c=u[2],h=l[2],p=c===h?0:((n||0)-c)/(h-c);return T()([],u,l,p)}},795:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.startTimestamp=void 0,e.getTimestamp=i;var r=n(725);function i(){if(!r.isBrowser){var t=r.process.hrtime();return t[0]+t[1]/1e6}return r.window.performance?r.window.performance.now():Date.now()}e.startTimestamp=i()},796:function(t,e,n){"use strict";function r(t){var e={0:"",1:"K",2:"M",3:"G","-1":"m","-2":"Âµ","-3":"n"},n=t+"";return n in e?e[n]:"e"+3*t}function i(t){var e=Math.abs,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.isInteger,o=void 0!==r&&r;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){for(var n=e.maxElts,r=void 0===n?16:n,o=e.size,a=void 0===o?1:o,s="[",u=0;u<t.length&&u<r;++u)0<u&&(s+=","+(0==u%a?" ":"")),s+=i(t[u],e);var l=t.length>r?"...":"]";return""+s+l}(t,n);if(!Number.isFinite(t))return t+"";if(e(t)<1e-16)return o?"0":"0.";if(o)return t.toFixed(0);if(100<e(t)&&1e4>e(t))return t.toFixed(0);var a=t.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}Object.defineProperty(e,"__esModule",{value:!0}),e.formatTime=function(t){return 10>t?t.toFixed(2)+"ms":100>t?t.toFixed(1)+"ms":1e3>t?t.toFixed(0)+"ms":(t/1e3).toFixed(2)+"s"},e.leftPad=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(e-t.length,0);return""+" ".repeat(n)+t},e.rightPad=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(e-t.length,0);return""+t+" ".repeat(n)},e.getSISuffix=r,e.formatSI=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:3,n=function(t){var e=t,n=0;if(0!==t){for(;10<=e||-10>=e;)e/=10,n++;for(;1>e&&-1<e;)e*=10,n--}return{base:e,exponent:n}}(t),i=n.base,o=n.exponent,a=Math.floor(o/3);return""+(i*Math.pow(10,o-3*a)).toPrecision(e)+r(a)},e.formatValue=i,e.formatImage=function(t,e,n){var r=Math.floor,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:600,o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));var a=t.width*n,s=t.height*n,u=["font-size:1px;","padding:"+r(s/2)+"px "+r(a/2)+"px;","line-height:"+s+"px;","background:url("+o+");","background-size:"+a+"px "+s+"px;","color:transparent;"].join("");return[e+" %c+",u]}},797:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COLOR=void 0,e.addColor=function(t,e,n){return r.isBrowser||"string"!=typeof t||(e&&(e=o(e),t="["+e+"m"+t+"[39m"),n&&(e=o(n),t="["+(n+10)+"m"+t+"[49m")),t};var r=n(725),i=e.COLOR={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function o(t){return"string"==typeof t?i[t.toUpperCase()]||i.WHITE:t}},798:function(t,e,n){"use strict";n.r(e);var r=n(734),i=n(726);n.d(e,"global",(function(){return i.a}));var o=n(761);if(i.a.luma&&"5.3.1"!==i.a.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(i.a.luma.VERSION," vs ").concat("5.3.1"));i.a.luma||(r.a&&o.a.log(0,"luma.gl ".concat("5.3.1"," - ").concat("set luma.log.priority=1 (or higher) to trace rendering"))(),i.a.luma=i.a.luma||{VERSION:"5.3.1",version:"5.3.1",log:o.a,stats:{},globals:{modules:{},nodeIO:{}}}),e.default=i.a.luma},799:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o);return t}},800:function(t,e){t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},801:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}},802:function(t,e){t.exports=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}},803:function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}},804:function(t,e,n){t.exports=n(883)},805:function(t,e){t.exports=function(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}},806:function(t,e){t.exports=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}},807:function(t,e,n){"use strict";function r(t){if(!t)throw new Error("viewport-mercator-project: assertion failed.")}n.d(e,"a",(function(){return r}))},808:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return l})),n.d(e,"f",(function(){return c})),n.d(e,"a",(function(){return h}));var r=n(747);function i(t,e,n){var i=new r.a(3);return i[0]=t,i[1]=e,i[2]=n,i}function o(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function a(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function s(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function u(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function l(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function c(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function h(t,e){var n=i(t[0],t[1],t[2]),r=i(e[0],e[1],e[2]);a(n,n),a(r,r);var o=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(n,r);return o>1?0:o<-1?Math.PI:Math.acos(o)}var p,f;p=new r.a(3),r.a!=Float32Array&&(p[0]=0,p[1]=0,p[2]=0),f=p},809:function(t,e){t.exports=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}},810:function(t,e){t.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t}},811:function(t,e,n){var r;!function(i,o,a,s){"use strict";var u,l=["","webkit","Moz","MS","ms","o"],c=o.createElement("div"),h="function",p=Math.round,f=Math.abs,d=Date.now;function v(t,e,n){return setTimeout(w(t,n),e)}function g(t,e,n){return!!Array.isArray(t)&&(y(t,n[e],n),!0)}function y(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function m(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=i.console&&(i.console.warn||i.console.log);return o&&o.call(i.console,r,n),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var _=m((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&t[r[i]]===s)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),b=m((function(t,e){return _(t,e,!0)}),"merge","Use `assign`.");function x(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&u(r,n)}function w(t,e){return function(){return t.apply(e,arguments)}}function E(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function S(t,e){return t===s?e:t}function A(t,e,n){y(C(e),(function(e){t.addEventListener(e,n,!1)}))}function T(t,e,n){y(C(e),(function(e){t.removeEventListener(e,n,!1)}))}function P(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function k(t,e){return t.indexOf(e)>-1}function C(t){return t.trim().split(/\s+/g)}function O(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function I(t){return Array.prototype.slice.call(t,0)}function M(t,e,n){for(var r=[],i=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];O(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function R(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;o<l.length;){if((r=(n=l[o])?n+i:e)in t)return r;o++}return s}var L=1;function F(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var N="ontouchstart"in i,j=R(i,"PointerEvent")!==s,D=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z=25,B=1,U=2,V=4,G=8,W=1,X=2,H=4,q=8,Z=16,K=X|H,Y=q|Z,J=K|Y,Q=["x","y"],$=["clientX","clientY"];function tt(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){E(t.options.enable,[t])&&n.handler(e)},this.init()}function et(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=e&B&&r-i==0,a=e&(V|G)&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=nt(e));i>1&&!n.firstMultiple?n.firstMultiple=nt(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,u=a?a.center:o.center,l=e.center=rt(r);e.timeStamp=d(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=st(u,l),e.distance=at(u,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==B&&o.eventType!==V||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y});e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=ot(e.deltaX,e.deltaY);var c=it(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=f(c.x)>f(c.y)?c.x:c.y,e.scale=a?(h=a.pointers,p=r,at(p[0],p[1],$)/at(h[0],h[1],$)):1,e.rotation=a?function(t,e){return st(e[1],e[0],$)+st(t[1],t[0],$)}(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(e.eventType!=G&&(u>z||a.velocity===s)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=it(u,l,c);r=h.x,i=h.y,n=f(h.x)>f(h.y)?h.x:h.y,o=ot(l,c),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}(n,e);var h,p;var v=t.element;P(e.srcEvent.target,v)&&(v=e.srcEvent.target);e.target=v}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function nt(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:p(t.pointers[n].clientX),clientY:p(t.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:e,center:rt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function rt(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:p(n/e),y:p(r/e)}}function it(t,e,n){return{x:e/t||0,y:n/t||0}}function ot(t,e){return t===e?W:f(t)>=f(e)?t<0?X:H:e<0?q:Z}function at(t,e,n){n||(n=Q);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function st(t,e,n){n||(n=Q);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(F(this.element),this.evWin,this.domHandler)}};var ut={mousedown:B,mousemove:U,mouseup:V},lt="mousedown",ct="mousemove mouseup";function ht(){this.evEl=lt,this.evWin=ct,this.pressed=!1,tt.apply(this,arguments)}x(ht,tt,{handler:function(t){var e=ut[t.type];e&B&&0===t.button&&(this.pressed=!0),e&U&&1!==t.which&&(e=V),this.pressed&&(e&V&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var pt={pointerdown:B,pointermove:U,pointerup:V,pointercancel:G,pointerout:G},ft={2:"touch",3:"pen",4:"mouse",5:"kinect"},dt="pointerdown",vt="pointermove pointerup pointercancel";function gt(){this.evEl=dt,this.evWin=vt,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(dt="MSPointerDown",vt="MSPointerMove MSPointerUp MSPointerCancel"),x(gt,tt,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=pt[r],o=ft[t.pointerType]||t.pointerType,a="touch"==o,s=O(e,t.pointerId,"pointerId");i&B&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):i&(V|G)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var yt={touchstart:B,touchmove:U,touchend:V,touchcancel:G},mt="touchstart",_t="touchstart touchmove touchend touchcancel";function bt(){this.evTarget=mt,this.evWin=_t,this.started=!1,tt.apply(this,arguments)}function xt(t,e){var n=I(t.touches),r=I(t.changedTouches);return e&(V|G)&&(n=M(n.concat(r),"identifier",!0)),[n,r]}x(bt,tt,{handler:function(t){var e=yt[t.type];if(e===B&&(this.started=!0),this.started){var n=xt.call(this,t,e);e&(V|G)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var wt={touchstart:B,touchmove:U,touchend:V,touchcancel:G},Et="touchstart touchmove touchend touchcancel";function St(){this.evTarget=Et,this.targetIds={},tt.apply(this,arguments)}function At(t,e){var n=I(t.touches),r=this.targetIds;if(e&(B|U)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=I(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return P(t.target,u)})),e===B)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),e&(V|G)&&delete r[a[i].identifier],i++;return s.length?[M(o.concat(s),"identifier",!0),s]:void 0}x(St,tt,{handler:function(t){var e=wt[t.type],n=At.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});var Tt=2500,Pt=25;function kt(){tt.apply(this,arguments);var t=w(this.handler,this);this.touch=new St(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ct(t,e){t&B?(this.primaryTouch=e.changedPointers[0].identifier,Ot.call(this,e)):t&(V|G)&&Ot.call(this,e)}function Ot(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),Tt)}}function It(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=Pt&&a<=Pt)return!0}return!1}x(kt,tt,{handler:function(t,e,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Ct.call(this,e,n);else if(i&&It.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Mt=R(c.style,"touchAction"),Rt=Mt!==s,Lt="auto",Ft="manipulation",Nt="none",jt="pan-x",Dt="pan-y",zt=function(){if(!Rt)return!1;var t={},e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||i.CSS.supports("touch-action",n)})),t}();function Bt(t,e){this.manager=t,this.set(e)}Bt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Rt&&this.manager.element.style&&zt[t]&&(this.manager.element.style[Mt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return y(this.manager.recognizers,(function(e){E(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(k(t,Nt))return Nt;var e=k(t,jt),n=k(t,Dt);if(e&&n)return Nt;if(e||n)return e?jt:Dt;if(k(t,Ft))return Ft;return Lt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=k(r,Nt)&&!zt[Nt],o=k(r,Dt)&&!zt[Dt],a=k(r,jt)&&!zt[jt];if(i){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&n&K||a&&n&Y?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ut=1,Vt=2,Gt=4,Wt=8,Xt=Wt,Ht=16;function qt(t){this.options=u({},this.defaults,t||{}),this.id=L++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Ut,this.simultaneous={},this.requireFail=[]}function Zt(t){return t&Ht?"cancel":t&Wt?"end":t&Gt?"move":t&Vt?"start":""}function Kt(t){return t==Z?"down":t==q?"up":t==X?"left":t==H?"right":""}function Yt(t,e){var n=e.manager;return n?n.get(t):t}function Jt(){qt.apply(this,arguments)}function Qt(){Jt.apply(this,arguments),this.pX=null,this.pY=null}function $t(){Jt.apply(this,arguments)}function te(){qt.apply(this,arguments),this._timer=null,this._input=null}function ee(){Jt.apply(this,arguments)}function ne(){Jt.apply(this,arguments)}function re(){qt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ie(t,e){return(e=e||{}).recognizers=S(e.recognizers,ie.defaults.preset),new oe(t,e)}qt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Yt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)?this:(t=Yt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return-1===O(e,t=Yt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=Yt(t,this);var e=O(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<Wt&&r(e.options.event+Zt(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=Wt&&r(e.options.event+Zt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Ut)))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!E(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Xt|Ht|32)&&(this.state=Ut),this.state=this.process(e),this.state&(Vt|Gt|Wt|Ht)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(Jt,qt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=e&(Vt|Gt),i=this.attrTest(t);return r&&(n&G||!i)?e|Ht:r||i?n&V?e|Wt:e&Vt?e|Gt:Vt:32}}),x(Qt,Jt,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&K&&e.push(Dt),t&Y&&e.push(jt),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(e.direction&K?(i=0===o?W:o<0?X:H,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?W:a<0?q:Z,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return Jt.prototype.attrTest.call(this,t)&&(this.state&Vt||!(this.state&Vt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Kt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x($t,Jt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Vt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),x(te,qt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Lt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(V|G)&&!i)this.reset();else if(t.eventType&B)this.reset(),this._timer=v((function(){this.state=Xt,this.tryEmit()}),e.time,this);else if(t.eventType&V)return Xt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Xt&&(t&&t.eventType&V?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),x(ee,Jt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Vt)}}),x(ne,Jt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|Y,pointers:1},getTouchAction:function(){return Qt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(K|Y)?e=t.overallVelocity:n&K?e=t.overallVelocityX:n&Y&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&f(e)>this.options.velocity&&t.eventType&V},emit:function(t){var e=Kt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x(re,qt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ft]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&B&&0===this.count)return this.failTimeout();if(r&&i&&n){if(t.eventType!=V)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||at(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=Xt,this.tryEmit()}),e.interval,this),Vt):Xt}return 32},failTimeout:function(){return this._timer=v((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Xt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ie.VERSION="2.0.7",ie.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ee,{enable:!1}],[$t,{enable:!1},["rotate"]],[ne,{direction:K}],[Qt,{direction:K},["swipe"]],[re],[re,{event:"doubletap",taps:2},["tap"]],[te]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function oe(t,e){var n;this.options=u({},ie.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(j?gt:D?St:N?kt:ht))(n,et),this.touchAction=new Bt(this,this.options.touchAction),ae(this,!0),y(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function ae(t,e){var n,r=t.element;r.style&&(y(t.options.cssProps,(function(i,o){n=R(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}oe.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&i.state&Xt)&&(i=e.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&n.state&(Vt|Gt|Wt)&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof qt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=O(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return y(C(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==s){var n=this.handlers;return y(C(t),(function(t){e?n[t]&&n[t].splice(O(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&ae(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(ie,{INPUT_START:B,INPUT_MOVE:U,INPUT_END:V,INPUT_CANCEL:G,STATE_POSSIBLE:Ut,STATE_BEGAN:Vt,STATE_CHANGED:Gt,STATE_ENDED:Wt,STATE_RECOGNIZED:Xt,STATE_CANCELLED:Ht,STATE_FAILED:32,DIRECTION_NONE:W,DIRECTION_LEFT:X,DIRECTION_RIGHT:H,DIRECTION_UP:q,DIRECTION_DOWN:Z,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:Y,DIRECTION_ALL:J,Manager:oe,Input:tt,TouchAction:Bt,TouchInput:St,MouseInput:ht,PointerEventInput:gt,TouchMouseInput:kt,SingleTouchInput:bt,Recognizer:qt,AttrRecognizer:Jt,Tap:re,Pan:Qt,Swipe:ne,Pinch:$t,Rotate:ee,Press:te,on:A,off:T,each:y,merge:b,extend:_,assign:u,inherit:x,bindFn:w,prefixed:R}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=ie,(r=function(){return ie}.call(e,n,e,t))===s||(t.exports=r)}(window,document)},812:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=!0,o=!1,a=void 0;try{for(var s,u=function(){var e=s.value;"function"==typeof t[e]&&(r.find((function(t){return e===t}))||(t[e]=t[e].bind(t)))},l=n[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)u()}catch(t){o=!0,a=t}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}};var r=["constructor","render","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount"]},813:function(t,e,n){"use strict";function r(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}n.d(e,"a",(function(){return r}))},814:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"h",(function(){return a})),n.d(e,"g",(function(){return s})),n.d(e,"e",(function(){return u})),n.d(e,"f",(function(){return l})),n.d(e,"d",(function(){return c})),n.d(e,"a",(function(){return h}));var r=n(747);function i(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],g=e[14],y=e[15],m=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*v-h*d,A=c*g-p*d,T=c*y-f*d,P=h*g-p*v,k=h*y-f*v,C=p*y-f*g,O=m*C-_*k+b*P+x*T-w*A+E*S;return O?(O=1/O,t[0]=(s*C-u*k+l*P)*O,t[1]=(i*k-r*C-o*P)*O,t[2]=(v*E-g*w+y*x)*O,t[3]=(p*w-h*E-f*x)*O,t[4]=(u*T-a*C-l*A)*O,t[5]=(n*C-i*T+o*A)*O,t[6]=(g*b-d*E-y*_)*O,t[7]=(c*E-p*b+f*_)*O,t[8]=(a*k-s*T+l*S)*O,t[9]=(r*T-n*k-o*S)*O,t[10]=(d*w-v*b+y*m)*O,t[11]=(h*b-c*w-f*m)*O,t[12]=(s*A-a*P-u*S)*O,t[13]=(n*P-r*A+i*S)*O,t[14]=(v*_-d*x-g*m)*O,t[15]=(c*x-h*_+p*m)*O,t):null}function o(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],g=e[13],y=e[14],m=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*v,t[1]=_*i+b*u+x*p+w*g,t[2]=_*o+b*l+x*f+w*y,t[3]=_*a+b*c+x*d+w*m,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*r+b*s+x*h+w*v,t[5]=_*i+b*u+x*p+w*g,t[6]=_*o+b*l+x*f+w*y,t[7]=_*a+b*c+x*d+w*m,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*r+b*s+x*h+w*v,t[9]=_*i+b*u+x*p+w*g,t[10]=_*o+b*l+x*f+w*y,t[11]=_*a+b*c+x*d+w*m,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*r+b*s+x*h+w*v,t[13]=_*i+b*u+x*p+w*g,t[14]=_*o+b*l+x*f+w*y,t[15]=_*a+b*c+x*d+w*m,t}function a(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*g+e[8]*y+e[12],t[13]=e[1]*v+e[5]*g+e[9]*y+e[13],t[14]=e[2]*v+e[6]*g+e[10]*y+e[14],t[15]=e[3]*v+e[7]*g+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*v+s*g+h*y+e[12],t[13]=i*v+u*g+p*y+e[13],t[14]=o*v+l*g+f*y+e[14],t[15]=a*v+c*g+d*y+e[15]),t}function s(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function u(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t}function l(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t}function c(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}function h(t,e){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],v=t[12],g=t[13],y=t[14],m=t[15],_=e[0],b=e[1],x=e[2],w=e[3],E=e[4],S=e[5],A=e[6],T=e[7],P=e[8],k=e[9],C=e[10],O=e[11],I=e[12],M=e[13],R=e[14],L=e[15];return Math.abs(n-_)<=r.b*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=r.b*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=r.b*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=r.b*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-E)<=r.b*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-S)<=r.b*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-A)<=r.b*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(c-T)<=r.b*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-P)<=r.b*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(p-k)<=r.b*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(f-C)<=r.b*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-O)<=r.b*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(v-I)<=r.b*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-M)<=r.b*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(y-R)<=r.b*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(m-L)<=r.b*Math.max(1,Math.abs(m),Math.abs(L))}},815:function(t,e,n){t.exports=function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),(n=i(a)).workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else e=i;else t=i}return r(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}function a(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!a(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var r in t)if(!a(t[r],e[r]))return!1;return!0}return t===e}function s(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var u=s(.25,.1,.25,1);function l(t,e,n){return Math.min(n,Math.max(e,t))}function c(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function h(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var p=1;function f(){return p++}function d(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function v(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function g(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function y(t,e){return-1!==t.indexOf(e,t.length-e.length)}function m(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function _(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?m(t,b):t}var x={};function w(t){x[t]||("undefined"!=typeof console&&console.warn(t),x[t]=!0)}function E(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function S(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)o=t[n],e+=((a=t[i]).x-o.x)*(o.y+a.y);return e}function A(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var T,P,k,C=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),O=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,I=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,M={now:C,frame:function(t){var e=O(t);return{cancel:function(){return I(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(0,0,t.width,t.height)},resolveURL:function(t){return T||(T=self.document.createElement("a")),T.href=t,T.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio}},R={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},L={supported:!1,testSupport:function(t){!F&&k&&(N?j(t):P=t)}},F=!1,N=!1;function j(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,k),t.isContextLost())return;L.supported=!0}catch(t){}t.deleteTexture(e),F=!0}self.document&&((k=self.document.createElement("img")).onload=function(){P&&j(P),P=null,N=!0},k.onerror=function(){F=!0,P=null},k.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var D="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes";function z(t,e){var n=q(R.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!R.REQUIRE_ACCESS_TOKEN)return Z(t);if(!(e=e||R.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+D);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+D);return t.params.push("access_token="+e),Z(t)}function B(t){return 0===t.indexOf("mapbox:")}var U=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function V(t){return U.test(t)}var G=/(\.(png|jpg)\d*)(?=$)/,W=/\.[\w]+$/,X=function(t){var e=q(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(W))return t;var n="mapbox://tiles/";n+=e.path.replace("/v4/","");var r=e.params.filter((function(t){return!t.match(/^access_token=/)}));return r.length&&(n+="?"+r.join("&")),n},H=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/;function q(t){var e=t.match(H);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Z(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function K(t){if(!t)return null;var e,n=t.split(".");if(!n||3!==n.length)return null;try{return JSON.parse((e=n[1],decodeURIComponent(self.atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))))}catch(t){return null}}var Y=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Y.prototype.getStorageKey=function(t){var e,n=K(R.ACCESS_TOKEN),r="";return n&&n.u?(e=n.u,r=self.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))})))):r=R.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+r:"mapbox.eventData:"+r},Y.prototype.fetchEventData=function(){var t=A("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=self.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=self.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){w("Unable to read from LocalStorage")}},Y.prototype.saveEventData=function(){var t=A("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){w("Unable to write to LocalStorage")}},Y.prototype.processRequests=function(){},Y.prototype.postEvent=function(t,e,n){var r=this;if(R.EVENTS_URL){var i=q(R.EVENTS_URL);i.params.push("access_token="+(R.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"0.54.1",userId:this.anonId},a=e?h(o,e):o,s={url:Z(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=ct(s,(function(t){r.pendingRequest=null,n(t),r.saveEventData(),r.processRequests()}))}},Y.prototype.queueRequest=function(t){this.queue.push(t),this.processRequests()};var J=function(t){function e(){t.call(this,"map.load"),this.success={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postMapLoadEvent=function(t,e){R.EVENTS_URL&&R.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return B(t)||V(t)}))&&this.queueRequest({id:e,timestamp:Date.now()})},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=this.queue.shift(),n=e.id,r=e.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),v(this.anonId)||(this.anonId=d()),this.postEvent(r,{},(function(e){e||n&&(t.success[n]=!0)})))}},e}(Y),Q=new(function(t){function e(){t.call(this,"appUserTurnstile")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postTurnstileEvent=function(t){R.EVENTS_URL&&R.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return B(t)||V(t)}))&&this.queueRequest(Date.now())},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var e=K(R.ACCESS_TOKEN),n=e?e.u:R.ACCESS_TOKEN,r=n!==this.eventData.tokenU;v(this.anonId)||(this.anonId=d(),r=!0);var i=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),a=new Date(i),s=(i-this.eventData.lastSuccess)/864e5;r=r||s>=1||s<-1||o.getDate()!==a.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(i,{"enabled.telemetry":!1},(function(e){e||(t.eventData.lastSuccess=i,t.eventData.tokenU=n)}))}},e}(Y)),$=Q.postTurnstileEvent.bind(Q),tt=new J,et=tt.postMapLoadEvent.bind(tt),nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(nt);var rt=function(t){function e(e,n,r){401===n&&V(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function it(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}var ot,at,st=it()?function(){return self.worker&&self.worker.referrer}:function(){var t=self.location.origin;if(t&&"null"!==t&&"file://"!==t)return t+self.location.pathname},ut=function(t,e){if(!/^file:/.test(t.url)){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n=new self.AbortController,r=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:st(),signal:n.signal});return"json"===t.type&&r.headers.set("Accept","application/json"),self.fetch(r).then((function(n){n.ok?n[t.type||"text"]().then((function(t){e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires"))})).catch((function(t){return e(new Error(t.message))})):e(new rt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))})),{cancel:function(){return n.abort()}}}(t,e);if(it()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e)}return function(t,e){var n=new self.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&n.setRequestHeader("Accept","application/json"),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new rt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},lt=function(t,e){return ut(h(t,{type:"arrayBuffer"}),e)},ct=function(t,e){return ut(h(t,{method:"POST"}),e)};ot=[],at=0;var ht=function(t,e){if(at>=R.MAX_PARALLEL_IMAGE_REQUESTS){var n={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return ot.push(n),n}at++;var r=!1,i=function(){if(!r)for(r=!0,at--;ot.length&&at<R.MAX_PARALLEL_IMAGE_REQUESTS;){var t=ot.shift(),e=t.requestParameters,n=t.callback;t.cancelled||(t.cancel=ht(e,n).cancel)}},o=lt(t,(function(t,n,r,o){if(i(),t)e(t);else if(n){var a=new self.Image,s=self.URL||self.webkitURL;a.onload=function(){e(null,a),s.revokeObjectURL(a.src)},a.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var u=new self.Blob([new Uint8Array(n)],{type:"image/png"});a.cacheControl=r,a.expires=o,a.src=n.byteLength?s.createObjectURL(u):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}));return{cancel:function(){o.cancel(),i()}}};function pt(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function ft(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var dt=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},vt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",h({error:e},n))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dt),gt=function(){};gt.prototype.on=function(t,e){return this._listeners=this._listeners||{},pt(t,e,this._listeners),this},gt.prototype.off=function(t,e){return ft(t,e,this._listeners),ft(t,e,this._oneTimeListeners),this},gt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},pt(t,e,this._oneTimeListeners),this},gt.prototype.fire=function(t,e){"string"==typeof t&&(t=new dt(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];ft(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof vt&&console.error(t.error);return this},gt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},gt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var yt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:[{"!":"text-offset"}],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[{"!":"text-anchor"},{"!":"text-offset"},{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",requires:["text-field"],values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},mt=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function _t(t){var e=t.key,n=t.value;return n?[new mt(e,n,"constants have been deprecated as of v8")]:[]}function bt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function xt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function wt(t){return Array.isArray(t)?t.map(wt):xt(t)}var Et=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),St=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n],o=i[0],a=i[1];this.bindings[o]=a}};St.prototype.concat=function(t){return new St(this,t)},St.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},St.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var At={kind:"null"},Tt={kind:"number"},Pt={kind:"string"},kt={kind:"boolean"},Ct={kind:"color"},Ot={kind:"object"},It={kind:"value"},Mt={kind:"collator"},Rt={kind:"formatted"};function Lt(t,e){return{kind:"array",itemType:t,N:e}}function Ft(t){if("array"===t.kind){var e=Ft(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Nt=[At,Tt,Pt,kt,Ct,Rt,Ot,Lt(It)];function jt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!jt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=Nt;n<r.length;n+=1)if(!jt(r[n],e))return null}return"Expected "+Ft(t)+" but found "+Ft(e)+" instead."}var Dt=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?r(parseFloat(t)/100*255):r(parseInt(t))}function a(t){return"%"===t[t.length-1]?i(parseFloat(t)/100):i(parseFloat(t))}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in n)return n[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=i.indexOf("("),l=i.indexOf(")");if(-1!==u&&l+1===i.length){var c=i.substr(0,u),h=i.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),v=a(h[2]),g=v<=.5?v*(d+1):v+d-v*d,y=2*v-g;return[r(255*s(y,g,f+1/3)),r(255*s(y,g,f)),r(255*s(y,g,f-1/3)),p];default:return null}}return null}}catch(t){}})).parseCSSColor,zt=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};zt.parse=function(t){if(t){if(t instanceof zt)return t;if("string"==typeof t){var e=Dt(t);if(e)return new zt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},zt.prototype.toString=function(){var t=this.toArray(),e=t[0],n=t[1],r=t[2],i=t[3];return"rgba("+Math.round(e)+","+Math.round(n)+","+Math.round(r)+","+i+")"},zt.prototype.toArray=function(){var t=this.r,e=this.g,n=this.b,r=this.a;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*n/r,r]},zt.black=new zt(0,0,0,1),zt.white=new zt(1,1,1,1),zt.transparent=new zt(0,0,0,0),zt.red=new zt(1,0,0,1);var Bt=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Bt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Bt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ut=function(t,e,n){this.text=t,this.scale=e,this.fontStack=n},Vt=function(t){this.sections=t};function Gt(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Wt(t){if(null===t)return At;if("string"==typeof t)return Pt;if("boolean"==typeof t)return kt;if("number"==typeof t)return Tt;if(t instanceof zt)return Ct;if(t instanceof Bt)return Mt;if(t instanceof Vt)return Rt;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=Wt(i[r]);if(e){if(e===o)continue;e=It;break}e=o}return Lt(e||It,n)}return Ot}function Xt(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof zt||t instanceof Vt?t.toString():JSON.stringify(t)}Vt.fromString=function(t){return new Vt([new Ut(t,null,null)])},Vt.prototype.toString=function(){return this.sections.map((function(t){return t.text})).join("")},Vt.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),t.push(i)}return t};var Ht=function(t,e){this.type=t,this.value=e};Ht.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof zt)return!0;if(e instanceof Bt)return!0;if(e instanceof Vt)return!0;if(Array.isArray(e)){for(var n=0,r=e;n<r.length;n+=1)if(!t(r[n]))return!1;return!0}if("object"==typeof e){for(var i in e)if(!t(e[i]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var n=t[1],r=Wt(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Ht(r,n)},Ht.prototype.evaluate=function(){return this.value},Ht.prototype.eachChild=function(){},Ht.prototype.possibleOutputs=function(){return[this.value]},Ht.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zt?["rgba"].concat(this.value.toArray()):this.value instanceof Vt?this.value.serialize():this.value};var qt=function(t){this.name="ExpressionEvaluationError",this.message=t};qt.prototype.toJSON=function(){return this.message};var Zt={string:Pt,number:Tt,boolean:kt,object:Ot},Kt=function(t,e){this.type=t,this.args=e};Kt.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in Zt)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=Zt[s],r++}else o=It;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=Lt(o,a)}else n=Zt[i];for(var u=[];r<t.length;r++){var l=e.parse(t[r],r,It);if(!l)return null;u.push(l)}return new Kt(n,u)},Kt.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!jt(this.type,Wt(n)))return n;if(e===this.args.length-1)throw new qt("Expected value to be of type "+Ft(this.type)+", but found "+Ft(Wt(n))+" instead.")}return null},Kt.prototype.eachChild=function(t){this.args.forEach(t)},Kt.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},Kt.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var Yt=function(t){this.type=Rt,this.sections=t};Yt.parse=function(t,e){if(t.length<3)return e.error("Expected at least two arguments.");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");for(var n=[],r=1;r<t.length-1;r+=2){var i=e.parse(t[r],1,It);if(!i)return null;var o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o)return e.error("Formatted text type must be 'string', 'value', or 'null'.");var a=t[r+1];if("object"!=typeof a||Array.isArray(a))return e.error("Format options argument must be an object.");var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Tt)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,Lt(Pt))))return null;n.push({text:i,scale:s,font:u})}return new Yt(n)},Yt.prototype.evaluate=function(t){return new Vt(this.sections.map((function(e){return new Ut(Xt(e.text.evaluate(t)),e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null)})))},Yt.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.text),r.scale&&t(r.scale),r.font&&t(r.font)}},Yt.prototype.possibleOutputs=function(){return[void 0]},Yt.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.text.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),t.push(i)}return t};var Jt={"to-boolean":kt,"to-color":Ct,"to-number":Tt,"to-string":Pt},Qt=function(t,e){this.type=t,this.args=e};Qt.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=Jt[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,It);if(!a)return null;i.push(a)}return new Qt(r,i)},Qt.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof zt)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Gt(e[0],e[1],e[2],e[3])))return new zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new qt(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new qt("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?Vt.fromString(Xt(this.args[0].evaluate(t))):Xt(this.args[0].evaluate(t))},Qt.prototype.eachChild=function(t){this.args.forEach(t)},Qt.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},Qt.prototype.serialize=function(){if("formatted"===this.type.kind)return new Yt([{text:this.args[0],scale:null,font:null}]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var $t=["Unknown","Point","LineString","Polygon"],te=function(){this.globals=null,this.feature=null,this.featureState=null,this._parseColorCache={}};te.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},te.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?$t[this.feature.type]:this.feature.type:null},te.prototype.properties=function(){return this.feature&&this.feature.properties||{}},te.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=zt.parse(t)),e};var ee=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};ee.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ee.prototype.eachChild=function(t){this.args.forEach(t)},ee.prototype.possibleOutputs=function(){return[void 0]},ee.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ee.parse=function(t,e){var n,r=t[0],i=ee.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new se(e.registry,e.path,null,e.scope);for(var d=[],v=!1,g=1;g<t.length;g++){var y=t[g],m=Array.isArray(p)?p[g-1]:p.type,_=u.parse(y,1+d.length,m);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var b=0;b<d.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=d[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new ee(r,o,f,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var E=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Ft).join(", ")+")":"("+Ft(e.type)+"...)"})).join(" | "),S=[],A=1;A<t.length;A++){var T=e.parse(t[A],1+S.length);if(!T)return null;S.push(Ft(T.type))}e.error("Expected arguments of type "+E+", but found ("+S.join(", ")+") instead.")}return null},ee.register=function(t,e){for(var n in ee.definitions=e,e)t[n]=ee};var ne=function(t,e,n){this.type=Mt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function re(t){if(t instanceof ee){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild((function(t){e&&!re(t)&&(e=!1)})),e}function ie(t){if(t instanceof ee&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!ie(t)&&(e=!1)})),e}function oe(t,e){if(t instanceof ee&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!oe(t,e)&&(n=!1)})),n}ne.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,kt);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,kt);if(!i)return null;var o=null;return n.locale&&!(o=e.parse(n.locale,1,Pt))?null:new ne(r,i,o)},ne.prototype.evaluate=function(t){return new Bt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ne.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ne.prototype.possibleOutputs=function(){return[void 0]},ne.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ae=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};ae.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new ae(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},ae.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},ae.prototype.eachChild=function(){},ae.prototype.possibleOutputs=function(){return[void 0]},ae.prototype.serialize=function(){return["var",this.name]};var se=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new St),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function ue(t,e){for(var n,r,i=0,o=t.length-1,a=0;i<=o;){if(n=t[a=Math.floor((i+o)/2)],r=t[a+1],e===n||e>n&&e<r)return a;if(n<e)i=a+1;else{if(!(n>e))throw new qt("Input is not a number.");o=a-1}}return Math.max(a-1,0)}se.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},se.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new Kt(e,[t]):"coerce"===n?new Qt(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=n(o,a,e.typeAnnotation||"coerce");else o=n(o,a,e.typeAnnotation||"assert")}if(!(o instanceof Ht)&&function t(e){if(e instanceof ae)return t(e.boundExpression);if(e instanceof ee&&"error"===e.name)return!1;if(e instanceof ne)return!1;var n=e instanceof Qt||e instanceof Kt,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof Ht})),!!r&&re(e)&&oe(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(o)){var u=new te;try{o=new Ht(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},se.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new se(this.registry,r,e||null,i,this.errors)},se.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Et(r,t))},se.prototype.checkSubtype=function(t,e){var n=jt(t,e);return n&&this.error(n),n};var le=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};function ce(t,e,n){return t*(1-n)+e*n}le.parse=function(t,e){var n=t[1],r=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,1,Tt)))return null;var i=[],o=null;e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType),r.unshift(-1/0);for(var a=0;a<r.length;a+=2){var s=r[a],u=r[a+1],l=a+1,c=a+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(i.length&&i[i.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var h=e.parse(u,c,o);if(!h)return null;o=o||h.type,i.push([s,h])}return new le(o,n,i)},le.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[ue(e,r)].evaluate(t)},le.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},le.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()})))},le.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var he=Object.freeze({number:ce,color:function(t,e,n){return new zt(ce(t.r,e.r,n),ce(t.g,e.g,n),ce(t.b,e.b,n),ce(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return ce(t,e[r],n)}))}}),pe=.95047,fe=1,de=1.08883,ve=4/29,ge=6/29,ye=3*ge*ge,me=ge*ge*ge,_e=Math.PI/180,be=180/Math.PI;function xe(t){return t>me?Math.pow(t,1/3):t/ye+ve}function we(t){return t>ge?t*t*t:ye*(t-ve)}function Ee(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Se(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ae(t){var e=Se(t.r),n=Se(t.g),r=Se(t.b),i=xe((.4124564*e+.3575761*n+.1804375*r)/pe),o=xe((.2126729*e+.7151522*n+.072175*r)/fe);return{l:116*o-16,a:500*(i-o),b:200*(o-xe((.0193339*e+.119192*n+.9503041*r)/de)),alpha:t.a}}function Te(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=fe*we(e),n=pe*we(n),r=de*we(r),new zt(Ee(3.2404542*n-1.5371385*e-.4985314*r),Ee(-.969266*n+1.8760108*e+.041556*r),Ee(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function Pe(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var ke={forward:Ae,reverse:Te,interpolate:function(t,e,n){return{l:ce(t.l,e.l,n),a:ce(t.a,e.a,n),b:ce(t.b,e.b,n),alpha:ce(t.alpha,e.alpha,n)}}},Ce={forward:function(t){var e=Ae(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*be;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*_e,n=t.c;return Te({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Pe(t.h,e.h,n),c:ce(t.c,e.c,n),l:ce(t.l,e.l,n),alpha:ce(t.alpha,e.alpha,n)}}},Oe=Object.freeze({lab:ke,hcl:Ce}),Ie=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[0],l=s[1];this.labels.push(u),this.outputs.push(l)}};function Me(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}Ie.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=Me(e,t.base,r,i);else if("linear"===t.name)o=Me(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(Me(e,1,r,i))}return o},Ie.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Tt)))return null;var u=[],l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=Ct:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=e.parse(p,d,l);if(!v)return null;l=l||v.type,u.push([h,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Ie(l,n,r,i,u):e.error("Type "+Ft(l)+" is not interpolatable.")},Ie.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=ue(e,r),a=e[o],s=e[o+1],u=Ie.interpolationFactor(this.interpolation,r,a,s),l=n[o].evaluate(t),c=n[o+1].evaluate(t);return"interpolate"===this.operator?he[this.type.kind.toLowerCase()](l,c,u):"interpolate-hcl"===this.operator?Ce.reverse(Ce.interpolate(Ce.forward(l),Ce.forward(c),u)):ke.reverse(ke.interpolate(ke.forward(l),ke.forward(c),u))},Ie.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ie.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()})))},Ie.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var Re=function(t,e){this.type=t,this.args=e};Re.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],u=e.parse(s,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!u)return null;n=n||u.type,i.push(u)}var l=r&&i.some((function(t){return jt(r,t.type)}));return new Re(l?It:n,i)},Re.prototype.evaluate=function(t){for(var e=null,n=0,r=this.args;n<r.length&&null===(e=r[n].evaluate(t));n+=1);return e},Re.prototype.eachChild=function(t){this.args.forEach(t)},Re.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map((function(t){return t.possibleOutputs()})))},Re.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Le=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Le.prototype.evaluate=function(t){return this.result.evaluate(t)},Le.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},Le.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var o=e.parse(t[r+1],r+1);if(!o)return null;n.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return a?new Le(n,a):null},Le.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Le.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e],i=r[0],o=r[1];t.push(i,o.serialize())}return t.push(this.result.serialize()),t};var Fe=function(t,e,n){this.type=t,this.index=e,this.input=n};Fe.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Tt),r=e.parse(t[2],2,Lt(e.expectedType||It));if(!n||!r)return null;var i=r.type;return new Fe(i.itemType,n,r)},Fe.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new qt("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new qt("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new qt("Array index must be an integer, but found "+e+" instead.");return n[e]},Fe.prototype.eachChild=function(t){t(this.index),t(this.input)},Fe.prototype.possibleOutputs=function(){return[void 0]},Fe.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ne=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};Ne.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,Wt(p)))return null}else n=Wt(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(u,a,r);if(!f)return null;r=r||f.type,o.push(f)}var d=e.parse(t[1],1,It);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,r);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new Ne(n,r,d,i,o,v):null},Ne.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Wt(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Ne.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Ne.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map((function(t){return t.possibleOutputs()}))).concat(this.otherwise.possibleOutputs())},Ne.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=n;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];1===p.length?e.push(s(p[0])):e.push(p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var je=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};function De(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ze(t,e,n,r){return 0===r.compare(e,n)}function Be(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=kt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,It);if(!o)return null;if(!De(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Ft(o.type)+"'.");var a=e.parse(t[2],2,It);if(!a)return null;if(!De(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Ft(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Ft(o.type)+"' and '"+Ft(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Kt(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Kt(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Mt)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=Wt(o),u=Wt(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new qt('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var l=Wt(o),c=Wt(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.possibleOutputs=function(){return[!0,!1]},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}je.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,kt);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new je(n,r,s):null},je.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[0],o=r[1];if(i.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},je.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[0],o=r[1];t(i),t(o)}t(this.otherwise)},je.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map((function(t){return t[0],t[1].possibleOutputs()}))).concat(this.otherwise.possibleOutputs())},je.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Ue=Be("==",(function(t,e,n){return e===n}),ze),Ve=Be("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!ze(0,e,n,r)})),Ge=Be("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),We=Be(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),Xe=Be("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),He=Be(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),qe=function(t,e,n,r,i){this.type=Pt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};qe.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Tt);if(!n)return null;var r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Pt)))return null;var o=null;if(r.currency&&!(o=e.parse(r.currency,1,Pt)))return null;var a=null;if(r["min-fraction-digits"]&&!(a=e.parse(r["min-fraction-digits"],1,Tt)))return null;var s=null;return r["max-fraction-digits"]&&!(s=e.parse(r["max-fraction-digits"],1,Tt))?null:new qe(n,i,o,a,s)},qe.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},qe.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},qe.prototype.possibleOutputs=function(){return[void 0]},qe.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Ze=function(t){this.type=Tt,this.input=t};Ze.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Ft(n.type)+" instead."):new Ze(n):null},Ze.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new qt("Expected value to be of type string or array, but found "+Ft(Wt(e))+" instead.")},Ze.prototype.eachChild=function(t){t(this.input)},Ze.prototype.possibleOutputs=function(){return[void 0]},Ze.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Ke={"==":Ue,"!=":Ve,">":We,"<":Ge,">=":He,"<=":Xe,array:Kt,at:Fe,boolean:Kt,case:je,coalesce:Re,collator:ne,format:Yt,interpolate:Ie,"interpolate-hcl":Ie,"interpolate-lab":Ie,length:Ze,let:Le,literal:Ht,match:Ne,number:Kt,"number-format":qe,object:Kt,step:le,string:Kt,"to-boolean":Qt,"to-color":Qt,"to-number":Qt,"to-string":Qt,var:ae};function Ye(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=Gt(n,r,i,a);if(s)throw new qt(s);return new zt(n/255*a,r/255*a,i/255*a,a)}function Je(t,e){return t in e}function Qe(t,e){var n=e[t];return void 0===n?null:n}function $e(t){return{type:t}}function tn(t){return{result:"success",value:t}}function en(t){return{result:"error",value:t}}function nn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function rn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function on(t){return!!t.expression&&t.expression.interpolated}function an(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function sn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function un(t){return t}function ln(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function cn(t,e,n,r,i){return ln(typeof n===i?r[n]:void 0,t.default,e.default)}function hn(t,e,n){if("number"!==an(n))return ln(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=dn(t.stops,n);return t.stops[i][1]}function pn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==an(n))return ln(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=dn(t.stops,n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=he[e.type]||un;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=Oe[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return l(n,r,a)}}:l(s,u,a)}function fn(t,e,n){return"color"===e.type?n=zt.parse(n):"formatted"===e.type?n=Vt.fromString(n.toString()):an(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),ln(n,t.default,e.default)}function dn(t,e){for(var n,r,i=0,o=t.length-1,a=0;i<=o;){if(n=t[a=Math.floor((i+o)/2)][0],r=t[a+1][0],e===n||e>n&&e<r)return a;n<e?i=a+1:n>e&&(o=a-1)}return Math.max(a-1,0)}ee.register(Ke,{error:[{kind:"error"},[Pt],function(t,e){var n=e[0];throw new qt(n.evaluate(t))}],typeof:[Pt,[It],function(t,e){return Ft(Wt(e[0].evaluate(t)))}],"to-rgba":[Lt(Tt,4),[Ct],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ct,[Tt,Tt,Tt],Ye],rgba:[Ct,[Tt,Tt,Tt,Tt],Ye],has:{type:kt,overloads:[[[Pt],function(t,e){return Je(e[0].evaluate(t),t.properties())}],[[Pt,Ot],function(t,e){var n=e[0],r=e[1];return Je(n.evaluate(t),r.evaluate(t))}]]},get:{type:It,overloads:[[[Pt],function(t,e){return Qe(e[0].evaluate(t),t.properties())}],[[Pt,Ot],function(t,e){var n=e[0],r=e[1];return Qe(n.evaluate(t),r.evaluate(t))}]]},"feature-state":[It,[Pt],function(t,e){return Qe(e[0].evaluate(t),t.featureState||{})}],properties:[Ot,[],function(t){return t.properties()}],"geometry-type":[Pt,[],function(t){return t.geometryType()}],id:[It,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[It,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Tt,$e(Tt),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[Tt,$e(Tt),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,e){var n=e[0],r=e[1];return n.evaluate(t)-r.evaluate(t)}],[[Tt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,e){var n=e[0],r=e[1];return n.evaluate(t)/r.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,e){var n=e[0],r=e[1];return n.evaluate(t)%r.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,e){var n=e[0],r=e[1];return Math.pow(n.evaluate(t),r.evaluate(t))}],sqrt:[Tt,[Tt],function(t,e){var n=e[0];return Math.sqrt(n.evaluate(t))}],log10:[Tt,[Tt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))}],log2:[Tt,[Tt],function(t,e){var n=e[0];return Math.log(n.evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,e){var n=e[0];return Math.sin(n.evaluate(t))}],cos:[Tt,[Tt],function(t,e){var n=e[0];return Math.cos(n.evaluate(t))}],tan:[Tt,[Tt],function(t,e){var n=e[0];return Math.tan(n.evaluate(t))}],asin:[Tt,[Tt],function(t,e){var n=e[0];return Math.asin(n.evaluate(t))}],acos:[Tt,[Tt],function(t,e){var n=e[0];return Math.acos(n.evaluate(t))}],atan:[Tt,[Tt],function(t,e){var n=e[0];return Math.atan(n.evaluate(t))}],min:[Tt,$e(Tt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Tt,$e(Tt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Tt,[Tt],function(t,e){var n=e[0];return Math.abs(n.evaluate(t))}],round:[Tt,[Tt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Tt,[Tt],function(t,e){var n=e[0];return Math.floor(n.evaluate(t))}],ceil:[Tt,[Tt],function(t,e){var n=e[0];return Math.ceil(n.evaluate(t))}],"filter-==":[kt,[Pt,It],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[kt,[It],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[kt,[Pt],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[kt,[Pt,It],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<o}],"filter-id-<":[kt,[It],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[kt,[Pt,It],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>o}],"filter-id->":[kt,[It],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[kt,[Pt,It],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[kt,[It],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[kt,[Pt,It],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],o=r.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[kt,[It],function(t,e){var n=e[0],r=t.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[kt,[It],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[kt,[],function(t){return null!==t.id()}],"filter-type-in":[kt,[Lt(Pt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[kt,[Lt(It)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[kt,[Pt,Lt(It)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[kt,[Pt,Lt(It)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:kt,overloads:[[[kt,kt],function(t,e){var n=e[0],r=e[1];return n.evaluate(t)&&r.evaluate(t)}],[$e(kt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],function(t,e){var n=e[0],r=e[1];return n.evaluate(t)||r.evaluate(t)}],[$e(kt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[kt,[kt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[kt,[Pt],function(t,e){var n=e[0],r=t.globals&&t.globals.isSupportedScript;return!r||r(n.evaluate(t))}],upcase:[Pt,[Pt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Pt,[Pt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Pt,$e(It),function(t,e){return e.map((function(e){return Xt(e.evaluate(t))})).join("")}],"resolved-locale":[Pt,[Mt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var vn=function(t,e){var n;this.expression=t,this._warningHistory={},this._evaluator=new te,this._defaultValue=e?"color"===(n=e).type&&sn(n.default)?new zt(0,0,0,0):"color"===n.type?zt.parse(n.default)||null:void 0===n.default?null:n.default:null,this._enumValues=e&&"enum"===e.type?e.values:null};function gn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ke}function yn(t,e){var n=new se(Ke,[],e?function(t){var e={color:Ct,string:Pt,number:Tt,enum:Pt,boolean:kt,formatted:Rt};return"array"===t.type?Lt(e[t.value]||It,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?tn(new vn(r,e)):en(n.errors)}vn.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this.expression.evaluate(this._evaluator)},vn.prototype.evaluate=function(t,e,n){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null;try{var r=this.expression.evaluate(this._evaluator);if(null==r)return this._defaultValue;if(this._enumValues&&!(r in this._enumValues))throw new qt("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(r)+" instead.");return r}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var mn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!ie(e.expression)};mn.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n)},mn.prototype.evaluate=function(t,e,n){return this._styleExpression.evaluate(t,e,n)};var _n=function(t,e,n){this.kind=t,this.zoomStops=n.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!ie(e.expression),n instanceof Ie&&(this._interpolationType=n.interpolation)};function bn(t,e){if("error"===(t=yn(t,e)).result)return t;var n=t.value.expression,r=re(n);if(!r&&!nn(e))return en([new Et("","data expressions not supported")]);var i=oe(n,["zoom"]);if(!i&&!rn(e))return en([new Et("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof Le)n=t(e.result);else if(e instanceof Re)for(var r=0,i=e.args;r<i.length;r+=1){var o=i[r];if(n=t(o))break}else(e instanceof le||e instanceof Ie)&&e.input instanceof ee&&"zoom"===e.input.name&&(n=e);return n instanceof Et?n:(e.eachChild((function(e){var r=t(e);r instanceof Et?n=r:!n&&r?n=new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Et("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n)}(n);return o||i?o instanceof Et?en([o]):o instanceof Ie&&!on(e)?en([new Et("",'"interpolate" expressions cannot be used with this property')]):tn(o?new _n(r?"camera":"composite",t.value,o):new mn(r?"constant":"source",t.value)):en([new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}_n.prototype.evaluateWithoutErrorHandling=function(t,e,n){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n)},_n.prototype.evaluate=function(t,e,n){return this._styleExpression.evaluate(t,e,n)},_n.prototype.interpolationFactor=function(t,e,n){return this._interpolationType?Ie.interpolationFactor(this._interpolationType,t,e,n):0};var xn=function(t,e){this._parameters=t,this._specification=e,bt(this,function t(e,n){var r,i,o,a="color"===n.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,l=s||!u,c=e.type||(on(n)?"exponential":"interval");if(a&&((e=bt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],zt.parse(t[1])]}))),e.default?e.default=zt.parse(e.default):e.default=zt.parse(n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Oe[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)r=pn;else if("interval"===c)r=hn;else if("categorical"===c){r=cn,i=Object.create(null);for(var h=0,p=e.stops;h<p.length;h+=1){var f=p[h];i[f[0]]=f[1]}o=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');r=fn}if(s){for(var d={},v=[],g=0;g<e.stops.length;g++){var y=e.stops[g],m=y[0].zoom;void 0===d[m]&&(d[m]={zoom:m,type:e.type,property:e.property,default:e.default,stops:[]},v.push(m)),d[m].stops.push([y[0].value,y[1]])}for(var _=[],b=0,x=v;b<x.length;b+=1){var w=x[b];_.push([d[w].zoom,t(d[w],n)])}return{kind:"composite",interpolationFactor:Ie.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:_.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return pn({stops:_,base:e.base},n,i).evaluate(i,r)}}}return l?{kind:"camera",interpolationFactor:"exponential"===c?Ie.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){var a=t.zoom;return r(e,n,a,i,o)}}:{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?ln(e.default,n.default):r(e,n,s,i,o)}}}(this._parameters,this._specification))};function wn(t,e){if(sn(t))return new xn(t,e);if(gn(t)){var n=bn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=zt.parse(t)),{kind:"constant",evaluate:function(){return r}}}function En(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=an(n);if("object"!==u)return[new mt(e,n,"object expected, "+u+" found")];for(var l in n){var c=l.split(".")[0],h=r[c]||r["*"],p=void 0;if(i[c])p=i[c];else if(r[c])p=qn;else if(i["*"])p=i["*"];else{if(!r["*"]){s.push(new mt(e,n[l],'unknown property "'+l+'"'));continue}p=qn}s=s.concat(p({key:(e?e+".":e)+l,value:n[l],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:l},n))}for(var f in r)i[f]||r[f].required&&void 0===r[f].default&&void 0===n[f]&&s.push(new mt(e,n,'missing required property "'+f+'"'));return s}function Sn(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||qn;if("array"!==an(e))return[new mt(o,e,"array expected, "+an(e)+" found")];if(n.length&&e.length!==n.length)return[new mt(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new mt(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===an(n.value)&&(s=n.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:r,styleSpec:i,key:o+"["+l+"]"}));return u}function An(t){var e=t.key,n=t.value,r=t.valueSpec,i=an(n);return"number"!==i?[new mt(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new mt(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new mt(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function Tn(t){var e,n,r,i=t.valueSpec,o=xt(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===an(t.value.stops)&&"array"===an(t.value.stops[0])&&"object"===an(t.value.stops[0][0]),c=En({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new mt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(Sn({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===an(n)&&0===n.length&&e.push(new mt(t.key,n,"array must have at least one stop")),e},default:function(t){return qn({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new mt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new mt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!on(t.valueSpec)&&c.push(new mt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!nn(t.valueSpec)?c.push(new mt(t.key,t.value,"property functions not supported")):s&&!rn(t.valueSpec)&&c.push(new mt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new mt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==an(o))return[new mt(s,o,"array expected, "+an(o)+" found")];if(2!==o.length)return[new mt(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==an(o[0]))return[new mt(s,o,"object expected, "+an(o[0])+" found")];if(void 0===o[0].zoom)return[new mt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new mt(s,o,"object stop key must have value")];if(r&&r>xt(o[0].zoom))return[new mt(s,o[0].zoom,"stop zoom values must appear in ascending order")];xt(o[0].zoom)!==r&&(r=xt(o[0].zoom),n=void 0,a={}),e=e.concat(En({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:An,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return gn(wt(o[1]))?e.concat([new mt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(qn({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,r){var s=an(t.value),u=xt(t.value),l=null!==t.value?t.value:r;if(e){if(s!==e)return[new mt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new mt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return nn(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new mt(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new mt(t.key,l,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new mt(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new mt(t.key,l,"integer expected, found "+u)]}}function Pn(t){var e=("property"===t.expressionContext?bn:yn)(wt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new mt(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==n.possibleOutputs().indexOf(void 0))return[new mt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ie(n))return[new mt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!ie(n))return[new mt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!oe(n,["zoom","feature-state"]))return[new mt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!re(n))return[new mt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function kn(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(xt(n))&&i.push(new mt(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(xt(n))&&i.push(new mt(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function Cn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!Cn(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}xn.deserialize=function(t){return new xn(t._parameters,t._specification)},xn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var On={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function In(t){if(null==t)return function(){return!0};Cn(t)||(t=Rn(t));var e=yn(t,On);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return function(t,n){return e.value.evaluate(t,n)}}function Mn(t,e){return t<e?-1:t>e?1:0}function Rn(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?Ln(t[1],t[2],"=="):"!="===n?jn(Ln(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?Ln(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(Rn))):"all"===n?["all"].concat(t.slice(1).map(Rn)):"none"===n?["all"].concat(t.slice(1).map(Rn).map(jn)):"in"===n?Fn(t[1],t.slice(2)):"!in"===n?jn(Fn(t[1],t.slice(2))):"has"===n?Nn(t[1]):"!has"!==n||jn(Nn(t[1]))}function Ln(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function Fn(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(Mn)]]:["filter-in-small",t,["literal",e]]}}function Nn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function jn(t){return["!",t]}function Dn(t){return Cn(wt(t.value))?Pn(bt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==an(n))return[new mt(r,n,"array expected, "+an(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new mt(r,n,"filter array must have at least 1 element")];switch(a=a.concat(kn({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),xt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===xt(n[1])&&a.push(new mt(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new mt(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=an(n[1]))&&a.push(new mt(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=an(n[s]),"$type"===xt(n[1])?a=a.concat(kn({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new mt(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=an(n[1]),2!==n.length?a.push(new mt(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new mt(r+"[1]",n[1],"string expected, "+i+" found"))}return a}(t)}function zn(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return qn({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new mt(n,o,'unknown property "'+a+'"')];if("string"===an(o)&&nn(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new mt(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new mt(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&sn(wt(o))&&"identity"===xt(o.type)&&h.push(new mt(n,o,'"text-font" does not support identity functions'))),h.concat(qn({key:t.key,value:o,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function Bn(t){return zn(t,"paint")}function Un(t){return zn(t,"layout")}function Vn(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new mt(r,n,'either "type" or "ref" is required'));var a,s=xt(n.type),u=xt(n.ref);if(n.id)for(var l=xt(n.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];xt(h.id)===l&&e.push(new mt(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new mt(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){xt(t.id)===u&&(a=t)})),a?a.ref?e.push(new mt(r,n.ref,"ref cannot reference another ref layer")):s=xt(a.type):e.push(new mt(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var p=i.sources&&i.sources[n.source],f=p&&xt(p.type);p?"vector"===f&&"raster"===s?e.push(new mt(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new mt(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==f||n["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new mt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new mt(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new mt(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new mt(r,n.source,'source "'+n.source+'" not found'))}else e.push(new mt(r,n,'missing required property "source"'));return e=e.concat(En({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return qn({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:Dn,layout:function(t){return En({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Un(bt({layerType:s},t))}}})},paint:function(t){return En({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Bn(bt({layerType:s},t))}}})}}}))}function Gn(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new mt(n,e,'"type" is required')];var o,a=xt(e.type);switch(a){case"vector":case"raster":case"raster-dem":if(o=En({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r}),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&o.push(new mt(n+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return o;case"geojson":if(o=En({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r}),e.cluster)for(var u in e.clusterProperties){var l=e.clusterProperties[u],c=l[0],h=l[1],p="string"==typeof c?[c,["accumulated"],["get",u]]:c;o.push.apply(o,Pn({key:n+"."+u+".map",value:h,expressionContext:"cluster-map"})),o.push.apply(o,Pn({key:n+"."+u+".reduce",value:p,expressionContext:"cluster-reduce"}))}return o;case"video":return En({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return En({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new mt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kn({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function Wn(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=an(e);if(void 0===e)return o;if("object"!==a)return o.concat([new mt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=u&&r[u[1]]&&r[u[1]].transition?o.concat(qn({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n})):r[s]?o.concat(qn({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n})):o.concat([new mt(s,e[s],'unknown property "'+s+'"')])}return o}function Xn(t){var e=t.value,n=t.key,r=an(e);return"string"!==r?[new mt(n,e,"string expected, "+r+" found")]:[]}var Hn={"*":function(){return[]},array:Sn,boolean:function(t){var e=t.value,n=t.key,r=an(e);return"boolean"!==r?[new mt(n,e,"boolean expected, "+r+" found")]:[]},number:An,color:function(t){var e=t.key,n=t.value,r=an(n);return"string"!==r?[new mt(e,n,"color expected, "+r+" found")]:null===Dt(n)?[new mt(e,n,'color expected, "'+n+'" found')]:[]},constants:_t,enum:kn,filter:Dn,function:Tn,layer:Vn,object:En,source:Gn,light:Wn,string:Xn,formatted:function(t){return 0===Xn(t).length?[]:Pn(t)}};function qn(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&sn(xt(e))?Tn(t):n.expression&&gn(wt(e))?Pn(t):n.type&&Hn[n.type]?Hn[n.type](t):En(bt({},t,{valueSpec:n.type?r[n.type]:n}))}function Zn(t){var e=t.value,n=t.key,r=Xn(t);return r.length?r:(-1===e.indexOf("{fontstack}")&&r.push(new mt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new mt(n,e,'"glyphs" url must include a "{range}" token')),r)}function Kn(t,e){e=e||yt;var n=[];return n=n.concat(qn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Zn,"*":function(){return[]}}})),t.constants&&(n=n.concat(_t({key:"constants",value:t.constants,style:t,styleSpec:e}))),Yn(n)}function Yn(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function Jn(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Yn(t.apply(this,e))}}Kn.source=Jn(Gn),Kn.light=Jn(Wn),Kn.layer=Jn(Vn),Kn.filter=Jn(Dn),Kn.paintProperty=Jn(Bn),Kn.layoutProperty=Jn(Un);var Qn=Kn,$n=Kn.light,tr=Kn.paintProperty,er=Kn.layoutProperty;function nr(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1){var o=i[r];t.fire(new vt(new Error(o.message))),n=!0}return n}var rr=or,ir=3;function or(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],e=i[1],n=i[2],this.d=e+2*n;for(var o=0;o<this.d*this.d;o++){var a=i[ir+o],s=i[ir+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[ir+r.length],l=i[ir+r.length+1];this.keys=i.subarray(u,l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var h=n/e*t;this.min=-h,this.max=t+h}or.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},or.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},or.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},or.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},or.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&n>=c[f+0]&&r>=c[f+1])?(a[p]=!0,o.push(l[p])):a[p]=!1}}},or.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},or.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},or.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},or.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ir+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[ir+a]=o,i.set(s,o),o+=s.length}return i[ir+t.length]=o,i.set(this.keys,o),o+=this.keys.length,i[ir+t.length+1]=o,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var ar=self.ImageData,sr={};function ur(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),sr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var lr in ur("Object",Object),rr.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},rr.deserialize=function(t){return new rr(t.buffer)},ur("Grid",rr),ur("Color",zt),ur("Error",Error),ur("StylePropertyFunction",xn),ur("StyleExpression",vn,{omit:["_evaluator"]}),ur("ZoomDependentExpression",_n),ur("ZoomConstantExpression",mn),ur("CompoundExpression",ee,{omit:["_evaluate"]}),Ke)Ke[lr]._classRegistryKey||ur("Expression_"+lr,Ke[lr]);function cr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof ar)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,o=t;i<o.length;i+=1){var a=o[i];r.push(cr(a,e))}return r}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var l=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(sr[u].omit.indexOf(c)>=0)){var h=t[c];l[c]=sr[u].shallow.indexOf(c)>=0?h:cr(h,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(l.$name=u),l}throw new Error("can't serialize object of type "+typeof t)}function hr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof ar)return t;if(Array.isArray(t))return t.map(hr);if("object"==typeof t){var e=t.$name||"Object",n=sr[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];r[a]=sr[e].shallow.indexOf(a)>=0?s:hr(s)}}return r}throw new Error("can't deserialize object of type "+typeof t)}var pr=function(){this.first=!0};pr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var fr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function dr(t){for(var e=0,n=t;e<n.length;e+=1)if(yr(n[e].charCodeAt(0)))return!0;return!1}function vr(t){for(var e=0,n=t;e<n.length;e+=1)if(!gr(n[e].charCodeAt(0)))return!1;return!0}function gr(t){return!(fr.Arabic(t)||fr["Arabic Supplement"](t)||fr["Arabic Extended-A"](t)||fr["Arabic Presentation Forms-A"](t)||fr["Arabic Presentation Forms-B"](t))}function yr(t){return!(746!==t&&747!==t&&(t<4352||!(fr["Bopomofo Extended"](t)||fr.Bopomofo(t)||fr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||fr["CJK Compatibility Ideographs"](t)||fr["CJK Compatibility"](t)||fr["CJK Radicals Supplement"](t)||fr["CJK Strokes"](t)||!(!fr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||fr["CJK Unified Ideographs Extension A"](t)||fr["CJK Unified Ideographs"](t)||fr["Enclosed CJK Letters and Months"](t)||fr["Hangul Compatibility Jamo"](t)||fr["Hangul Jamo Extended-A"](t)||fr["Hangul Jamo Extended-B"](t)||fr["Hangul Jamo"](t)||fr["Hangul Syllables"](t)||fr.Hiragana(t)||fr["Ideographic Description Characters"](t)||fr.Kanbun(t)||fr["Kangxi Radicals"](t)||fr["Katakana Phonetic Extensions"](t)||fr.Katakana(t)&&12540!==t||!(!fr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!fr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||fr["Unified Canadian Aboriginal Syllabics"](t)||fr["Unified Canadian Aboriginal Syllabics Extended"](t)||fr["Vertical Forms"](t)||fr["Yijing Hexagram Symbols"](t)||fr["Yi Syllables"](t)||fr["Yi Radicals"](t))))}function mr(t){return!(yr(t)||function(t){return!!(fr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||fr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||fr["Letterlike Symbols"](t)||fr["Number Forms"](t)||fr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||fr["Control Pictures"](t)&&9251!==t||fr["Optical Character Recognition"](t)||fr["Enclosed Alphanumerics"](t)||fr["Geometric Shapes"](t)||fr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||fr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||fr["CJK Symbols and Punctuation"](t)||fr.Katakana(t)||fr["Private Use Area"](t)||fr["CJK Compatibility Forms"](t)||fr["Small Form Variants"](t)||fr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function _r(t,e){return!(!e&&(t>=1424&&t<=2303||fr["Arabic Presentation Forms-A"](t)||fr["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||fr.Khmer(t))}var br,xr=!1,wr=null,Er=!1,Sr=new gt,Ar={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Er||null!=Ar.applyArabicShaping}},Tr=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pr,this.transition={})};Tr.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!_r(r[n].charCodeAt(0),e))return!1;return!0}(t,Ar.isLoaded())},Tr.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Tr.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var Pr=function(t,e){this.property=t,this.value=e,this.expression=wn(void 0===e?t.specification.default:e,t.specification)};Pr.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Pr.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var kr=function(t){this.property=t,this.value=new Pr(t,void 0)};kr.prototype.transitioned=function(t,e){return new Or(this.property,this.value,e,h({},t.transition,this.transition),t.now)},kr.prototype.untransitioned=function(){return new Or(this.property,this.value,null,{},0)};var Cr=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Cr.prototype.getValue=function(t){return b(this._values[t].value.value)},Cr.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new kr(this._values[t].property)),this._values[t].value=new Pr(this._values[t].property,null===e?void 0:b(e))},Cr.prototype.getTransition=function(t){return b(this._values[t].transition)},Cr.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new kr(this._values[t].property)),this._values[t].transition=b(e)||void 0},Cr.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},Cr.prototype.transitioned=function(t,e){for(var n=new Ir(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},Cr.prototype.untransitioned=function(){for(var t=new Ir(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var Or=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};Or.prototype.possiblyEvaluate=function(t){var e=t.now||0,n=this.value.possiblyEvaluate(t),r=this.prior;if(r){if(e>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(e<this.begin)return r.possiblyEvaluate(t);var i=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(r.possiblyEvaluate(t),n,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(i))}return n};var Ir=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Ir.prototype.possiblyEvaluate=function(t){for(var e=new Lr(this._properties),n=0,r=Object.keys(this._values);n<r.length;n+=1){var i=r[n];e._values[i]=this._values[i].possiblyEvaluate(t)}return e},Ir.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var n=e[t];if(this._values[n].prior)return!0}return!1};var Mr=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Mr.prototype.getValue=function(t){return b(this._values[t].value)},Mr.prototype.setValue=function(t,e){this._values[t]=new Pr(this._values[t].property,null===e?void 0:b(e))},Mr.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},Mr.prototype.possiblyEvaluate=function(t){for(var e=new Lr(this._properties),n=0,r=Object.keys(this._values);n<r.length;n+=1){var i=r[n];e._values[i]=this._values[i].possiblyEvaluate(t)}return e};var Rr=function(t,e,n){this.property=t,this.value=e,this.parameters=n};Rr.prototype.isConstant=function(){return"constant"===this.value.kind},Rr.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Rr.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.parameters,t,e)};var Lr=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Lr.prototype.get=function(t){return this._values[t]};var Fr=function(t){this.specification=t};Fr.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Fr.prototype.interpolate=function(t,e,n){var r=he[this.specification.type];return r?r(t,e,n):t};var Nr=function(t){this.specification=t};Nr.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Rr(this,{kind:"constant",value:t.expression.evaluate(e)},e):new Rr(this,t.expression,e)},Nr.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Rr(this,{kind:"constant",value:void 0},t.parameters);var r=he[this.specification.type];return r?new Rr(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},Nr.prototype.evaluate=function(t,e,n,r){return"constant"===t.kind?t.value:t.evaluate(e,n,r)};var jr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(t,e){if(void 0===t.value)return new Rr(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var n=t.expression.evaluate(e),r=this._calculate(n,n,n,e);return new Rr(this,{kind:"constant",value:r},e)}if("camera"===t.expression.kind){var i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Rr(this,{kind:"constant",value:i},e)}return new Rr(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r){if("source"===t.kind){var i=t.evaluate(e,n,r);return this._calculate(i,i,i,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(Nr),Dr=function(t){this.specification=t};Dr.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var n=t.expression.evaluate(e);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new Tr(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Tr(Math.floor(e.zoom),e)),t.expression.evaluate(new Tr(Math.floor(e.zoom+1),e)),e)}},Dr.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},Dr.prototype.interpolate=function(t){return t};var zr=function(t){this.specification=t};zr.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},zr.prototype.interpolate=function(){return!1};var Br=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var n=t[e],r=this.defaultPropertyValues[e]=new Pr(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new kr(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};ur("DataDrivenProperty",Nr),ur("DataConstantProperty",Fr),ur("CrossFadedDataDrivenProperty",jr),ur("CrossFadedProperty",Dr),ur("ColorRampProperty",zr);var Ur=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(e=e,this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Mr(n.layout)),n.paint)){for(var r in this._transitionablePaint=new Cr(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var r="layers."+this.id+".layout."+t;if(this._validate(er,r,t,e,n))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e},e.prototype.getPaintProperty=function(t){return y(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e){var r="layers."+this.id+".paint."+t;if(this._validate(tr,r,t,e,n))return!1}if(y(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var i=this._transitionablePaint._values[t],o="cross-faded-data-driven"===i.property.specification["property-type"]&&!i.value.value&&e,a=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var s=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),s||a||o},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),_(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&nr(this,t.call(Qn,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:yt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Rr&&nn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(gt),Vr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Gr=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Wr=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Xr(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i,o=(i=t.type,Vr[i].BYTES_PER_ELEMENT),a=n=Hr(n,Math.max(e,o)),s=t.components||1;return r=Math.max(r,o),n+=o*s,{name:t.name,type:t.type,components:s,offset:a}})),size:Hr(n,Math.max(r,e)),alignment:e}}function Hr(t,e){return Math.ceil(t/e)*e}Wr.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Wr.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Wr.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Wr.prototype.clear=function(){this.length=0},Wr.prototype.resize=function(t){this.reserve(t),this.length=t},Wr.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Wr.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Wr);qr.prototype.bytesPerElement=4,ur("StructArrayLayout2i4",qr);var Zr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Wr);Zr.prototype.bytesPerElement=8,ur("StructArrayLayout4i8",Zr);var Kr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Wr);Kr.prototype.bytesPerElement=12,ur("StructArrayLayout2i4i12",Kr);var Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,a,s)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u){var l=6*t,c=12*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.int16[l+2]=r,this.int16[l+3]=i,this.uint8[c+8]=o,this.uint8[c+9]=a,this.uint8[c+10]=s,this.uint8[c+11]=u,t},e}(Wr);Yr.prototype.bytesPerElement=12,ur("StructArrayLayout4i4ub12",Yr);var Jr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,a,s)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u){var l=8*t;return this.uint16[l+0]=e,this.uint16[l+1]=n,this.uint16[l+2]=r,this.uint16[l+3]=i,this.uint16[l+4]=o,this.uint16[l+5]=a,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Wr);Jr.prototype.bytesPerElement=16,ur("StructArrayLayout8ui16",Jr);var Qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,a,s)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u){var l=8*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.int16[l+2]=r,this.int16[l+3]=i,this.uint16[l+4]=o,this.uint16[l+5]=a,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Wr);Qr.prototype.bytesPerElement=16,ur("StructArrayLayout4i4ui16",Qr);var $r=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Wr);$r.prototype.bytesPerElement=12,ur("StructArrayLayout3f12",$r);var ti=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint32[n+0]=e,t},e}(Wr);ti.prototype.bytesPerElement=4,ur("StructArrayLayout1ul4",ti);var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,n,r,i,o,a,s,u,l,c)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h){var p=12*t,f=6*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.int16[p+4]=o,this.int16[p+5]=a,this.uint32[f+3]=s,this.uint16[p+8]=u,this.uint16[p+9]=l,this.int16[p+10]=c,this.int16[p+11]=h,t},e}(Wr);ei.prototype.bytesPerElement=24,ur("StructArrayLayout6i1ul2ui2i24",ei);var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Wr);ni.prototype.bytesPerElement=12,ur("StructArrayLayout2i2i2i12",ni);var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Wr);ri.prototype.bytesPerElement=12,ur("StructArrayLayout2ub2f12",ri);var ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d){var v=this.length;return this.resize(v+1),this.emplace(v,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var g=22*t,y=11*t,m=44*t;return this.int16[g+0]=e,this.int16[g+1]=n,this.uint16[g+2]=r,this.uint16[g+3]=i,this.uint32[y+2]=o,this.uint32[y+3]=a,this.uint32[y+4]=s,this.uint16[g+10]=u,this.uint16[g+11]=l,this.uint16[g+12]=c,this.float32[y+7]=h,this.float32[y+8]=p,this.uint8[m+36]=f,this.uint8[m+37]=d,this.uint32[y+10]=v,t},e}(Wr);ii.prototype.bytesPerElement=44,ur("StructArrayLayout2i2ui3ul3ui2f2ub1ul44",ii);var oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,g,y){var m=this.length;return this.resize(m+1),this.emplace(m,t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,g,y)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v,g,y,m){var _=22*t,b=11*t;return this.int16[_+0]=e,this.int16[_+1]=n,this.int16[_+2]=r,this.int16[_+3]=i,this.int16[_+4]=o,this.int16[_+5]=a,this.uint16[_+6]=s,this.uint16[_+7]=u,this.uint16[_+8]=l,this.uint16[_+9]=c,this.uint16[_+10]=h,this.uint16[_+11]=p,this.uint16[_+12]=f,this.uint16[_+13]=d,this.uint16[_+14]=v,this.uint32[b+8]=g,this.float32[b+9]=y,this.float32[b+10]=m,t},e}(Wr);oi.prototype.bytesPerElement=44,ur("StructArrayLayout6i9ui1ul2f44",oi);var ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.float32[n+0]=e,t},e}(Wr);ai.prototype.bytesPerElement=4,ur("StructArrayLayout1f4",ai);var si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Wr);si.prototype.bytesPerElement=6,ur("StructArrayLayout3i6",si);var ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=2*t,o=4*t;return this.uint32[i+0]=e,this.uint16[o+2]=n,this.uint16[o+3]=r,t},e}(Wr);ui.prototype.bytesPerElement=8,ur("StructArrayLayout1ul2ui8",ui);var li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Wr);li.prototype.bytesPerElement=6,ur("StructArrayLayout3ui6",li);var ci=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Wr);ci.prototype.bytesPerElement=4,ur("StructArrayLayout2ui4",ci);var hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var n=1*t;return this.uint16[n+0]=e,t},e}(Wr);hi.prototype.bytesPerElement=2,ur("StructArrayLayout1ui2",hi);var pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Wr);pi.prototype.bytesPerElement=8,ur("StructArrayLayout2f8",pi);var fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Wr);fi.prototype.bytesPerElement=16,ur("StructArrayLayout4f16",fi);var di=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.radius.get=function(){return this._structArray.int16[this._pos2+10]},n.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},n.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},n.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Gr);di.prototype.size=24;var vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new di(this,t)},e}(ei);ur("CollisionBoxArray",vi);var gi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},Object.defineProperties(e.prototype,n),e}(Gr);gi.prototype.size=44;var yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new gi(this,t)},e}(ii);ur("PlacedSymbolArray",yi);var mi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},radialTextOffset:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},n.key.get=function(){return this._structArray.uint16[this._pos2+6]},n.key.set=function(t){this._structArray.uint16[this._pos2+6]=t},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+7]},n.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+7]=t},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.featureIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+12]},n.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+12]=t},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+13]},n.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+13]=t},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+14]},n.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+14]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+8]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+8]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+9]},n.textBoxScale.set=function(t){this._structArray.float32[this._pos4+9]=t},n.radialTextOffset.get=function(){return this._structArray.float32[this._pos4+10]},n.radialTextOffset.set=function(t){this._structArray.float32[this._pos4+10]=t},Object.defineProperties(e.prototype,n),e}(Gr);mi.prototype.size=44;var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new mi(this,t)},e}(oi);ur("SymbolInstanceArray",_i);var bi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={offsetX:{configurable:!0}};return n.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},n.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,n),e}(Gr);bi.prototype.size=4;var xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new bi(this,t)},e}(ai);ur("GlyphOffsetArray",xi);var wi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return n.x.get=function(){return this._structArray.int16[this._pos2+0]},n.x.set=function(t){this._structArray.int16[this._pos2+0]=t},n.y.get=function(){return this._structArray.int16[this._pos2+1]},n.y.set=function(t){this._structArray.int16[this._pos2+1]=t},n.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},n.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,n),e}(Gr);wi.prototype.size=6;var Ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new wi(this,t)},e}(si);ur("SymbolLineVertexArray",Ei);var Si=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},n.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,n),e}(Gr);Si.prototype.size=8;var Ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Si(this,t)},e}(ui);ur("FeatureIndexArray",Ai);var Ti=Xr([{name:"a_pos",components:2,type:"Int16"}],4).members,Pi=function(t){void 0===t&&(t=[]),this.segments=t};function ki(t,e){return 256*(t=l(Math.floor(t),0,255))+l(Math.floor(e),0,255)}Pi.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>Pi.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+Pi.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>Pi.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},Pi.prototype.get=function(){return this.segments},Pi.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},Pi.simpleSegment=function(t,e,n,r){return new Pi([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},Pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ur("SegmentVector",Pi);var Ci=function(){this.ids=[],this.positions=[],this.indexed=!1};function Oi(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}Ci.prototype.add=function(t,e,n,r){this.ids.push(t),this.positions.push(e,n,r)},Ci.prototype.getPositions=function(t){for(var e=0,n=this.ids.length-1;e<n;){var r=e+n>>1;this.ids[r]>=t?n=r:e=r+1}for(var i=[];this.ids[e]===t;){var o=this.positions[3*e],a=this.positions[3*e+1],s=this.positions[3*e+2];i.push({index:o,start:a,end:s}),e++}return i},Ci.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){if(!(r>=i)){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;Oi(e,a,s),Oi(n,3*a,3*s),Oi(n,3*a+1,3*s+1),Oi(n,3*a+2,3*s+2)}t(e,n,r,s),t(e,n,s+1,i)}}(n,r,0,n.length-1),e.push(n.buffer,r.buffer),{ids:n,positions:r}},Ci.deserialize=function(t){var e=new Ci;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},ur("FeaturePositionMap",Ci);var Ii=function(t,e){this.gl=t.gl,this.location=e},Mi=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(Ii),Ri=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(Ii),Li=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(Ii),Fi=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(Ii),Ni=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(Ii),ji=function(t){function e(e,n){t.call(this,e,n),this.current=zt.transparent}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(Ii),Di=new Float32Array(16),zi=function(t){function e(e,n){t.call(this,e,n),this.current=Di}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Ii);function Bi(t){return[ki(255*t.r,255*t.g),ki(255*t.b,255*t.a)]}var Ui=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map((function(t){return"u_"+t})),this.type=n,this.maxValue=-1/0};Ui.prototype.defines=function(){return this.names.map((function(t){return"#define HAS_UNIFORM_u_"+t}))},Ui.prototype.setConstantPatternPositions=function(){},Ui.prototype.populatePaintArray=function(){},Ui.prototype.updatePaintArray=function(){},Ui.prototype.upload=function(){},Ui.prototype.destroy=function(){},Ui.prototype.setUniforms=function(t,e,n,r){e.set(r.constantOr(this.value))},Ui.prototype.getBinding=function(t,e){return"color"===this.type?new ji(t,e):new Ri(t,e)},Ui.serialize=function(t){var e=t.value,n=t.names,r=t.type;return{value:cr(e),names:n,type:r}},Ui.deserialize=function(t){var e=t.value,n=t.names,r=t.type;return new Ui(hr(e),n,r)};var Vi=function(t,e,n){this.value=t,this.names=e,this.uniformNames=this.names.map((function(t){return"u_"+t})),this.type=n,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};Vi.prototype.defines=function(){return this.names.map((function(t){return"#define HAS_UNIFORM_u_"+t}))},Vi.prototype.populatePaintArray=function(){},Vi.prototype.updatePaintArray=function(){},Vi.prototype.upload=function(){},Vi.prototype.destroy=function(){},Vi.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},Vi.prototype.setUniforms=function(t,e,n,r,i){var o=this.patternPositions;"u_pattern_to"===i&&o.patternTo&&e.set(o.patternTo),"u_pattern_from"===i&&o.patternFrom&&e.set(o.patternFrom)},Vi.prototype.getBinding=function(t,e){return new Ni(t,e)};var Gi=function(t,e,n,r){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map((function(t){return"a_"+t})),this.maxValue=-1/0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Gi.prototype.defines=function(){return[]},Gi.prototype.setConstantPatternPositions=function(){},Gi.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,r=n.length;n.reserve(t);var i=this.expression.evaluate(new Tr(0),e,{});if("color"===this.type)for(var o=Bi(i),a=r;a<t;a++)n.emplaceBack(o[0],o[1]);else{for(var s=r;s<t;s++)n.emplaceBack(i);this.maxValue=Math.max(this.maxValue,i)}},Gi.prototype.updatePaintArray=function(t,e,n,r){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:0},n,r);if("color"===this.type)for(var a=Bi(o),s=t;s<e;s++)i.emplace(s,a[0],a[1]);else{for(var u=t;u<e;u++)i.emplace(u,o);this.maxValue=Math.max(this.maxValue,o)}},Gi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Gi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Gi.prototype.setUniforms=function(t,e){e.set(0)},Gi.prototype.getBinding=function(t,e){return new Ri(t,e)};var Wi=function(t,e,n,r,i,o){this.expression=t,this.names=e,this.uniformNames=this.names.map((function(t){return"a_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=-1/0;var a=o;this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new a};Wi.prototype.defines=function(){return[]},Wi.prototype.setConstantPatternPositions=function(){},Wi.prototype.populatePaintArray=function(t,e){var n=this.paintVertexArray,r=n.length;n.reserve(t);var i=this.expression.evaluate(new Tr(this.zoom),e,{}),o=this.expression.evaluate(new Tr(this.zoom+1),e,{});if("color"===this.type)for(var a=Bi(i),s=Bi(o),u=r;u<t;u++)n.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var l=r;l<t;l++)n.emplaceBack(i,o);this.maxValue=Math.max(this.maxValue,i,o)}},Wi.prototype.updatePaintArray=function(t,e,n,r){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:this.zoom},n,r),a=this.expression.evaluate({zoom:this.zoom+1},n,r);if("color"===this.type)for(var s=Bi(o),u=Bi(a),l=t;l<e;l++)i.emplace(l,s[0],s[1],u[0],u[1]);else{for(var c=t;c<e;c++)i.emplace(c,o,a);this.maxValue=Math.max(this.maxValue,o,a)}},Wi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Wi.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},Wi.prototype.setUniforms=function(t,e,n){e.set(this.interpolationFactor(n.zoom))},Wi.prototype.getBinding=function(t,e){return new Ri(t,e)};var Xi=function(t,e,n,r,i,o,a){this.expression=t,this.names=e,this.type=n,this.uniformNames=this.names.map((function(t){return"a_"+t+"_t"})),this.useIntegerZoom=r,this.zoom=i,this.maxValue=-1/0,this.layerId=a,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}})),this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o};Xi.prototype.defines=function(){return[]},Xi.prototype.setConstantPatternPositions=function(){},Xi.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray,i=this.zoomOutPaintVertexArray,o=this.layerId,a=r.length;if(r.reserve(t),i.reserve(t),n&&e.patterns&&e.patterns[o]){var s=e.patterns[o],u=s.min,l=s.mid,c=s.max,h=n[u],p=n[l],f=n[c];if(!h||!p||!f)return;for(var d=a;d<t;d++)r.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1]),i.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1])}},Xi.prototype.updatePaintArray=function(t,e,n,r,i){var o=this.zoomInPaintVertexArray,a=this.zoomOutPaintVertexArray,s=this.layerId;if(i&&n.patterns&&n.patterns[s]){var u=n.patterns[s],l=u.min,c=u.mid,h=u.max,p=i[l],f=i[c],d=i[h];if(!p||!f||!d)return;for(var v=t;v<e;v++)o.emplace(v,f.tl[0],f.tl[1],f.br[0],f.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1]),a.emplace(v,f.tl[0],f.tl[1],f.br[0],f.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1])}},Xi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},Xi.prototype.setUniforms=function(t,e){e.set(0)},Xi.prototype.getBinding=function(t,e){return new Ri(t,e)};var Hi=function(){this.binders={},this.cacheKey="",this._buffers=[],this._featureMap=new Ci,this._bufferOffset=0};Hi.createDynamic=function(t,e,n){var r=new Hi,i=[];for(var o in t.paint._values)if(n(o)){var a=t.paint.get(o);if(a instanceof Rr&&nn(a.property.specification)){var s=Zi(o,t.type),u=a.property.specification.type,l=a.property.useIntegerZoom;if("cross-faded"===a.property.specification["property-type"]||"cross-faded-data-driven"===a.property.specification["property-type"])if("constant"===a.value.kind)r.binders[o]=new Vi(a.value.value,s,u),i.push("/u_"+o);else{var c=Ki(o,u,"source");r.binders[o]=new Xi(a.value,s,u,l,e,c,t.id),i.push("/a_"+o)}else if("constant"===a.value.kind)r.binders[o]=new Ui(a.value.value,s,u),i.push("/u_"+o);else if("source"===a.value.kind){var h=Ki(o,u,"source");r.binders[o]=new Gi(a.value,s,u,h),i.push("/a_"+o)}else{var p=Ki(o,u,"composite");r.binders[o]=new Wi(a.value,s,u,l,e,p),i.push("/z_"+o)}}}return r.cacheKey=i.sort().join(""),r},Hi.prototype.populatePaintArrays=function(t,e,n,r){for(var i in this.binders)this.binders[i].populatePaintArray(t,e,r);void 0!==e.id&&this._featureMap.add(+e.id,n,this._bufferOffset,t),this._bufferOffset=t},Hi.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders)this.binders[n].setConstantPatternPositions(t,e)},Hi.prototype.updatePaintArrays=function(t,e,n,r){var i=!1;for(var o in t)for(var a=0,s=this._featureMap.getPositions(+o);a<s.length;a+=1){var u=s[a],l=e.feature(u.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Ui||h instanceof Vi)&&!0===h.expression.isStateDependent){var p=n.paint.get(c);h.expression=p.value,h.updatePaintArray(u.start,u.end,l,t[o],r),i=!0}}}return i},Hi.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},Hi.prototype.getPaintVertexBuffers=function(){return this._buffers},Hi.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders)for(var i=this.binders[r],o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s]);n.push({name:s,property:r,binding:u})}}return n},Hi.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property,l=a.binding;this.binders[u].setUniforms(t,l,r,n.get(u),s)}},Hi.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var n in this.binders){var r=this.binders[n];if(r instanceof Xi){var i=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;i&&e.push(i)}else(r instanceof Gi||r instanceof Wi)&&r.paintVertexBuffer&&e.push(r.paintVertexBuffer)}this._buffers=e},Hi.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var n=[];for(var r in this.binders){var i=this.binders[r];(i instanceof Gi||i instanceof Wi)&&i.paintVertexBuffer&&n.push(i.paintVertexBuffer)}this._buffers=n},Hi.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var qi=function(t,e,n,r){void 0===r&&(r=function(){return!0}),this.programConfigurations={};for(var i=0,o=e;i<o.length;i+=1){var a=o[i];this.programConfigurations[a.id]=Hi.createDynamic(a,n,r),this.programConfigurations[a.id].layoutAttributes=t}this.needsUpload=!1};function Zi(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Ki(t,e,n){var r={color:{source:pi,composite:fi},number:{source:ai,composite:pi}},i=function(t){return{"line-pattern":{source:Jr,composite:Jr},"fill-pattern":{source:Jr,composite:Jr},"fill-extrusion-pattern":{source:Jr,composite:Jr}}[t]}(t);return i&&i[n]||r[e][n]}qi.prototype.populatePaintArrays=function(t,e,n,r){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,r);this.needsUpload=!0},qi.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,e,a,r)||this.needsUpload}},qi.prototype.get=function(t){return this.programConfigurations[t]},qi.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},qi.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},ur("ConstantBinder",Ui),ur("CrossFadedConstantBinder",Vi),ur("SourceExpressionBinder",Gi),ur("CrossFadedCompositeBinder",Xi),ur("CompositeExpressionBinder",Wi),ur("ProgramConfiguration",Hi,{omit:["_buffers"]}),ur("ProgramConfigurationSet",qi);var Yi=8192,Ji={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function Qi(t){for(var e=Yi/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<Ji.min||a.x>Ji.max||a.y<Ji.min||a.y>Ji.max)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function $i(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var to=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qr,this.indexArray=new li,this.segments=new Pi,this.programConfigurations=new qi(Ti,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function eo(t,e){for(var n=0;n<t.length;n++)if(co(e,t[n]))return!0;for(var r=0;r<e.length;r++)if(co(t,e[r]))return!0;return!!oo(t,e)}function no(t,e,n){return!!co(t,e)||!!so(e,t,n)}function ro(t,e){if(1===t.length)return lo(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if(co(t,r[i]))return!0;for(var o=0;o<t.length;o++)if(lo(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(oo(t,e[a]))return!0;return!1}function io(t,e,n){if(t.length>1){if(oo(t,e))return!0;for(var r=0;r<e.length;r++)if(so(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(so(t[i],e,n))return!0;return!1}function oo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(ao(r,i,e[o],e[o+1]))return!0;return!1}function ao(t,e,n,r){return E(t,n,r)!==E(e,n,r)&&E(t,e,n)!==E(t,e,r)}function so(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(uo(t,e[i-1],e[i])<r)return!0;return!1}function uo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return i<0?t.distSqr(e):i>1?t.distSqr(n):t.distSqr(n.sub(e)._mult(i)._add(e))}function lo(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)r=n[s],i=n[u],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function co(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ho(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=E(t,e,n[0]);return o!==E(t,e,n[1])||o!==E(t,e,n[2])||o!==E(t,e,n[3])}function po(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).binders[t].maxValue}function fo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function vo(t,e,n,r,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++){var l=t[u];s.push(l.sub(a))}return s}to.prototype.populate=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=r[n],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Tr(this.zoom),o)){var u=Qi(o);this.addFeature(o,u,a),e.featureIndex.insert(o,u,a,s,this.index)}}},to.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},to.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},to.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},to.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ti),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},to.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},to.prototype.addFeature=function(t,e,n){for(var r=0,i=e;r<i.length;r+=1)for(var o=0,a=i[r];o<a.length;o+=1){var s=a[o],u=s.x,l=s.y;if(!(u<0||u>=Yi||l<0||l>=Yi)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=c.vertexLength;$i(this.layoutVertexArray,u,l,-1,-1),$i(this.layoutVertexArray,u,l,1,-1),$i(this.layoutVertexArray,u,l,1,1),$i(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{})},ur("CircleBucket",to,{omit:["layers"]});var go={paint:new Br({"circle-radius":new Nr(yt.paint_circle["circle-radius"]),"circle-color":new Nr(yt.paint_circle["circle-color"]),"circle-blur":new Nr(yt.paint_circle["circle-blur"]),"circle-opacity":new Nr(yt.paint_circle["circle-opacity"]),"circle-translate":new Fr(yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Fr(yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fr(yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fr(yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nr(yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nr(yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nr(yt.paint_circle["circle-stroke-opacity"])})},yo="undefined"!=typeof Float32Array?Float32Array:Array;function mo(){var t=new yo(9);return yo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _o(){var t=new yo(3);return yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function bo(t,e,n){var r=new yo(3);return r[0]=t,r[1]=e,r[2]=n,r}function xo(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function wo(){var t=new yo(4);return yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.PI,_o(),function(){var t;t=new yo(4),yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),_o(),bo(1,0,0),bo(0,1,0),wo(),wo(),mo(),function(){var t;t=new yo(2),yo!=Float32Array&&(t[0]=0,t[1]=0)}();var Eo=function(t){function e(e){t.call(this,e,go)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new to(t)},e.prototype.queryRadius=function(t){var e=t;return po("circle-radius",this,e)+po("circle-stroke-width",this,e)+fo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=vo(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return So(t,e)}))}(u,s),p=c?l*a:l,f=0,d=r;f<d.length;f+=1)for(var v=0,g=d[f];v<g.length;v+=1){var y=g[v],m=c?y:So(y,s),_=p,b=xo([],[y.x,y.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/b[3]),no(h,m,_))return!0}return!1},e}(Ur);function So(t,e){var n=xo([],[t.x,t.y,0,1],e);return new i(n[0]/n[3],n[1]/n[3])}var Ao=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(to);function To(t,e,n,r){var i=e.width,o=e.height;if(r){if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function Po(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=To({},{width:r,height:i},n);ko(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ko(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((n.y+u)*t.width+n.x)*o,c=((r.y+u)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return e}ur("HeatmapBucket",Ao,{omit:["layers"]});var Co=function(t,e){To(this,t,1,e)};Co.prototype.resize=function(t){Po(this,t,1)},Co.prototype.clone=function(){return new Co({width:this.width,height:this.height},new Uint8Array(this.data))},Co.copy=function(t,e,n,r,i){ko(t,e,n,r,i,1)};var Oo=function(t,e){To(this,t,4,e)};Oo.prototype.resize=function(t){Po(this,t,4)},Oo.prototype.replace=function(t,e){e?this.data.set(t):this.data=t},Oo.prototype.clone=function(){return new Oo({width:this.width,height:this.height},new Uint8Array(this.data))},Oo.copy=function(t,e,n,r,i){ko(t,e,n,r,i,4)},ur("AlphaImage",Co),ur("RGBAImage",Oo);var Io={paint:new Br({"heatmap-radius":new Nr(yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nr(yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fr(yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zr(yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fr(yt.paint_heatmap["heatmap-opacity"])})};function Mo(t,e){for(var n=new Uint8Array(1024),r={},i=0,o=0;i<256;i++,o+=4){r[e]=i/255;var a=t.evaluate(r);n[o+0]=Math.floor(255*a.r/a.a),n[o+1]=Math.floor(255*a.g/a.a),n[o+2]=Math.floor(255*a.b/a.a),n[o+3]=Math.floor(255*a.a)}return new Oo({width:256,height:1},n)}var Ro=function(t){function e(e){t.call(this,e,Io),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ao(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Mo(t,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Ur),Lo={paint:new Br({"hillshade-illumination-direction":new Fr(yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Fr(yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fr(yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fr(yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fr(yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fr(yt.paint_hillshade["hillshade-accent-color"])})},Fo=function(t){function e(e){t.call(this,e,Lo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Ur),No=Xr([{name:"a_pos",components:2,type:"Int16"}],4).members,jo=zo,Do=zo;function zo(t,e,n){n=n||2;var r,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*n:t.length,p=Bo(t,0,h,n,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Bo(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(Yo(a));for(s.sort(qo),i=0;i<s.length;i++)Zo(s[i],n),n=Uo(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-r,a-i))?1/l:0}return Vo(p,f,n,r,i,l),f}function Bo(t,e,n,r,i){var o,a;if(i===sa(t,e,n,r)>0)for(o=e;o<n;o+=r)a=ia(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=ia(o,t[o],t[o+1],a);return a&&ta(a,a.next)&&(oa(a),a=a.next),a}function Uo(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!ta(r,r.next)&&0!==$o(r.prev,r,r.next))r=r.next;else{if(oa(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Vo(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ko(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Wo(t,r,i,o):Go(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),oa(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Vo(t=Xo(t,e,n),e,n,r,i,o,2):2===a&&Ho(t,e,n,r,i,o):Vo(Uo(t),e,n,r,i,o,1);break}}}function Go(t){var e=t.prev,n=t,r=t.next;if($o(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Jo(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&$o(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Wo(t,e,n,r){var i=t.prev,o=t,a=t.next;if($o(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Ko(s,u,e,n,r),p=Ko(l,c,e,n,r),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&Jo(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&$o(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&Jo(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$o(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&Jo(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&$o(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&Jo(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&$o(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Xo(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!ta(i,o)&&ea(i,r,r.next,o)&&na(i,o)&&na(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),oa(r),oa(r.next),r=t=o),r=r.next}while(r!==t);return r}function Ho(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Qo(a,s)){var u=ra(a,s);return a=Uo(a,a.next),u=Uo(u,u.next),Vo(a,e,n,r,i,o),void Vo(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function qo(t,e){return t.x-e.x}function Zo(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var u,l=n,c=n.x,h=n.y,p=1/0;for(r=n.next;r!==l;)i>=r.x&&r.x>=c&&i!==r.x&&Jo(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<p||u===p&&r.x>n.x)&&na(r,t)&&(n=r,p=u),r=r.next;return n}(t,e)){var n=ra(e,t);Uo(n,n.next)}}function Ko(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yo(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Jo(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Qo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&ea(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&na(t,e)&&na(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function $o(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ta(t,e){return t.x===e.x&&t.y===e.y}function ea(t,e,n,r){return!!(ta(t,e)&&ta(n,r)||ta(t,r)&&ta(n,e))||$o(t,e,n)>0!=$o(t,e,r)>0&&$o(n,r,t)>0!=$o(n,r,e)>0}function na(t,e){return $o(t.prev,t,t.next)<0?$o(t,e,t.next)>=0&&$o(t,t.prev,e)>=0:$o(t,e,t.prev)<0||$o(t,t.next,e)<0}function ra(t,e){var n=new aa(t.i,t.x,t.y),r=new aa(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function ia(t,e,n,r){var i=new aa(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function oa(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function aa(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sa(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function ua(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var h=e[n],p=r,f=i;for(la(e,r,n),o(e[i],h)>0&&la(e,r,i);p<f;){for(la(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[r],h)?la(e,r,f):la(e,++f,i),f<=n&&(r=f+1),n<=f&&(i=f-1)}}(t,e,n||0,r||t.length-1,i||ca)}function la(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function ca(t,e){return t<e?-1:t>e?1:0}function ha(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=S(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(ua(o[u],e,1,o[u].length-1,pa),o[u]=o[u].slice(0,e));return o}function pa(t,e){return e.area-t.area}function fa(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function da(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:r-1},n,{}),h=l.evaluate({zoom:r},n,{}),p=l.evaluate({zoom:r+1},n,{});o[c]=!0,o[h]=!0,o[p]=!0,n.patterns[u.id]={min:c,mid:h,max:p}}}return n}zo.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(sa(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(sa(t,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},zo.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n},jo.default=Do;var va=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new qr,this.indexArray=new li,this.indexArray2=new ci,this.programConfigurations=new qi(No,t.layers,t.zoom),this.segments=new Pi,this.segments2=new Pi,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};va.prototype.populate=function(t,e){this.features=[],this.hasPattern=fa("fill",this.layers,e);for(var n=0,r=t;n<r.length;n+=1){var i=r[n],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Tr(this.zoom),o)){var u=Qi(o),l={sourceLayerIndex:s,index:a,geometry:u,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(l.id=o.id),this.hasPattern?this.features.push(da("fill",this.layers,l,this.zoom,e)):this.addFeature(l,u,a,{}),e.featureIndex.insert(o,u,a,s,this.index)}}},va.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},va.prototype.addFeatures=function(t,e){for(var n=0,r=this.features;n<r.length;n+=1){var i=r[n],o=i.geometry;this.addFeature(i,o,i.index,e)}},va.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},va.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,No),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},va.prototype.addFeature=function(t,e,n,r){for(var i=0,o=ha(e,500);i<o.length;i+=1){for(var a=o[i],s=0,u=0,l=a;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=c.vertexLength,p=[],f=[],d=0,v=a;d<v.length;d+=1){var g=v[d];if(0!==g.length){g!==a[0]&&f.push(p.length/2);var y=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),m=y.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(m+g.length-1,m),p.push(g[0].x),p.push(g[0].y);for(var _=1;_<g.length;_++)this.layoutVertexArray.emplaceBack(g[_].x,g[_].y),this.indexArray2.emplaceBack(m+_-1,m+_),p.push(g[_].x),p.push(g[_].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var b=jo(p,f),x=0;x<b.length;x+=3)this.indexArray.emplaceBack(h+b[x],h+b[x+1],h+b[x+2]);c.vertexLength+=s,c.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r)},ur("FillBucket",va,{omit:["layers","features"]});var ga={paint:new Br({"fill-antialias":new Fr(yt.paint_fill["fill-antialias"]),"fill-opacity":new Nr(yt.paint_fill["fill-opacity"]),"fill-color":new Nr(yt.paint_fill["fill-color"]),"fill-outline-color":new Nr(yt.paint_fill["fill-outline-color"]),"fill-translate":new Fr(yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Fr(yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new jr(yt.paint_fill["fill-pattern"])})},ya=function(t){function e(e){t.call(this,e,ga)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new va(t)},e.prototype.queryRadius=function(){return fo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return ro(vo(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(Ur),ma=Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,_a=ba;function ba(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(xa,this,e)}function xa(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function wa(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],r+=((n=t[a]).x-e.x)*(e.y+n.y);return r}ba.types=["Unknown","Point","LineString","Polygon"],ba.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var l=t.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},ba.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(r<=0){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},ba.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=ba.types[this.type];function c(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+s)/o;t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];c(u=h);break;case 2:for(r=0;r<u.length;r++)c(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=wa(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)c(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Ea=Sa;function Sa(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Aa,this,e),this.length=this._features.length}function Aa(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function Ta(t,e,n){if(3===t){var r=new Ea(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}Sa.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new _a(this._pbf,e,this.extent,this._keys,this._values)};var Pa={VectorTile:function(t,e){this.layers=t.readFields(Ta,{},e)},VectorTileFeature:_a,VectorTileLayer:Ea},ka=Pa.VectorTileFeature.types,Ca=Math.pow(2,13);function Oa(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*Ca)+a,i*Ca*2,o*Ca*2,Math.round(s))}var Ia=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Kr,this.indexArray=new li,this.programConfigurations=new qi(ma,t.layers,t.zoom),this.segments=new Pi,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ma(t,e){return t.x===e.x&&(t.x<0||t.x>Yi)||t.y===e.y&&(t.y<0||t.y>Yi)}function Ra(t){return t.every((function(t){return t.x<0}))||t.every((function(t){return t.x>Yi}))||t.every((function(t){return t.y<0}))||t.every((function(t){return t.y>Yi}))}Ia.prototype.populate=function(t,e){this.features=[],this.hasPattern=fa("fill-extrusion",this.layers,e);for(var n=0,r=t;n<r.length;n+=1){var i=r[n],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Tr(this.zoom),o)){var u=Qi(o),l={sourceLayerIndex:s,index:a,geometry:u,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(l.id=o.id),this.hasPattern?this.features.push(da("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,u,a,{}),e.featureIndex.insert(o,u,a,s,this.index,!0)}}},Ia.prototype.addFeatures=function(t,e){for(var n=0,r=this.features;n<r.length;n+=1){var i=r[n],o=i.geometry;this.addFeature(i,o,i.index,e)}},Ia.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ia.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ia.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ia.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ma),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ia.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ia.prototype.addFeature=function(t,e,n,r){for(var i=0,o=ha(e,500);i<o.length;i+=1){for(var a=o[i],s=0,u=0,l=a;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,p=a;h<p.length;h+=1){var f=p[h];if(0!==f.length&&!Ra(f))for(var d=0,v=0;v<f.length;v++){var g=f[v];if(v>=1){var y=f[v-1];if(!Ma(g,y)){c.vertexLength+4>Pi.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var m=g.sub(y)._perp()._unit(),_=y.dist(g);d+_>32768&&(d=0),Oa(this.layoutVertexArray,g.x,g.y,m.x,m.y,0,0,d),Oa(this.layoutVertexArray,g.x,g.y,m.x,m.y,0,1,d),d+=_,Oa(this.layoutVertexArray,y.x,y.y,m.x,m.y,0,0,d),Oa(this.layoutVertexArray,y.x,y.y,m.x,m.y,0,1,d);var b=c.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),c.vertexLength+=4,c.primitiveLength+=2}}}}if(c.vertexLength+s>Pi.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===ka[t.type]){for(var x=[],w=[],E=c.vertexLength,S=0,A=a;S<A.length;S+=1){var T=A[S];if(0!==T.length){T!==a[0]&&w.push(x.length/2);for(var P=0;P<T.length;P++){var k=T[P];Oa(this.layoutVertexArray,k.x,k.y,0,0,1,1,0),x.push(k.x),x.push(k.y)}}}for(var C=jo(x,w),O=0;O<C.length;O+=3)this.indexArray.emplaceBack(E+C[O],E+C[O+2],E+C[O+1]);c.primitiveLength+=C.length/3,c.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,r)},ur("FillExtrusionBucket",Ia,{omit:["layers","features"]});var La={paint:new Br({"fill-extrusion-opacity":new Fr(yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nr(yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fr(yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fr(yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jr(yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nr(yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nr(yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fr(yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Fa=function(t){function e(e){t.call(this,e,La)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ia(t)},e.prototype.queryRadius=function(){return fo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s,u){var l=vo(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),p=function(t,e,n,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];xo(l,l,e),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),f=function(t,e,n,r){for(var o=[],a=[],s=r[8]*e,u=r[9]*e,l=r[10]*e,c=r[11]*e,h=r[8]*n,p=r[9]*n,f=r[10]*n,d=r[11]*n,v=0,g=t;v<g.length;v+=1){for(var y=[],m=[],_=0,b=g[v];_<b.length;_+=1){var x=b[_],w=x.x,E=x.y,S=r[0]*w+r[4]*E+r[12],A=r[1]*w+r[5]*E+r[13],T=r[2]*w+r[6]*E+r[14],P=r[3]*w+r[7]*E+r[15],k=T+l,C=P+c,O=S+h,I=A+p,M=T+f,R=P+d,L=new i((S+s)/C,(A+u)/C);L.z=k/C,y.push(L);var F=new i(O/R,I/R);F.z=M/R,m.push(F)}o.push(y),a.push(m)}return[o,a]}(r,h,c,u);return function(t,e,n){var r=1/0;ro(n,e)&&(r=ja(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=o[s+1],c=a[s],h=[u,l,a[s+1],c,u];eo(n,h)&&(r=Math.min(r,ja(n,h)))}return r!==1/0&&r}(f[0],f[1],p)},e}(Ur);function Na(t,e){return t.x*e.x+t.y*e.y}function ja(t,e){if(1===t.length){var n=e[0],r=e[1],i=e[3],o=t[0],a=r.sub(n),s=i.sub(n),u=o.sub(n),l=Na(a,a),c=Na(a,s),h=Na(s,s),p=Na(u,a),f=Na(u,s),d=l*h-c*c,v=(h*p-c*f)/d,g=(l*f-c*p)/d,y=1-v-g;return n.z*y+r.z*v+i.z*g}for(var m=1/0,_=0,b=e;_<b.length;_+=1){var x=b[_];m=Math.min(m,x.z)}return m}var Da=Xr([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,za=Pa.VectorTileFeature.types,Ba=63,Ua=Math.cos(Math.PI/180*37.5),Va=.5,Ga=Math.pow(2,14)/Va;function Wa(t,e,n,r,i,o,a){t.emplaceBack(e.x,e.y,r?1:0,i?1:-1,Math.round(Ba*n.x)+128,Math.round(Ba*n.y)+128,1+(0===o?0:o<0?-1:1)|(a*Va&63)<<2,a*Va>>6)}var Xa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.features=[],this.hasPattern=!1,this.layoutVertexArray=new Yr,this.indexArray=new li,this.programConfigurations=new qi(Da,t.layers,t.zoom),this.segments=new Pi,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ha(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Ga-1)}Xa.prototype.populate=function(t,e){this.features=[],this.hasPattern=fa("line",this.layers,e);for(var n=0,r=t;n<r.length;n+=1){var i=r[n],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new Tr(this.zoom),o)){var u=Qi(o),l={sourceLayerIndex:s,index:a,geometry:u,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(l.id=o.id),this.hasPattern?this.features.push(da("line",this.layers,l,this.zoom,e)):this.addFeature(l,u,a,{}),e.featureIndex.insert(o,u,a,s,this.index)}}},Xa.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Xa.prototype.addFeatures=function(t,e){for(var n=0,r=this.features;n<r.length;n+=1){var i=r[n],o=i.geometry;this.addFeature(i,o,i.index,e)}},Xa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Xa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Da),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Xa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Xa.prototype.addFeature=function(t,e,n,r){for(var i=this.layers[0].layout,o=i.get("line-join").evaluate(t,{}),a=i.get("line-cap"),s=i.get("line-miter-limit"),u=i.get("line-round-limit"),l=0,c=e;l<c.length;l+=1){var h=c[l];this.addLine(h,t,o,a,s,u,n,r)}},Xa.prototype.addLine=function(t,e,n,r,i,o,a,s){var u=null;e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")&&(u={start:e.properties.mapbox_clip_start,end:e.properties.mapbox_clip_end,tileTotal:void 0});for(var l="Polygon"===za[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(l?3:2))){u&&(u.tileTotal=function(t,e,n){for(var r,i,o=0,a=e;a<n-1;a++)r=t[a],i=t[a+1],o+=r.dist(i);return o}(t,h,c)),"bevel"===n&&(i=1.05);var p=Yi/(512*this.overscaling)*15,f=t[h],d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);this.distance=0;var v,g,y,m=r,_=l?"butt":r,b=!0,x=void 0,w=void 0,E=void 0,S=void 0;this.e1=this.e2=this.e3=-1,l&&(v=t[c-2],S=f.sub(v)._unit()._perp());for(var A=h;A<c;A++)if(!(w=l&&A===c-1?t[h+1]:t[A+1])||!t[A].equals(w)){S&&(E=S),v&&(x=v),v=t[A],S=w?w.sub(v)._unit()._perp():E;var T=(E=E||S).add(S);0===T.x&&0===T.y||T._unit();var P=T.x*S.x+T.y*S.y,k=0!==P?1/P:1/0,C=P<Ua&&x&&w;if(C&&A>h){var O=v.dist(x);if(O>2*p){var I=v.sub(v.sub(x)._mult(p/O)._round());this.distance+=I.dist(x),this.addCurrentVertex(I,this.distance,E.mult(1),0,0,!1,d,u),x=I}}var M=x&&w,R=M?n:w?m:_;if(M&&"round"===R&&(k<o?R="miter":k<=2&&(R="fakeround")),"miter"===R&&k>i&&(R="bevel"),"bevel"===R&&(k>2&&(R="flipbevel"),k<i&&(R="miter")),x&&(this.distance+=v.dist(x)),"miter"===R)T._mult(k),this.addCurrentVertex(v,this.distance,T,0,0,!1,d,u);else if("flipbevel"===R){if(k>100)T=S.clone().mult(-1);else{var L=E.x*S.y-E.y*S.x>0?-1:1,F=k*E.add(S).mag()/E.sub(S).mag();T._perp()._mult(F*L)}this.addCurrentVertex(v,this.distance,T,0,0,!1,d,u),this.addCurrentVertex(v,this.distance,T.mult(-1),0,0,!1,d,u)}else if("bevel"===R||"fakeround"===R){var N=E.x*S.y-E.y*S.x>0,j=-Math.sqrt(k*k-1);if(N?(y=0,g=j):(g=0,y=j),b||this.addCurrentVertex(v,this.distance,E,g,y,!1,d,u),"fakeround"===R){for(var D=Math.floor(8*(.5-(P-.5))),z=void 0,B=0;B<D;B++)z=S.mult((B+1)/(D+1))._add(E)._unit(),this.addPieSliceVertex(v,this.distance,z,N,d,u);this.addPieSliceVertex(v,this.distance,T,N,d,u);for(var U=D-1;U>=0;U--)z=E.mult((U+1)/(D+1))._add(S)._unit(),this.addPieSliceVertex(v,this.distance,z,N,d,u)}w&&this.addCurrentVertex(v,this.distance,S,-g,-y,!1,d,u)}else"butt"===R?(b||this.addCurrentVertex(v,this.distance,E,0,0,!1,d,u),w&&this.addCurrentVertex(v,this.distance,S,0,0,!1,d,u)):"square"===R?(b||(this.addCurrentVertex(v,this.distance,E,1,1,!1,d,u),this.e1=this.e2=-1),w&&this.addCurrentVertex(v,this.distance,S,-1,-1,!1,d,u)):"round"===R&&(b||(this.addCurrentVertex(v,this.distance,E,0,0,!1,d,u),this.addCurrentVertex(v,this.distance,E,1,1,!0,d,u),this.e1=this.e2=-1),w&&(this.addCurrentVertex(v,this.distance,S,-1,-1,!0,d,u),this.addCurrentVertex(v,this.distance,S,0,0,!1,d,u)));if(C&&A<c-1){var V=v.dist(w);if(V>2*p){var G=v.add(w.sub(v)._mult(p/V)._round());this.distance+=G.dist(v),this.addCurrentVertex(G,this.distance,S.mult(1),0,0,!1,d,u),v=G}}b=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,s)}},Xa.prototype.addCurrentVertex=function(t,e,n,r,i,o,a,s){var u,l=this.layoutVertexArray,c=this.indexArray;s&&(e=Ha(e,s)),u=n.clone(),r&&u._sub(n.perp()._mult(r)),Wa(l,t,u,o,!1,r,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=n.mult(-1),i&&u._sub(n.perp()._mult(i)),Wa(l,t,u,o,!0,-i,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Ga/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,n,r,i,o,a))},Xa.prototype.addPieSliceVertex=function(t,e,n,r,i,o){n=n.mult(r?-1:1);var a=this.layoutVertexArray,s=this.indexArray;o&&(e=Ha(e,o)),Wa(a,t,n,!1,r,0,e),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3},ur("LineBucket",Xa,{omit:["layers","features"]});var qa=new Br({"line-cap":new Fr(yt.layout_line["line-cap"]),"line-join":new Nr(yt.layout_line["line-join"]),"line-miter-limit":new Fr(yt.layout_line["line-miter-limit"]),"line-round-limit":new Fr(yt.layout_line["line-round-limit"])}),Za={paint:new Br({"line-opacity":new Nr(yt.paint_line["line-opacity"]),"line-color":new Nr(yt.paint_line["line-color"]),"line-translate":new Fr(yt.paint_line["line-translate"]),"line-translate-anchor":new Fr(yt.paint_line["line-translate-anchor"]),"line-width":new Nr(yt.paint_line["line-width"]),"line-gap-width":new Nr(yt.paint_line["line-gap-width"]),"line-offset":new Nr(yt.paint_line["line-offset"]),"line-blur":new Nr(yt.paint_line["line-blur"]),"line-dasharray":new Dr(yt.paint_line["line-dasharray"]),"line-pattern":new jr(yt.paint_line["line-pattern"]),"line-gradient":new zr(yt.paint_line["line-gradient"])}),layout:qa},Ka=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new Tr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=h({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(Nr))(Za.paint.properties["line-width"].specification);Ka.useIntegerZoom=!0;var Ya=function(t){function e(e){t.call(this,e,Za)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Mo(t,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=Ka.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Xa(t)},e.prototype.queryRadius=function(t){var e=t,n=Ja(po("line-width",this,e),po("line-gap-width",this,e)),r=po("line-offset",this,e);return n/2+Math.abs(r)+fo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s){var u=vo(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*Ja(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),c=this.paint.get("line-offset").evaluate(e,n);return c&&(r=function(t,e){for(var n=[],r=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u-1],c=a[u],h=a[u+1],p=0===u?r:c.sub(l)._unit()._perp(),f=u===a.length-1?r:h.sub(c)._unit()._perp(),d=p._add(f)._unit(),v=d.x*f.x+d.y*f.y;d._mult(1/v),s.push(d._mult(e)._add(c))}n.push(s)}return n}(r,c*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if(co(t,i[o]))return!0;if(io(t,i,n))return!0}return!1}(u,r,l)},e.prototype.isTileClipped=function(){return!0},e}(Ur);function Ja(t,e){return e>0?e+2*t:t}var Qa=Xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),$a=Xr([{name:"a_projected_pos",components:3,type:"Float32"}],4),ts=(Xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),es=(Xr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),ns=Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function rs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),Ar.applyArabicShaping&&(t=Ar.applyArabicShaping(t)),t}(t.text,e,n)})),t}Xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"}]),Xr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"radialTextOffset"}]),Xr([{type:"Float32",name:"offsetX"}]),Xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var is={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"},os=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);ur("Anchor",os);var as=256;function ss(t,e){var n=e.expression;if("constant"===n.kind)return{functionType:"constant",layoutSize:n.evaluate(new Tr(t+1))};if("source"===n.kind)return{functionType:"source"};for(var r=n.zoomStops,i=0;i<r.length&&r[i]<=t;)i++;for(var o=i=Math.max(0,i-1);o<r.length&&r[o]<t+1;)o++;o=Math.min(r.length-1,o);var a={min:r[i],max:r[o]};return"composite"===n.kind?{functionType:"composite",zoomRange:a,propertyValue:e.value}:{functionType:"camera",layoutSize:n.evaluate(new Tr(t+1)),zoomRange:a,sizeRange:{min:n.evaluate(new Tr(a.min)),max:n.evaluate(new Tr(a.max))},propertyValue:e.value}}function us(t,e,n){var r=e;return"source"===t.functionType?n.lowerSize/as:"composite"===t.functionType?ce(n.lowerSize/as,n.upperSize/as,r.uSizeT):r.uSize}function ls(t,e,n){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var r=t.propertyValue,i=t.zoomRange,o=t.sizeRange,a=l(wn(r,n.specification).interpolationFactor(e,i.min,i.max),0,1);return{uSizeT:0,uSize:o.min+a*(o.max-o.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:l(wn(s,n.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}}var cs=Object.freeze({getSizeData:ss,evaluateSizeForFeature:us,evaluateSizeForZoom:ls,SIZE_PACK_FACTOR:as}),hs=Pa.VectorTileFeature.types,ps=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fs(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,s?s[0]:0,s?s[1]:0)}function ds(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}var vs=function(t){this.layoutVertexArray=new Qr,this.indexArray=new li,this.programConfigurations=t,this.segments=new Pi,this.dynamicLayoutVertexArray=new $r,this.opacityVertexArray=new ti,this.placedSymbolArray=new yi};vs.prototype.upload=function(t,e,n,r){n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qa.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,$a.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ps,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t)},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ur("SymbolBuffers",vs);var gs=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Pi,this.collisionVertexArray=new ri};gs.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,ts.members,!0)},gs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ur("CollisionBuffers",gs);var ys=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ss(this.zoom,e["text-size"]),this.iconSizeData=ss(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1);var o="viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey;this.sortFeaturesByY=o&&(n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement")),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};ys.prototype.createArrays=function(){this.text=new vs(new qi(Qa.members,this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new vs(new qi(Qa.members,this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.collisionBox=new gs(ni,es.members,ci),this.collisionCircle=new gs(ni,ns.members,li),this.glyphOffsetArray=new xi,this.lineVertexArray=new Ei,this.symbolInstances=new _i},ys.prototype.calculateGlyphDependencies=function(t,e,n,r){for(var i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,n&&r){var o=is[t.charAt(i)];o&&(e[o.charCodeAt(0)]=!0)}},ys.prototype.populate=function(t,e){var n=this.layers[0],r=n.layout,i=r.get("text-font"),o=r.get("text-field"),a=r.get("icon-image"),s=("constant"!==o.value.kind||o.value.value.toString().length>0)&&("constant"!==i.value.kind||i.value.value.length>0),u="constant"!==a.value.kind||a.value.value&&a.value.value.length>0,l=r.get("symbol-sort-key");if(this.features=[],s||u){for(var c=e.iconDependencies,h=e.glyphDependencies,p=new Tr(this.zoom),f=0,d=t;f<d.length;f+=1){var v=d[f],g=v.feature,y=v.index,m=v.sourceLayerIndex;if(n._featureFilter(p,g)){var _=void 0;if(s){var b=n.getValueAndResolveTokens("text-field",g);_=rs(b instanceof Vt?b:Vt.fromString(b),n,g)}var x=void 0;if(u&&(x=n.getValueAndResolveTokens("icon-image",g)),_||x){var w=this.sortFeaturesByKey?l.evaluate(g,{}):void 0,E={text:_,icon:x,index:y,sourceLayerIndex:m,geometry:Qi(g),properties:g.properties,type:hs[g.type],sortKey:w};if(void 0!==g.id&&(E.id=g.id),this.features.push(E),x&&(c[x]=!0),_)for(var S=i.evaluate(g,{}).join(","),A="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),T=0,P=_.sections;T<P.length;T+=1){var k=P[T],C=dr(_.toString()),O=k.fontStack||S,I=h[O]=h[O]||{};this.calculateGlyphDependencies(k.text,I,A,C)}}}}"line"===r.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in n&&d in e&&n[f]!==e[d]){var v=s(f,d,h),g=a(f,d,r[v].geometry);delete e[f],delete n[d],n[u(p,r[g].geometry,!0)]=g,r[v].geometry=null}else f in n?a(f,d,h):d in e?s(f,d,h):(o(l),e[f]=i-1,n[d]=i-1)}else o(l)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},ys.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},ys.prototype.isEmpty=function(){return 0===this.symbolInstances.length},ys.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ys.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ys.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},ys.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},ys.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,l){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,o.sortKey),d=this.glyphOffsetArray.length,v=f.vertexLength,g=0,y=e;g<y.length;g+=1){var m=y[g],_=m.tl,b=m.tr,x=m.bl,w=m.br,E=m.tex,S=f.vertexLength,A=m.glyphOffset[1];fs(h,s.x,s.y,_.x,A+_.y,E.x,E.y,n),fs(h,s.x,s.y,b.x,A+b.y,E.x+E.w,E.y,n),fs(h,s.x,s.y,x.x,A+x.y,E.x,E.y+E.h,n),fs(h,s.x,s.y,w.x,A+w.y,E.x+E.w,E.y+E.h,n),ds(p,s,0),c.emplaceBack(S,S+1,S+2),c.emplaceBack(S+1,S+2,S+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(m.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,v,u,l,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,!1,0),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{})},ys.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},ys.prototype.addCollisionDebugVertices=function(t,e,n,r,o,a,s,u){var l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=l.vertexLength,h=o.layoutVertexArray,p=o.collisionVertexArray,f=s.anchorX,d=s.anchorY;if(this._addCollisionDebugVertex(h,p,a,f,d,new i(t,e)),this._addCollisionDebugVertex(h,p,a,f,d,new i(n,e)),this._addCollisionDebugVertex(h,p,a,f,d,new i(n,r)),this._addCollisionDebugVertex(h,p,a,f,d,new i(t,r)),l.vertexLength+=4,u){var v=o.indexArray;v.emplaceBack(c,c+1,c+2),v.emplaceBack(c,c+2,c+3),l.primitiveLength+=2}else{var g=o.indexArray;g.emplaceBack(c,c+1),g.emplaceBack(c+1,c+2),g.emplaceBack(c+2,c+3),g.emplaceBack(c+3,c),l.primitiveLength+=4}},ys.prototype.addDebugCollisionBoxes=function(t,e,n){for(var r=t;r<e;r++){var i=this.collisionBoxArray.get(r),o=i.x1,a=i.y1,s=i.x2,u=i.y2,l=i.radius>0;this.addCollisionDebugVertices(o,a,s,u,l?this.collisionCircle:this.collisionBox,i.anchorPoint,n,l)}},ys.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e)}},ys.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i){for(var o={},a=e;a<n;a++){var s=t.get(a);if(0===s.radius){o.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},o.textFeatureIndex=s.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=s.featureIndex),o.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var u=r;u<i;u++){var l=t.get(u);if(0===l.radius){o.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},o.iconFeatureIndex=l.featureIndex;break}}return o},ys.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex))}},ys.prototype.hasTextData=function(){return this.text.segments.get().length>0},ys.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ys.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},ys.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},ys.prototype.addIndicesForPlacedTextSymbol=function(t){for(var e=this.text.placedSymbolArray.get(t),n=e.vertexStartIndex+4*e.numGlyphs,r=e.vertexStartIndex;r<n;r+=4)this.text.indexArray.emplaceBack(r,r+1,r+2),this.text.indexArray.emplaceBack(r+1,r+2,r+3)},ys.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var n=[],r=0;r<this.symbolInstances.length;r++)n.push(r);for(var i=Math.sin(t),o=Math.cos(t),a=[],s=[],u=0;u<this.symbolInstances.length;u++){var l=this.symbolInstances.get(u);a.push(0|Math.round(i*l.anchorX+o*l.anchorY)),s.push(l.featureIndex)}n.sort((function(t,e){return a[t]-a[e]||s[e]-s[t]})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,h=n;c<h.length;c+=1){var p=h[c],f=this.symbolInstances.get(p);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedTextSymbol(t)})),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedTextSymbol(f.verticalPlacedTextSymbolIndex);var d=this.icon.placedSymbolArray.get(p);if(d.numGlyphs){var v=d.vertexStartIndex;this.icon.indexArray.emplaceBack(v,v+1,v+2),this.icon.indexArray.emplaceBack(v+1,v+2,v+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ur("SymbolBucket",ys,{omit:["layers","collisionBoxArray","features","compareText"]}),ys.MAX_GLYPHS=65535,ys.addDynamicAttributes=ds;var ms=new Br({"symbol-placement":new Fr(yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Fr(yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fr(yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nr(yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fr(yt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Fr(yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Fr(yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fr(yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fr(yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nr(yt.layout_symbol["icon-size"]),"icon-text-fit":new Fr(yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fr(yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nr(yt.layout_symbol["icon-image"]),"icon-rotate":new Nr(yt.layout_symbol["icon-rotate"]),"icon-padding":new Fr(yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Fr(yt.layout_symbol["icon-keep-upright"]),"icon-offset":new Nr(yt.layout_symbol["icon-offset"]),"icon-anchor":new Nr(yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fr(yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fr(yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fr(yt.layout_symbol["text-rotation-alignment"]),"text-field":new Nr(yt.layout_symbol["text-field"]),"text-font":new Nr(yt.layout_symbol["text-font"]),"text-size":new Nr(yt.layout_symbol["text-size"]),"text-max-width":new Nr(yt.layout_symbol["text-max-width"]),"text-line-height":new Fr(yt.layout_symbol["text-line-height"]),"text-letter-spacing":new Nr(yt.layout_symbol["text-letter-spacing"]),"text-justify":new Nr(yt.layout_symbol["text-justify"]),"text-radial-offset":new Nr(yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fr(yt.layout_symbol["text-variable-anchor"]),"text-anchor":new Nr(yt.layout_symbol["text-anchor"]),"text-max-angle":new Fr(yt.layout_symbol["text-max-angle"]),"text-rotate":new Nr(yt.layout_symbol["text-rotate"]),"text-padding":new Fr(yt.layout_symbol["text-padding"]),"text-keep-upright":new Fr(yt.layout_symbol["text-keep-upright"]),"text-transform":new Nr(yt.layout_symbol["text-transform"]),"text-offset":new Nr(yt.layout_symbol["text-offset"]),"text-allow-overlap":new Fr(yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Fr(yt.layout_symbol["text-ignore-placement"]),"text-optional":new Fr(yt.layout_symbol["text-optional"])}),_s={paint:new Br({"icon-opacity":new Nr(yt.paint_symbol["icon-opacity"]),"icon-color":new Nr(yt.paint_symbol["icon-color"]),"icon-halo-color":new Nr(yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nr(yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nr(yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Fr(yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fr(yt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nr(yt.paint_symbol["text-opacity"]),"text-color":new Nr(yt.paint_symbol["text-color"]),"text-halo-color":new Nr(yt.paint_symbol["text-halo-color"]),"text-halo-width":new Nr(yt.paint_symbol["text-halo-width"]),"text-halo-blur":new Nr(yt.paint_symbol["text-halo-blur"]),"text-translate":new Fr(yt.paint_symbol["text-translate"]),"text-translate-anchor":new Fr(yt.paint_symbol["text-translate-anchor"])}),layout:ms},bs=function(t){function e(e){t.call(this,e,_s)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var n,r=this.layout.get(t).evaluate(e,{}),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||gn(i.value)?r:(n=e.properties,r.replace(/{([^{}]+)}/g,(function(t,e){return e in n?String(n[e]):""})))},e.prototype.createBucket=function(t){return new ys(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Ur),xs={paint:new Br({"background-color":new Fr(yt.paint_background["background-color"]),"background-pattern":new Dr(yt.paint_background["background-pattern"]),"background-opacity":new Fr(yt.paint_background["background-opacity"])})},ws=function(t){function e(e){t.call(this,e,xs)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ur),Es={paint:new Br({"raster-opacity":new Fr(yt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Fr(yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fr(yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fr(yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Fr(yt.paint_raster["raster-saturation"]),"raster-contrast":new Fr(yt.paint_raster["raster-contrast"]),"raster-resampling":new Fr(yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Fr(yt.paint_raster["raster-fade-duration"])})},Ss=function(t){function e(e){t.call(this,e,Es)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ur),As=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t)},e}(Ur),Ts={circle:Eo,heatmap:Ro,hillshade:Fo,fill:ya,"fill-extrusion":Fa,line:Ya,symbol:bs,background:ws,raster:Ss};function Ps(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}var ks=function(t,e){var n=e.pixelRatio,r=e.version;this.paddedRect=t,this.pixelRatio=n,this.version=r},Cs={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Cs.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Cs.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Cs.tlbr.get=function(){return this.tl.concat(this.br)},Cs.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ks.prototype,Cs);var Os=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=Ps(i),a=o.w,s=o.h,u=new Oo({width:a||1,height:s||1});for(var l in t){var c=t[l],h=n[l].paddedRect;Oo.copy(c.data,u,{x:0,y:0},{x:h.x+1,y:h.y+1},c.data)}for(var p in e){var f=e[p],d=r[p].paddedRect,v=d.x+1,g=d.y+1,y=f.data.width,m=f.data.height;Oo.copy(f.data,u,{x:0,y:0},{x:v,y:g},f.data),Oo.copy(f.data,u,{x:0,y:m-1},{x:v,y:g-1},{width:y,height:1}),Oo.copy(f.data,u,{x:0,y:0},{x:v,y:g+m},{width:y,height:1}),Oo.copy(f.data,u,{x:y-1,y:0},{x:v-1,y:g},{width:1,height:m}),Oo.copy(f.data,u,{x:0,y:0},{x:v+y,y:g},{width:1,height:m})}this.image=u,this.iconPositions=n,this.patternPositions=r};Os.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new ks(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},Os.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},Os.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl,i=r[0],o=r[1];n.update(e.data,void 0,{x:i,y:o})}},ur("ImagePosition",ks),ur("ImageAtlas",Os);var Is=self.HTMLImageElement,Ms=self.HTMLCanvasElement,Rs=self.HTMLVideoElement,Ls=self.ImageData,Fs=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Fs.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof Is||t instanceof Ms||t instanceof Rs||t instanceof Ls?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},l=u.x,c=u.y;t instanceof Is||t instanceof Ms||t instanceof Rs||t instanceof Ls?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Fs.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Fs.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Fs.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ns=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,h=n?i-1:0,p=n?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},js=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*v},Ds=zs;function zs(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Bs(t){return t.type===zs.Bytes?t.readVarint()+t.pos:t.pos+1}function Us(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Vs(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function Gs(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Ws(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Xs(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Hs(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function qs(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Zs(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Ks(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function Ys(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function Js(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Qs(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function $s(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function tu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}zs.Varint=0,zs.Fixed64=1,zs.Bytes=2,zs.Fixed32=5,zs.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Qs(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=tu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Qs(this.buf,this.pos)+4294967296*Qs(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Qs(this.buf,this.pos)+4294967296*tu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ns(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ns(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return Us(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return Us(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return Us(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return Us(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return Us(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return Us(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=Bs(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Bs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===zs.Varint)for(;this.buf[this.pos++]>127;);else if(e===zs.Bytes)this.pos=this.readVarint()+this.pos;else if(e===zs.Fixed32)this.pos+=4;else{if(e!==zs.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),$s(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),$s(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),$s(this.buf,-1&t,this.pos),$s(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),$s(this.buf,-1&t,this.pos),$s(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Vs(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),js(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),js(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&Vs(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,zs.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,Gs,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Ws,e)},writePackedBoolean:function(t,e){this.writeMessage(t,qs,e)},writePackedFloat:function(t,e){this.writeMessage(t,Xs,e)},writePackedDouble:function(t,e){this.writeMessage(t,Hs,e)},writePackedFixed32:function(t,e){this.writeMessage(t,Zs,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Ks,e)},writePackedFixed64:function(t,e){this.writeMessage(t,Ys,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Js,e)},writeBytesField:function(t,e){this.writeTag(t,zs.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,zs.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,zs.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,zs.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,zs.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,zs.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,zs.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,zs.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,zs.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,zs.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var eu=3;function nu(t,e,n){1===t&&n.readMessage(ru,e)}function ru(t,e,n){if(3===t){var r=n.readMessage(iu,{}),i=r.id,o=r.bitmap,a=r.width,s=r.height,u=r.left,l=r.top,c=r.advance;e.push({id:i,bitmap:new Co({width:a+2*eu,height:s+2*eu},o),metrics:{width:a,height:s,left:u,top:l,advance:c}})}}function iu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}var ou=eu,au=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.callbackID=0,g(["receive"],this),this.target.addEventListener("message",this.receive,!1)};function su(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}au.prototype.send=function(t,e,n,r){var i=this,o=n?this.mapId+":"+this.callbackID++:null;n&&(this.callbacks[o]=n);var a=[];if(this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(o),data:cr(e,a)},a),n)return{cancel:function(){i.callbacks[o]=null,i.target.postMessage({targetMapId:r,sourceMapId:i.mapId,type:"<cancel>",id:String(o)})}}},au.prototype.receive=function(t){var e,n=this,r=t.data,i=r.id;if(!r.targetMapId||this.mapId===r.targetMapId){var o=function(t,e){delete n.callbacks[i];var r=[];n.target.postMessage({sourceMapId:n.mapId,type:"<response>",id:String(i),error:t?cr(t):null,data:cr(e,r)},r)};if("<response>"===r.type||"<cancel>"===r.type)e=this.callbacks[r.id],delete this.callbacks[r.id],e&&r.error?e(hr(r.error)):e&&e(null,hr(r.data));else if(void 0!==r.id&&this.parent[r.type]){this.callbacks[r.id]=null;var a=this.parent[r.type](r.sourceMapId,hr(r.data),o);a&&null===this.callbacks[r.id]&&(this.callbacks[r.id]=a.cancel)}else if(void 0!==r.id&&this.parent.getWorkerSource){var s=r.type.split("."),u=hr(r.data);this.parent.getWorkerSource(r.sourceMapId,s[0],u.source)[s[1]](u,o)}else this.parent[r.type](hr(r.data))}},au.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var uu=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};uu.prototype.setNorthEast=function(t){return this._ne=t instanceof lu?new lu(t.lng,t.lat):lu.convert(t),this},uu.prototype.setSouthWest=function(t){return this._sw=t instanceof lu?new lu(t.lng,t.lat):lu.convert(t),this},uu.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof lu)e=t,n=t;else{if(!(t instanceof uu))return Array.isArray(t)?t.every(Array.isArray)?this.extend(uu.convert(t)):this.extend(lu.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new lu(e.lng,e.lat),this._ne=new lu(n.lng,n.lat)),this},uu.prototype.getCenter=function(){return new lu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},uu.prototype.getSouthWest=function(){return this._sw},uu.prototype.getNorthEast=function(){return this._ne},uu.prototype.getNorthWest=function(){return new lu(this.getWest(),this.getNorth())},uu.prototype.getSouthEast=function(){return new lu(this.getEast(),this.getSouth())},uu.prototype.getWest=function(){return this._sw.lng},uu.prototype.getSouth=function(){return this._sw.lat},uu.prototype.getEast=function(){return this._ne.lng},uu.prototype.getNorth=function(){return this._ne.lat},uu.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},uu.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},uu.prototype.isEmpty=function(){return!(this._sw&&this._ne)},uu.convert=function(t){return!t||t instanceof uu?t:new uu(t)};var lu=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};function cu(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function hu(t){return(180+t)/360}function pu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function fu(t,e){return t/cu(e)}function du(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}lu.prototype.wrap=function(){return new lu(c(this.lng,-180,180),this.lat)},lu.prototype.toArray=function(){return[this.lng,this.lat]},lu.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},lu.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new uu(new lu(this.lng-n,this.lat-e),new lu(this.lng+n,this.lat+e))},lu.convert=function(t){if(t instanceof lu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new lu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new lu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var vu=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};vu.fromLngLat=function(t,e){void 0===e&&(e=0);var n=lu.convert(t);return new vu(hu(n.lng),pu(n.lat),fu(e,n.lat))},vu.prototype.toLngLat=function(){return new lu(360*this.x-180,du(this.y))},vu.prototype.toAltitude=function(){return this.z*cu(du(this.y))};var gu=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=_u(0,t,e,n)};gu.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},gu.prototype.url=function(t,e){var n,r,i,o,a,s=(n=this.x,r=this.y,i=this.z,o=su(256*n,256*(r=Math.pow(2,i)-r-1),i),a=su(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},gu.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i((t.x*e-this.x)*Yi,(t.y*e-this.y)*Yi)};var yu=function(t,e){this.wrap=t,this.canonical=e,this.key=_u(t,e.z,e.x,e.y)},mu=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new gu(n,+r,+i),this.key=_u(e,t,r,i)};function _u(t,e,n,r){(t*=2)<0&&(t=-1*t-1);var i=1<<e;return 32*(i*i*t+i*r+n)+e}mu.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},mu.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new mu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},mu.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},mu.prototype.children=function(t){if(this.overscaledZ>=t)return[new mu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new mu(e,this.wrap,e,n,r),new mu(e,this.wrap,e,n+1,r),new mu(e,this.wrap,e,n,r+1),new mu(e,this.wrap,e,n+1,r+1)]},mu.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},mu.prototype.wrapped=function(){return new mu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},mu.prototype.unwrapTo=function(t){return new mu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},mu.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},mu.prototype.toUnwrapped=function(){return new yu(this.wrap,this.canonical)},mu.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},mu.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new vu(t.x-this.wrap,t.y))},ur("CanonicalTileID",gu),ur("OverscaledTileID",mu,{omit:["posMatrix"]});var bu=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return w('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');var r=this.dim=e.height;this.stride=this.dim+2,this.data=new Int32Array(this.stride*this.stride);for(var i=e.data,o="terrarium"===n?this._unpackTerrarium:this._unpackMapbox,a=0;a<r;a++)for(var s=0;s<r;s++){var u=4*(a*r+s);this.set(s,a,o(i[u],i[u+1],i[u+2]))}for(var l=0;l<r;l++)this.set(-1,l,this.get(0,l)),this.set(r,l,this.get(r-1,l)),this.set(l,-1,this.get(l,0)),this.set(l,r,this.get(l,r-1));this.set(-1,-1,this.get(0,0)),this.set(r,-1,this.get(r-1,0)),this.set(-1,r,this.get(0,r-1)),this.set(r,r,this.get(r-1,r-1))};bu.prototype.set=function(t,e,n){this.data[this._idx(t,e)]=n+65536},bu.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},bu.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},bu.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},bu.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},bu.prototype.getPixels=function(){return new Oo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},bu.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,l=o;l<a;l++)for(var c=r;c<i;c++)this.set(c,l,t.get(c+s,l+u))},ur("DEMData",bu);var xu=Xr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),wu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};wu.prototype.encode=function(t){return this._stringToNumber[t]},wu.prototype.decode=function(t){return this._numberToString[t]};var Eu=function(t,e,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,null!=t.id&&(this.id=t.id)},Su={geometry:{configurable:!0}};Su.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Su.geometry.set=function(t){this._geometry=t},Eu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Eu.prototype,Su);var Au=function(){this.state={},this.stateChanges={},this.deletedStates={}};Au.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},h(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},Au.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},Au.prototype.getState=function(t,e){var n=String(e),r=this.state[t]||{},i=this.stateChanges[t]||{},o=h({},r[n],i[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var a=this.deletedStates[t][e];if(null===a)return{};for(var s in a)delete o[s]}return o},Au.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Au.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),h(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,p=Object.keys(this.deletedStates[a][l]);c<p.length;c+=1){var f=p[c];delete this.state[a][l][f]}s[l]=this.state[a][l]}n[a]=n[a]||{},h(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var d in t)t[d].setFeatureState(n,e)};var Tu=function(t,e,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new rr(Yi,16,0),this.grid3D=new rr(Yi,16,0),this.featureIndexArray=n||new Ai};function Pu(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function ku(t,e){return e-t}Tu.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<Yi&&c[1]<Yi&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},Tu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Pa.VectorTile(new Ds(this.rawTileData)).layers,this.sourceLayerCoder=new wu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Tu.prototype.query=function(t,e,n){var r=this;this.loadVTLayers();for(var o=t.params||{},a=Yi/t.tileSize/t.scale,s=In(o.filter),u=t.queryGeometry,l=t.queryPadding*a,c=Pu(u),h=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),p=Pu(t.cameraQueryGeometry),f=0,d=this.grid3D.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l,(function(e,n,r,o){return function(t,e,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var l=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(co(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(ho(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-l,n-l,r+l,o+l)}));f<d.length;f+=1){var v=d[f];h.push(v)}h.sort(ku);for(var g,y={},m=function(i){var l=h[i];if(l!==g){g=l;var c=r.featureIndexArray.get(l),p=null;r.loadMatchingFeature(y,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,s,o.layers,e,(function(e,i){p||(p=Qi(e));var o={};return e.id&&(o=n.getState(i.sourceLayer||"_geojsonTileLayer",e.id)),i.queryIntersectsFeature(u,e,o,p,r.z,t.transform,a,t.pixelPosMatrix)}))}},_=0;_<h.length;_++)m(_);return y},Tu.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s){var u=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,u)){var l=this.sourceLayerCoder.decode(n),c=this.vtLayers[l].feature(r);if(i(new Tr(this.tileID.overscaledZ),c))for(var h=0;h<u.length;h++){var p=u[h];if(!(o&&o.indexOf(p)<0)){var f=a[p];if(f){var d=!s||s(c,f);if(d){var v=new Eu(c,this.z,this.x,this.y);v.layer=f.serialize();var g=t[p];void 0===g&&(g=t[p]=[]),g.push({featureIndex:r,feature:v,intersectionZ:d})}}}}}},Tu.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o){var a={};this.loadVTLayers();for(var s=In(r),u=0,l=t;u<l.length;u+=1){var c=l[u];this.loadMatchingFeature(a,e,n,c,s,i,o)}return a},Tu.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},ur("FeatureIndex",Tu,{omit:["rawTileData","sourceLayerCoder"]});var Cu=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.expiredRequestCount=0,this.state="loading"};Cu.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<M.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Cu.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Cu.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1){var u=s[a];n[u.id]=t}}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof ys){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}for(var o in this.queryPadding=0,this.buckets){var a=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(o).queryRadius(a))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new vi},Cu.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Cu.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Cu.prototype.getBucket=function(t){return this.buckets[t.id]},Cu.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fs(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fs(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},Cu.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Cu.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:r,scale:i,tileSize:this.tileSize,pixelPosMatrix:u,transform:a,params:o,queryPadding:this.queryPadding*s},t,e):{}},Cu.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var n=this.latestFeatureIndex.loadVTLayers(),r=e?e.sourceLayer:"",i=n._geojsonTileLayer||n[r];if(i)for(var o=In(e&&e.filter),a=this.tileID.canonical,s=a.z,u=a.x,l=a.y,c={z:s,x:u,y:l},h=0;h<i.length;h++){var p=i.feature(h);if(o(new Tr(this.tileID.overscaledZ),p)){var f=new Eu(p,s,u,l);f.tile=c,t.push(f)}}}},Cu.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Cu.prototype.setMask=function(t,e){if(!a(this.mask,t)&&(this.mask=t,this.clearMask(),!a(t,{0:!0}))){var n=new Zr,r=new li;this.segments=new Pi,this.segments.prepareSegment(0,n,r);for(var o=Object.keys(t),s=0;s<o.length;s++){var u=t[o[s]],l=Yi>>u.z,c=new i(u.x*l,u.y*l),h=new i(c.x+l,c.y+l),p=this.segments.prepareSegment(4,n,r);n.emplaceBack(c.x,c.y,c.x,c.y),n.emplaceBack(h.x,c.y,h.x,c.y),n.emplaceBack(c.x,h.y,c.x,h.y),n.emplaceBack(h.x,h.y,h.x,h.y);var f=p.vertexLength;r.emplaceBack(f,f+1,f+2),r.emplaceBack(f+1,f+2,f+3),p.vertexLength+=4,p.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(n,xu.members),this.maskedIndexBuffer=e.createIndexBuffer(r)}},Cu.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Cu.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Cu.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Cu.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Cu.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];a&&s&&0!==Object.keys(s).length&&(i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(r).queryRadius(i))))}}},Cu.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Cu.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()},Cu.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Cu.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=M.now()+t};var Ou=24,Iu={horizontal:1,vertical:2,horizontalOnly:3},Mu=function(){this.text="",this.sectionIndex=[],this.sections=[]};function Ru(t,e,n,r,i,o,a,s,u,l){var c,h=Mu.fromFeature(t,n);l===Iu.vertical&&h.verticalizePunctuation();var p=Ar.processBidirectionalText,f=Ar.processStyledBidirectionalText;if(p&&1===h.sections.length){c=[];for(var d=0,v=p(h.toString(),zu(h,s,r,e));d<v.length;d+=1){var g=v[d],y=new Mu;y.text=g,y.sections=h.sections;for(var m=0;m<g.length;m++)y.sectionIndex.push(0);c.push(y)}}else if(f){c=[];for(var _=0,b=f(h.text,h.sectionIndex,zu(h,s,r,e));_<b.length;_+=1){var x=b[_],w=new Mu;w.text=x[0],w.sectionIndex=x[1],w.sections=h.sections,c.push(w)}}else c=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(h,zu(h,s,r,e));var E=[],S={positionedGlyphs:E,text:h.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:l,lineCount:c.length};return function(t,e,n,r,i,o,a,s){for(var u=0,l=-17,c=0,h=t.positionedGlyphs,p="right"===o?1:"left"===o?0:.5,f=0,d=n;f<d.length;f+=1){var v=d[f];v.trim();var g=v.getMaxScale();if(v.length()){for(var y=h.length,m=0;m<v.length();m++){var _=v.getSection(m),b=v.getCharCode(m),x=24*(g-_.scale),w=e[_.fontStack],E=w&&w[b];E&&(yr(b)&&a!==Iu.horizontal?(h.push({glyph:b,x:u,y:x,vertical:!0,scale:_.scale,fontStack:_.fontStack}),u+=Ou*_.scale+s):(h.push({glyph:b,x:u,y:l+x,vertical:!1,scale:_.scale,fontStack:_.fontStack}),u+=E.metrics.advance*_.scale+s))}if(h.length!==y){var S=u-s;c=Math.max(S,c),Uu(h,e,y,h.length-1,p)}u=0,l+=r*g}else l+=r}var A=Bu(i),T=A.horizontalAlign,P=A.verticalAlign;!function(t,e,n,r,i,o,a){for(var s=(e-n)*i,u=(-r*a+.5)*o,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u}(h,p,T,P,c,r,n.length);var k=l- -17;t.top+=-P*k,t.bottom=t.top+k,t.left+=-T*c,t.right=t.left+c}(S,e,c,i,o,a,l,s),!!E.length&&S}Mu.fromFeature=function(t,e){for(var n=new Mu,r=0;r<t.sections.length;r++){var i=t.sections[r];n.sections.push({scale:i.scale||1,fontStack:i.fontStack||e}),n.text+=i.text;for(var o=0;o<i.text.length;o++)n.sectionIndex.push(r)}return n},Mu.prototype.length=function(){return this.text.length},Mu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Mu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Mu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;r&&mr(r)&&!is[t[n+1]]||i&&mr(i)&&!is[t[n-1]]||!is[t[n]]?e+=t[n]:e+=is[t[n]]}return e}(this.text)},Mu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Lu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Lu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Mu.prototype.substring=function(t,e){var n=new Mu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Mu.prototype.toString=function(){return this.text},Mu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)};var Lu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Fu={};function Nu(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function ju(t,e){var n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Du(t,e,n,r,i,o){for(var a=null,s=Nu(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],h=Nu(e-c.x,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function zu(t,e,n,r){if(!n)return[];if(!t)return[];for(var i,o=[],a=function(t,e,n,r){for(var i=0,o=0;o<t.length();o++){var a=t.getSection(o),s=r[a.fontStack],u=s&&s[t.getCharCode(o)];u&&(i+=u.metrics.advance*a.scale+e)}return i/Math.max(1,Math.ceil(i/n))}(t,e,n,r),s=0,u=0;u<t.length();u++){var l=t.getSection(u),c=t.getCharCode(u),h=r[l.fontStack],p=h&&h[c];p&&!Lu[c]&&(s+=p.metrics.advance*l.scale+e),u<t.length()-1&&(Fu[c]||!((i=c)<11904)&&(fr["Bopomofo Extended"](i)||fr.Bopomofo(i)||fr["CJK Compatibility Forms"](i)||fr["CJK Compatibility Ideographs"](i)||fr["CJK Compatibility"](i)||fr["CJK Radicals Supplement"](i)||fr["CJK Strokes"](i)||fr["CJK Symbols and Punctuation"](i)||fr["CJK Unified Ideographs Extension A"](i)||fr["CJK Unified Ideographs"](i)||fr["Enclosed CJK Letters and Months"](i)||fr["Halfwidth and Fullwidth Forms"](i)||fr.Hiragana(i)||fr["Ideographic Description Characters"](i)||fr["Kangxi Radicals"](i)||fr["Katakana Phonetic Extensions"](i)||fr.Katakana(i)||fr["Vertical Forms"](i)||fr["Yi Radicals"](i)||fr["Yi Syllables"](i)))&&o.push(Du(u+1,s,a,o,ju(c,t.getCharCode(u+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Du(t.length(),s,a,o,0,!0))}function Bu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Uu(t,e,n,r,i){if(i){var o=t[r],a=e[o.fontStack],s=a&&a[o.glyph];if(s)for(var u=s.metrics.advance*o.scale,l=(t[r].x+u)*i,c=n;c<=r;c++)t[c].x-=l}}function Vu(t,e,n){var r=Bu(n),i=r.horizontalAlign,o=r.verticalAlign,a=e[0],s=e[1],u=a-t.displaySize[0]*i,l=u+t.displaySize[0],c=s-t.displaySize[1]*o;return{image:t,top:c,bottom:c+t.displaySize[1],left:u,right:l}}function Gu(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a-1],h=t[a],p=t[a+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=h.dist(p)}return!0}function Wu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Xu(t,e,n){return t?.6*e*n:0}function Hu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function qu(t,e,n,r,i,o){for(var a=Xu(n,i,o),s=Hu(n,r)*o,u=0,l=Wu(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,v=ce(h.x,p.x,d),g=ce(h.y,p.y,d),y=new os(v,g,p.angleTo(h),c);return y._round(),!a||Gu(t,y,s,a,e)?y:void 0}u+=f}}function Zu(t,e,n,r,i,o,a,s,u){var l=Xu(r,o,a),c=Hu(r,i),h=c*a,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,u,l){for(var c=a/2,h=Wu(e),p=0,f=n-r,d=[],v=0;v<e.length-1;v++){for(var g=e[v],y=e[v+1],m=g.dist(y),_=y.angleTo(g);f+r<p+m;){var b=((f+=r)-p)/m,x=ce(g.x,y.x,b),w=ce(g.y,y.y,b);if(x>=0&&x<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var E=new os(x,w,_,v);E._round(),i&&!Gu(e,E,a,i,o)||d.push(E)}}p+=m}return u||d.length||s||(d=t(e,p/2,r,i,o,a,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,l,n,h,p,!1,u)}Fu[10]=!0,Fu[32]=!0,Fu[38]=!0,Fu[40]=!0,Fu[41]=!0,Fu[43]=!0,Fu[45]=!0,Fu[47]=!0,Fu[173]=!0,Fu[183]=!0,Fu[8203]=!0,Fu[8208]=!0,Fu[8211]=!0,Fu[8231]=!0;var Ku=function(t,e,n,r,o,a,s,u,l,c,h,p){var f=s.top*u-l,d=s.bottom*u+l,v=s.left*u-l,g=s.right*u+l;if(this.boxStartIndex=t.length,c){var y=d-f,m=g-v;y>0&&(y=Math.max(10*u,y),this._addLineCollisionCircles(t,e,n,n.segment,m,y,r,o,a,h))}else{if(p){var _=new i(v,f),b=new i(g,f),x=new i(v,d),w=new i(g,d),E=p*Math.PI/180;_._rotate(E),b._rotate(E),x._rotate(E),w._rotate(E),v=Math.min(_.x,b.x,x.x,w.x),g=Math.max(_.x,b.x,x.x,w.x),f=Math.min(_.y,b.y,x.y,w.y),d=Math.max(_.y,b.y,x.y,w.y)}t.emplaceBack(n.x,n.y,v,f,g,d,r,o,a,0,0)}this.boxEndIndex=t.length};Ku.prototype._addLineCollisionCircles=function(t,e,n,r,i,o,a,s,u,l){var c=o/2,h=Math.floor(i/c)||1,p=1+.4*Math.log(l)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,v=n,g=r+1,y=d,m=-i/2,_=m-i/4;do{if(--g<0){if(y>m)return;g=0;break}y-=e[g].dist(v),v=e[g]}while(y>_);for(var b=e[g].dist(e[g+1]),x=-f;x<h+f;x++){var w=x*c,E=m+w;if(w<0&&(E+=w),w>i&&(E+=w-i),!(E<y)){for(;y+b<E;){if(y+=b,++g+1>=e.length)return;b=e[g].dist(e[g+1])}var S=E-y,A=e[g],T=e[g+1].sub(A)._unit()._mult(S)._add(A)._round(),P=Math.abs(E-d)<c?0:.8*(E-d);t.emplaceBack(T.x,T.y,-o/2,-o/2,o/2,o/2,a,s,u,o/2,P)}}};var Yu=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=Ju),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function Ju(t,e){return t<e?-1:t>e?1:0}function Qu(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<r)&&(r=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=a-r,p=s-o,f=Math.min(h,p),d=f/2,v=new Yu([],$u);if(0===f)return new i(r,o);for(var g=r;g<a;g+=f)for(var y=o;y<s;y+=f)v.push(new tl(g+d,y+d,d,t));for(var m=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new tl(n/e,r/e,0,t)}(t),_=v.length;v.length;){var b=v.pop();(b.d>m.d||!m.d)&&(m=b,n&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,_)),b.max-m.d<=e||(d=b.h/2,v.push(new tl(b.p.x-d,b.p.y-d,d,t)),v.push(new tl(b.p.x+d,b.p.y-d,d,t)),v.push(new tl(b.p.x-d,b.p.y+d,d,t)),v.push(new tl(b.p.x+d,b.p.y+d,d,t)),_+=4)}return n&&(console.log("num probes: "+_),console.log("best distance: "+m.d)),m.p}function $u(t,e){return e.max-t.max}function tl(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(n=!n),r=Math.min(r,uo(t,l,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}Yu.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Yu.prototype.pop=function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},Yu.prototype.peek=function(){return this.data[0]},Yu.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},Yu.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var el=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,l;for(n=3&t.length,r=t.length-n,i=e,a=3432918353,s=461845907,l=0;l<r;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),nl=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),rl=el,il=el,ol=nl;rl.murmur3=il,rl.murmur2=ol;var al=7;function sl(t,e){var n=0,r=0,i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-al;break;case"bottom-right":case"bottom-left":r=-i+al;break;case"bottom":r=-e+al;break;case"top":r=e-al}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}function ul(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ll(t,e,n,r,o,a,s){var u=a.layoutTextSize.evaluate(e,{}),l=a.layoutIconSize.evaluate(e,{}),c=a.textMaxSize.evaluate(e,{});void 0===c&&(c=u);var h=t.layers[0].layout,p=h.get("icon-offset").evaluate(e,{}),f=pl(n.horizontal),d=u/24,v=t.tilePixelRatio*d,g=t.tilePixelRatio*c/24,y=t.tilePixelRatio*l,m=t.tilePixelRatio*h.get("symbol-spacing"),_=h.get("text-padding")*t.tilePixelRatio,b=h.get("icon-padding")*t.tilePixelRatio,x=h.get("text-max-angle")/180*Math.PI,E="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),S="map"===h.get("icon-rotation-alignment")&&"point"!==h.get("symbol-placement"),A=h.get("symbol-placement"),T=m/2,P=function(u,l){l.x<0||l.x>=Yi||l.y<0||l.y>=Yi||function(t,e,n,r,o,a,s,u,l,c,h,p,f,d,v,g,y,m,_,b,x){var E,S,A=t.addToLineVertexArray(e,n),T=0,P=0,k=0,C={},O=rl(""),I=(a.layout.get("text-radial-offset").evaluate(_,{})||0)*Ou;for(var M in r.horizontal){var R=r.horizontal[M];if(!E){O=rl(R.text);var L=a.layout.get("text-rotate").evaluate(_,{});E=new Ku(s,n,e,u,l,c,R,h,p,f,t.overscaling,L)}var F=1===R.lineCount;if(P+=hl(t,e,R,a,f,_,d,A,r.vertical?Iu.horizontal:Iu.horizontalOnly,F?Object.keys(r.horizontal):[M],C,b,x),F)break}r.vertical&&(k+=hl(t,e,r.vertical,a,f,_,d,A,Iu.vertical,["vertical"],C,b,x));var N=E?E.boxStartIndex:t.collisionBoxArray.length,j=E?E.boxEndIndex:t.collisionBoxArray.length;if(o){var D=function(t,e,n,r,o,a){var s,u,l,c,h=e.image,p=n.layout,f=e.top-1/h.pixelRatio,d=e.left-1/h.pixelRatio,v=e.bottom+1/h.pixelRatio,g=e.right+1/h.pixelRatio;if("none"!==p.get("icon-text-fit")&&o){var y=g-d,m=v-f,_=p.get("text-size").evaluate(a,{})/24,b=o.left*_,x=o.right*_,w=o.top*_,E=x-b,S=o.bottom*_-w,A=p.get("icon-text-fit-padding")[0],T=p.get("icon-text-fit-padding")[1],P=p.get("icon-text-fit-padding")[2],k=p.get("icon-text-fit-padding")[3],C="width"===p.get("icon-text-fit")?.5*(S-m):0,O="height"===p.get("icon-text-fit")?.5*(E-y):0,I="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?E:y,M="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?S:m;s=new i(b+O-k,w+C-A),u=new i(b+O+T+I,w+C-A),l=new i(b+O+T+I,w+C+P+M),c=new i(b+O-k,w+C+P+M)}else s=new i(d,f),u=new i(g,f),l=new i(g,v),c=new i(d,v);var R=n.layout.get("icon-rotate").evaluate(a,{})*Math.PI/180;if(R){var L=Math.sin(R),F=Math.cos(R),N=[F,-L,L,F];s._matMult(N),u._matMult(N),c._matMult(N),l._matMult(N)}return[{tl:s,tr:u,bl:c,br:l,tex:h.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,o,a,0,pl(r.horizontal),_),z=a.layout.get("icon-rotate").evaluate(_,{});S=new Ku(s,n,e,u,l,c,o,v,g,!1,t.overscaling,z),T=4*D.length;var B=t.iconSizeData,U=null;"source"===B.functionType?(U=[as*a.layout.get("icon-size").evaluate(_,{})])[0]>cl&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'):"composite"===B.functionType&&((U=[as*x.compositeIconSizes[0].evaluate(_,{}),as*x.compositeIconSizes[1].evaluate(_,{})])[0]>cl||U[1]>cl)&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'),t.addSymbols(t.icon,D,U,m,y,_,!1,e,A.lineStartIndex,A.lineLength)}var V=S?S.boxStartIndex:t.collisionBoxArray.length,G=S?S.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=ys.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,C.right>=0?C.right:-1,C.center>=0?C.center:-1,C.left>=0?C.left:-1,C.vertical||-1,O,N,j,V,G,u,P,k,T,0,h,I)}(t,l,u,n,r,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,v,_,E,s,y,b,S,p,e,o,a)};if("line"===A)for(var k=0,C=function(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<0&&p.x<0||(h.x<0?h=new i(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round():p.x<0&&(p=new i(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round()),h.y<0&&p.y<0||(h.y<0?h=new i(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round():p.y<0&&(p=new i(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round()),h.x>=r&&p.x>=r||(h.x>=r?h=new i(r,h.y+(p.y-h.y)*((r-h.x)/(p.x-h.x)))._round():p.x>=r&&(p=new i(r,h.y+(p.y-h.y)*((r-h.x)/(p.x-h.x)))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(p.x-h.x)*((o-h.y)/(p.y-h.y)),o)._round():p.y>=o&&(p=new i(h.x+(p.x-h.x)*((o-h.y)/(p.y-h.y)),o)._round()),l&&h.equals(l[l.length-1])||(l=[h],a.push(l)),l.push(p)))))}return a}(e.geometry,0,0,Yi,Yi);k<C.length;k+=1)for(var O=C[k],I=0,M=Zu(O,m,x,n.vertical||f,r,24,g,t.overscaling,Yi);I<M.length;I+=1){var R=M[I];f&&fl(t,f.text,T,R)||P(O,R)}else if("line-center"===A)for(var L=0,F=e.geometry;L<F.length;L+=1){var N=F[L];if(N.length>1){var j=qu(N,x,n.vertical||f,r,24,g);j&&P(N,j)}}else if("Polygon"===e.type)for(var D=0,z=ha(e.geometry,0);D<z.length;D+=1){var B=z[D],U=Qu(B,16);P(B[0],new os(U.x,U.y,0))}else if("LineString"===e.type)for(var V=0,G=e.geometry;V<G.length;V+=1){var W=G[V];P(W,new os(W[0].x,W[0].y,0))}else if("Point"===e.type)for(var X=0,H=e.geometry;X<H.length;X+=1)for(var q=0,Z=H[X];q<Z.length;q+=1){var K=Z[q];P([K],new os(K.x,K.y,0))}}var cl=65535;function hl(t,e,n,r,o,a,s,u,l,c,h,p,f){var d=function(t,e,n,r,o,a,s){for(var u=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,l=e.positionedGlyphs,c=[],h=0;h<l.length;h++){var p=l[h],f=s[p.fontStack],d=f&&f[p.glyph];if(d){var v=d.rect;if(v){var g=ou+1,y=d.metrics.advance*p.scale/2,m=o?[p.x+y,p.y]:[0,0],_=o?[0,0]:[p.x+y+n[0],p.y+n[1]],b=(d.metrics.left-g)*p.scale-y+_[0],x=(-d.metrics.top-g)*p.scale+_[1],w=b+v.w*p.scale,E=x+v.h*p.scale,S=new i(b,x),A=new i(w,x),T=new i(b,E),P=new i(w,E);if(o&&p.vertical){var k=new i(-y,y),C=-Math.PI/2,O=new i(5,0);S._rotateAround(C,k)._add(O),A._rotateAround(C,k)._add(O),T._rotateAround(C,k)._add(O),P._rotateAround(C,k)._add(O)}if(u){var I=Math.sin(u),M=Math.cos(u),R=[M,-I,I,M];S._matMult(R),A._matMult(R),T._matMult(R),P._matMult(R)}c.push({tl:S,tr:A,bl:T,br:P,tex:v,writingMode:e.writingMode,glyphOffset:m})}}}return c}(0,n,s,r,o,a,p),v=t.textSizeData,g=null;"source"===v.functionType?(g=[as*r.layout.get("text-size").evaluate(a,{})])[0]>cl&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'):"composite"===v.functionType&&((g=[as*f.compositeTextSizes[0].evaluate(a,{}),as*f.compositeTextSizes[1].evaluate(a,{})])[0]>cl||g[1]>cl)&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'),t.addSymbols(t.text,d,g,s,o,a,l,e,u.lineStartIndex,u.lineLength);for(var y=0,m=c;y<m.length;y+=1)h[m[y]]=t.text.placedSymbolArray.length-1;return 4*d.length}function pl(t){for(var e in t)return t[e];return null}function fl(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}t.Actor=au,t.AlphaImage=Co,t.CanonicalTileID=gu,t.CollisionBoxArray=vi,t.Color=zt,t.DEMData=bu,t.DataConstantProperty=Fr,t.DictionaryCoder=wu,t.EXTENT=Yi,t.ErrorEvent=vt,t.EvaluationParameters=Tr,t.Event=dt,t.Evented=gt,t.FeatureIndex=Tu,t.FillBucket=va,t.FillExtrusionBucket=Ia,t.ImageAtlas=Os,t.ImagePosition=ks,t.LineBucket=Xa,t.LngLat=lu,t.LngLatBounds=uu,t.MercatorCoordinate=vu,t.ONE_EM=Ou,t.OverscaledTileID=mu,t.Point=i,t.Point$1=i,t.ProgramConfiguration=Hi,t.Properties=Br,t.Protobuf=Ds,t.RGBAImage=Oo,t.ResourceType=nt,t.SegmentVector=Pi,t.SourceFeatureState=Au,t.StructArrayLayout1ui2=hi,t.StructArrayLayout2i4=qr,t.StructArrayLayout2ui4=ci,t.StructArrayLayout3ui6=li,t.StructArrayLayout4i8=Zr,t.SymbolBucket=ys,t.Texture=Fs,t.Tile=Cu,t.Transitionable=Cr,t.Uniform1f=Ri,t.Uniform1i=Mi,t.Uniform2f=Li,t.Uniform3f=Fi,t.Uniform4f=Ni,t.UniformColor=ji,t.UniformMatrix4f=zi,t.UnwrappedTileID=yu,t.ValidationError=mt,t.WritingMode=Iu,t.ZoomHistory=pr,t.addDynamicAttributes=ds,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=s,t.bindAll=g,t.browser=M,t.canonicalizeTileset=function(t,e){if(!B(e))return t.tiles||[];for(var n=[],r=0,i=t.tiles;r<i.length;r+=1){var o=i[r],a=X(o);n.push(a)}return n},t.clamp=l,t.clone=function(t){var e=new yo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.config=R,t.create=function(){var t=new yo(16);return yo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=mo,t.create$2=function(){var t=new yo(4);return yo!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=yn,t.createLayout=Xr,t.createStyleLayer=function(t){return"custom"===t.type?new As(t):new Ts[t.type](t)},t.deepEqual=a,t.ease=u,t.emitValidationErrors=nr,t.endsWith=y,t.evaluateRadialOffset=sl,t.evaluateSizeForFeature=us,t.evaluateSizeForZoom=ls,t.evented=Sr,t.extend=h,t.featureFilter=In,t.filterObject=_,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Bu,t.getAnchorJustification=ul,t.getArrayBuffer=lt,t.getImage=ht,t.getJSON=function(t,e){return ut(h(t,{type:"json"}),e)},t.getReferrer=st,t.getVideo=function(t,e){var n,r,i=self.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");n=t[o],r=void 0,(r=self.document.createElement("a")).href=n,(r.protocol!==self.document.location.protocol||r.host!==self.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],g=e[14],y=e[15],m=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,w=r*l-o*s,E=i*l-o*u,S=c*v-h*d,A=c*g-p*d,T=c*y-f*d,P=h*g-p*v,k=h*y-f*v,C=p*y-f*g,O=m*C-_*k+b*P+x*T-w*A+E*S;return O?(O=1/O,t[0]=(s*C-u*k+l*P)*O,t[1]=(i*k-r*C-o*P)*O,t[2]=(v*E-g*w+y*x)*O,t[3]=(p*w-h*E-f*x)*O,t[4]=(u*T-a*C-l*A)*O,t[5]=(n*C-i*T+o*A)*O,t[6]=(g*b-d*E-y*_)*O,t[7]=(c*E-p*b+f*_)*O,t[8]=(a*k-s*T+l*S)*O,t[9]=(r*T-n*k-o*S)*O,t[10]=(d*w-v*b+y*m)*O,t[11]=(h*b-c*w-f*m)*O,t[12]=(s*A-a*P-u*S)*O,t[13]=(n*P-r*A+i*S)*O,t[14]=(v*_-d*x-g*m)*O,t[15]=(c*x-h*_+p*m)*O,t):null},t.isChar=fr,t.isMapboxURL=B,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=ut,t.mapObject=m,t.mercatorXfromLng=hu,t.mercatorYfromLat=pu,t.mercatorZfromAltitude=fu,t.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],g=e[13],y=e[14],m=e[15],_=n[0],b=n[1],x=n[2],w=n[3];return t[0]=_*r+b*s+x*h+w*v,t[1]=_*i+b*u+x*p+w*g,t[2]=_*o+b*l+x*f+w*y,t[3]=_*a+b*c+x*d+w*m,_=n[4],b=n[5],x=n[6],w=n[7],t[4]=_*r+b*s+x*h+w*v,t[5]=_*i+b*u+x*p+w*g,t[6]=_*o+b*l+x*f+w*y,t[7]=_*a+b*c+x*d+w*m,_=n[8],b=n[9],x=n[10],w=n[11],t[8]=_*r+b*s+x*h+w*v,t[9]=_*i+b*u+x*p+w*g,t[10]=_*o+b*l+x*f+w*y,t[11]=_*a+b*c+x*d+w*m,_=n[12],b=n[13],x=n[14],w=n[15],t[12]=_*r+b*s+x*h+w*v,t[13]=_*i+b*u+x*p+w*g,t[14]=_*o+b*l+x*f+w*y,t[15]=_*a+b*c+x*d+w*m,t},t.mvt=Pa,t.normalizeGlyphsURL=function(t,e){if(!B(t))return t;var n=q(t);return n.path="/fonts/v1"+n.path,z(n,e)},t.normalizeSourceURL=function(t,e){if(!B(t))return t;var n=q(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),z(n,e)},t.normalizeSpriteURL=function(t,e,n,r){var i=q(t);return B(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,z(i,r)):(i.path+=""+e+n,Z(i))},t.normalizeStyleURL=function(t,e){if(!B(t))return t;var n=q(t);return n.path="/styles/v1"+n.path,z(n,e)},t.normalizeTileURL=function(t,e,n){if(!e||!B(e))return t;var r=q(t),i=M.devicePixelRatio>=2||512===n?"@2x":"",o=L.supported?".webp":"$1";return r.path=r.path.replace(G,""+i+o),r.path="/v4"+r.path,z(r)},t.number=ce,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Ds(t).readFields(nu,[])},t.pbf=Ds,t.performSymbolLayout=function(t,e,n,r,i,o){t.createArrays();var a=512*t.overscaling;t.tilePixelRatio=Yi/a,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,p=c.max;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Tr(h)),u["text-size"].possiblyEvaluate(new Tr(p))]}if("composite"===t.iconSizeData.functionType){var f=t.iconSizeData.zoomRange,d=f.min,v=f.max;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Tr(d)),u["icon-size"].possiblyEvaluate(new Tr(v))]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new Tr(t.zoom+1)),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new Tr(t.zoom+1)),l.textMaxSize=u["text-size"].possiblyEvaluate(new Tr(18));for(var g=s.get("text-line-height")*Ou,y="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),_=0,b=t.features;_<b.length;_+=1){var x=b[_],E=s.get("text-font").evaluate(x,{}).join(","),S=n,A={horizontal:{},vertical:void 0},T=x.text,P=[0,0];if(T){var k=T.toString(),C=s.get("text-letter-spacing").evaluate(x,{})*Ou,O=vr(k)?C:0,I=s.get("text-anchor").evaluate(x,{}),M=s.get("text-variable-anchor"),R=s.get("text-radial-offset").evaluate(x,{});M||(P=R?sl(I,R*Ou):s.get("text-offset").evaluate(x,{}).map((function(t){return t*Ou})));var L=y?"center":s.get("text-justify").evaluate(x,{}),F="point"===s.get("symbol-placement")?s.get("text-max-width").evaluate(x,{})*Ou:0;if(!y&&M)for(var N="auto"===L?M.map((function(t){return ul(t)})):[L],j=!1,D=0;D<N.length;D++){var z=N[D];if(!A.horizontal[z])if(j)A.horizontal[z]=A.horizontal[0];else{var B=Ru(T,e,E,F,g,"center",z,O,P,Iu.horizontal);B&&(A.horizontal[z]=B,j=1===B.lineCount)}}else{"auto"===L&&(L=ul(I));var U=Ru(T,e,E,F,g,I,L,O,P,Iu.horizontal);U&&(A.horizontal[L]=U),dr(k)&&y&&m&&(A.vertical=Ru(T,e,E,F,g,I,L,O,P,Iu.vertical))}}var V=void 0;if(x.icon){var G=r[x.icon];G&&(V=Vu(i[x.icon],s.get("icon-offset").evaluate(x,{}),s.get("icon-anchor").evaluate(x,{})),void 0===t.sdfIcons?t.sdfIcons=G.sdf:t.sdfIcons!==G.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),G.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(Object.keys(A.horizontal).length||V)&&ll(t,x,A,V,S,l,P)}o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=Ar,t.polygonIntersectsPolygon=eo,t.postMapLoadEvent=et,t.postTurnstileEvent=$,t.potpack=Ps,t.properties=_s,t.rasterBoundsAttributes=xu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=ur,t.registerForPluginAvailability=function(t){return wr?t({pluginURL:wr,completionCallback:br}):Sr.once("pluginAvailable",t),t},t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+h*r,t[7]=u*i+p*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=h*i-s*r,t[11]=p*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+h*r,t[3]=u*i+p*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=h*i-s*r,t[7]=p*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setRTLTextPlugin=function(t,e){if(xr)throw new Error("setRTLTextPlugin cannot be called multiple times.");xr=!0,wr=M.resolveURL(t),br=function(t){t?(xr=!1,wr=null,e&&e(t)):Er=!0},Sr.fire(new dt("pluginAvailable",{pluginURL:wr,completionCallback:br}))},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.styleSpec=yt,t.symbolSize=cs,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=xo,t.translate=function(t,e,n){var r,i,o,a,s,u,l,c,h,p,f,d,v=n[0],g=n[1],y=n[2];return e===t?(t[12]=e[0]*v+e[4]*g+e[8]*y+e[12],t[13]=e[1]*v+e[5]*g+e[9]*y+e[13],t[14]=e[2]*v+e[6]*g+e[10]*y+e[14],t[15]=e[3]*v+e[7]*g+e[11]*y+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=r*v+s*g+h*y+e[12],t[13]=i*v+u*g+p*y+e[13],t[14]=o*v+l*g+f*y+e[14],t[15]=a*v+c*g+d*y+e[15]),t},t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=$n,t.validateStyle=Qn,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=Pa,t.version="0.54.1",t.warnOnce=w,t.webpSupported=L,t.window=self,t.wrap=c})),r(0,(function(t){function e(t){var n=typeof t;if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,o=t;i<o.length;i+=1)r+=e(o[i])+",";return r+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var r=function(t){t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter)}for(var l=0,c=r;l<c.length;l+=1){var h=c[l];delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t){for(var e={},r=0;r<t.length;r++){var i=n(t[r]),o=e[i];o||(o=e[i]=[]),o.push(t[r])}var a=[];for(var s in e)a.push(e[s]);return a}(t.values(this._layerConfigs));p<f.length;p+=1){var d=f[p].map((function(t){return i._layers[t.id]})),v=d[0];if("none"!==v.visibility){var g=v.source||"",y=this.familiesBySource[g];y||(y=this.familiesBySource[g]={});var m=v.sourceLayer||"_geojsonTileLayer",_=y[m];_||(_=y[m]=[]),_.push(d)}}};var i=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(r),h=c.w,p=c.h,f=new t.AlphaImage({width:h||1,height:p||1});for(var d in e){var v=e[d];for(var g in v){var y=v[+g];if(y&&0!==y.bitmap.width&&0!==y.bitmap.height){var m=n[d][g].rect;t.AlphaImage.copy(y.bitmap,f,{x:0,y:0},{x:m.x+1,y:m.y+1},y.bitmap)}}}this.image=f,this.positions=n};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function a(e,n){for(var r=new t.EvaluationParameters(n),i=0,o=e;i<o.length;i+=1)o[i].recalculate(r)}o.prototype.parse=function(e,n,r,o){var s=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var u=new t.DictionaryCoder(Object.keys(e.layers).sort()),l=new t.FeatureIndex(this.tileID);l.bucketLayerIDs=[];var c,h,p,f,d={},v={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{}},g=n.familiesBySource[this.source];for(var y in g){var m=e.layers[y];if(m){1===m.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var _=u.encode(y),b=[],x=0;x<m.length;x++){var w=m.feature(x);b.push({feature:w,index:x,sourceLayerIndex:_})}for(var E=0,S=g[y];E<S.length;E+=1){var A=S[E],T=A[0];T.minzoom&&this.zoom<Math.floor(T.minzoom)||T.maxzoom&&this.zoom>=T.maxzoom||"none"!==T.visibility&&(a(A,this.zoom),(d[T.id]=T.createBucket({index:l.bucketLayerIDs.length,layers:A,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_,sourceID:this.source})).populate(b,v),l.bucketLayerIDs.push(A.map((function(t){return t.id}))))}}}var P=t.mapObject(v.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(P).length?r.send("getGlyphs",{uid:this.uid,stacks:P},(function(t,e){c||(c=t,h=e,O.call(s))})):h={};var k=Object.keys(v.iconDependencies);k.length?r.send("getImages",{icons:k},(function(t,e){c||(c=t,p=e,O.call(s))})):p={};var C=Object.keys(v.patternDependencies);function O(){if(c)return o(c);if(h&&p&&f){var e=new i(h),n=new t.ImageAtlas(p,f);for(var r in d){var s=d[r];s instanceof t.SymbolBucket?(a(s.layers,this.zoom),t.performSymbolLayout(s,h,e.positions,p,n.iconPositions,this.showCollisionBoxes)):s.hasPattern&&(s instanceof t.LineBucket||s instanceof t.FillBucket||s instanceof t.FillExtrusionBucket)&&(a(s.layers,this.zoom),s.addFeatures(v,n.patternPositions))}this.status="done",o(null,{buckets:t.values(d).filter((function(t){return!t.isEmpty()})),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}C.length?r.send("getImages",{icons:C},(function(t,e){c||(c=t,f=e,O.call(s))})):f={},O.call(this)};var s="undefined"!=typeof performance,u={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,n){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,n)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},l=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},u.mark(this._marks.start)};function c(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}l.prototype.finish=function(){u.mark(this._marks.end);var t=u.getEntriesByName(this._marks.measure);return 0===t.length&&(u.measure(this._marks.measure,this._marks.start,this._marks.end),t=u.getEntriesByName(this._marks.measure),u.clearMarks(this._marks.start),u.clearMarks(this._marks.end),u.clearMeasures(this._marks.measure)),t},u.Performance=l;var h=function(t,e,n){this.actor=t,this.layerIndex=e,this.loadVectorData=n||c,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new u.Performance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,(function(e,o){if(delete r.loading[i],e||!o)return s.status="done",r.loaded[i]=s,n(e);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,r.layerIndex,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,l,c))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},h.prototype.reloadTile=function(t,e){var n=this.loaded,r=t.uid,i=this;if(n&&n[r]){var o=n[r];o.showCollisionBoxes=t.showCollisionBoxes;var a=function(t,n){var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,i.actor,r)),e(t,n)};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.actor,a):a())}},h.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},h.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var p=function(){this.loaded={}};p.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=new t.DEMData(r,o,i);this.loaded=this.loaded||{},this.loaded[r]=a,n(null,a)},p.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var f={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function d(t){var e=0;if(t&&t.length>0){e+=Math.abs(v(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(v(t[n]))}return e}function v(t){var e,n,r,i,o,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(r=u-2,i=u-1,o=0):a===u-1?(r=u-1,i=0,o=1):(r=a,i=a+1,o=a+2),e=t[r],n=t[i],s+=(g(t[o][0])-g(e[0]))*Math.sin(g(n[1]));s=s*f.RADIUS*f.RADIUS/2}return s}function g(t){return t*Math.PI/180}var y={geometry:function t(e){var n,r=0;switch(e.type){case"Polygon":return d(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=d(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},ring:v};function m(t,e){return function(n){return t(n,e)}}function _(t,e){e=!!e,t[0]=b(t[0],e);for(var n=1;n<t.length;n++)t[n]=b(t[n],!e);return t}function b(t,e){return function(t){return y.ring(t)>=0}(t)===e?t:t.reverse()}var x=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,w=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};w.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},w.prototype.toGeoJSON=function(t,e,n){return x.call(this,t,e,n)};var E=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};E.prototype.feature=function(t){return new w(this._features[t])};var S=t.vectorTile.VectorTileFeature,A=T;function T(t,e){this.options=e||{},this.features=t,this.length=t.length}function P(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}T.prototype.feature=function(t){return new P(this.features[t],this.options.extent)},P.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},P.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},P.prototype.toGeoJSON=S.prototype.toGeoJSON;var k=I,C=I,O=A;function I(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,M,t.layers[n])}(e,n),n.finish()}function M(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,R,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,D,o[n])}function R(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,L,t),e.writeVarintField(3,n.type),e.writeMessage(4,j,n)}function L(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in n.properties){var u=o[s];void 0===u&&(r.push(s),u=r.length-1,o[s]=u),e.writeVarint(u);var l=n.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=a[h];void 0===p&&(i.push(l),p=i.length-1,a[h]=p),e.writeVarint(p)}}function F(t,e){return(e<<3)+(7&t)}function N(t){return t<<1^t>>31}function j(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],l=1;1===r&&(l=u.length),e.writeVarint(F(1,l));for(var c=3===r?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==r&&e.writeVarint(F(2,c-1));var p=u[h].x-i,f=u[h].y-o;e.writeVarint(N(p)),e.writeVarint(N(f)),i+=p,o+=f}3===r&&e.writeVarint(F(7,1))}}function D(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function z(t,e,n,r){B(t,n,r),B(e,2*n,2*r),B(e,2*n+1,2*r+1)}function B(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function U(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}k.fromVectorTileJs=C,k.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new A(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return I({layers:n})},k.GeoJSONWrapper=O;var V=function(t){return t[0]},G=function(t){return t[1]},W=function(t,e,n,r,i){void 0===e&&(e=V),void 0===n&&(n=G),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*c/s+h)),Math.min(o,Math.floor(r+(s-u)*c/s+h)),a)}var p=n[2*r+a],f=i,d=o;for(z(e,n,i,r),n[2*o+a]>p&&z(e,n,i,o);f<d;){for(z(e,n,f,d),f++,d--;n[2*f+a]<p;)f++;for(;n[2*d+a]>p;)d--}n[2*i+a]===p?z(e,n,i,d):z(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};W.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var v=Math.floor((f+p)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[v]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(f),l.push(v-1),l.push(g)),(0===h?i>=s:o>=u)&&(l.push(v+1),l.push(p),l.push(g))}}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)},W.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)U(e[2*p],e[2*p+1],n,r)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],v=e[2*f+1];U(d,v,n,r)<=u&&s.push(t[f]);var g=(l+1)%2;(0===l?n-i<=d:r-i<=v)&&(a.push(h),a.push(f-1),a.push(g)),(0===l?n+i>=d:r+i>=v)&&(a.push(f+1),a.push(c),a.push(g))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var X={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},H=function(t){this.options=$(Object.create(X),t),this.trees=new Array(this.options.maxZoom+1)};function q(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function Z(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:J(r),y:Q(i),zoom:1/0,index:e,parentId:-1}}function K(t){return{type:"Feature",id:t.id,properties:Y(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function Y(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return $($({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function J(t){return t/360+.5}function Q(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function $(t,e){for(var n in e)t[n]=e[n];return t}function tt(t){return t.x}function et(t){return t.y}function nt(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function rt(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)it(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)it(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)it(t,e[r][i])}(i),i}function it(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function ot(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)at(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)at(i[l],s);else if("LineString"===o)st(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],st(i[l],s,a,!1),t.push(rt(u,"LineString",s,e.properties));return}ut(i,s,a,!1)}else if("Polygon"===o)ut(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)ot(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];ut(i[l],c,a,!0),s.push(c)}}t.push(rt(u,o,s,e.properties))}}function at(t,e){e.push(lt(t[0])),e.push(ct(t[1])),e.push(0)}function st(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=lt(t[s][0]),l=ct(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,l=e[n],c=e[n+1],h=e[r],p=e[r+1],f=n+3;f<r;f+=3){var d=nt(e[f],e[f+1],l,c,h,p);if(d>a)o=f,a=d;else if(d===a){var v=Math.abs(f-s);v<u&&(o=f,u=v)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,c,n),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function ut(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];st(t[i],o,n,r),e.push(o)}}function lt(t){return t/360+.5}function ct(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function ht(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=n&&d<r)u.push(c);else if(!(d<n||f>=r)){var v=[];if("Point"===p||"MultiPoint"===p)pt(h,v,n,r,i);else if("LineString"===p)ft(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===p)vt(h,v,n,r,i,!1);else if("Polygon"===p)vt(h,v,n,r,i,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];vt(h[g],y,n,r,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<v.length;g++)u.push(rt(c.id,p,v[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(rt(c.id,p,v,c.tags))}}}return u.length?u:null}function pt(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ft(t,e,n,r,i,o,a){for(var s,u,l=dt(t),c=0===i?yt:mt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],v=t[p+2],g=t[p+3],y=t[p+4],m=0===i?f:d,_=0===i?g:y,b=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-y,2))),m<n?_>n&&(u=c(l,f,d,g,y,n),a&&(l.start=h+s*u)):m>r?_<r&&(u=c(l,f,d,g,y,r),a&&(l.start=h+s*u)):gt(l,f,d,v),_<n&&m>=n&&(u=c(l,f,d,g,y,n),b=!0),_>r&&m<=r&&(u=c(l,f,d,g,y,r),b=!0),!o&&b&&(a&&(l.end=h+s*u),e.push(l),l=dt(t)),a&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],v=t[x+2],(m=0===i?f:d)>=n&&m<=r&&gt(l,f,d,v),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&gt(l,l[0],l[1],l[2]),l.length&&e.push(l)}function dt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function vt(t,e,n,r,i,o){for(var a=0;a<t.length;a++)ft(t[a],e,n,r,i,o,!1)}function gt(t,e,n,r){t.push(e),t.push(n),t.push(r)}function yt(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function mt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function _t(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=bt(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(bt(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(bt(o.geometry[s][l],e));i.push(u)}n.push(rt(o.id,a,i,o.tags))}return n}function bt(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function xt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push(wt(l[r],l[r+1],e,o,a,s));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(wt(l[r][i],l[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function wt(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function Et(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,St(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function St(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)At(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)At(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)At(a,l[s],t,n,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function At(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function Tt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)ot(n,t.features[r],e,r);else"Feature"===t.type?ot(n,t,e):ot(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=ht(t,1,-1-n,n,0,-1,2,e),o=ht(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=ht(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=_t(i,1).concat(r)),o&&(r=r.concat(_t(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pt(t,e,n){return 32*((1<<t)*n+e)+t}function kt(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new E(r.features),o=k(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}H.prototype.load=function(t){var e=this.options,n=e.log,r=e.minZoom,i=e.maxZoom,o=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(Z(t[u],u));this.trees[i+1]=new W(s,tt,et,o,Float32Array),n&&console.timeEnd(a);for(var l=i;l>=r;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new W(s,tt,et,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this},H.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(J(n),Q(o),J(i),Q(r));c<h.length;c+=1){var p=h[c],f=u.points[p];l.push(f.numPoints?K(f):this.points[f.index])}return l},H.prototype.getChildren=function(t){var e=t>>5,n=t%32,r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===t&&s.push(h.numPoints?K(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},H.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},H.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},H.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},H.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},H.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:u.numPoints?Y(u):this.points[u.index].properties},c=u.numPoints?u.id:this.points[u.index].id;void 0!==c&&(l.id=c),o.features.push(l)}},H.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},H.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=i/(o*Math.pow(2,e)),u=0;u<t.length;u++){var l=t[u];if(!(l.zoom<=e)){l.zoom=e;for(var c=this.trees[e+1],h=c.within(l.x,l.y,s),p=l.numPoints||1,f=l.x*p,d=l.y*p,v=a?this._map(l,!0):null,g=(u<<5)+(e+1),y=0,m=h;y<m.length;y+=1){var _=m[y],b=c.points[_];if(!(b.zoom<=e)){b.zoom=e;var x=b.numPoints||1;f+=b.x*x,d+=b.y*x,p+=x,b.parentId=g,a&&a(v,this._map(b))}}1===p?n.push(l):(l.parentId=g,n.push(q(f/p,d/p,g,p,v)))}}return n},H.prototype._map=function(t,e){if(t.numPoints)return e?$({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?$({},r):r},Tt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Pt(e,n,r),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=Et(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var v,g,y,m,_,b,x=.5*u.buffer/u.extent,w=.5-x,E=.5+x,S=1+x;v=g=y=m=null,_=ht(t,c,n-x,n+E,0,p.minX,p.maxX,u),b=ht(t,c,n+w,n+S,0,p.minX,p.maxX,u),t=null,_&&(v=ht(_,c,r-x,r+E,1,p.minY,p.maxY,u),g=ht(_,c,r+w,r+S,1,p.minY,p.maxY,u),_=null),b&&(y=ht(b,c,r-x,r+E,1,p.minY,p.maxY,u),m=ht(b,c,r+w,r+S,1,p.minY,p.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*n,2*r),s.push(g||[],e+1,2*n,2*r+1),s.push(y||[],e+1,2*n+1,2*r),s.push(m||[],e+1,2*n+1,2*r+1)}}},Tt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=Pt(t,e=(e%a+a)%a,n);if(this.tiles[s])return xt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var u,l=t,c=e,h=n;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[Pt(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?xt(this.tiles[s],i):null):null};var Ct=function(e){function n(t,n,r){e.call(this,t,n,kt),r&&(this.loadGeoJSON=r)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new u.Performance(r.request);this.loadGeoJSON(r,(function(o,a){if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data is not a valid GeoJSON object."));!function t(e,n){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(m(t,n)),e;case"GeometryCollection":return e.geometries=e.geometries.map(m(t,n)),e;case"Feature":return e.geometry=t(e.geometry,n),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=_(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(m(_,e))),t}(e,n);default:return e}}(a,!0);try{e._geoJSONIndex=r.cluster?new H(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),l=0,c=u;l<c.length;l+=1){var h=c[l],p=r[h],f=p[0],d=p[1],v=t.createExpression(d),g=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);i[h]=v.value,o[h]=g.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(a.features):function(t,e){return new Tt(t,e)}(a,r.geojsonVtOptions)}catch(o){return n(o)}e.loaded={};var s={};if(i){var u=i.finish();u&&(s.resourceTiming={},s.resourceTiming[r.source]=JSON.parse(JSON.stringify(u)))}n(null,s)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded,i=t.uid;return r&&r[i]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},n.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},n.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},n}(h),Ot=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:h,geojson:Ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return Ot.prototype.setReferrer=function(t,e){this.referrer=e},Ot.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},Ot.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},Ot.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},Ot.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},Ot.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},Ot.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},Ot.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},Ot.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},Ot.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},Ot.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},Ot.prototype.loadRTLTextPlugin=function(e,n,r){try{t.plugin.isLoaded()||(this.self.importScripts(n),r(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+n)))}catch(t){r(t.toString())}},Ot.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},Ot.prototype.getWorkerSource=function(t,e,n){var r=this;if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][n]){var i={send:function(e,n,i){r.actor.send(e,n,i,t)}};this.workerSources[t][e][n]=new this.workerSourceTypes[e](i,this.getLayerIndex(t))}return this.workerSources[t][e][n]},Ot.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new Ot(t.window)),Ot})),r(0,(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===n[t]&&(n[t]=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t)),n[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},r=t.window.document?t.window.document.documentElement.style:null;function i(t){if(!r)return null;for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&a&&(o=r[a],r[a]="none")},n.enableDrag=function(){r&&a&&(r[a]=o)};var s=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),"passive"in r&&u?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),"passive"in r&&u?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return n=n.touches?n.touches[0]:n,new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o="touchend"===n.type?n.changedTouches:n.touches,a=0;a<o.length;a++)i.push(new t.Point(o[a].clientX-r.left-e.clientLeft,o[a].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e],i=r.ids,o=r.callback;this._notify(i,o)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this.images[t]=e},n.prototype.updateImage=function(t,e){var n=this.images[t];e.version=n.version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.images[o]||(n=!1)}this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,a,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];h(i)&&this.updateImage(r,i)}}},n}(t.Evented),f=v,d=1e20;function v(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(y(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(y(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function y(t,e,n,r,i){n[0]=0,r[0]=-d,r[1]=+d;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+d}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}v.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?d:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?d:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var o=this.gridOuter[r]-this.gridInner[r];n[r]=Math.max(0,Math.min(255,Math.round(255-255*(o/this.radius+this.cutoff))))}return n};var m=function(t,e){this.requestTransform=t,this.localIdeographFontFamily=e,this.entries={}};m.prototype.setURL=function(t){this.url=t},m.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1){var u=s[a];i.push({stack:o,id:u})}t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{}});var a=o.glyphs[i];if(void 0===a)if(a=r._tinySDF(o,n,i))e(null,{stack:n,id:i,glyph:a});else{var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var u=o.requests[s];u||(u=o.requests[s]=[],m.loadGlyphRange(n,s,r.url,r.requestTransform,(function(t,e){if(e)for(var n in e)o.glyphs[+n]=e[+n];for(var r=0,i=u;r<i.length;r+=1)(0,i[r])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(r[s]||(r[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}n(null,r)}}))},m.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&(t.isChar["CJK Unified Ideographs"](r)||t.isChar["Hangul Syllables"](r))){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new m.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},m.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i(t.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},m.TinySDF=f;var _=function(){this.specification=t.styleSpec.light.position};_.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},_.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new _,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),x=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),w=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};w.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},w.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];for(var s=this.width/o,u=s/2,l=e.length%2==1,c=-r;c<=r;c++)for(var h=this.nextRow+r+c,p=this.width*h,f=l?-e[e.length-1]:0,d=e[0],v=1,g=0;g<this.width;g++){for(;d<g/s;)f=d,d+=e[v],l&&v===e.length-1&&(d+=e[0]),v++;var y=Math.abs(g-f*s),m=Math.abs(g-d*s),_=Math.min(y,m),b=v%2==1,x=void 0;if(n){var w=r?c/r*(u+1):0;if(b){var E=u-Math.abs(w);x=Math.sqrt(_*_+E*E)}else x=u-Math.sqrt(_*_+w*w)}else x=(b?1:-1)*_;this.data[3+4*(p+g)]=Math.max(0,Math.min(255,x+128))}var S={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,S},w.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var E=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=i[o],s=new e.Actor(a,r,this.id);s.name="Worker "+o,this.actors.push(s)}};function S(e,n,r){var i=function(n,i){if(n)return r(n);if(i){var o=t.pick(i,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);i.vector_layers&&(o.vectorLayers=i.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(t){return t.id}))),e.url&&(o.tiles=t.canonicalizeTileset(o,e.url)),r(null,o)}};return e.url?t.getJSON(n(t.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}E.prototype.broadcast=function(e,n,r){r=r||function(){},t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r)},E.prototype.send=function(t,e,n,r){return("number"!=typeof r||isNaN(r))&&(r=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[r].send(t,e,n),r},E.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},E.Actor=t.Actor;var A=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};A.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},A.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var T=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,t.extend(this,t.pick(r,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._transformRequest,(function(n,r){e._tileJSONRequest=null,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId()),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=t.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url),i={request:this.map._transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function o(t,r){return e.aborted?n(null):t&&404!==t.status?n(t):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",i,o.bind(this)):"loading"===e.state?e.reloadCallback=n:this.dispatcher.send("reloadTile",i,o.bind(this),e.workerID)},n.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=S(this._options,this.map._transformRequest,(function(n,r){e._tileJSONRequest=null,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new A(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId()),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=t.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),k=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=t.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._transformRequest(r,t.ResourceType.Tile),function(r,i){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(i){this.map._refreshExpiredTiles&&e.setExpiryData(i),delete i.cacheControl,delete i.expires;var o=t.browser.getImageData(i),a={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",a,function(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},n}(P),C=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=i,this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution);var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1},clusterProperties:r.clusterProperties},r.workerOptions)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e,this.workerID),this},n.prototype.getClusterChildren=function(t,e){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e,this.workerID),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r,this.workerID),this},n.prototype._updateWorkerData=function(e){var n=this,r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.workerID=this.dispatcher.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.dispatcher.send(n.type+".coalesce",{source:r.source},null,n.workerID),e(t))}),this.workerID)},n.prototype.loadTile=function(e,n){var r=this,i=void 0===e.workerID?"loadTile":"reloadTile",o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};e.workerID=this.dispatcher.send(i,o,(function(t,o){return e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}),this.workerID)},n.prototype.abortTile=function(t){t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},n.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),O=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(e,n){var r=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._transformRequest(this.url,t.ResourceType.Image),(function(i,o){i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=i-n,c=o-r,h=Math.max(l,c),p=Math.max(0,Math.floor(-Math.log(h)/Math.LN2)),f=Math.pow(2,p);return new t.CanonicalTileID(p,Math.floor((n+i)/2*f),Math.floor((r+o)/2*f))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),I=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this,n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1){var o=i[r];this.urls.push(this.map._transformRequest(o,t.ResourceType.Source).url)}t.getVideo(this.urls,(function(n,r){n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(O),M=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(O),R={vector:T,raster:P,"raster-dem":k,geojson:C,video:I,image:O,canvas:M},L=function(e,n,r,i){var o=new R[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function F(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function N(t,e,n,r,i){var o=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(r&&r.layers,e,t.id),a=i.maxPitchScaleFactor(),s=t.tilesIn(n,a,o);s.sort(j);for(var u=[],l=0,c=s;l<c.length;l+=1){var h=c[l];u.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,r,i,a,F(t.transform,h.tileID))})}var p=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];h[v.featureIndex]||(h[v.featureIndex]=!0,p.push(v))}}return e}(u);for(var f in p)p[f].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return p}function j(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var D=function(t,e){this.max=t,this.onRemove=e,this.reset()};D.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},D.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},D.prototype.has=function(t){return t.wrapped().key in this.data},D.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},D.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},D.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},D.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},D.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var z=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};z.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},z.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},z.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var B={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=this.attributes[n],i=e.attributes[r.name];void 0!==i&&t.enableVertexAttribArray(i)}},U.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[B[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},U.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var G=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),rt=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(V),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),gt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),bt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e}(V),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),Et=function(t,e,n){this.context=t,this.width=e,this.height=n;var r=t.gl,i=this.framebuffer=r.createFramebuffer();this.colorAttachment=new xt(t,i),this.depthAttachment=new wt(t,i)};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n),t.deleteFramebuffer(this.framebuffer)};var St=function(t,e,n){this.func=t,this.mask=e,this.range=n};St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);var At=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};At.disabled=new At({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Pt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};Pt.disabled=new Pt(!1,1029,2305),Pt.backCCW=new Pt(!0,1029,2305);var kt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new W(this),this.clearStencil=new X(this),this.colorMask=new H(this),this.depthMask=new q(this),this.stencilMask=new Z(this),this.stencilFunc=new K(this),this.stencilOp=new Y(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new $(this),this.depthFunc=new tt(this),this.blend=new et(this),this.blendFunc=new nt(this),this.blendColor=new rt(this),this.blendEquation=new it(this),this.cullFace=new ot(this),this.cullFaceSide=new at(this),this.frontFace=new st(this),this.program=new ut(this),this.activeTexture=new lt(this),this.viewport=new ct(this),this.bindFramebuffer=new ht(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new dt(this),this.bindElementBuffer=new vt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new gt(this),this.pixelStoreUnpack=new yt(this),this.pixelStoreUnpackPremultiplyAlpha=new mt(this),this.pixelStoreUnpackFlipY=new _t(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};kt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},kt.prototype.createIndexBuffer=function(t,e){return new z(this,t,e)},kt.prototype.createVertexBuffer=function(t,e,n){return new U(this,t,e,n)},kt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},kt.prototype.createFramebuffer=function(t,e){return new Et(this,t,e)},kt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},kt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},kt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},kt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},kt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},kt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ct=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=L(n,r,i,this),this._tiles={},this._cache=new D(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(Ot)},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(+i,e)&&r.push(+i);return e?r.sort((function(e,r){var i=n._tiles[e].tileID,o=n._tiles[r].tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})):r.sort(Ot)},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){for(var n=t.overscaledZ-1;n>=e;n--){var r=t.scaledTo(n);if(!r)return;var i=String(r.key),o=this._tiles[i];if(o&&o.hasData())return o;if(this._cache.has(r))return this._cache.get(r)}},n.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),n=Math.floor(5*e),r="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(r)},n.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,n=Math.round(e);if(this._prevLng=t,n){var r={};for(var i in this._tiles){var o=this._tiles[i];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+n),r[o.tileID.key]=o}for(var a in this._tiles=r,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var s in this._tiles){var u=this._tiles[s];this._setTileReloadTimer(s,u)}}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(It(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var g=this.findLoadedParent(d,a);g&&(this._addTile(g.tileID),l[g.tileID.key]=g.tileID),c[f]=d}}for(var y in this._retainLoadedChildren(c,o,s,u),l)u[y]||(this._coveredTiles[y]=!0,u[y]=l[y])}for(var m in u)this._tiles[m].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,u);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);r[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,r);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var g=d.children(this._source.maxzoom)[0],y=this.getTile(g);if(y&&y.hasData()){r[g.key]=g;continue}}else{var m=d.children(this._source.maxzoom);if(r[m[0].key]&&r[m[1].key]&&r[m[2].key]&&r[m[3].key])continue}for(var _=v.wasRequested(),b=d.overscaledZ-1;b>=o;--b){var x=d.scaledTo(b);if(i[x.key])break;if(i[x.key]=!0,!(v=this.getTile(x))&&_&&(v=this._addTile(x)),v&&(r[x.key]=x,_=v.wasRequested(),v.hasData()))break}}}return r},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),l=s.map((function(t){return a.pointCoordinate(t)})),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,v=0,g=l;v<g.length;v+=1){var y=g[v];h=Math.min(h,y.x),p=Math.min(p,y.y),f=Math.max(f,y.x),d=Math.max(d,y.y)}for(var m=function(e){var r=i._tiles[c[e]];if(!r.holdingForFade()){var s=r.tileID,v=Math.pow(2,a.zoom-r.tileID.overscaledZ),g=n*r.queryPadding*t.EXTENT/r.tileSize/v,y=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(y[0].x-g<t.EXTENT&&y[0].y-g<t.EXTENT&&y[1].x+g>=0&&y[1].y+g>=0){var m=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:m,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)m(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(It(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.updateState(t,e,n)},n.prototype.removeFeatureState=function(t,e,n){t=t||"_geojsonTileLayer",this._state.removeFeatureState(t,e,n)},n.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},n}(t.Evented);function Ot(t,e){return t%32-e%32||e-t}function It(t){return"raster"===t||"image"===t||"video"===t}function Mt(){return new t.window.Worker($r.workerUrl)}Ct.maxOverzooming=10,Ct.maxUnderzooming=3;var Rt=function(){this.active={}};Rt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Rt.workerCount;)this.workers.push(new Mt);return this.active[t]=!0,this.workers.slice()},Rt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)};var Lt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function Nt(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function jt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Nt(t[r],e[t[r].ref]));return t}Rt.workerCount=Math.max(Math.min(Ft,6),1);var Dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zt(t,e,n){n.push({command:Dt.addSource,args:[t,e[t]]})}function Bt(t,e,n){e.push({command:Dt.removeSource,args:[t]}),n[t]=!0}function Ut(t,e,n,r){Bt(t,n,r),zt(t,e,n)}function Vt(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function Gt(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function Wt(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Ht=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};Ht.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ht.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Ht.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Ht.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Ht.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Ht.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}var p={hitTest:i,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,n,r,this._queryCell,a,p,o),i?a.length>0:a},Ht.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var l=[],c={hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}};return this._forEachCell(o,s,a,u,this._queryCellCircle,l,c,i),r?l.length>0:l},Ht.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Ht.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Ht.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Ht.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&n>=c[d+0]&&r>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[i];if(null!==v)for(var g=this.circles,y=0,m=v;y<m.length;y+=1){var _=m[y];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(g[b],g[b+1],g[b+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var x=g[b],w=g[b+1],E=g[b+2];o.push({key:this.circleKeys[_],x1:x-E,y1:w-E,x2:x+E,y2:w+E})}}}},Ht.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var g=this.circleCells[i];if(null!==g)for(var y=this.circles,m=0,_=g;m<_.length;m+=1){var b=_[m];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(y[x],y[x+1],y[x+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}},Ht.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.xCellCount*f+p;if(i.call(this,t,e,n,r,d,o,a,s))return}},Ht.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Ht.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Ht.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Ht.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+n)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=n*n};var qt=t.properties.layout;function Zt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Kt(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function Yt(e,n){var r=[e.x,e.y,0,1];ae(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function Jt(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function Qt(e,n,r,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,r.transform.zoom,qt.properties[i?"text-size":"icon-size"]),h=[256/r.width*2+1,256/r.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height,g=!1,y=0;y<d.length;y++){var m=d.get(y);if(m.hidden||m.writingMode===t.WritingMode.vertical&&!g)oe(m.numGlyphs,p);else{g=!1;var _=[m.anchorX,m.anchorY,0,1];if(t.transformMat4(_,_,n),Jt(_,h)){var b=.5+_[3]/r.transform.cameraToCenterDistance*.5,x=t.evaluateSizeForFeature(l,c,m),w=s?x*b:x/b,E=new t.Point(m.anchorX,m.anchorY),S=Yt(E,o).point,A={},T=ee(m,w,!1,u,n,o,a,e.glyphOffsetArray,f,p,S,E,A,v);g=T.useVertical,(T.notEnoughRoom||g||T.needsFlipping&&ee(m,w,!0,u,n,o,a,e.glyphOffsetArray,f,p,S,E,A,v).notEnoughRoom)&&oe(m.numGlyphs,p)}else oe(m.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function $t(t,e,n,r,i,o,a,s,u,l,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,v=e.getoffsetX(s.glyphStartIndex),g=e.getoffsetX(p-1),y=re(t*v,n,r,i,o,a,s.segment,f,d,u,l,c,h);if(!y)return null;var m=re(t*g,n,r,i,o,a,s.segment,f,d,u,l,c,h);return m?{first:y,last:m}:null}function te(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function ee(e,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,g=n/24,y=e.lineOffsetX*g,m=e.lineOffsetY*g;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=$t(g,u,y,m,r,h,p,e,l,a,f,!1);if(!w)return{notEnoughRoom:!0};var E=Yt(w.first.point,s).point,S=Yt(w.last.point,s).point;if(i&&!r){var A=te(e.writingMode,E,S,d);if(A)return A}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(re(g*u.getoffsetX(T),y,m,r,h,p,e.segment,b,x,l,a,f,!1));v.push(w.last)}else{if(i&&!r){var P=Yt(p,o).point,k=e.lineStartIndex+e.segment+1,C=new t.Point(l.getx(k),l.gety(k)),O=Yt(C,o),I=O.signedDistanceFromCamera>0?O.point:ne(p,C,P,1,o),M=te(e.writingMode,P,I,d);if(M)return M}var R=re(g*u.getoffsetX(e.glyphStartIndex),y,m,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,f,!1);if(!R)return{notEnoughRoom:!0};v=[R]}for(var L=0,F=v;L<F.length;L+=1){var N=F[L];t.addDynamicAttributes(c,N.point,N.angle)}return{}}function ne(t,e,n,r,i){var o=Yt(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function re(e,n,r,i,o,a,s,u,l,c,h,p,f){var d=i?e-n:e+n,v=d>0?1:-1,g=0;i&&(v*=-1,g=Math.PI),v<0&&(g+=Math.PI);for(var y=v>0?u+s:u+s+1,m=y,_=o,b=o,x=0,w=0,E=Math.abs(d);x+w<=E;){if((y+=v)<u||y>=l)return null;if(b=_,void 0===(_=p[y])){var S=new t.Point(c.getx(y),c.gety(y)),A=Yt(S,h);if(A.signedDistanceFromCamera>0)_=p[y]=A.point;else{var T=y-v;_=ne(0===x?a:new t.Point(c.getx(T),c.gety(T)),S,b,E-x+1,h)}}x+=w,w=b.dist(_)}var P=(E-x)/w,k=_.sub(b),C=k.mult(P)._add(b);return C._add(k._unit()._perp()._mult(r*v)),{point:C,angle:g+Math.atan2(_.y-b.y,_.x-b.x),tileDistance:f?{prevTileDistance:y-v===m?0:c.gettileUnitDistanceFromAnchor(y-v),lastSegmentViewportDistance:E-x}:null}}var ie=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oe(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(ie,3*r)}}function ae(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var se=function(t,e,n){void 0===e&&(e=new Ht(t.width+200,t.height+200,25)),void 0===n&&(n=new Ht(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function ue(t,e,n){t[e+4]=n?1:0}function le(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}se.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},se.prototype.approximateTileDistance=function(t,e,n,r,i){var o=i?1:r/this.pitchfactor,a=t.lastSegmentViewportDistance*n;return t.prevTileDistance+a+(o-1)*a*Math.abs(Math.sin(e))},se.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,l,c,h,p,f){var d=[],v=this.projectAnchor(l,o.anchorX,o.anchorY),g=u/24,y=o.lineOffsetX*u,m=o.lineOffsetY*u,_=new t.Point(o.anchorX,o.anchorY),b=$t(g,s,y,m,!1,Yt(_,c).point,_,o,a,c,{},!0),x=!1,w=!1,E=!0,S=v.perspectiveRatio*i,A=1/(i*r),T=0,P=0;b&&(T=this.approximateTileDistance(b.first.tileDistance,b.first.angle,A,v.cameraDistance,p),P=this.approximateTileDistance(b.last.tileDistance,b.last.angle,A,v.cameraDistance,p));for(var k=0;k<e.length;k+=5){var C=e[k],O=e[k+1],I=e[k+2],M=e[k+3];if(!b||M<-T||M>P)ue(e,k,!1);else{var R=this.projectPoint(l,C,O),L=I*S;if(d.length>0){var F=R.x-d[d.length-4],N=R.y-d[d.length-3];if(L*L*2>F*F+N*N&&k+8<e.length){var j=e[k+8];if(j>-T&&j<P){ue(e,k,!1);continue}}}var D=k/5;d.push(R.x,R.y,L,D),ue(e,k,!0);var z=R.x-L,B=R.y-L,U=R.x+L,V=R.y+L;if(E=E&&this.isOffscreen(z,B,U,V),w=w||this.isInsideGrid(z,B,U,V),!n&&this.grid.hitTestCircle(R.x,R.y,L,f)){if(!h)return{circles:[],offscreen:!1};x=!0}}}return{circles:x||!w?[]:d,offscreen:E}},se.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),n.push(c)}for(var h={},p={},f=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));f<d.length;f+=1){var v=d[f],g=v.key;if(void 0===h[g.bucketInstanceId]&&(h[g.bucketInstanceId]={}),!h[g.bucketInstanceId][g.featureIndex]){var y=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(n,y)&&(h[g.bucketInstanceId][g.featureIndex]=!0,void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]=[]),p[g.bucketInstanceId].push(g.featureIndex))}}return p},se.prototype.insertCollisionBox=function(t,e,n,r,i){var o={bucketInstanceId:n,featureIndex:r,collisionGroupID:i};(e?this.ignoredGrid:this.grid).insert(o,t[0],t[1],t[2],t[3])},se.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},se.prototype.projectAnchor=function(t,e,n){var r=[e,n,0,1];return ae(r,r,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/r[3]*.5,cameraDistance:r[3]}},se.prototype.projectPoint=function(e,n,r){var i=[n,r,0,1];return ae(i,i,e),new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100)},se.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return ae(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},se.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},se.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary};var ce=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var he=function(t,e,n,r,i){this.text=new ce(t?t.text:null,e,n,i),this.icon=new ce(t?t.icon:null,e,r,i)};he.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var pe=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},fe=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},de=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function ve(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,l=t.evaluateRadialOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}de.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var ge=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new de(n),this.prevPlacement=r,r&&(r.prevPlacement=void 0)};function ye(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}ge.prototype.placeLayerTile=function(e,n,r,i){var o=n.getBucket(e),a=n.latestFeatureIndex;if(o&&a&&e.id===o.layerIds[0]){var s=n.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),p=Zt(h,"map"===u.get("text-pitch-alignment"),"map"===u.get("text-rotation-alignment"),this.transform,le(n,1,this.transform.zoom)),f=Zt(h,"map"===u.get("icon-pitch-alignment"),"map"===u.get("icon-rotation-alignment"),this.transform,le(n,1,this.transform.zoom));this.retainedQueryData[o.bucketInstanceId]=new fe(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,n.tileID),this.placeLayerBucket(o,h,p,f,l,c,r,n.holdingForFade(),i,s)}},ge.prototype.attemptAnchorPlacement=function(e,n,r,i,o,a,s,u,l,c,h,p,f,d){var v,g=ve(e,r,i,o,a),y=this.collisionIndex.placeCollisionBox(function(e,n,r,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(n,r);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}(n,g.x,g.y,s,u,this.transform.angle),p,l,c,h.predicate);if(y.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID].text&&(v=this.prevPlacement.variableOffsets[f.crossTileID].anchor),this.variableOffsets[f.crossTileID]={radialOffset:o,width:r,height:i,anchor:e,textBoxScale:a,prevAnchor:v},this.markUsedJustification(d,e,f),y},ge.prototype.placeLayerBucket=function(e,n,r,i,o,a,s,u,l,c){var h=e.layers[0].layout,p=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,t.properties.layout.properties["text-size"]),f=h.get("text-optional"),d=h.get("icon-optional"),v=h.get("text-allow-overlap"),g=h.get("icon-allow-overlap"),y=v&&(g||!e.hasIconData()||d),m=g&&(v||!e.hasTextData()||f),_=this.collisionGroups.get(e.sourceID),b="map"===h.get("text-rotation-alignment"),x="map"===h.get("text-pitch-alignment");!e.collisionArrays&&c&&e.deserializeCollisionBoxes(c);for(var w=0;w<e.symbolInstances.length;w++){var E=e.symbolInstances.get(w);if(!l[E.crossTileID]){if(u){this.placements[E.crossTileID]=new pe(!1,!1,!1);continue}var S=!1,A=!1,T=!0,P=null,k=null,C=null,O=0,I=0,M=e.collisionArrays[w];M.textFeatureIndex&&(O=M.textFeatureIndex);var R=M.textBox;if(R)if(h.get("text-variable-anchor")){var L=R.x2-R.x1,F=R.y2-R.y1,N=E.textBoxScale,j=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[E.crossTileID]){var D=this.prevPlacement.variableOffsets[E.crossTileID];j[0]!==D.anchor&&(j=j.filter((function(t){return t!==D.anchor}))).unshift(D.anchor)}for(var z=0,B=j;z<B.length;z+=1){var U=B[z];if(P=this.attemptAnchorPlacement(U,R,L,F,E.radialTextOffset,N,b,x,a,n,_,v,E,e)){S=!0;break}}if(!this.variableOffsets[E.crossTileID]&&this.prevPlacement){var V=this.prevPlacement.variableOffsets[E.crossTileID];V&&(this.variableOffsets[E.crossTileID]=V,this.markUsedJustification(e,V.anchor,E))}}else S=(P=this.collisionIndex.placeCollisionBox(R,h.get("text-allow-overlap"),a,n,_.predicate)).box.length>0;T=P&&P.offscreen;var G=M.textCircles;if(G){var W=e.text.placedSymbolArray.get(E.centerJustifiedTextSymbolIndex),X=t.evaluateSizeForFeature(e.textSizeData,p,W);k=this.collisionIndex.placeCollisionCircles(G,h.get("text-allow-overlap"),o,a,W,e.lineVertexArray,e.glyphOffsetArray,X,n,r,s,x,_.predicate),S=h.get("text-allow-overlap")||k.circles.length>0,T=T&&k.offscreen}M.iconFeatureIndex&&(I=M.iconFeatureIndex),M.iconBox&&(A=(C=this.collisionIndex.placeCollisionBox(M.iconBox,h.get("icon-allow-overlap"),a,n,_.predicate)).box.length>0,T=T&&C.offscreen);var H=f||0===E.numHorizontalGlyphVertices&&0===E.numVerticalGlyphVertices,q=d||0===E.numIconVertices;H||q?q?H||(A=A&&S):S=A&&S:A=S=A&&S,S&&P&&this.collisionIndex.insertCollisionBox(P.box,h.get("text-ignore-placement"),e.bucketInstanceId,O,_.ID),A&&C&&this.collisionIndex.insertCollisionBox(C.box,h.get("icon-ignore-placement"),e.bucketInstanceId,I,_.ID),S&&k&&this.collisionIndex.insertCollisionCircles(k.circles,h.get("text-ignore-placement"),e.bucketInstanceId,O,_.ID),this.placements[E.crossTileID]=new pe(S||y,A||m,T||e.justReloaded),l[E.crossTileID]=!0}}e.justReloaded=!1},ge.prototype.markUsedJustification=function(e,n,r){var i={left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex},o=i[t.getAnchorJustification(n)];for(var a in i){var s=i[a];s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=o>=0&&s!==o?0:r.crossTileID)}},ge.prototype.commit=function(t){this.commitTime=t;var e=this.prevPlacement,n=!1,r=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,i=e?e.opacities:{},o=e?e.variableOffsets:{};for(var a in this.placements){var s=this.placements[a],u=i[a];u?(this.opacities[a]=new he(u,r,s.text,s.icon),n=n||s.text!==u.text.placed||s.icon!==u.icon.placed):(this.opacities[a]=new he(null,r,s.text,s.icon,s.skipFade),n=n||s.text||s.icon)}for(var l in i){var c=i[l];if(!this.opacities[l]){var h=new he(c,r,!1,!1);h.isHidden()||(this.opacities[l]=h,n=n||c.text.placed||c.icon.placed)}}for(var p in o)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=o[p]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},ge.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},ge.prototype.updateBucketOpacities=function(e,n,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();var i=e.layers[0].layout,o=new he(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),s=i.get("icon-allow-overlap"),u=i.get("text-variable-anchor"),l="map"===i.get("text-rotation-alignment"),c="map"===i.get("text-pitch-alignment"),h=new he(null,0,a&&(s||!e.hasIconData()||i.get("icon-optional")),s&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasCollisionBoxData()||e.hasCollisionCircleData())&&e.deserializeCollisionBoxes(r);for(var p=0;p<e.symbolInstances.length;p++){var f=e.symbolInstances.get(p),d=f.numHorizontalGlyphVertices,v=f.numVerticalGlyphVertices,g=f.crossTileID,y=n[g],m=this.opacities[g];y?m=o:m||(m=h,this.opacities[g]=m),n[g]=!0;var _=d>0||v>0,b=f.numIconVertices>0;if(_){for(var x=Ae(m.text),w=(d+v)/4,E=0;E<w;E++)e.text.opacityVertexArray.emplaceBack(x);var S=m.text.isHidden()?1:0;[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=S)}));var A=this.variableOffsets[f.crossTileID];A&&this.markUsedJustification(e,A.anchor,f)}if(b){for(var T=Ae(m.icon),P=0;P<f.numIconVertices/4;P++)e.icon.opacityVertexArray.emplaceBack(T);e.icon.placedSymbolArray.get(p).hidden=m.icon.isHidden()}if(e.hasCollisionBoxData()||e.hasCollisionCircleData()){var k=e.collisionArrays[p];if(k){if(k.textBox){var C=new t.Point(0,0),O=!0;if(u){var I=this.variableOffsets[g];I?(C=ve(I.anchor,I.width,I.height,I.radialOffset,I.textBoxScale),l&&C._rotate(c?this.transform.angle:-this.transform.angle)):O=!1}ye(e.collisionBox.collisionVertexArray,m.text.placed,!O,C.x,C.y)}k.iconBox&&ye(e.collisionBox.collisionVertexArray,m.icon.placed,!1);var M=k.textCircles;if(M&&e.hasCollisionCircleData())for(var R=0;R<M.length;R+=5){var L=y||0===M[R+4];ye(e.collisionCircle.collisionVertexArray,m.text.placed,L)}}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray)},ge.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},ge.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},ge.prototype.stillRecent=function(t){return this.commitTime+this.fadeDuration>t},ge.prototype.setStale=function(){this.stale=!0};var me=Math.pow(2,25),_e=Math.pow(2,24),be=Math.pow(2,17),xe=Math.pow(2,16),we=Math.pow(2,9),Ee=Math.pow(2,8),Se=Math.pow(2,1);function Ae(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*me+e*_e+n*be+e*xe+n*we+e*Ee+n*Se+e}var Te=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Te.prototype.continuePlacement=function(t,e,n,r,i){for(;this._currentTileIndex<t.length;){var o=t[this._currentTileIndex];if(e.placeLayerTile(r,o,n,this._seenCrossTileIDs),this._currentTileIndex++,i())return!0}};var Pe=function(t,e,n,r,i,o,a){this.placement=new ge(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Pe.prototype.isDone=function(){return this._done},Pe.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Te),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Pe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var ke=512/t.EXTENT/2,Ce=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Ce.prototype.getScaledCoordinates=function(e,n){var r=n.canonical.z-this.tileID.canonical.z,i=ke/Math.pow(2,r);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*i),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*i)}},Ce.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=r&&Math.abs(c.coord.y-s.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Oe=function(){this.maxCrossTileID=0};Oe.prototype.generate=function(){return++this.maxCrossTileID};var Ie=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ie.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},Ie.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ce(t,e.symbolInstances,e.bucketInstanceId),!0},Ie.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1){var o=i[r];delete this.usedCrossTileIDs[t][o.crossTileID]}},Ie.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var Me=function(){this.layerIndexes={},this.crossTileIDs=new Oe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Me.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Ie);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},Me.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Re=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},Le=t.pick(Dt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fe=t.pick(Dt,["setCenter","setZoom","setBearing","setPitch"]),Ne=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new E((Lt||(Lt=new Rt),Lt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new m(r._transformRequest,i.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Me,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginAvailability((function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),a.sourceCaches)a.sourceCaches[e].reload()})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=t.normalizeStyleURL(e,n.accessToken);var o=this.map._transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype._load=function(e,n){var r=this;if(!n||!Re(this,t.validateStyle(e))){for(var i in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(i,e.sources[i],{validate:!1});e.sprite?this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n(t.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,c())})),l=t.getImage(n(t.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,a||(a=t,o=e,c())}));function c(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,v=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:l,height:c}),n[s]={data:v,pixelRatio:d,sdf:f}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e.sprite,this.map._transformRequest,(function(e,n){if(r._spriteRequest=null,e)r.fire(new t.ErrorEvent(e));else if(n)for(var i in n)r.imageManager.addImage(i,n[i]);r.imageManager.setLoaded(!0),r.fire(new t.Event("data",{dataType:"style"}))})):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var o=jt(this.stylesheet.layers);this._order=o.map((function(t){return t.id})),this._layers={};for(var a=0,s=o;a<s.length;a+=1){var u=s[a];(u=t.createStyleLayer(u)).setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n],o=this._layers[i];"custom"!==o.type&&e.push(o.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var u in this.sourceCaches)this.sourceCaches[u].used=!1;for(var l=0,c=this._order;l<c.length;l+=1){var h=c[l],p=this._layers[h];p.recalculate(e),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Re(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var r=function(e,n){if(!e)return[{command:Dt.setStyle,args:[n]}];var r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Dt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:Dt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:Dt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:Dt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:Dt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:Dt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:Dt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:Dt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:Dt.setLight,args:[n.light]});var i={},o=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Bt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Vt(e,n,o)?r.push({command:Dt.setGeoJSONSourceData,args:[o,n[o].data]}):Ut(o,n,r,i)):zt(o,n,r))}(e.sources,n.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?r.push({command:Dt.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,n,r){n=n||[];var i,o,a,s,u,l,c,h=(e=e||[]).map(Wt),p=n.map(Wt),f=e.reduce(Xt,{}),d=n.reduce(Xt,{}),v=h.slice(),g=Object.create(null);for(i=0,o=0;i<h.length;i++)a=h[i],d.hasOwnProperty(a)?o++:(r.push({command:Dt.removeLayer,args:[a]}),v.splice(v.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)a=p[p.length-1-i],v[v.length-1-i]!==a&&(f.hasOwnProperty(a)?(r.push({command:Dt.removeLayer,args:[a]}),v.splice(v.lastIndexOf(a,v.length-o),1)):o++,l=v[v.length-i],r.push({command:Dt.addLayer,args:[d[a],l]}),v.splice(v.length-i,0,a),g[a]=!0);for(i=0;i<p.length;i++)if(s=f[a=p[i]],u=d[a],!g[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Gt(s.layout,u.layout,r,a,null,Dt.setLayoutProperty),Gt(s.paint,u.paint,r,a,null,Dt.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:Dt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:Dt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],r,a,c.slice(6),Dt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Dt.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],r,a,c.slice(6),Dt.setPaintProperty):t.deepEqual(s[c],u[c])||r.push({command:Dt.setLayerProperty,args:[a,c,u[c]]}))}else r.push({command:Dt.removeLayer,args:[a]}),l=v[v.lastIndexOf(a)+1],r.push({command:Dt.addLayer,args:[u,l]})}(a,n.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:Dt.setStyle,args:[n]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in Fe)}));if(0===r.length)return!1;var i=r.filter((function(t){return!(t.command in Le)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Ct(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Re(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}var a=n?this._order.indexOf(n):this._order.length;if(n&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r],a=parseInt(e.id,10);if(void 0!==o){var s=o.getSource().type;"geojson"===s&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||i?isNaN(a)||a<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):o.setFeatureState(i,a,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==o||a?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):i.removeFeatureState(a,s,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n],o=parseInt(e.id,10);if(void 0!==i)if("vector"!==i.getSource().type||r){if(!(isNaN(o)||o<0))return i.getFeatureState(r,o);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1){var p=h[c];i.push(p)}}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var f=[],d=this._order.length-1;d>=0;d--){var v=this._order[d];if(n(v))for(var g=i.length-1;g>=0;g--){var y=i[g].feature;if(r[y.layer.id]<d)break;f.push(y),i.pop()}else for(var m=0,_=t;m<_.length;m+=1){var b=_[m][v];if(b)for(var x=0,w=b;x<w.length;x+=1){var E=w[x];f.push(E.feature)}}}return f},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in this.sourceCaches)n.layers&&!i[c]||l.push(N(this.sourceCaches[c],this._layers,e,n,r));return this.placement&&l.push(function(t,e,n,r,i,o){for(var a={},s=i.queryRenderedSymbols(n),u=[],l=0,c=Object.keys(s).map(Number);l<c.length;l+=1){var h=c[l];u.push(o[h])}u.sort(j);for(var p=function(){var e=d[f],n=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,r.filter,r.layers,t);for(var i in n){var o=a[i]=a[i]||[],u=n[i];u.sort((function(t,n){var r=e.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(n.featureIndex)-i}return n.featureIndex-t.featureIndex}));for(var l=0,c=u;l<c.length;l+=1){var h=c[l];o.push(h)}}},f=0,d=u;f<d.length;f+=1)p();var v=function(n){a[n].forEach((function(r){var i=r.feature,o=t[n],a=e[o.source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}))};for(var g in a)v(g);return a}(this._layers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Re(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i){for(var o=!1,a=!1,s={},u=0,l=this._order;u<l.length;u+=1){var c=l[u],h=this._layers[c];if("symbol"===h.type){if(!s[h.source]){var p=this.sourceCaches[h.source];s[h.source]=p.getRenderableIds(!0).map((function(t){return p.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var f=this.crossTileSymbolIndex.addLayer(h,s[h.source],e.center.lng);o=o||f}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var d=this._layerOrderChanged||0===r;if((d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now()))&&(this.pauseablePlacement=new Pe(e,this._order,d,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(var v=0,g=this._order;v<g.length;v+=1){var y=g[v],m=this._layers[y];"symbol"===m.type&&this.placement.updateLayerOpacities(m,s[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ne.getSourceType=function(t){return R[t]},Ne.setSourceType=function(t,e){R[t]=e},Ne.registerForPluginAvailability=t.registerForPluginAvailability;var je=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),De=cn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),ze=cn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Be=cn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ue=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ve=cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ge=cn("#pragma mapbox: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),We=cn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xe=cn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),He=cn("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),qe=cn("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ze=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=cn("#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_pos;void main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ye=cn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Je=cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Qe=cn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),$e=cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),tn=cn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;return (data.r+data.g*256.0+data.b*256.0*256.0)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),en=cn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nn=cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),rn=cn("#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),on=cn("uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_gl_units_to_pixels;uniform mediump float u_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),an=cn("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),sn=cn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),un=cn("uniform sampler2D u_texture;\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;\n#pragma mapbox: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),ln=cn("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}");function cn(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r={};return{fragmentSource:t=t.replace(n,(function(t,e,n,i,o){return r[o]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+n+" "+i+" "+o+";\n#else\nuniform "+n+" "+i+" u_"+o+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+n+" "+i+" "+o+" = u_"+o+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,i,o){var a="float"===i?"vec2":"vec4",s=o.match(/color/)?"color":a;return r[o]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\nvarying "+n+" "+i+" "+o+";\n#else\nuniform "+n+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = a_"+o+";\n#else\n    "+n+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+s+"(a_"+o+", a_"+o+"_t);\n#else\n    "+n+" "+i+" "+o+" = u_"+o+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float a_"+o+"_t;\nattribute "+n+" "+a+" a_"+o+";\n#else\nuniform "+n+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+n+" "+i+" "+o+" = a_"+o+";\n#else\n    "+n+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+n+" "+i+" "+o+" = unpack_mix_"+s+"(a_"+o+", a_"+o+"_t);\n#else\n    "+n+" "+i+" "+o+" = u_"+o+";\n#endif\n"}))}}var hn=Object.freeze({prelude:De,background:ze,backgroundPattern:Be,circle:Ue,clippingMask:Ve,heatmap:Ge,heatmapTexture:We,collisionBox:Xe,collisionCircle:He,debug:qe,fill:Ze,fillOutline:Ke,fillOutlinePattern:Ye,fillPattern:Je,fillExtrusion:Qe,fillExtrusionPattern:$e,hillshadePrepare:tn,hillshade:en,line:nn,lineGradient:rn,linePattern:on,lineSDF:an,raster:sn,symbolIcon:un,symbolSDF:ln}),pn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};pn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,l=0;!u&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(u=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==n||u||this.boundIndexBuffer!==i||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,n,r,i,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind())},pn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=n;p<f.length;p+=1)f[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,v=n;d<v.length;d+=1){var g=v[d];g.bind(),g.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},pn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var fn=function(e,n,r,i,o){var a=e.gl;this.program=a.createProgram();var s=r.defines().concat("#define DEVICE_PIXEL_RATIO "+t.browser.devicePixelRatio.toFixed(1));o&&s.push("#define OVERDRAW_INSPECTOR;");var u=s.concat(De.fragmentSource,n.fragmentSource).join("\n"),l=s.concat(De.vertexSource,n.vertexSource).join("\n"),c=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(c,u),a.compileShader(c),a.attachShader(this.program,c);var h=a.createShader(a.VERTEX_SHADER);a.shaderSource(h,l),a.compileShader(h),a.attachShader(this.program,h);for(var p=r.layoutAttributes||[],f=0;f<p.length;f++)a.bindAttribLocation(this.program,f,p[f].name);a.linkProgram(this.program),this.numAttributes=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES),this.attributes={};for(var d={},v=0;v<this.numAttributes;v++){var g=a.getActiveAttrib(this.program,v);g&&(this.attributes[g.name]=a.getAttribLocation(this.program,g.name))}for(var y=a.getProgramParameter(this.program,a.ACTIVE_UNIFORMS),m=0;m<y;m++){var _=a.getActiveUniform(this.program,m);_&&(d[_.name]=a.getUniformLocation(this.program,_.name))}this.fixedUniforms=i(e,d),this.binderUniforms=r.getUniforms(e,d)};function dn(e,n,r){var i=1/le(r,1,n.transform.tileZoom),o=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,n.transform.tileZoom)/o,s=a*(r.tileID.canonical.x+r.tileID.wrap*o),u=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,u>>16],u_pixel_coord_lower:[65535&s,65535&u]}}fn.prototype.draw=function(t,e,n,r,i,o,a,s,u,l,c,h,p,f,d,v){var g,y=t.gl;for(var m in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[m].set(a[m]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(g={},g[y.LINES]=2,g[y.TRIANGLES]=3,g[y.LINE_STRIP]=1,g)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new pn)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,v),y.drawElements(e,w.primitiveLength*_,y.UNSIGNED_SHORT,w.primitiveOffset*_*2)}};var vn=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+r,u_opacity:i}},gn=function(e,n,r,i,o,a,s){return t.extend(vn(e,n,r,i),dn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},yn=function(t){return{u_matrix:t}},mn=function(e,n,r,i){return t.extend(yn(e),dn(r,n,i))},_n=function(t,e){return{u_matrix:t,u_world:e}},bn=function(e,n,r,i,o){return t.extend(mn(e,n,r,i),{u_world:o})},xn=function(t,e,n,r){var i,o,a=t.transform;if("map"===r.paint.get("circle-pitch-alignment")){var s=le(n,1,a.zoom);i=!0,o=[s,s]}else i=!1,o=a.pixelsToGLUnits;return{u_camera_to_center_distance:a.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,n,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+i,u_extrude_scale:o}},wn=function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},En=function(t,e,n){var r=le(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},Sn=function(t,e){return{u_matrix:t,u_color:e}},An=function(t){return{u_matrix:t}},Tn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:le(e,1,n),u_intensity:r}},Pn=function(t,e,n){var r=n.paint.get("hillshade-shadow-color"),i=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Cn(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:i,u_accent:o}},kn=function(e,n){var r=e.dem.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.tileID.overscaledZ,u_maxzoom:n}};function Cn(e,n){var r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new t.MercatorCoordinate(0,i/r).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/r).toLngLat().lat]}var On=function(t,e,n){var r=t.transform;return{u_matrix:Fn(t,e,n),u_ratio:1/le(e,1,r.zoom),u_gl_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},In=function(e,n,r){return t.extend(On(e,n,r),{u_image:0})},Mn=function(e,n,r,i){var o=e.transform,a=Ln(n,o);return{u_matrix:Fn(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/le(n,1,o.zoom),u_image:0,u_scale:[t.browser.devicePixelRatio,a,i.fromScale,i.toScale],u_fade:i.t,u_gl_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Rn=function(e,n,r,i,o){var a=e.transform,s=e.lineAtlas,u=Ln(n,a),l="round"===r.layout.get("line-cap"),c=s.getDash(i.from,l),h=s.getDash(i.to,l),p=c.width*o.fromScale,f=h.width*o.toScale;return t.extend(On(e,n,r),{u_patternscale_a:[u/p,-c.height/2],u_patternscale_b:[u/f,-h.height/2],u_sdfgamma:s.width/(256*Math.min(p,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:h.y,u_mix:o.t})};function Ln(t,e){return 1/le(t,1,e.tileZoom)}function Fn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Nn=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:jn(i.paint.get("raster-hue-rotate"))};var o,a};function jn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Dn=function(t,e,n,r,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_gl_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:l,u_texture:0}},zn=function(e,n,r,i,o,a,s,u,l,c,h){var p=o.transform;return t.extend(Dn(e,n,r,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_is_halo:+h})},Bn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Un=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from),o=n.imageManager.getPattern(t.to),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/l,h=c*(r.tileID.canonical.x+r.tileID.wrap*l),p=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/le(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Vn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:wn,collisionCircle:wn,debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_maxzoom:new t.Uniform1f(e,n.u_maxzoom)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_image:new t.Uniform1i(e,n.u_image),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_scale:new t.Uniform4f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,n.u_gl_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,n.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,n.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_is_halo:new t.Uniform1f(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Gn(e,n){for(var r=e.sort((function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0})),i=0;i<r.length;i++){var o={},a=r[i],s=r.slice(i+1);Wn(a.tileID.wrapped(),a.tileID,s,new t.OverscaledTileID(0,a.tileID.wrap+1,0,0,0),o),a.setMask(o,n)}}function Wn(e,n,r,i,o){for(var a=0;a<r.length;a++){var s=r[a];if(i.isLessThan(s.tileID))break;if(n.key===s.tileID.key)return;if(s.tileID.isChildOf(n)){for(var u=n.children(1/0),l=0;l<u.length;l++)Wn(e,u[l],r.slice(a),i,o);return}}var c=n.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(c,n.canonical.x-(e.canonical.x<<c),n.canonical.y-(e.canonical.y<<c));o[h.key]=o[h.key]||h}function Xn(t,e,n,r,i){for(var o=t.context,a=o.gl,s=i?t.useProgram("collisionCircle"):t.useProgram("collisionBox"),u=0;u<r.length;u++){var l=r[u],c=e.getTile(l),h=c.getBucket(n);if(h){var p=i?h.collisionCircle:h.collisionBox;p&&s.draw(o,i?a.TRIANGLES:a.LINES,St.disabled,At.disabled,t.colorModeForRenderPass(),Pt.disabled,En(l.posMatrix,t.transform,c),n.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,t.transform.zoom,null,null,p.collisionVertexBuffer)}}}var Hn=t.identity(new Float32Array(16)),qn=t.properties.layout;function Zn(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,l=-(s.verticalAlign-.5)*r,c=t.evaluateRadialOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function Kn(e,n,r,i,o,a,s,u,l,c){var h=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray;p.clear();for(var f=0;f<h.length;f++){var d=h.get(f),v=!d.hidden&&d.crossTileID?i[d.crossTileID]:null;if(v){var g=new t.Point(d.anchorX,d.anchorY),y=Yt(g,r?u:s),m=.5+a.cameraToCenterDistance/y.signedDistanceFromCamera*.5,_=o.evaluateSizeForFeature(e.textSizeData,c,d)*m/t.ONE_EM;r&&(_*=e.tilePixelRatio/l);for(var b=v.width,x=v.height,w=v.radialOffset,E=v.textBoxScale,S=Zn(v.anchor,b,x,w,E,_),A=r?Yt(g.add(S),s).point:y.point.add(n?S.rotate(-a.angle):S),T=0;T<d.numGlyphs;T++)t.addDynamicAttributes(p,A,0)}else oe(d.numGlyphs,p)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function Yn(e,n,r,i,o,a,s,u,l,c,h,p,f){for(var d,v,g=e.context,y=g.gl,m=e.transform,_="map"===u,b="map"===l,x=_&&"point"!==r.layout.get("symbol-placement"),w=_&&!b&&!x,E=void 0!==r.layout.get("symbol-sort-key").constantOr(1),S=e.depthModeForSublayer(0,St.ReadOnly),A=r.layout.get("text-variable-anchor"),T=[],P=0,k=i;P<k.length;P+=1){var C=k[P],O=n.getTile(C),I=O.getBucket(r);if(I){var M=o?I.text:I.icon;if(M&&M.segments.get().length){var R=M.programConfigurations.get(r.id),L=o||I.sdfIcons,F=o?I.textSizeData:I.iconSizeData;d||(d=e.useProgram(L?"symbolSDF":"symbolIcon",R),v=t.evaluateSizeForZoom(F,m.zoom,qn.properties[o?"text-size":"icon-size"])),g.activeTexture.set(y.TEXTURE0);var N=void 0,j=void 0,D=void 0;if(o)j=O.glyphAtlasTexture,D=y.LINEAR,N=O.glyphAtlasTexture.size;else{var z=1!==r.layout.get("icon-size").constantOr(0)||I.iconsNeedLinear,B=b||0!==m.pitch;j=O.imageAtlasTexture,D=L||e.options.rotating||e.options.zooming||z||B?y.LINEAR:y.NEAREST,N=O.imageAtlasTexture.size}var U=le(O,1,e.transform.zoom),V=Zt(C.posMatrix,b,_,e.transform,U),G=Kt(C.posMatrix,b,_,e.transform,U);if(x)Qt(I,C.posMatrix,e,o,V,G,b,c);else if(o&&v&&A){var W=Math.pow(2,m.zoom-O.tileID.overscaledZ);Kn(I,_,b,f,t.symbolSize,m,V,C.posMatrix,W,v)}var X=e.translatePosMatrix(C.posMatrix,O,a,s),H=x||o&&A?Hn:V,q=e.translatePosMatrix(G,O,a,s,!0),Z=L&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),K={program:d,buffers:M,uniformValues:L?zn(F.functionType,v,w,b,e,X,H,q,o,N,!0):Dn(F.functionType,v,w,b,e,X,H,q,o,N),atlasTexture:j,atlasInterpolation:D,isSDF:L,hasHalo:Z};if(E)for(var Y=0,J=M.segments.get();Y<J.length;Y+=1){var Q=J[Y];T.push({segments:new t.SegmentVector([Q]),sortKey:Q.sortKey,state:K})}else T.push({segments:M.segments,sortKey:0,state:K})}}}E&&T.sort((function(t,e){return t.sortKey-e.sortKey}));for(var $=0,tt=T;$<tt.length;$+=1){var et=tt[$],nt=et.state;if(nt.atlasTexture.bind(nt.atlasInterpolation,y.CLAMP_TO_EDGE),nt.isSDF){var rt=nt.uniformValues;nt.hasHalo&&(rt.u_is_halo=1,Jn(nt.buffers,et.segments,r,e,nt.program,S,h,p,rt)),rt.u_is_halo=0}Jn(nt.buffers,et.segments,r,e,nt.program,S,h,p,nt.uniformValues)}}function Jn(t,e,n,r,i,o,a,s,u){var l=r.context,c=l.gl;i.draw(l,c.TRIANGLES,o,a,s,Pt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Qn(t,e,n,r,i,o,a){var s,u,l,c,h,p=t.context.gl,f=n.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var g=0,y=r;g<y.length;g+=1){var m=y[g],_=e.getTile(m);if(!d||_.patternsLoaded()){var b=_.getBucket(n);if(b){var x=b.programConfigurations.get(n.id),w=t.useProgram(u,x);d&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),x.updatePatternPaintBuffers(v));var E=f.constantOr(null);if(E&&_.imageAtlas){var S=_.imageAtlas.patternPositions[E.to],A=_.imageAtlas.patternPositions[E.from];S&&A&&x.setConstantPatternPositions(S,A)}var T=t.translatePosMatrix(m.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){c=b.indexBuffer2,h=b.segments2;var P=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?bn(T,t,v,_,P):_n(T,P)}else c=b.indexBuffer,h=b.segments,l=d?mn(T,t,v,_):yn(T);w.draw(t.context,s,i,t.stencilModeForClipping(m),o,Pt.disabled,l,n.id,b.layoutVertexBuffer,c,h,n.paint,t.transform.zoom,x)}}}}function $n(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,l=n.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=0,d=r;f<d.length;f+=1){var v=d[f],g=e.getTile(v),y=g.getBucket(n);if(y){var m=y.programConfigurations.get(n.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",m);c&&(t.context.activeTexture.set(u.TEXTURE0),g.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),m.updatePatternPaintBuffers(h));var b=l.constantOr(null);if(b&&g.imageAtlas){var x=g.imageAtlas.patternPositions[b.to],w=g.imageAtlas.patternPositions[b.from];x&&w&&m.setConstantPatternPositions(x,w)}var E=t.translatePosMatrix(v.posMatrix,g,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),S=n.paint.get("fill-extrusion-vertical-gradient"),A=c?gn(E,t,S,p,v,h,g):vn(E,t,S,p);_.draw(s,s.gl.TRIANGLES,i,o,a,Pt.backCCW,A,n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,t.transform.zoom,m)}}}function tr(t,e,n,r,i,o){var a=t.context,s=a.gl,u=e.fbo;if(u){var l=t.useProgram("hillshade");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var c=Pn(t,e,n);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?l.draw(a,s.TRIANGLES,r,i,o,Pt.disabled,c,n.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):l.draw(a,s.TRIANGLES,r,i,o,Pt.disabled,c,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function er(e,n,r,i,o,a,s){var u=e.context,l=u.gl;if(n.dem&&n.dem.data){var c=n.dem.dim,h=n.dem.stride,p=n.dem.getPixels();if(u.activeTexture.set(l.TEXTURE1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var f=n.demTexture;f.update(p,{premultiply:!1}),f.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(u,p,l.RGBA,{premultiply:!1}),n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);u.activeTexture.set(l.TEXTURE0);var d=n.fbo;if(!d){var v=new t.Texture(u,{width:c,height:c,data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE),(d=n.fbo=u.createFramebuffer(c,c)).colorAttachment.set(v.texture)}u.bindFramebuffer.set(d.framebuffer),u.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(u,l.TRIANGLES,o,a,s,Pt.disabled,kn(n,i),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function nr(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=n?(s-n.timeAdded)/a:-1,c=r.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function rr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=St.disabled,l=At.disabled,c=e.colorModeForRenderPass(),h="$debug";s.draw(i,o.LINE_STRIP,u,l,c,Pt.disabled,Sn(a,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);for(var p=n.getTileByID(r.key).latestRawTileData,f=p&&p.byteLength||0,d=Math.floor(f/1024),v=function(t,e,n,r){r=r||1;var i,o,a,s,u,l,c,h,p=[];for(i=0,o=t.length;i<o;i++)if(u=ir[t[i]]){for(h=null,a=0,s=u[1].length;a<s;a+=2)-1===u[1][a]&&-1===u[1][a+1]?h=null:(l=e+u[1][a]*r,c=200-u[1][a+1]*r,h&&p.push(h.x,h.y,l,c),h={x:l,y:c});e+=u[0]*r}return p}(r.toString()+" "+d+"kb",50,0,5),g=new t.StructArrayLayout2i4,y=new t.StructArrayLayout2ui4,m=0;m<v.length;m+=2)g.emplaceBack(v[m],v[m+1]),y.emplaceBack(m,m+1);for(var _=i.createVertexBuffer(g,je.members),b=i.createIndexBuffer(y),x=t.SegmentVector.simpleSegment(0,0,g.length/2,g.length/2),w=n.getTile(r).tileSize,E=t.EXTENT/(Math.pow(2,e.transform.zoom-r.overscaledZ)*w),S=[[-1,-1],[-1,1],[1,-1],[1,1]],A=0;A<S.length;A++){var T=S[A];s.draw(i,o.LINES,u,l,c,Pt.disabled,Sn(t.translate([],a,[E*T[0],E*T[1],0]),t.Color.white),h,_,b,x)}s.draw(i,o.LINES,u,l,c,Pt.disabled,Sn(a,t.Color.black),h,_,b,x)}var ir={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},or={symbol:function(t,e,n,r,i){if("translucent"===t.renderPass){var o=At.disabled,a=t.colorModeForRenderPass();0!==n.paint.get("icon-opacity").constantOr(1)&&Yn(t,e,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,a,i),0!==n.paint.get("text-opacity").constantOr(1)&&Yn(t,e,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,a,i),e.map.showCollisionBoxes&&function(t,e,n,r){Xn(t,e,n,r,!1),Xn(t,e,n,r,!0)}(t,e,n,r)}},circle:function(t,e,n,r){if("translucent"===t.renderPass){var i=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity");if(0!==i.constantOr(1)||0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=t.context,u=s.gl,l=t.depthModeForSublayer(0,St.ReadOnly),c=At.disabled,h=t.colorModeForRenderPass(),p=0;p<r.length;p++){var f=r[p],d=e.getTile(f),v=d.getBucket(n);if(v){var g=v.programConfigurations.get(n.id);t.useProgram("circle",g).draw(s,u.TRIANGLES,l,c,h,Pt.disabled,xn(t,f,d,n),n.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,n.paint,t.transform.zoom,g)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=e.depthModeForSublayer(0,St.ReadOnly),u=At.disabled,l=new Tt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,n,r,i){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,n.width/4,n.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),i.colorAttachment.set(r),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,i.colorAttachment.setDirty(),t(e,n,r,i))}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var c=0;c<i.length;c++){var h=i[c];if(!n.hasRenderableParent(h)){var p=n.getTile(h),f=p.getBucket(r);if(f){var d=f.programConfigurations.get(r.id),v=e.useProgram("heatmap",d),g=e.transform.zoom;v.draw(o,a.TRIANGLES,s,u,l,Pt.disabled,Tn(h.posMatrix,p,g,r.paint.get("heatmap-intensity")),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,r.paint,e.transform.zoom,d)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,St.disabled,At.disabled,e.colorModeForRenderPass(),Pt.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:r,u_color_ramp:i,u_opacity:n.paint.get("heatmap-opacity")}}(e,n,0,1),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=e.depthModeForSublayer(0,St.ReadOnly),u=e.colorModeForRenderPass(),l=r.paint.get("line-dasharray"),c=r.paint.get("line-pattern"),h=c.constantOr(1),p=r.paint.get("line-gradient"),f=r.getCrossfadeParameters(),d=l?"lineSDF":h?"linePattern":p?"lineGradient":"line",v=e.context,g=v.gl,y=!0;if(p){v.activeTexture.set(g.TEXTURE0);var m=r.gradientTexture;if(!r.gradient)return;m||(m=r.gradientTexture=new t.Texture(v,r.gradient,g.RGBA)),m.bind(g.LINEAR,g.CLAMP_TO_EDGE)}for(var _=0,b=i;_<b.length;_+=1){var x=b[_],w=n.getTile(x);if(!h||w.patternsLoaded()){var E=w.getBucket(r);if(E){var S=E.programConfigurations.get(r.id),A=e.context.program.get(),T=e.useProgram(d,S),P=y||T.program!==A,k=c.constantOr(null);if(k&&w.imageAtlas){var C=w.imageAtlas.patternPositions[k.to],O=w.imageAtlas.patternPositions[k.from];C&&O&&S.setConstantPatternPositions(C,O)}var I=l?Rn(e,w,r,l,f):h?Mn(e,w,r,f):p?In(e,w,r):On(e,w,r);l&&(P||e.lineAtlas.dirty)?(v.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(v)):h&&(v.activeTexture.set(g.TEXTURE0),w.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),S.updatePatternPaintBuffers(f)),T.draw(v,g.TRIANGLES,s,e.stencilModeForClipping(x),u,Pt.disabled,I,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,e.transform.zoom,S),y=!1}}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?St.ReadWrite:St.ReadOnly);Qn(e,n,r,i,c,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);Qn(e,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))$n(t,e,n,r,o,At.disabled,Tt.disabled),$n(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();$n(t,e,n,r,o,At.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=e.getSource().maxzoom,a=t.depthModeForSublayer(0,St.ReadOnly),s=At.disabled,u=t.colorModeForRenderPass(),l=0,c=r;l<c.length;l+=1){var h=c[l],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?er(t,p,n,o,a,s,u):"translucent"===t.renderPass&&tr(t,p,n,a,s,u)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity"))for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=At.disabled,l=t.colorModeForRenderPass(),c=r.length&&r[0].overscaledZ,h=!t.options.moving,p=0,f=r;p<f.length;p+=1){var d=f[p],v=t.depthModeForSublayer(d.overscaledZ-c,1===n.paint.get("raster-opacity")?St.ReadWrite:St.ReadOnly,o.LESS),g=e.getTile(d),y=t.transform.calculatePosMatrix(d.toUnwrapped(),h);g.registerFadeDuration(n.paint.get("raster-fade-duration"));var m=e.findLoadedParent(d,0),_=nr(g,m,e,n,t.transform),b=void 0,x=void 0,w="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),g.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),m?(m.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),b=Math.pow(2,m.tileID.overscaledZ-g.tileID.overscaledZ),x=[g.tileID.canonical.x*b%1,g.tileID.canonical.y*b%1]):g.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var E=Nn(y,x||[0,0],b||1,_,n);a instanceof O?s.draw(i,o.TRIANGLES,v,u,l,Pt.disabled,E,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):g.maskedBoundsBuffer&&g.maskedIndexBuffer&&g.segments?s.draw(i,o.TRIANGLES,v,u,l,Pt.disabled,E,n.id,g.maskedBoundsBuffer,g.maskedIndexBuffer,g.segments,n.paint,t.transform.zoom):s.draw(i,o.TRIANGLES,v,u,l,Pt.disabled,E,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=n.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=l||1!==r.a||1!==i?"translucent":"opaque";if(t.renderPass===c){var h=At.disabled,p=t.depthModeForSublayer(0,"opaque"===c?St.ReadWrite:St.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var g=n.getCrossfadeParameters(),y=0,m=v;y<m.length;y+=1){var _=m[y],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=l?Un(b,i,t,l,{tileID:_,tileSize:u},g):Bn(b,i,r);d.draw(o,a.TRIANGLES,p,h,f,Pt.disabled,x,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)rr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(At.disabled);var a="3d"===i.renderingMode?new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,St.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},ar=function(e,n){this.context=new kt(e),this.transform=n,this._tileTextures={},this.setup(),this.numSublayers=Ct.maxUnderzooming+Ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new Me};function sr(t,e){if(t.y>e.y){var n=t;t=e,e=n}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function ur(t,e,n,r,i){var o=Math.max(n,Math.floor(e.y0)),a=Math.min(r,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,c=t.dx>0,h=e.dx<0,p=o;p<a;p++){var f=u*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=l*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;i(Math.floor(d),Math.ceil(f),p)}}function lr(t,e,n,r,i,o){var a,s=sr(t,e),u=sr(e,n),l=sr(n,t);s.dy>u.dy&&(a=s,s=u,u=a),s.dy>l.dy&&(a=s,s=l,l=a),u.dy>l.dy&&(a=u,u=l,l=a),s.dy&&ur(l,s,r,i,o),u.dy&&ur(l,u,r,i,o)}ar.prototype.resize=function(e,n){var r=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,o=this.style._order;i<o.length;i+=1){var a=o[i];this.style._layers[a].resize()}this.depthRbo&&(r.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},ar.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,je.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,je.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,je.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var u=this.context.gl;this.stencilClearMode=new At({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},ar.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,St.disabled,this.stencilClearMode,Tt.disabled,Pt.disabled,An(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ar.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(Tt.disabled),n.setDepthMode(St.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,St.disabled,new At({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),Tt.disabled,Pt.disabled,An(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ar.prototype.stencilModeFor3D=function(){this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new At({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},ar.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new At({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},ar.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},ar.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return St.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(n||this.context.gl.LEQUAL,e,[r,r])},ar.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ar.prototype.render=function(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var r=this.style._order,i=this.style.sourceCaches;for(var o in i){var a=i[o];a.used&&a.prepare(this.context)}var s={},u={},l={};for(var c in i){var h=i[c];s[c]=h.getVisibleCoordinates(),u[c]=s[c].slice().reverse(),l[c]=h.getVisibleCoordinates(!0).reverse()}for(var p in i){var f=i[p],d=f.getSource();if("raster"===d.type||"raster-dem"===d.type){for(var v=[],g=0,y=s[p];g<y.length;g+=1){var m=y[g];v.push(f.getTile(m))}Gn(v,this.context)}}this.opaquePassCutoff=1/0;for(var _=0;_<r.length;_++){var b=r[_];if(this.style._layers[b].is3D()){this.opaquePassCutoff=_;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var x=0,w=r;x<w.length;x+=1){var E=w[x],S=this.style._layers[E];if(S.hasOffscreenPass()&&!S.isHidden(this.transform.zoom)){var A=u[S.source];("custom"===S.type||A.length)&&this.renderLayer(this,i[S.source],S,A)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){var T=this.style._layers[r[this.currentLayer]],P=i[T.source],k=s[T.source];this._renderTileClippingMasks(T,k),this.renderLayer(this,P,T,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){var C=this.style._layers[r[this.currentLayer]],O=i[C.source],I=("symbol"===C.type?l:u)[C.source];this._renderTileClippingMasks(C,s[C.source]),this.renderLayer(this,O,C,I)}if(this.options.showTileBoundaries)for(var M in i){or.debug(this,i[M],s[M]);break}this.setCustomLayerDefaults()},ar.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},ar.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,or[n.type](t,e,n,r,this.style.placement.variableOffsets))},ar.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var l=[o?r[0]:le(n,r[0],this.transform.zoom),o?r[1]:le(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},ar.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},ar.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},ar.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from),n=this.imageManager.getPattern(t.to);return!e||!n},ar.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new fn(this.context,hn[t],e,Vn[t],this._showOverdrawInspector)),this.cache[n]},ar.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ar.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var cr=function(e,n,r){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===r||r,this._minZoom=e||0,this._maxZoom=n||22,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},hr={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};cr.prototype.clone=function(){var t=new cr(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},hr.minZoom.get=function(){return this._minZoom},hr.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},hr.maxZoom.get=function(){return this._maxZoom},hr.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},hr.renderWorldCopies.get=function(){return this._renderWorldCopies},hr.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},hr.worldSize.get=function(){return this.tileSize*this.scale},hr.centerPoint.get=function(){return this.size._div(2)},hr.size.get=function(){return new t.Point(this.width,this.height)},hr.bearing.get=function(){return-this.angle/Math.PI*180},hr.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},hr.pitch.get=function(){return this._pitch/Math.PI*180},hr.pitch.set=function(e){var n=t.clamp(e,0,60)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},hr.fov.get=function(){return this._fov/Math.PI*180},hr.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},hr.zoom.get=function(){return this._zoom},hr.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},hr.center.get=function(){return this._center},hr.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},cr.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},cr.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&n.push(new t.UnwrappedTileID(l,e));return n},cr.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=new t.Point(o*i.x-.5,o*i.y-.5);return function(e,n,r,i){void 0===i&&(i=!0);var o=1<<e,a={};function s(n,s,u){var l,c,h,p;if(u>=0&&u<=o)for(l=n;l<s;l++)c=Math.floor(l/o),h=(l%o+o)%o,0!==c&&!0!==i||(p=new t.OverscaledTileID(r,c,e,h,u),a[p.key]=p)}var u=n.map((function(e){return new t.Point(e.x,e.y)._mult(o)}));return lr(u[0],u[1],u[2],0,o,s),lr(u[2],u[3],u[0],0,o,s),Object.keys(a).map((function(t){return a[t]}))}(n,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?r:n,this._renderWorldCopies).sort((function(t,e){return a.dist(t.canonical)-a.dist(e.canonical)}))},cr.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},hr.unmodified.get=function(){return this._unmodified},cr.prototype.zoomScale=function(t){return Math.pow(2,t)},cr.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},cr.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},cr.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},hr.point.get=function(){return this.project(this.center)},cr.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},cr.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},cr.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},cr.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},cr.prototype.coordinateLocation=function(t){return t.toLngLat()},cr.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[0]/i,s=r[0]/o,u=n[1]/i,l=r[1]/o,c=n[2]/i,h=r[2]/o,p=c===h?0:(0-c)/(h-c);return new t.MercatorCoordinate(t.number(a,s,p)/this.worldSize,t.number(u,l,p)/this.worldSize)},cr.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},cr.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},cr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},cr.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},cr.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},cr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},cr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,n=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,g=l.y/2;v-g<o&&(i=o+g),v+g>a&&(i=a-g)}if(this.lngRange){var y=f.x,m=l.x/2;y-m<s&&(r=s+m),y+m>u&&(r=u-m)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},cr.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,n=Math.PI/2+this._pitch,r=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-n-e),i=this.point,o=i.x,a=i.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*r+this.cameraToCenterDistance),u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,1,s),t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-o,-a,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u;var l=this.width%2/2,c=this.height%2/2,h=Math.cos(this.angle),p=Math.sin(this.angle),f=o-Math.round(o)+h*l+p*c,d=a-Math.round(a)+h*c+p*l,v=new Float64Array(u);if(t.translate(v,v,[f>.5?f-1:f,d>.5?d-1:d,0]),this.alignedProjMatrix=v,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},cr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},cr.prototype.getCameraPoint=function(){var e=this._pitch,n=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,n))},cr.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var l=u[s];r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(cr.prototype,hr);var pr=function(){var e,n,r,i;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),n=!1,r=0,i=function(){r=0,n&&(e(),r=setTimeout(i,300),n=!1)},function(){return n=!0,r||i(),r})};pr.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},pr.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},pr.prototype.getHashString=function(t){var e=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this._map.getBearing(),u=this._map.getPitch(),l="";return l+=t?"#/"+o+"/"+a+"/"+n:"#"+n+"/"+a+"/"+o,(s||u)&&(l+="/"+Math.round(10*s)/10),u&&(l+="/"+Math.round(u)),l},pr.prototype._onHashChange=function(){var e=t.window.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},pr.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var fr=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),dr=function(e){function r(r,i,o){var a=n.touchPos(i.getCanvasContainer(),o),s=a.map((function(t){return i.unproject(t)})),u=a.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),l=i.unproject(u);e.call(this,r,{points:a,point:u,lngLats:s,lngLat:l,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),vr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),gr=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};gr.prototype.isEnabled=function(){return!!this._enabled},gr.prototype.isActive=function(){return!!this._active},gr.prototype.isZooming=function(){return!!this._zooming},gr.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},gr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gr.prototype.onWheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this.isActive()||this._start(e)),e.preventDefault()}},gr.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},gr.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},gr.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a="number"==typeof this._targetZoom?this._targetZoom:n.zoom,s=this._startZoom,u=this._easing,l=!1;if("wheel"===this._type&&s&&u){var c=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=u(c);n.zoom=t.number(s,a,h),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):l=!0}else n.zoom=a,l=!0;n.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),l&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom}),200))}},gr.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n};var yr=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};yr.prototype.isEnabled=function(){return!!this._enabled},yr.prototype.isActive=function(){return!!this._active},yr.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},yr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},yr.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),n.disableDrag(),this._startPos=this._lastPos=n.mousePos(this._el,e),this._active=!0)},yr.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=e,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var i=Math.min(r.x,e.x),o=Math.max(r.x,e.x),a=Math.min(r.y,e.y),s=Math.max(r.y,e.y);n.setTransform(this._box,"translate("+i+"px,"+a+"px)"),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"}},yr.prototype._onMouseUp=function(e){if(0===e.button){var r=this._startPos,i=n.mousePos(this._el,e);this._finish(),n.suppressClick(),r.x===i.x&&r.y===i.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(r,i,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},yr.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},yr.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},yr.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var mr=t.bezier(0,0,.25,1),_r=function(e,n){this._map=e,this._el=n.element||e.getCanvasContainer(),this._state="disabled",this._button=n.button||"right",this._bearingSnap=n.bearingSnap||0,this._pitchWithRotate=!1!==n.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};_r.prototype.isEnabled=function(){return"disabled"!==this._state},_r.prototype.isActive=function(){return"active"===this._state},_r.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},_r.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},_r.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=n.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==n.mouseButton(e))return;this._eventButton=0}n.disableDrag(),t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._lastPos=n.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},_r.prototype._onMouseMove=function(t){var e=n.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},_r.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var n=this._map.transform,r=this._startPos,i=this._lastPos,o=.8*(r.x-i.x),a=-.5*(r.y-i.y),s=n.bearing-o,u=n.pitch-a,l=this._inertia,c=l[l.length-1];this._drainInertiaBuffer(),l.push([t.browser.now(),this._map._normalizeBearing(s,c[1])]),n.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",e),n.pitch=u),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._startPos=this._lastPos}},_r.prototype._onMouseUp=function(t){if(n.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},_r.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},_r.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),n.enableDrag()},_r.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos},_r.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var n=this._map,r=n.getBearing(),i=this._inertia,o=function(){Math.abs(r)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(i.length<2)o();else{var a=i[0],s=i[i.length-1],u=i[i.length-2],l=n._normalizeBearing(r,u[1]),c=s[1]-a[1],h=c<0?-1:1,p=(s[0]-a[0])/1e3;if(0!==c&&0!==p){var f=Math.abs(c*(.25/p));f>180&&(f=180);var d=f/180;l+=h*f*(d/2),Math.abs(n._normalizeBearing(l,0))<this._bearingSnap&&(l=n._normalizeBearing(0,l)),n.rotateTo(l,{duration:1e3*d,easing:mr,noMoveStart:!0},{originalEvent:t})}else o()}},_r.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},_r.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var br=t.bezier(0,0,.3,1),xr=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=n.clickTolerance||1,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};xr.prototype.isEnabled=function(){return"disabled"!==this._state},xr.prototype.isActive=function(){return"active"===this._state},xr.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},xr.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},xr.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==n.mouseButton(e)||(n.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},xr.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(n.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},xr.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=n.mousePos(this._el,e),this._inertia=[[t.browser.now(),this._startPos]]},xr.prototype._onMove=function(e){e.preventDefault();var r=n.mousePos(this._el,e);this._lastPos.equals(r)||"pending"===this._state&&r.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=r,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},xr.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._startPos=this._lastPos,delete this._lastMoveEvent}},xr.prototype._onMouseUp=function(t){if(0===n.mouseButton(t))switch(this._state){case"active":this._state="enabled",n.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},xr.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},xr.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},xr.prototype._unbind=function(){n.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onTouchEnd),n.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),n.removeEventListener(t.window.document,"mouseup",this._onMouseUp),n.removeEventListener(t.window,"blur",this._onBlur)},xr.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos},xr.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var n=e[e.length-1],r=e[0],i=n[1].sub(r[1]),o=(n[0]-r[0])/1e3;if(0===o||n[1].equals(r[1]))this._fireEvent("moveend",t);else{var a=i.mult(.3/o),s=a.mag();s>1400&&(s=1400,a._unit()._mult(s));var u=s/750,l=a.mult(-u/2);this._map.panBy(l,{duration:1e3*u,easing:br,noMoveStart:!0},{originalEvent:t})}}},xr.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},xr.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>0&&n-e[0][0]>160;)e.shift()};var wr=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function Er(t){return t*(2-t)}wr.prototype.isEnabled=function(){return!!this._enabled},wr.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},wr.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},wr.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,r=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),u={duration:300,delayEndEvents:500,easing:Er,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*n,pitch:a.getPitch()+10*r,offset:[100*-i,100*-o],center:a.getCenter()};a.easeTo(u,{originalEvent:t})}};var Sr=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};Sr.prototype.isEnabled=function(){return!!this._enabled},Sr.prototype.isActive=function(){return!!this._active},Sr.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Sr.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Sr.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout((function(){e._tapped=null}),300)))},Sr.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Sr.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Sr.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Ar=t.bezier(0,0,.15,1),Tr=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Tr.prototype.isEnabled=function(){return!!this._enabled},Tr.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Tr.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Tr.prototype.disableRotation=function(){this._rotationDisabled=!0},Tr.prototype.enableRotation=function(){this._rotationDisabled=!1},Tr.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var r=n.mousePos(this._el,e.touches[0]),i=n.mousePos(this._el,e.touches[1]),o=r.add(i).div(2);this._startVec=r.sub(i),this._startAround=this._map.transform.pointLocation(o),this._gestureIntent=void 0,this._inertia=[],n.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.addEventListener(t.window.document,"touchend",this._onEnd)}},Tr.prototype._getTouchEventData=function(t){var e=n.mousePos(this._el,t.touches[0]),r=n.mousePos(this._el,t.touches[1]),i=e.sub(r);return{vec:i,center:e.add(r).div(2),scale:i.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*i.angleWith(this._startVec)/Math.PI}},Tr.prototype._onMove=function(e){if(2===e.touches.length){var n=this._getTouchEventData(e),r=n.vec,i=n.scale,o=n.bearing;if(!this._gestureIntent){var a=this._rotationDisabled&&1!==i||Math.abs(1-i)>.15;Math.abs(o)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=r)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Tr.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var n=this._map.transform;this._startScale||(this._startScale=n.scale,this._startBearing=n.bearing);var r=this._getTouchEventData(this._lastTouchEvent),i=r.center,o=r.bearing,a=r.scale,s=n.pointLocation(i),u=n.locationPoint(s);"rotate"===e&&(n.bearing=this._startBearing+o),n.zoom=n.scaleZoom(this._startScale*a),n.setLocationAtPoint(this._startAround,u),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),a,i])}},Tr.prototype._onEnd=function(e){n.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),n.removeEventListener(t.window.document,"touchend",this._onEnd);var r=this._gestureIntent,i=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,r){this._map.fire(new t.Event(r+"end",{originalEvent:e})),this._drainInertiaBuffer();var o=this._inertia,a=this._map;if(o.length<2)a.snapToNorth({},{originalEvent:e});else{var s=o[o.length-1],u=o[0],l=a.transform.scaleZoom(i*s[1]),c=a.transform.scaleZoom(i*u[1]),h=l-c,p=(s[0]-u[0])/1e3,f=s[2];if(0!==p&&l!==c){var d=.15*h/p;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var v=1e3*Math.abs(d/(12*.15)),g=l+d*v/2e3;g<0&&(g=0),a.easeTo({zoom:g,duration:v,easing:Ar,around:this._aroundCenter?a.getCenter():a.unproject(f),noMoveStart:!0},{originalEvent:e})}else a.snapToNorth({},{originalEvent:e})}}},Tr.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,n=t.browser.now();e.length>2&&n-e[0][0]>160;)e.shift()};var Pr={scrollZoom:gr,boxZoom:yr,dragRotate:_r,dragPan:xr,keyboard:wr,doubleClickZoom:Sr,touchZoomRotate:Tr},kr=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){if("number"==typeof(i=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}if(t.deepEqual(Object.keys(i.padding).sort((function(t,e){return t<e?-1:t>e?1:0})),["bottom","left","right","top"])){var a=this.transform,s=a.project(t.LngLat.convert(e)),u=a.project(t.LngLat.convert(n)),l=s.rotate(-r*Math.PI/180),c=u.rotate(-r*Math.PI/180),h=new t.Point(Math.max(l.x,c.x),Math.max(l.y,c.y)),p=new t.Point(Math.min(l.x,c.x),Math.min(l.y,c.y)),f=h.sub(p),d=(a.width-i.padding.left-i.padding.right)/f.x,v=(a.height-i.padding.top-i.padding.bottom)/f.y;if(!(v<0||d<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(d,v)),i.maxZoom),y=t.Point.convert(i.offset),m=(i.padding.left-i.padding.right)/2,_=(i.padding.top-i.padding.bottom)/2,b=new t.Point(y.x+m,y.y+_).mult(a.scale/a.zoomScale(g));return{center:a.unproject(s.add(u).div(2).sub(b)),zoom:g,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(n=t.extend(e,n)).linear?this.easeTo(n,r):this.flyTo(n,r):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u="zoom"in e?+e.zoom:o,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,h=i.centerPoint.add(t.Point.convert(e.offset)),p=i.pointLocation(h),f=t.LngLat.convert(e.center||p);this._normalizeCenter(f);var d,v,g=i.project(p),y=i.project(f).sub(g),m=i.zoomScale(u-o);return e.around&&(d=t.LngLat.convert(e.around),v=i.locationPoint(d)),this._zooming=u!==o,this._rotating=a!==l,this._pitching=c!==s,this._prepareEase(n,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,u,e)),r._rotating&&(i.bearing=t.number(a,l,e)),r._pitching&&(i.pitch=t.number(s,c,e)),d)i.setLocationAtPoint(d,v);else{var p=i.zoomScale(i.zoom-o),f=u>o?Math.min(2,m):Math.max(.5,m),_=Math.pow(f,1-e),b=i.unproject(g.add(y.mult(e*_)).mult(p));i.setLocationAtPoint(i.renderWorldCopies?b.wrap():b,h)}r._fireMoveEvents(n)}),(function(){e.delayEndEvents?r._easeEndTimeoutID=setTimeout((function(){return r._afterEase(n)}),e.delayEndEvents):r._afterEase(n)}),e),this},n.prototype._prepareEase=function(e,n){this._moving=!0,n||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e){var n=this._zooming,r=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,n&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),i&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},n.prototype.flyTo=function(e,n){var r=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u="zoom"in e?t.clamp(+e.zoom,i.minZoom,i.maxZoom):o,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,h=i.zoomScale(u-o),p=i.centerPoint.add(t.Point.convert(e.offset)),f=i.pointLocation(p),d=t.LngLat.convert(e.center||f);this._normalizeCenter(d);var v=i.project(f),g=i.project(d).sub(v),y=e.curve,m=Math.max(i.width,i.height),_=m/h,b=g.mag();if("minZoom"in e){var x=t.clamp(Math.min(e.minZoom,o,u),i.minZoom,i.maxZoom),w=m/i.zoomScale(x-o);y=Math.sqrt(w/b*2)}var E=y*y;function S(t){var e=(_*_-m*m+(t?-1:1)*E*E*b*b)/(2*(t?_:m)*E*b);return Math.log(Math.sqrt(e*e+1)-e)}function A(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}var P=S(0),k=function(t){return T(P)/T(P+y*t)},C=function(t){return m*((T(P)*(A(e=P+y*t)/T(e))-A(P))/E)/b;var e},O=(S(1)-P)/y;if(Math.abs(b)<1e-6||!isFinite(O)){if(Math.abs(m-_)<1e-6)return this.easeTo(e,n);var I=_<m?-1:1;O=Math.abs(Math.log(_/m))/y,C=function(){return 0},k=function(t){return Math.exp(I*y*t)}}if("duration"in e)e.duration=+e.duration;else{var M="screenSpeed"in e?+e.screenSpeed/y:+e.speed;e.duration=1e3*O/M}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=a!==l,this._pitching=c!==s,this._prepareEase(n,!1),this._ease((function(e){var h=e*O,f=1/k(h);i.zoom=1===e?u:o+i.scaleZoom(f),r._rotating&&(i.bearing=t.number(a,l,e)),r._pitching&&(i.pitch=t.number(s,c,e));var y=1===e?d:i.unproject(v.add(g.mult(C(h))).mult(f));i.setLocationAtPoint(i.renderWorldCopies?y.wrap():y,p),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),Cr=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};Cr.prototype.getDefaultPosition=function(){return"bottom-right"},Cr.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Cr.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},Cr.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener"}},Cr.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Cr.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length})),(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).length?(this._innerContainer.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},Cr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Or=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Or.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Or.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Or.prototype.getDefaultPosition=function(){return"bottom-left"},Or.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Or.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Or.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var Ir=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ir.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Ir.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},Ir.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!r.cancelled&&(r.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ir.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Mr=t.window.HTMLImageElement,Rr=t.window.HTMLElement,Lr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Fr=function(r){function i(e){var i=this;if(null!=(e=t.extend({},Lr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var o=new cr(e.minZoom,e.maxZoom,e.renderWorldCopies);r.call(this,o,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new Ir,this._controls=[],this._mapId=t.uniqueId();var a=e.transformRequest;if(this._transformRequest=a?function(t,e){return a(t,e)||{url:t}}:function(t){return{url:t}},"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Rr))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return i._update(!1)})),this.on("moveend",(function(){return i._update(!1)})),this.on("zoom",(function(){return i._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var r=t.getCanvasContainer(),i=null,o=!1,a=null;for(var s in Pr)t[s]=new Pr[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);n.addEventListener(r,"mouseout",(function(e){t.fire(new fr("mouseout",t,e))})),n.addEventListener(r,"mousedown",(function(i){o=!0,a=n.mousePos(r,i);var s=new fr("mousedown",t,i);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(i),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(i),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(i))})),n.addEventListener(r,"mouseup",(function(e){var n=t.dragRotate.isActive();i&&!n&&t.fire(new fr("contextmenu",t,i)),i=null,o=!1,t.fire(new fr("mouseup",t,e))})),n.addEventListener(r,"mousemove",(function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var n=e.target;n&&n!==r;)n=n.parentNode;n===r&&t.fire(new fr("mousemove",t,e))}})),n.addEventListener(r,"mouseover",(function(e){for(var n=e.target;n&&n!==r;)n=n.parentNode;n===r&&t.fire(new fr("mouseover",t,e))})),n.addEventListener(r,"touchstart",(function(n){var r=new dr("touchstart",t,n);t.fire(r),r.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(n),t.touchZoomRotate.onStart(n),t.doubleClickZoom.onTouchStart(r))}),{passive:!1}),n.addEventListener(r,"touchmove",(function(e){t.fire(new dr("touchmove",t,e))}),{passive:!1}),n.addEventListener(r,"touchend",(function(e){t.fire(new dr("touchend",t,e))})),n.addEventListener(r,"touchcancel",(function(e){t.fire(new dr("touchcancel",t,e))})),n.addEventListener(r,"click",(function(i){var o=n.mousePos(r,i);(o.equals(a)||o.dist(a)<e.clickTolerance)&&t.fire(new fr("click",t,i))})),n.addEventListener(r,"dblclick",(function(e){var n=new fr("dblclick",t,e);t.fire(n),n.defaultPrevented||t.doubleClickZoom.onDblClick(n)})),n.addEventListener(r,"contextmenu",(function(e){var n=t.dragRotate.isActive();o||n?o&&(i=e):t.fire(new fr("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()})),n.addEventListener(r,"wheel",(function(n){e.interactive&&t.stop();var r=new vr("wheel",t,n);t.fire(r),r.defaultPrevented||t.scrollZoom.onWheel(n)}),{passive:!1})}(this,e),this._hash=e.hash&&(new pr).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Cr({customAttribution:e.customAttribution})),this.addControl(new Or,e.logoPosition),this.on("style.load",(function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)})),this.on("data",(function(e){i._update("style"===e.dataType),i.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){i.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),i.prototype=Object.create(r&&r.prototype),i.prototype.constructor=i;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&e.getDefaultPosition&&(n=e.getDefaultPosition()),void 0===n&&(n="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];return this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},i.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},i.prototype.on=function(t,e,n){var i=this;if(void 0===n)return r.prototype.on.call(this,t,e);var o=function(){var r;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new fr(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new fr(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new fr(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}}();for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o),o.delegates)this.on(a,o.delegates[a]);return this},i.prototype.off=function(t,e,n){if(void 0===n)return r.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var i=this._delegatedListeners[t],o=0;o<i.length;o++){var a=i[o];if(a.layer===e&&a.listener===n){for(var s in a.delegates)this.off(s,a.delegates[s]);return i.splice(o,1),this}}return this},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:Lr.localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ne(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=t.normalizeStyleURL(e),o=this._transformRequest(i,t.ResourceType.Style);t.getJSON(o,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==typeof e&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;if(void 0===o&&(o=!1),n instanceof Mr){var a=t.browser.getImageData(n),s=a.width,u=a.height,l=a.data;this.style.addImage(e,{data:new t.RGBAImage({width:s,height:u},l),pixelRatio:i,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=n.width,h=n.height,p=n.data,f=n;this.style.addImage(e,{data:new t.RGBAImage({width:c,height:h},new Uint8Array(p)),pixelRatio:i,sdf:o,version:0,userImage:f}),f.onAdd&&f.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Mr?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;if(void 0===o||void 0===a)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||a!==r.data.height)return this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var u=!(n instanceof Mr);r.data.replace(s,u),this.style.updateImage(e,r)},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)}))},i.prototype._resizeCanvas=function(e,n){var r=t.window.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new ar(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var n=this.transform.zoom,r=t.browser.now();this.style.zoomHistory.update(n,r);var i=new t.EvaluationParameters(n,{now:r,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),o=i.crossFadingFactor();1===o&&o===this._crossFadingFactor||(e=!0,this._crossFadingFactor=o),this.style.update(i)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),Nr(this._canvasContainer),Nr(this._controlContainer),Nr(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(){e._frame=null,e._render()})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},Object.defineProperties(i.prototype,o),i}(kr);function Nr(t){t.parentNode&&t.parentNode.removeChild(t)}var jr={showCompass:!0,showZoom:!0},Dr=function(e){var r=this;this.options=t.extend({},jr,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom in",(function(){return r._map.zoomIn()})),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom out",(function(){return r._map.zoomOut()}))),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset bearing to north",(function(){return r._map.resetNorth()})),this._compassArrow=n.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function zr(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Dr.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMaxZoom()),this._zoomOutButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMinZoom())},Dr.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Dr.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _r(t,{button:"left",element:this._compass}),n.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Dr.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),n.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map},Dr.prototype._createButton=function(t,e,r){var i=n.create("button",t,this._container);return i.type="button",i.title=e,i.setAttribute("aria-label",e),i.addEventListener("click",r),i};var Br={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ur(t,e,n){var r=t.classList;for(var i in Br)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Vr,Gr=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._draggable=r&&r.draggable||!1,this._state="inactive",r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=n.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=n.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var g=n.createNS("http://www.w3.org/2000/svg","path");g.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(g);var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),y.setAttributeNS(null,"fill","#FFFFFF");var m=n.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=n.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),m.appendChild(_),m.appendChild(b),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(y),s.appendChild(m),o.appendChild(s),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),Ur(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=zr(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Br[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"))},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r}(t.Evented),Wr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},Xr=function(e){function r(n){e.call(this),this.options=t.extend({},Wr,n),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Vr?r(Vr):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){Vr="denied"!==t.state,r(Vr)})):(Vr=!!t.window.navigator.geolocation,r(Vr)),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),n.remove(this._container),this._map=void 0},r.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},r.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;!1!==e?(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Gr(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.")},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),Hr={maxWidth:100,unit:"metric"},qr=function(e){this.options=t.extend({},Hr,e),t.bindAll(["_onMove","setUnit"],this)};function Zr(t,e,n){var r,i,o,a,s,u,l=n&&n.maxWidth||100,c=t._container.clientHeight/2,h=(r=t.unproject([0,c]),i=t.unproject([l,c]),o=Math.PI/180,a=r.lat*o,s=i.lat*o,u=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((i.lng-r.lng)*o),6371e3*Math.acos(Math.min(u,1)));if(n&&"imperial"===n.unit){var p=3.2808*h;p>5280?Kr(e,l,p/5280,"mi"):Kr(e,l,p,"ft")}else n&&"nautical"===n.unit?Kr(e,l,h/1852,"nm"):Kr(e,l,h,"m")}function Kr(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a))),u=s/n;"m"===r&&s>=1e3&&(s/=1e3,r="km"),t.style.width=e*u+"px",t.innerHTML=s+r}qr.prototype.getDefaultPosition=function(){return"bottom-left"},qr.prototype._onMove=function(){Zr(this._map,this._container,this.options)},qr.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},qr.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},qr.prototype.setUnit=function(t){this.options.unit=t,Zr(this._map,this._container,this.options)};var Yr=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Yr.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Yr.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Yr.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Yr.prototype._setupUI=function(){(this._fullscreenButton=n.create("button",this._className+"-icon "+this._className+"-fullscreen",this._controlContainer)).type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Yr.prototype._updateTitle=function(){var t=this._isFullscreen()?"Exit fullscreen":"Enter fullscreen";this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Yr.prototype._isFullscreen=function(){return this._fullscreen},Yr.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"),this._updateTitle())},Yr.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Jr={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Qr=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(Jr),n),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._update(),this},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},r.prototype._createContent=function(){this._content&&n.remove(this._content),this._content=n.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},r.prototype._update=function(){var e=this;if(this._map&&this._lngLat&&this._content){this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return e._container.classList.add(t)}))),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&(this._lngLat=zr(this._lngLat,this._pos,this._map.transform));var r=this._pos=this._map.project(this._lngLat),i=this.options.anchor,o=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!i){var a,s=this._container.offsetWidth,u=this._container.offsetHeight;a=r.y+o.bottom.y<u?["top"]:r.y>this._map.transform.height-u?["bottom"]:[],r.x<s/2?a.push("left"):r.x>this._map.transform.width-s/2&&a.push("right"),i=0===a.length?"bottom":a.join("-")}var l=r.add(o[i]).round();n.setTransform(this._container,Br[i]+" translate("+l.x+"px,"+l.y+"px)"),Ur(this._container,i,"popup")}},r.prototype._onClickClose=function(){this.remove()},r}(t.Evented),$r={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,Map:Fr,NavigationControl:Dr,GeolocateControl:Xr,AttributionControl:Cr,ScaleControl:qr,FullscreenControl:Yr,Popup:Qr,Marker:Gr,Style:Ne,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Rt.workerCount},set workerCount(t){Rt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},workerUrl:""};return $r})),n}()},845:function(t,e,n){"use strict";n.r(e);var r,i,o=n(708),a=n(686),s=n(687),u=n(811),l=n.n(u),c=1,h=2,p=4,f={mousedown:c,mousemove:h,mouseup:p};r=l.a.PointerEventInput,i=r.prototype.handler,r.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(e,(function(e){return e.pointerId===t.pointerId}))||e.push(t)),i.call(this,t)},l.a.MouseInput.prototype.handler=function(t){var e=f[t.type];e&c&&t.button>=0&&(this.pressed=!0),e&h&&0===t.which&&(e=p),this.pressed&&(e&p&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))};var d=l.a.Manager,v=l.a,g=v?[[v.Rotate,{enable:!1}],[v.Pinch,{enable:!1}],[v.Swipe,{enable:!1}],[v.Pan,{threshold:0,enable:!1}],[v.Press,{enable:!1}],[v.Tap,{event:"doubletap",taps:2,enable:!1}],[v.Tap,{event:"anytap",enable:!1}],[v.Tap,{enable:!1}]]:null,y={rotate:["pinch"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},m={doubletap:["tap"]},_={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},b=["keydown","keyup"],x=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],w=["wheel","mousewheel","DOMMouseScroll"],E={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},S={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},A=n(909),T=-1!==A.b.indexOf("firefox"),P=w,k=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(a.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.events=P.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent,!!A.a&&{passive:!1})}))}return Object(s.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;A.c.WheelEvent&&(T&&t.deltaMode===A.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=A.c.devicePixelRatio),t.deltaMode===A.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var n={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,n)}}},{key:"_onWheel",value:function(t,e,n){this.callback({type:"wheel",center:n,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),C=x,O=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(a.a)(this,t),this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=C.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent)}))}return Object(s.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),I=b,M=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(a.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=I.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach((function(t){return e.addEventListener(t,r.handleEvent)}))}return Object(s.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),R=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(a.a)(this,t),this.element=e,this.callback=n,this.options=Object.assign({enable:!0},r),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(s.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),L=1,F=2,N=4,j={pointerdown:L,pointermove:F,pointerup:N,mousedown:L,mousemove:F,mouseup:N},D=1,z=2,B=3,U=0,V=1,G=2,W=1,X=2,H=4;var q=function(){function t(e){Object(a.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(s.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.handlers,o=this.handlersByElement;o.has(n)||o.set(n,[]);var a={type:t,handler:e,srcElement:n,once:r};i.push(a),o.get(n).push(a)}},{key:"remove",value:function(t,e){for(var n=this.handlers,r=this.handlersByElement,i=n.length-1;i>=0;i--){var o=n[i];if(o.type===t&&o.handler===e){n.splice(i,1);var a=r.get(o.srcElement);a.splice(a.indexOf(o),1),0===a.length&&r.delete(o.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),n=t.srcEvent.target;n&&n!==e.rootElement;){if(this._emit(e,n),e.handled)return;n=n.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var n=this.handlersByElement.get(e);if(n){for(var r=!1,i=function(){t.handled=!0},o=function(){t.handled=!0,r=!0},a=[],s=0;s<n.length;s++){var u=n[s],l=u.type,c=u.handler,h=u.once;if(c(Object.assign({},t,{type:l,stopPropagation:i,stopImmediatePropagation:o})),h&&a.push(n[s]),r)break}for(var p=0;p<a.length;p++){var f=a[p];l=f.type,c=f.handler;this.remove(l,c)}}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=j[t.srcEvent.type];if(!e)return null;var n=t.srcEvent,r=n.buttons,i=n.button,o=n.which,a=!1,s=!1,u=!1;return e===N||e===F&&!Number.isFinite(r)?(a=o===D,s=o===z,u=o===B):e===F?(a=Boolean(r&W),s=Boolean(r&H),u=Boolean(r&X)):e===L&&(a=i===U,s=i===V,u=i===G),{leftButton:a,middleButton:s,rightButton:u}}(t),function(t,e){var n=t.srcEvent;if(!t.center&&!Number.isFinite(n.clientX))return null;var r=t.center||{x:n.clientX,y:n.clientY},i=e.getBoundingClientRect(),o=i.width/e.offsetWidth,a=i.height/e.offsetHeight;return{center:r,offsetCenter:{x:(r.x-i.left-e.clientLeft)/o,y:(r.y-i.top-e.clientTop)/a}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),Z={events:null,recognizers:null,recognizerOptions:{},Manager:d,touchAction:"none"},K=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,t),this.options=Object.assign({},Z,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var r=n.events;r&&this.on(r)}return Object(s.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var n=this.options,r=n.Manager;for(var i in this.manager=new r(t,{touchAction:n.touchAction,recognizers:n.recognizers||g}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(y).forEach((function(t){var n=e.manager.get(t);n&&y[t].forEach((function(t){n.recognizeWith(t)}))})),n.recognizerOptions){var a=this.manager.get(i);if(a){var s=n.recognizerOptions[i];delete s.enable,a.set(s)}}this.wheelInput=new k(t,this._onOtherEvent,{enable:!1}),this.moveInput=new O(t,this._onOtherEvent,{enable:!1}),this.keyInput=new M(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new R(t,this._onOtherEvent,{enable:!1});var u=!0,l=!1,c=void 0;try{for(var h,p=this.events[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=Object(o.a)(h.value,2),d=f[0],v=f[1];v.isEmpty()||(this._toggleRecognizer(v.recognizerName,!0),this.manager.on(d,v.handleEvent))}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,n){this._addEventHandler(t,e,n,!1)}},{key:"once",value:function(t,e,n){this._addEventHandler(t,e,n,!0)}},{key:"off",value:function(t,e){this._removeEventHandler(t,e)}},{key:"_toggleRecognizer",value:function(t,e){var n=this.manager;if(n){var r=n.get(t);if(r&&r.options.enable!==e){r.set({enable:e});var i=m[t];i&&!this.options.recognizers&&i.forEach((function(i){var o=n.get(i);e?(o.requireFailure(t),r.dropRequireFailure(i)):o.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,n,r){if("string"==typeof t){var i=this.manager,o=this.events,a=S[t]||t,s=o.get(a);s||(s=new q(this),o.set(a,s),s.recognizerName=E[a]||a,i&&i.on(a,s.handleEvent)),this._toggleRecognizer(s.recognizerName,!0),s.add(t,e,n,r)}else for(var u in n=e,t)this._addEventHandler(u,t[u],n,r)}},{key:"_removeEventHandler",value:function(t,e){if("string"==typeof t){var n=this.events,r=S[t]||t,i=n.get(r);if(i&&(i.remove(t,e),i.isEmpty())){var o=i.recognizerName,a=!1,s=!0,u=!1,l=void 0;try{for(var c,h=n.values()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=c.value;if(p.recognizerName===o&&!p.isEmpty()){a=!0;break}}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}a||this._toggleRecognizer(o,!1)}}else for(var f in t)this._removeEventHandler(f,t[f])}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,n=_[e.type];n&&this.manager.emit(n,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();n.d(e,"EventManager",(function(){return K}))},848:function(t,e,n){"use strict";n.r(e);var r=n(689),i=n(723),o={name:"project32",dependencies:[i.a],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 worldPosition\n) {\n  vec3 projectedPosition = project_position(position);\n  worldPosition = vec4(projectedPosition + offset, 1.0);\n  return project_to_clipspace(worldPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 worldPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, worldPosition);\n}\n"},a=n(758),s=n(757);function u(){Object(r.s)([r.n,r.o,i.a,o,a.a,s.a,r.r]),Object(r.t)([i.a])}n.d(e,"initializeShaderModules",(function(){return u})),n.d(e,"fp32",(function(){return r.n})),n.d(e,"fp64",(function(){return r.o})),n.d(e,"picking",(function(){return r.r})),n.d(e,"project",(function(){return i.a})),n.d(e,"project64",(function(){return a.a})),n.d(e,"lighting",(function(){return s.a})),u()},849:function(t,e,n){"use strict";var r=n(686),i=n(687),o=n(697),a=n(208),s=n(695),u=n(209),l=n(708),c=n(759),h=n(771),p=n(814),f=Object(c.a)(),d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,i=e.height,o=e.viewMatrix,a=void 0===o?f:o,s=e.projectionMatrix,u=void 0===s?f:s;Object(r.a)(this,t),this.width=n||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=u;var l=Object(c.a)();p.c(l,l,this.projectionMatrix),p.c(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var h=Object(c.a)();p.g(h,h,[this.width/2,-this.height/2,1]),p.h(h,h,[1,-1,0]),p.c(h,h,this.viewProjectionMatrix);var d=p.b(Object(c.a)(),h);if(!d)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=d,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(i.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&p.a(e.projectionMatrix,this.projectionMatrix)&&p.a(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),o=Object(h.h)(i,this.pixelProjectionMatrix),a=Object(l.a)(o,2),s=a[0],u=a[1],c=r?u:this.height-u;return 2===t.length?[s,c]:[s,c,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=Object(l.a)(t,3),a=o[0],s=o[1],u=o[2],c=r?s:this.height-s,p=i&&i*this.pixelsPerMeter,f=Object(h.e)([a,c,u],this.pixelUnprojectionMatrix,p),d=this.unprojectPosition(f),v=Object(l.a)(d,3),g=v[0],y=v[1],m=v[2];return Number.isFinite(u)?[g,y,m]:Number.isFinite(i)?[g,y,i]:[g,y]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=Object(l.a)(e,2);return[n[0],n[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=Object(l.a)(e,2);return[n[0],n[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}(),v=n(911),g=n(749);n.d(e,"a",(function(){return y}));var y=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.width,s=n.height,l=n.latitude,c=void 0===l?0:l,p=n.longitude,f=void 0===p?0:p,d=n.zoom,v=void 0===d?0:d,g=n.pitch,y=void 0===g?0:g,m=n.bearing,_=void 0===m?0:m,b=n.altitude,x=void 0===b?1.5:b,w=n.nearZMultiplier,E=n.farZMultiplier;Object(r.a)(this,e),i=i||1,s=s||1;var S=Object(h.i)(v);x=Math.max(.75,x);var A=Object(h.d)([f,c],S);A[2]=0;var T=Object(h.b)({width:i,height:s,pitch:y,bearing:_,altitude:x,nearZMultiplier:w||1/s,farZMultiplier:E||1.01}),P=Object(h.c)({height:s,center:A,pitch:y,bearing:_,altitude:x,flipY:!0});return(t=Object(o.a)(this,Object(a.a)(e).call(this,{width:i,height:s,viewMatrix:P,projectionMatrix:T}))).latitude=c,t.longitude=f,t.zoom=v,t.pitch=y,t.bearing=_,t.altitude=x,t.scale=S,t.center=A,t.pixelsPerMeter=Object(h.a)(Object(u.a)(Object(u.a)(t))).pixelsPerMeter[2],Object.freeze(Object(u.a)(Object(u.a)(t))),t}return Object(s.a)(e,t),Object(i.a)(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.d)(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return Object(h.g)(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,r=Object(h.e)(n,this.pixelUnprojectionMatrix),i=Object(h.d)(e,this.scale),o=g.a([],i,g.e([],r)),a=g.a([],this.center,o);return Object(h.g)(a,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=Object(v.a)(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(d)},850:function(t,e,n){"use strict";var r=n(686),i=n(687),o=n(697),a=n(208),s=n(695),u=n(309),l=n(768),c=function(t){function e(){return Object(r.a)(this,e),Object(o.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(i.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this).check()}},{key:"copy",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t[e];return this.check()}},{key:"set",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=(t<0||arguments.length<=t?void 0:arguments[t])||0;return this.check()}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}},{key:"toString",value:function(){return this.formatString(l.b)}},{key:"formatString",value:function(t){for(var e="",n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+Object(l.d)(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(l.c)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"inverse",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=1/this[t];return this.check()}},{key:"lerp",value:function(t,e,n){void 0===n&&(n=e,e=t,t=this);for(var r=0;r<this.ELEMENTS;++r){var i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"check",value:function(){if(l.b.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){return this.scale(t)}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}}]),e}(Object(u.a)(Array));n.d(e,"a",(function(){return p}));var h=function(t,e){if(!t)throw new Error(e)},p=function(t){function e(){return Object(r.a)(this,e),Object(o.a)(this,Object(a.a)(e).apply(this,arguments))}return Object(s.a)(e,t),Object(i.a)(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-t[n];e+=r*r}return Object(l.a)(e)}},{key:"dot",value:function(t){for(var e=0,n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return Object(l.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]+=i[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]-=i[o];return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]*=i[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<this.ELEMENTS;++o)this[o]/=i[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"scaleAndAdd",value:function(t,e){for(var n=0;n<this.ELEMENTS;++n)this[n]=this[n]*e+t[n];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return h(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(l.a)(this[t])}},{key:"setComponent",value:function(t,e){return h(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Object(l.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Object(l.a)(t)}}]),e}(c)},851:function(t,e,n){(function(e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i="object"!==(void 0===e?"undefined":r(e))||"[object process]"!==String(e)||e.browser;t.exports={window:"undefined"!=typeof window?window:n,global:void 0!==n?n:window,document:"undefined"!=typeof document?document:{},isBrowser:i}}).call(this,n(211),n(23))},852:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(725),a=p(n(853)),s=n(795),u=n(796),l=n(797),c=n(854),h=p(n(855));function p(t){return t&&t.__esModule?t:{default:t}}function f(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var d={debug:o.isBrowser&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},v={enabled:!1,priority:0};function g(){}var y={};var m=function(){function t(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).id;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.id=e,this.VERSION=o.VERSION,this._startTs=(0,s.getTimestamp)(),this._deltaTs=(0,s.getTimestamp)(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new a.default("__probe-"+this.id+"__",v),this.userData={},this.timeStamp(this.id+" started"),(0,c.autobind)(this),Object.seal(this)}return i(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return+((0,s.getTimestamp)()-this._startTs).toPrecision(10)}},{key:"getDelta",value:function(){return+((0,s.getTimestamp)()-this._deltaTs).toPrecision(10)}},{key:"enable",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({priority:t}),this}},{key:"warn",value:function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._getLogFunction({message:t,args:n,method:d.warn,once:!0})}},{key:"error",value:function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._getLogFunction({message:t,args:n,method:d.error})}},{key:"deprecated",value:function(t,e){return this.warn("`"+t+"` is deprecated and will be removed in a later version. Use `"+e+"` instead")}},{key:"removed",value:function(t,e){return this.error("`"+t+"` has been removed. Use `"+e+"` instead")}},{key:"probe",value:function(t,e){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:t,message:e,args:r,method:d.log,time:!0,once:!0})}},{key:"log",value:function(t,e){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:t,message:e,args:r,method:d.debug})}},{key:"info",value:function(t,e){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:t,message:e,args:r,method:console.info})}},{key:"once",value:function(t,e){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:t,message:e,args:r,method:d.debug||d.info,once:!0})}},{key:"table",value:function(t,e,n){if(e){var r=function(t){for(var e in t)for(var n in t[e])return n||"untitled";return"empty"}(e);return this._getLogFunction({priority:t,message:e,args:n&&[n],tag:r,method:console.table||g})}return g}},{key:"image",value:function(t){var e=t.priority,n=t.image,r=t.message,i=void 0===r?"":r,a=t.scale,s=void 0===a?1:a;return e>this.getPriority()?g:o.isBrowser?this._logImageInBrowser({image:n,message:i,scale:s}):this._logImageInNode({image:n,message:i,scale:s})}},{key:"_logImageInNode",value:function(t){var e=t.image,r=(t.message,t.scale),i=void 0===r?1:r,o=null;try{o=n(760)}catch(t){}return o?function(){return o(e,{fit:"box",width:Math.round(80*i)+"%"}).then((function(t){return console.log(t)}))}:g}},{key:"_logImageInBrowser",value:function(t){var e=t.image,n=t.message,r=void 0===n?"":n,i=t.scale,o=void 0===i?1:i;if("string"==typeof e){var a=new Image;return a.onload=function(){var t,e=(0,u.formatImage)(a,r,o);(t=console).log.apply(t,f(e))},a.src=e,g}var s,l=e.nodeName||"";if("img"===l.toLowerCase())return(s=console).log.apply(s,f((0,u.formatImage)(e,r,o))),g;if("canvas"===l.toLowerCase()){var c=new Image;return c.onload=function(){var t;return(t=console).log.apply(t,f((0,u.formatImage)(c,r,o)))},c.src=e.toDataURL(),g}return g}},{key:"time",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeStamp||g})}},{key:"group",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},r=n=this._normalizeArguments({priority:t,message:e,opts:n}),i=r.collapsed;return this._getLogFunction({priority:t,message:e,opts:n,method:(i?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction({priority:t,message:"",method:console.groupEnd||g})}},{key:"withGroup",value:function(t,e,n){var r=this._normalizeArguments({priority:t,message:e});this.group(r);try{n()}finally{this.groupEnd(r.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return 0===(t=this._normalizePriority(t))||this.isEnabled()&&this.getPriority()>=t}},{key:"_getElapsedTime",value:function(){var t=this.getTotal(),e=this.getDelta();return this._deltaTs=(0,s.getTimestamp)(),{total:t,delta:e}}},{key:"_getLogFunction",value:function(t){if(this._shouldLog(t.priority)){var e=t.method;t=this._parseArguments(t),(0,h.default)(e);var n=t.message,r=t.tag||t.message;if(t.once){if(y[r])return g;y[r]=(0,s.getTimestamp)()}return n=this._decorateMessage(n,t),e.bind.apply(e,[console,n].concat(f(t.args)))}return g}},{key:"_parseArguments",value:function(t){var e=this._normalizeArguments(t),n=this._getElapsedTime(),r=n.delta,i=n.total;return Object.assign(t,e,{delta:r,total:i})}},{key:"_normalizePriority",value:function(t){var e;switch(void 0===t?"undefined":r(t)){case"number":e=t;break;case"object":e=t.priority||0;break;default:e=0}return(0,h.default)(Number.isFinite(e)&&0<=e),e}},{key:"_normalizeArguments",value:function(t){var e=t.priority,n=t.message,i=t.args,o=void 0===i?[]:i,a=t.opts,s={priority:this._normalizePriority(e),message:n,args:o};switch(void 0===e?"undefined":r(e)){case"string":case"function":void 0!==n&&o.unshift(n),Object.assign(s,{message:e});break;case"object":Object.assign(s,e)}return"function"==typeof s.message&&(s.message=this._shouldLog(s.priority)?s.message():""),(0,h.default)("string"==typeof s.message||"object"===r(s.message)),Object.assign(s,a)}},{key:"_decorateMessage",value:function(t,e){if("string"==typeof t){var n="";if(e.time){var r=this._getElapsedTime().total;n=(0,u.leftPad)((0,u.formatTime)(r))}t=e.time?this.id+": "+n+"  "+t:this.id+": "+t,t=(0,l.addColor)(t,e.color,e.background)}return t}},{key:"priority",set:function(t){return this._storage.updateConfiguration({priority:t}),this},get:function(){return this._storage.config.priority}}]),t}();e.default=m,m.VERSION=o.VERSION},853:function(t,e,n){"use strict";var r=function(){function t(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"sessionStorage";(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.storage=function(t){try{var e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(t){return null}}(r),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return r(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();e.default=i},854:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.autobind=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=!0,o=!1,a=void 0;try{for(var s,u=function(){var n=s.value;"function"!=typeof t[n]||e.find((function(t){return n===t}))||(t[n]=t[n].bind(t))},l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)u()}catch(t){o=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}}},855:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(!t)throw new Error("Assertion failed. "+e)}},856:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n,r=0;r<e.length;r++)(n=e[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(795),o=n(796);var a=function(){function t(e){var n=e.id;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.id=n,this.time=(0,i.getTimestamp)(),this.counters={},Object.seal(this)}var e=Math.round;return r(t,[{key:"addCounter",value:function(t){return this._getCounter(t),this}},{key:"bump",value:function(t){var e=this._getCounter(t);return e.call++,e.count++,this}},{key:"increment",value:function(t,e){var n=this._getCounter(t);return n.call++,n.count+=e,this}},{key:"addTimer",value:function(t){return this._getCounter(t).time=0,this}},{key:"addTime",value:function(t,e){var n=this._getCounter(t);return n.time+=e,n.count++,this}},{key:"timeStart",value:function(t){this._getCounter(t)._startTime=(0,i.getTimestamp)()}},{key:"timeEnd",value:function(t){var e=this._getCounter(t);this.addTime(t,(0,i.getTimestamp)()-e._startTime)}},{key:"reset",value:function(){for(var t in this.time=(0,i.getTimestamp)(),this.counters){var e=this.counters[t];e.count=0,e.time=0}return this}},{key:"hasTimeElapsed",value:function(){return!(0<arguments.length&&void 0!==arguments[0])||arguments[0],1e3<(0,i.getTimestamp)()-this.time}},{key:"getStats",value:function(){var t=((0,i.getTimestamp)()-this.time)/1e3,n={};for(var r in this.counters){var a=this.counters[r];n[a.title]={total:a.count,fps:e(a.count/t)},a.time&&(n[a.title].totalTime=(0,o.formatTime)(a.time),n[a.title].avgTime=(0,o.formatTime)(a.time/a.count))}return n}},{key:"getStatsTable",value:function(){var t=this.getStats();for(var e in t)0===t[e].total&&delete t[e];return t}},{key:"getStatNames",value:function(){return Object.keys(this.counters)}},{key:"get",value:function(t){return this._getCounter(t).count}},{key:"getCount",value:function(t){return this._getCounter(t).count}},{key:"getFPS",value:function(t){var n=this._getCounter(t),r=((0,i.getTimestamp)()-this.time)/1e3;return e(n.count/r)}},{key:"getTimeString",value:function(){return this.id+":"+(0,o.formatTime)(this.time)+"("+this.count+")"}},{key:"oneSecondPassed",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3;return this.hasTimeElapsed(t)}},{key:"_getCounter",value:function(t){var e=this.counters[t];return e||(e={title:t,unit:"",timer:!1,count:0,time:0,totalTime:0,averageTime:0},this.counters[t]=e),e}},{key:"_incrementTimer",value:function(t,e,n){t.count+=n,t.totalTime+=e,t.averageTime=t.totalTime/n}}]),t}();e.default=a},857:function(t,e,n){"use strict";n(725).global.probe={}},858:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.enableDOMLogging=o,e.logLineToDOM=s;var r=n(725),i=null;function o(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];t&&!i&&(i=r.console.log.bind(r.console),r.console.log=function(){s.apply(void 0,arguments),i.apply(void 0,arguments)}),!t&&i&&(r.console.log=i,i=null)}var a=null;function s(t){if(!a){var e=r.global.probe.markdown;a=r.document.createElement(e?"pre":"div")}var n=r.document.body.childNodes;r.document.body.insertBefore(a,n&&n[0]),"string"==typeof t&&(a.innerHTML+=t+"<br />")}e.default=o},859:function(t,e,n){"use strict";(function(t){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}e.a="undefined"!=typeof window&&"object"===n(window.process)&&"renderer"===window.process.type||!(void 0===t||"object"!==n(t.versions)||!Boolean(t.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":n(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n(211))},860:function(t,e){t.exports=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}},861:function(t,e,n){t.exports=function(t,e){var n=r(t[0],t[1],t[2]),a=r(e[0],e[1],e[2]);i(n,n),i(a,a);var s=o(n,a);return s>1?0:Math.acos(s)};var r=n(862),i=n(799),o=n(800)},862:function(t,e){t.exports=function(t,e,n){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=n,r}},863:function(t,e){t.exports=function(t,e,n,r){var i=n[1],o=n[2],a=e[1]-i,s=e[2]-o,u=Math.sin(r),l=Math.cos(r);return t[0]=e[0],t[1]=i+a*l-s*u,t[2]=o+a*u+s*l,t}},864:function(t,e){t.exports=function(t,e,n,r){var i=n[0],o=n[2],a=e[0]-i,s=e[2]-o,u=Math.sin(r),l=Math.cos(r);return t[0]=i+s*u+a*l,t[1]=e[1],t[2]=o+s*l-a*u,t}},865:function(t,e){t.exports=function(t,e,n,r){var i=n[0],o=n[1],a=e[0]-i,s=e[1]-o,u=Math.sin(r),l=Math.cos(r);return t[0]=i+a*l-s*u,t[1]=o+a*u+s*l,t[2]=e[2],t}},866:function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],v=t[14],g=t[15];return(e*a-n*o)*(h*g-p*v)-(e*s-r*o)*(c*g-p*d)+(e*u-i*o)*(c*v-h*d)+(n*s-r*a)*(l*g-p*f)-(n*u-i*a)*(l*v-h*f)+(r*u-i*s)*(l*d-c*f)}},867:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,h=r*s,p=i*a,f=i*s,d=i*u,v=o*a,g=o*s,y=o*u;return t[0]=1-h-d,t[1]=c+y,t[2]=p-g,t[3]=0,t[4]=c-y,t[5]=1-l-d,t[6]=f+v,t[7]=0,t[8]=p+g,t[9]=f-v,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},868:function(t,e){t.exports=function(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}},869:function(t,e){t.exports=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},870:function(t,e){t.exports=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}},871:function(t,e){t.exports=function(t,e,n,r){var i,o,a,s,u,l,c,h,p,f,d,v,g,y,m,_,b,x,w,E,S,A,T,P,k=r[0],C=r[1],O=r[2],I=Math.sqrt(k*k+C*C+O*O);if(Math.abs(I)<1e-6)return null;k*=I=1/I,C*=I,O*=I,i=Math.sin(n),o=Math.cos(n),a=1-o,s=e[0],u=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],d=e[7],v=e[8],g=e[9],y=e[10],m=e[11],_=k*k*a+o,b=C*k*a+O*i,x=O*k*a-C*i,w=k*C*a-O*i,E=C*C*a+o,S=O*C*a+k*i,A=k*O*a+C*i,T=C*O*a-k*i,P=O*O*a+o,t[0]=s*_+h*b+v*x,t[1]=u*_+p*b+g*x,t[2]=l*_+f*b+y*x,t[3]=c*_+d*b+m*x,t[4]=s*w+h*E+v*S,t[5]=u*w+p*E+g*S,t[6]=l*w+f*E+y*S,t[7]=c*w+d*E+m*S,t[8]=s*A+h*T+v*P,t[9]=u*A+p*T+g*P,t[10]=l*A+f*T+y*P,t[11]=c*A+d*T+m*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t}},872:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}},873:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}},874:function(t,e){t.exports=function(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}},875:function(t,e){t.exports=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}},876:function(t,e,n){t.exports=n(877)},877:function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}},878:function(t,e,n){t.exports=n(879)},879:function(t,e){t.exports=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}},880:function(t,e,n){t.exports=n(881)},881:function(t,e){t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}},882:function(t,e,n){var r=n(800),i=n(801),o=n(803),a=n(799),s=n(804),u=n(805);t.exports=function(t,e,n){var p=r(e,n);return p<-.999999?(i(l,c,e),o(l)<1e-6&&i(l,h,e),a(l,l),u(t,l,Math.PI),t):p>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(i(l,e,n),t[0]=l[0],t[1]=l[1],t[2]=l[2],t[3]=1+p,s(t,t))};var l=[0,0,0],c=[1,0,0],h=[0,1,0]},883:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;a>0&&(a=1/Math.sqrt(a),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a);return t}},884:function(t,e,n){t.exports=n(885)},885:function(t,e){t.exports=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}},886:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}},887:function(t,e){t.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}},888:function(t,e){t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}},889:function(t,e,n){t.exports=n(890)},890:function(t,e){t.exports=function(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}},891:function(t,e){t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+a*s+i*l-o*u,t[1]=i*c+a*u+o*s-r*l,t[2]=o*c+a*l+r*u-i*s,t[3]=a*c-r*s-i*u-o*l,t}},892:function(t,e){t.exports=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}},893:function(t,e){t.exports=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}},894:function(t,e){t.exports=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}},895:function(t,e,n){t.exports=n(806)},896:function(t,e,n){t.exports=n(897)},897:function(t,e){t.exports=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}},898:function(t,e){t.exports=function(t,e,n,r){var i,o,a,s,u,l=e[0],c=e[1],h=e[2],p=e[3],f=n[0],d=n[1],v=n[2],g=n[3];(o=l*f+c*d+h*v+p*g)<0&&(o=-o,f=-f,d=-d,v=-v,g=-g);1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r);return t[0]=s*l+u*f,t[1]=s*c+u*d,t[2]=s*h+u*v,t[3]=s*p+u*g,t}},899:function(t,e){t.exports=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}},900:function(t,e){t.exports=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}},901:function(t,e){t.exports=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}},902:function(t,e,n){"use strict";(function(t){var r=n(903),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=!("object"===(void 0===t?"undefined":i(t))&&"[object process]"===String(t)&&!t.browser)||r.a;e.a=o}).call(this,n(211))},903:function(t,e,n){"use strict";(function(t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.a="undefined"!=typeof window&&"object"===n(window.process)&&"renderer"===window.process.type||!(void 0===t||"object"!==n(t.versions)||!Boolean(t.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":n(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n(211))},904:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var r="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",i="undefined"!=typeof window?window:t;void 0!==t||window,"undefined"!=typeof document&&document}).call(this,n(23))},905:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,u,l,c,f,d,g=e&&e.length,y=g?e[0]*n:t.length,m=i(t,0,y,n,!0),_=[];if(!m||m.next===m.prev)return _;if(g&&(m=function(t,e,n,r){var a,s,u,l,c,f=[];for(a=0,s=e.length;a<s;a++)u=e[a]*r,l=a<s-1?e[a+1]*r:t.length,(c=i(t,u,l,r,!1))===c.next&&(c.steiner=!0),f.push(v(c));for(f.sort(h),a=0;a<f.length;a++)p(f[a],n),n=o(n,n.next);return n}(t,e,m,n)),t.length>80*n){r=u=t[0],s=l=t[1];for(var b=n;b<y;b+=n)(c=t[b])<r&&(r=c),(f=t[b+1])<s&&(s=f),c>u&&(u=c),f>l&&(l=f);d=0!==(d=Math.max(u-r,l-s))?1/d:0}return a(m,_,n,r,s,d),_}function i(t,e,n,r,i){var o,a;if(i===k(t,e,n,r)>0)for(o=e;o<n;o+=r)a=A(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=A(o,t[o],t[o+1],a);return a&&_(a,a.next)&&(T(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(T(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,p){if(t){!p&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=d(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,h);for(var f,v,g=t;t.prev!==t.next;)if(f=t.prev,v=t.next,h?u(t,r,i,h):s(t))e.push(f.i/n),e.push(t.i/n),e.push(v.i/n),T(t),t=v.next,g=v.next;else if((t=v)===g){p?1===p?a(t=l(o(t),e,n),e,n,r,i,h,2):2===p&&c(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(m(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(g(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(m(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=d(s,u,e,n,r),p=d(l,c,e,n,r),f=t.prevZ,v=t.nextZ;f&&f.z>=h&&v&&v.z<=p;){if(f!==t.prev&&f!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==t.prev&&v!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=p;){if(v!==t.prev&&v!==t.next&&g(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&m(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function l(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!_(i,a)&&b(i,r,r.next,a)&&E(i,a)&&E(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),T(r),T(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function c(t,e,n,r,i,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&y(u,l)){var c=S(u,l);return u=o(u,u.next),c=o(c,c.next),a(u,e,n,r,i,s),void a(c,e,n,r,i,s)}l=l.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&g(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),E(r,t)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&f(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(t,e)){var n=S(e,t);o(n,n.next)}}function f(t,e){return(m(t.prev,t,e.prev)<0||m(e.prev,t,t.next)<0)&&(m(t.prev,t,e.next)<0||m(e.next,t,t.next)<0)}function d(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function g(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(m(t.prev,t,e.prev)||m(t,e.prev,e))||_(t,e)&&m(t.prev,t,t.next)>0&&m(e.prev,e,e.next)>0)}function m(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){var i=w(m(t,e,n)),o=w(m(t,e,r)),a=w(m(n,r,t)),s=w(m(n,r,e));return i!==o&&a!==s||(!(0!==i||!x(t,n,e))||(!(0!==o||!x(t,r,e))||(!(0!==a||!x(n,t,r))||!(0!==s||!x(n,e,r)))))}function x(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function w(t){return t>0?1:t<0?-1:0}function E(t,e){return m(t.prev,t,t.next)<0?m(t,e,t.next)>=0&&m(t,t.prev,e)>=0:m(t,e,t.prev)<0||m(t,t.next,e)<0}function S(t,e){var n=new P(t.i,t.x,t.y),r=new P(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function A(t,e,n,r){var i=new P(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(k(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(k(t,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},906:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(t,n):{};r.get||r.set?Object.defineProperty(e,n,r):e[n]=t[n]}return e.default=t,e}(n(0)),i=u(n(2)),o=u(n(812)),a=n(907),s=n(685);function u(t){return t&&t.__esModule?t:{default:t}}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var v=Object.assign({},s.Deck.getPropTypes(i.default),{viewports:i.default.array,viewport:i.default.object}),g=s.Deck.defaultProps,y=function(t){function e(t){var n;return h(this,e),(n=function(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?d(t):e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).state={},n.children=[],(0,o.default)(d(n)),n}var n,i,u;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");f(t.prototype,e&&e.prototype),e&&f(t,e)}(e,t),n=e,(i=[{key:"componentDidMount",value:function(){this.deck=new s.Deck(Object.assign({},this.props,{canvas:this.deckCanvas,viewState:this._getViewState(this.props),onViewStateChange:this._onViewStateChange,onResize:this._onResize})),this._updateFromProps(this.props)}},{key:"componentWillReceiveProps",value:function(t){this._updateFromProps(t)}},{key:"componentWillUnmount",value:function(){this.deck.finalize()}},{key:"pickObject",value:function(t){var e=t.x,n=t.y,r=t.radius,i=void 0===r?0:r,o=t.layerIds,a=void 0===o?null:o;return this.deck.pickObject({x:e,y:n,radius:i,layerIds:a})}},{key:"pickMultipleObjects",value:function(t){var e=t.x,n=t.y,r=t.radius,i=void 0===r?0:r,o=t.layerIds,a=void 0===o?null:o,s=t.depth,u=void 0===s?10:s;return this.deck.pickMultipleObjects({x:e,y:n,radius:i,layerIds:a,depth:u})}},{key:"pickObjects",value:function(t){var e=t.x,n=t.y,r=t.width,i=void 0===r?1:r,o=t.height,a=void 0===o?1:o,s=t.layerIds,u=void 0===s?null:s;return this.deck.pickObjects({x:e,y:n,width:i,height:a,layerIds:u})}},{key:"queryObject",value:function(t){return s.log.deprecated("queryObject","pickObject")(),this.deck.pickObject(t)}},{key:"queryVisibleObjects",value:function(t){return s.log.deprecated("queryVisibleObjects","pickObjects")(),this.pickObjects(t)}},{key:"_onResize",value:function(){var t;this.props.onResize&&(t=this.props).onResize.apply(t,arguments),this.forceUpdate()}},{key:"_onViewStateChange",value:function(){var t;this.props.onViewStateChange&&(t=this.props).onViewStateChange.apply(t,arguments),this.forceUpdate()}},{key:"_updateFromProps",value:function(t){var e=this._extractJSXLayers(t.children),n=e.layers,r=e.children;this.deck&&this.deck.setProps(Object.assign({},t,{views:this._getViews(t),viewState:this._getViewState(t),layers:n?c(n).concat(c(t.layers)):t.layers})),this.children=r}},{key:"_getViews",value:function(t){return t.viewports&&s.log.deprecated("DeckGL.viewports","DeckGL.views")(),t.viewport&&s.log.deprecated("DeckGL.viewport","DeckGL.views")(),t.views||t.viewports||t.viewport&&[t.viewport]}},{key:"_getViewState",value:function(t){var e=t.viewState;if(!e&&"latitude"in t&&"longitude"in t&&"zoom"in t){var n=t.latitude,r=t.longitude,i=t.zoom,o=t.pitch,a=void 0===o?0:o,s=t.bearing,u=void 0===s?0:s;e=t.viewState||{latitude:n,longitude:r,zoom:i,pitch:a,bearing:u}}return e}},{key:"_extractJSXLayers",value:function(t){var e=[],n=null;return r.default.Children.forEach(t,(function(t){if(t){var r=t.type;if((0,a.inheritsFrom)(r,s.Layer)){var i=new r(t.props);(n=n||[]).push(i)}else e.push(t)}})),{layers:n,children:e}}},{key:"_renderChildrenUnderViews",value:function(t){var e=this,n=this.deck?this.deck.getViewports():[],r={};return n.forEach((function(t){t.id&&(r[t.id]=t)})),t.map((function(t,n){return t.props.viewId||t.props.viewId?e._positionChild({child:t,viewMap:r,i:n}):t}))}},{key:"_positionChild",value:function(t){var e=t.child,n=t.viewMap,i=t.i,o=e.props,a=o.viewId,u=o.viewportId;u&&s.log.deprecated("viewportId","viewId")();var l=n[a||u];if(!l)return null;var c=l.x,h=l.y,p=l.width,f=l.height,d=Object.assign({},e.props,{width:p,height:f});Object.assign(d,l.getMercatorParams(),{visible:l.isMapSynched()});var v=(0,r.cloneElement)(e,d),g={position:"absolute",left:c,top:h,width:p,height:f},y="view-child-".concat(a,"-").concat(i);return(0,r.createElement)("div",{key:y,id:y,style:g},v)}},{key:"render",value:function(){var t=this,e=this._renderChildrenUnderViews(this.children),n=this.props.id,i=Object.assign({},{position:"absolute",left:0,top:0},this.props.style),o=(0,r.createElement)("canvas",{ref:function(e){return t.deckCanvas=e},key:"deck-canvas",id:n,style:i});return e.push(o),(0,r.createElement)("div",{id:"deckgl-wrapper"},e)}}])&&p(n.prototype,i),u&&p(n,u),e}(r.default.Component);e.default=y,y.propTypes=v,y.defaultProps=g},907:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inheritsFrom=function(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}},908:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(0),i=u(n(2)),o=n(845),a=n(685),s=u(n(910));function u(t){return t&&t.__esModule?t:{default:t}}function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(n=t,!(null!=(r=e)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r))throw new TypeError("Cannot call a class as a function");var n,r}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d={viewportState:i.default.func,state:i.default.object,width:i.default.number.isRequired,height:i.default.number.isRequired,longitude:i.default.number.isRequired,latitude:i.default.number.isRequired,zoom:i.default.number.isRequired,bearing:i.default.number,pitch:i.default.number,altitude:i.default.number,position:i.default.array,maxZoom:i.default.number,minZoom:i.default.number,maxPitch:i.default.number,minPitch:i.default.number,onViewportChange:i.default.func,transitionDuration:i.default.number,transitionInterpolator:i.default.object,transitionInterruption:i.default.number,transitionEasing:i.default.func,onTransitionStart:i.default.func,onTransitionInterrupt:i.default.func,onTransitionEnd:i.default.func,scrollZoom:i.default.bool,dragPan:i.default.bool,dragRotate:i.default.bool,doubleClickZoom:i.default.bool,touchZoomRotate:i.default.bool,getCursor:i.default.func,controls:i.default.shape({events:i.default.arrayOf(i.default.string),handleEvent:i.default.func})},v={onViewportChange:null,scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoomRotate:!0,getCursor:function(t){return t.isDragging?s.default.GRABBING:s.default.GRAB}},g=function(t){function e(t){var n;return c(this,e),(n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))).state={isDragging:!1},n}var n,i,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");f(t.prototype,e&&e.prototype),e&&f(t,e)}(e,t),n=e,(i=[{key:"componentDidMount",value:function(){this._eventManager=new o.EventManager(this.eventCanvas),this._controls=this.props.controls||new a.MapController(this.props.viewportState),this._controls.setOptions(Object.assign({},this.props,{onStateChange:this._onInteractiveStateChange.bind(this),eventManager:this._eventManager}))}},{key:"componentWillUpdate",value:function(t){this._controls&&this._controls.setOptions(t)}},{key:"componentWillUnmount",value:function(){this._eventManager.destroy()}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,n=void 0!==e&&e;n!==this.state.isDragging&&this.setState({isDragging:n})}},{key:"render",value:function(){var t=this,e=this.props,n={width:e.width,height:e.height,position:"relative",cursor:(0,e.getCursor)(this.state)};return(0,r.createElement)("div",{key:"map-controls",ref:function(e){return t.eventCanvas=e},style:n},this.props.children)}}])&&h(n.prototype,i),s&&h(n,s),e}(r.Component);e.default=g,g.displayName="ViewportController",g.propTypes=d,g.defaultProps=v},909:function(t,e,n){"use strict";(function(t){n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var r="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i="undefined"!=typeof window?window:t,o=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var a={get passive(){return o=!0,!0}};i.addEventListener("test",a,a),i.removeEventListener("test",a,a)}catch(t){}}).call(this,n(23))},910:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={GRABBING:"".concat("-webkit-","grabbing"),GRAB:"".concat("-webkit-","grab"),POINTER:"pointer"};e.default=r},911:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(708),i=n(849),o=n(813);function a(t){var e=t.width,n=t.height,a=t.bounds,s=t.minExtent,u=void 0===s?0:s,l=t.maxZoom,c=void 0===l?24:l,h=t.padding,p=void 0===h?0:h,f=t.offset,d=void 0===f?[0,0]:f,v=Object(r.a)(a,2),g=Object(r.a)(v[0],2),y=g[0],m=g[1],_=Object(r.a)(v[1],2),b=_[0],x=_[1];if(Number.isFinite(p)){p={top:p,bottom:p,left:p,right:p}}else Object(o.a)(Number.isFinite(p.top)&&Number.isFinite(p.bottom)&&Number.isFinite(p.left)&&Number.isFinite(p.right));var w=new i.a({width:e,height:n,longitude:0,latitude:0,zoom:0}),E=w.project([y,x]),S=w.project([b,m]),A=[Math.max(Math.abs(S[0]-E[0]),u),Math.max(Math.abs(S[1]-E[1]),u)],T=[e-p.left-p.right-2*Math.abs(d[0]),n-p.top-p.bottom-2*Math.abs(d[1])];Object(o.a)(T[0]>0&&T[1]>0);var P=T[0]/A[0],k=T[1]/A[1],C=(p.right-p.left)/2/P,O=(p.bottom-p.top)/2/k,I=[(S[0]+E[0])/2+C,(S[1]+E[1])/2+O],M=w.unproject(I),R=w.zoom+Math.log2(Math.abs(Math.min(P,k)));return{longitude:M[0],latitude:M[1],zoom:Math.min(R,c)}}},912:function(t,e,n){"use strict";(function(t){var r=n(0);function i(e){var n;n="undefined"!=typeof window?window:"undefined"!=typeof self?self:t;var r,i,o="undefined"!=typeof document&&document.attachEvent;if(!o){var a=(i=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(t){return n.setTimeout(t,20)},function(t){return i(t)}),s=(r=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout,function(t){return r(t)}),u=function(t){var e=t.__resizeTriggers__,n=e.firstElementChild,r=e.lastElementChild,i=n.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,i.style.width=n.offsetWidth+1+"px",i.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},l=function(t){if(!(t.target.className.indexOf("contract-trigger")<0&&t.target.className.indexOf("expand-trigger")<0)){var e=this;u(this),this.__resizeRAF__&&s(this.__resizeRAF__),this.__resizeRAF__=a((function(){(function(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height})(e)&&(e.__resizeLast__.width=e.offsetWidth,e.__resizeLast__.height=e.offsetHeight,e.__resizeListeners__.forEach((function(n){n.call(e,t)})))}))}},c=!1,h="",p="animationstart",f="Webkit Moz O ms".split(" "),d="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(c=!0),!1===c)for(var g=0;g<f.length;g++)if(void 0!==v.style[f[g]+"AnimationName"]){h="-"+f[g].toLowerCase()+"-",p=d[g],c=!0;break}var y="resizeanim",m="@"+h+"keyframes "+y+" { from { opacity: 0; } to { opacity: 0; } } ",_=h+"animation: 1ms "+y+"; "}return{addResizeListener:function(t,r){if(o)t.attachEvent("onresize",r);else{if(!t.__resizeTriggers__){var i=t.ownerDocument,a=n.getComputedStyle(t);a&&"static"==a.position&&(t.style.position="relative"),function(t){if(!t.getElementById("detectElementResize")){var n=(m||"")+".resize-triggers { "+(_||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',r=t.head||t.getElementsByTagName("head")[0],i=t.createElement("style");i.id="detectElementResize",i.type="text/css",null!=e&&i.setAttribute("nonce",e),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n)),r.appendChild(i)}}(i),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=i.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),u(t),t.addEventListener("scroll",l,!0),p&&(t.__resizeTriggers__.__animationListener__=function(e){e.animationName==y&&u(t)},t.__resizeTriggers__.addEventListener(p,t.__resizeTriggers__.__animationListener__))}t.__resizeListeners__.push(r)}},removeResizeListener:function(t,e){if(o)t.detachEvent("onresize",e);else if(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),!t.__resizeListeners__.length){t.removeEventListener("scroll",l,!0),t.__resizeTriggers__.__animationListener__&&(t.__resizeTriggers__.removeEventListener(p,t.__resizeTriggers__.__animationListener__),t.__resizeTriggers__.__animationListener__=null);try{t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)}catch(t){}}}}}var o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=function(t){function e(){var t,n,r;o(this,e);for(var i=arguments.length,a=Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r=u(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),r.state={height:r.props.defaultHeight||0,width:r.props.defaultWidth||0},r._onResize=function(){var t=r.props,e=t.disableHeight,n=t.disableWidth,i=t.onResize;if(r._parentNode){var o=r._parentNode.offsetHeight||0,a=r._parentNode.offsetWidth||0,s=window.getComputedStyle(r._parentNode)||{},u=parseInt(s.paddingLeft,10)||0,l=parseInt(s.paddingRight,10)||0,c=parseInt(s.paddingTop,10)||0,h=parseInt(s.paddingBottom,10)||0,p=o-c-h,f=a-u-l;(!e&&r.state.height!==p||!n&&r.state.width!==f)&&(r.setState({height:o-c-h,width:a-u-l}),i({height:o,width:a}))}},r._setRef=function(t){r._autoSizer=t},u(r,n)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"componentDidMount",value:function(){var t=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=i(t),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var t=this.props,e=t.children,n=t.className,i=t.disableHeight,o=t.disableWidth,a=t.style,u=this.state,l=u.height,c=u.width,h={overflow:"visible"},p={},f=!1;return i||(0===l&&(f=!0),h.height=0,p.height=l),o||(0===c&&(f=!0),h.width=0,p.width=c),Object(r.createElement)("div",{className:n,ref:this._setRef,style:s({},h,a)},!f&&e(p))}}]),e}(r.PureComponent);l.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}},e.a=l}).call(this,n(23))},913:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return p}));var r=n(686),i=n(687),o=n(696),a=n(2),s=n.n(a),u=n(772);var l={container:s.a.object,gl:s.a.object,mapboxApiAccessToken:s.a.string,mapboxApiUrl:s.a.string,attributionControl:s.a.bool,preserveDrawingBuffer:s.a.bool,reuseMaps:s.a.bool,transformRequest:s.a.func,mapOptions:s.a.object,mapStyle:s.a.oneOfType([s.a.string,s.a.object]),visible:s.a.bool,asyncRender:s.a.bool,onLoad:s.a.func,onError:s.a.func,width:s.a.number,height:s.a.number,viewState:s.a.object,longitude:s.a.number,latitude:s.a.number,zoom:s.a.number,bearing:s.a.number,pitch:s.a.number,altitude:s.a.number},c={container:u.a.body,mapboxApiAccessToken:function(){var e=null;if("undefined"!=typeof window&&window.location){var n=window.location.search.match(/access_token=([^&\/]*)/);e=n&&n[1]}e||void 0===t||(e=e||Object({NODE_ENV:"production",NODE_PATH:"",PUBLIC_URL:"."}).MapboxAccessToken||Object({NODE_ENV:"production",NODE_PATH:"",PUBLIC_URL:"."}).REACT_APP_MAPBOX_ACCESS_TOKEN);return e||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:function(){},onError:function(t){t&&console.error(t.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0};function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component";t.debug&&s.a.checkPropTypes(l,t,"prop",e)}var p=function(){function t(e){var n=this;if(Object(r.a)(this,t),Object(o.a)(this,"mapboxgl",void 0),Object(o.a)(this,"props",c),Object(o.a)(this,"_map",null),Object(o.a)(this,"width",0),Object(o.a)(this,"height",0),Object(o.a)(this,"_fireLoadEvent",(function(){n.props.onLoad({type:"load",target:n._map})})),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Object(i.a)(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),r=e.container;for(r.classList.add("mapboxgl-map");n.childNodes.length>0;)r.appendChild(n.childNodes[0]);this._map._container=r,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var r={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(r.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},r,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(t){var e=this;h(t=Object.assign({},c,t),"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||c.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t.container;Object.defineProperty(n,"offsetWidth",{get:function(){return e.width}}),Object.defineProperty(n,"clientWidth",{get:function(){return e.width}}),Object.defineProperty(n,"offsetHeight",{get:function(){return e.height}}),Object.defineProperty(n,"clientHeight",{get:function(){return e.height}});var r=this._map.getCanvas();r&&(r.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,e){if(this._map){h(e=Object.assign({},this.props,e),"Mapbox");var n=this._updateMapViewport(t,e),r=this._updateMapSize(t,e);e.asyncRender||!n&&!r||this.redraw(),this.props=e}}},{key:"_updateMapSize",value:function(t,e){var n=t.width!==e.width||t.height!==e.height;return n&&(this.width=e.width,this.height=e.height,this.resize()),n}},{key:"_updateMapViewport",value:function(t,e){var n=this._getViewState(t),r=this._getViewState(e),i=r.latitude!==n.latitude||r.longitude!==n.longitude||r.zoom!==n.zoom||r.pitch!==n.pitch||r.bearing!==n.bearing||r.altitude!==n.altitude;return i&&(this._map.jumpTo(this._viewStateToMapboxProps(r)),r.altitude!==n.altitude&&(this._map.transform.altitude=r.altitude)),i}},{key:"_getViewState",value:function(t){var e=t.viewState||t,n=e.longitude,r=e.latitude,i=e.zoom,o=e.pitch,a=void 0===o?0:o,s=e.bearing,u=void 0===s?0:s,l=e.altitude;return{longitude:n,latitude:r,zoom:i,pitch:a,bearing:u,altitude:void 0===l?1.5:l}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==u.a)try{var e=u.a.createElement("div");e.className="mapboxgl-map",e.style.display="none",u.a.body.append(e);var n="static"!==window.getComputedStyle(e).position;if(!n){var r=u.a.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),u.a.head.append(r)}}catch(t){}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),t}();Object(o.a)(p,"initialized",!1),Object(o.a)(p,"propTypes",l),Object(o.a)(p,"defaultProps",c),Object(o.a)(p,"savedMap",null)}).call(this,n(211))},914:function(t,e,n){(t.exports=n(333)(!1)).push([t.i,".mapboxgl-map {\n    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n    overflow: hidden;\n    position: relative;\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.mapboxgl-map:-webkit-full-screen {\n    width: 100%;\n    height: 100%;\n}\n\n.mapboxgl-canary {\n    background-color: salmon;\n}\n\n.mapboxgl-canvas-container.mapboxgl-interactive,\n.mapboxgl-ctrl-group > button.mapboxgl-ctrl-compass {\n    cursor: -webkit-grab;\n    cursor: grab;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\n.mapboxgl-canvas-container.mapboxgl-interactive:active,\n.mapboxgl-ctrl-group > button.mapboxgl-ctrl-compass:active {\n    cursor: -webkit-grabbing;\n    cursor: grabbing;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas {\n    touch-action: pan-x pan-y;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,\n.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas {\n    touch-action: pinch-zoom;\n}\n\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,\n.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {\n    touch-action: none;\n}\n\n.mapboxgl-ctrl-top-left,\n.mapboxgl-ctrl-top-right,\n.mapboxgl-ctrl-bottom-left,\n.mapboxgl-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.mapboxgl-ctrl-top-left     { top: 0; left: 0; }\n.mapboxgl-ctrl-top-right    { top: 0; right: 0; }\n.mapboxgl-ctrl-bottom-left  { bottom: 0; left: 0; }\n.mapboxgl-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.mapboxgl-ctrl { clear: both; pointer-events: auto; }\n.mapboxgl-ctrl-top-left .mapboxgl-ctrl     { margin: 10px 0 0 10px; float: left; }\n.mapboxgl-ctrl-top-right .mapboxgl-ctrl    { margin: 10px 10px 0 0; float: right; }\n.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl  { margin: 0 0 10px 10px; float: left; }\n.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl { margin: 0 10px 10px 0; float: right; }\n\n.mapboxgl-ctrl-group {\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n}\n\n.mapboxgl-ctrl-group:not(:empty) {\n    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);\n}\n\n.mapboxgl-ctrl-group > button {\n    width: 30px;\n    height: 30px;\n    display: block;\n    padding: 0;\n    outline: none;\n    border: 0;\n    box-sizing: border-box;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n.mapboxgl-ctrl-group > button + button {\n    border-top: 1px solid #ddd;\n}\n\n/* https://bugzilla.mozilla.org/show_bug.cgi?id=140562 */\n.mapboxgl-ctrl > button::-moz-focus-inner {\n    border: 0;\n    padding: 0;\n}\n\n.mapboxgl-ctrl > button:hover {\n    background-color: rgba(0, 0, 0, 0.05);\n}\n\n.mapboxgl-ctrl-icon,\n.mapboxgl-ctrl-icon > .mapboxgl-ctrl-compass-arrow {\n    speak: none;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n.mapboxgl-ctrl-icon {\n    padding: 5px;\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-zoom-out {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath style='fill:%23333333;' d='m 7,9 c -0.554,0 -1,0.446 -1,1 0,0.554 0.446,1 1,1 l 6,0 c 0.554,0 1,-0.446 1,-1 0,-0.554 -0.446,-1 -1,-1 z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-zoom-in {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath style='fill:%23333333;' d='M 10 6 C 9.446 6 9 6.4459904 9 7 L 9 9 L 7 9 C 6.446 9 6 9.446 6 10 C 6 10.554 6.446 11 7 11 L 9 11 L 9 13 C 9 13.55401 9.446 14 10 14 C 10.554 14 11 13.55401 11 13 L 11 11 L 13 11 C 13.554 11 14 10.554 14 10 C 14 9.446 13.554 9 13 9 L 11 9 L 11 7 C 11 6.4459904 10.554 6 10 6 z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10 4C9 4 9 5 9 5L9 5.1A5 5 0 0 0 5.1 9L5 9C5 9 4 9 4 10 4 11 5 11 5 11L5.1 11A5 5 0 0 0 9 14.9L9 15C9 15 9 16 10 16 11 16 11 15 11 15L11 14.9A5 5 0 0 0 14.9 11L15 11C15 11 16 11 16 10 16 9 15 9 15 9L14.9 9A5 5 0 0 0 11 5.1L11 5C11 5 11 4 10 4zM10 6.5A3.5 3.5 0 0 1 13.5 10 3.5 3.5 0 0 1 10 13.5 3.5 3.5 0 0 1 6.5 10 3.5 3.5 0 0 1 10 6.5zM10 8.3A1.8 1.8 0 0 0 8.3 10 1.8 1.8 0 0 0 10 11.8 1.8 1.8 0 0 0 11.8 10 1.8 1.8 0 0 0 10 8.3z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate:disabled {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E %3Cpath d='M10 4C9 4 9 5 9 5L9 5.1A5 5 0 0 0 5.1 9L5 9C5 9 4 9 4 10 4 11 5 11 5 11L5.1 11A5 5 0 0 0 9 14.9L9 15C9 15 9 16 10 16 11 16 11 15 11 15L11 14.9A5 5 0 0 0 14.9 11L15 11C15 11 16 11 16 10 16 9 15 9 15 9L14.9 9A5 5 0 0 0 11 5.1L11 5C11 5 11 4 10 4zM10 6.5A3.5 3.5 0 0 1 13.5 10 3.5 3.5 0 0 1 10 13.5 3.5 3.5 0 0 1 6.5 10 3.5 3.5 0 0 1 10 6.5zM10 8.3A1.8 1.8 0 0 0 8.3 10 1.8 1.8 0 0 0 10 11.8 1.8 1.8 0 0 0 11.8 10 1.8 1.8 0 0 0 10 8.3z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5L9 5.1A5 5 0 0 0 5.1 9L5 9C5 9 4 9 4 10 4 11 5 11 5 11L5.1 11A5 5 0 0 0 9 14.9L9 15C9 15 9 16 10 16 11 16 11 15 11 15L11 14.9A5 5 0 0 0 14.9 11L15 11C15 11 16 11 16 10 16 9 15 9 15 9L14.9 9A5 5 0 0 0 11 5.1L11 5C11 5 11 4 10 4zM10 6.5A3.5 3.5 0 0 1 13.5 10 3.5 3.5 0 0 1 10 13.5 3.5 3.5 0 0 1 6.5 10 3.5 3.5 0 0 1 10 6.5zM10 8.3A1.8 1.8 0 0 0 8.3 10 1.8 1.8 0 0 0 10 11.8 1.8 1.8 0 0 0 11.8 10 1.8 1.8 0 0 0 10 8.3z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E %3Cpath d='M10 4C9 4 9 5 9 5L9 5.1A5 5 0 0 0 5.1 9L5 9C5 9 4 9 4 10 4 11 5 11 5 11L5.1 11A5 5 0 0 0 9 14.9L9 15C9 15 9 16 10 16 11 16 11 15 11 15L11 14.9A5 5 0 0 0 14.9 11L15 11C15 11 16 11 16 10 16 9 15 9 15 9L14.9 9A5 5 0 0 0 11 5.1L11 5C11 5 11 4 10 4zM10 6.5A3.5 3.5 0 0 1 13.5 10 3.5 3.5 0 0 1 10 13.5 3.5 3.5 0 0 1 6.5 10 3.5 3.5 0 0 1 10 6.5zM10 8.3A1.8 1.8 0 0 0 8.3 10 1.8 1.8 0 0 0 10 11.8 1.8 1.8 0 0 0 11.8 10 1.8 1.8 0 0 0 10 8.3z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M 10,4 C 9,4 9,5 9,5 L 9,5.1 C 7.0357113,5.5006048 5.5006048,7.0357113 5.1,9 L 5,9 c 0,0 -1,0 -1,1 0,1 1,1 1,1 l 0.1,0 c 0.4006048,1.964289 1.9357113,3.499395 3.9,3.9 L 9,15 c 0,0 0,1 1,1 1,0 1,-1 1,-1 l 0,-0.1 c 1.964289,-0.400605 3.499395,-1.935711 3.9,-3.9 l 0.1,0 c 0,0 1,0 1,-1 C 16,9 15,9 15,9 L 14.9,9 C 14.499395,7.0357113 12.964289,5.5006048 11,5.1 L 11,5 c 0,0 0,-1 -1,-1 z m 0,2.5 c 1.932997,0 3.5,1.5670034 3.5,3.5 0,1.932997 -1.567003,3.5 -3.5,3.5 C 8.0670034,13.5 6.5,11.932997 6.5,10 6.5,8.0670034 8.0670034,6.5 10,6.5 Z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E %3Cpath d='M 10,4 C 9,4 9,5 9,5 L 9,5.1 C 7.0357113,5.5006048 5.5006048,7.0357113 5.1,9 L 5,9 c 0,0 -1,0 -1,1 0,1 1,1 1,1 l 0.1,0 c 0.4006048,1.964289 1.9357113,3.499395 3.9,3.9 L 9,15 c 0,0 0,1 1,1 1,0 1,-1 1,-1 l 0,-0.1 c 1.964289,-0.400605 3.499395,-1.935711 3.9,-3.9 l 0.1,0 c 0,0 1,0 1,-1 C 16,9 15,9 15,9 L 14.9,9 C 14.499395,7.0357113 12.964289,5.5006048 11,5.1 L 11,5 c 0,0 0,-1 -1,-1 z m 0,2.5 c 1.932997,0 3.5,1.5670034 3.5,3.5 0,1.932997 -1.567003,3.5 -3.5,3.5 C 8.0670034,13.5 6.5,11.932997 6.5,10 6.5,8.0670034 8.0670034,6.5 10,6.5 Z'/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting {\n    -webkit-animation: mapboxgl-spin 2s infinite linear;\n    animation: mapboxgl-spin 2s infinite linear;\n}\n\n@-webkit-keyframes mapboxgl-spin {\n    0% { -webkit-transform: rotate(0deg); }\n    100% { -webkit-transform: rotate(360deg); }\n}\n\n@keyframes mapboxgl-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-fullscreen {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath d='M 5 4 C 4.5 4 4 4.5 4 5 L 4 6 L 4 9 L 4.5 9 L 5.7773438 7.296875 C 6.7771319 8.0602131 7.835765 8.9565728 8.890625 10 C 7.8257121 11.0633 6.7761791 11.951675 5.78125 12.707031 L 4.5 11 L 4 11 L 4 15 C 4 15.5 4.5 16 5 16 L 9 16 L 9 15.5 L 7.2734375 14.205078 C 8.0428931 13.187886 8.9395441 12.133481 9.9609375 11.068359 C 11.042371 12.14699 11.942093 13.2112 12.707031 14.21875 L 11 15.5 L 11 16 L 14 16 L 15 16 C 15.5 16 16 15.5 16 15 L 16 14 L 16 11 L 15.5 11 L 14.205078 12.726562 C 13.177985 11.949617 12.112718 11.043577 11.037109 10.009766 C 12.151856 8.981061 13.224345 8.0798624 14.228516 7.3046875 L 15.5 9 L 16 9 L 16 5 C 16 4.5 15.5 4 15 4 L 11 4 L 11 4.5 L 12.703125 5.7773438 C 11.932647 6.7864834 11.026693 7.8554712 9.9707031 8.9199219 C 8.9584739 7.8204943 8.0698767 6.7627188 7.3046875 5.7714844 L 9 4.5 L 9 4 L 6 4 L 5 4 z '/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-shrink {\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath style='fill:%23000000;' d='M 4.2421875 3.4921875 A 0.750075 0.750075 0 0 0 3.71875 4.78125 L 5.9648438 7.0273438 L 4 8.5 L 4 9 L 8 9 C 8.500001 8.9999988 9 8.4999992 9 8 L 9 4 L 8.5 4 L 7.0175781 5.9550781 L 4.78125 3.71875 A 0.750075 0.750075 0 0 0 4.2421875 3.4921875 z M 15.734375 3.4921875 A 0.750075 0.750075 0 0 0 15.21875 3.71875 L 12.984375 5.953125 L 11.5 4 L 11 4 L 11 8 C 11 8.4999992 11.499999 8.9999988 12 9 L 16 9 L 16 8.5 L 14.035156 7.0273438 L 16.28125 4.78125 A 0.750075 0.750075 0 0 0 15.734375 3.4921875 z M 4 11 L 4 11.5 L 5.9648438 12.972656 L 3.71875 15.21875 A 0.75130096 0.75130096 0 1 0 4.78125 16.28125 L 7.0273438 14.035156 L 8.5 16 L 9 16 L 9 12 C 9 11.500001 8.500001 11.000001 8 11 L 4 11 z M 12 11 C 11.499999 11.000001 11 11.500001 11 12 L 11 16 L 11.5 16 L 12.972656 14.035156 L 15.21875 16.28125 A 0.75130096 0.75130096 0 1 0 16.28125 15.21875 L 14.035156 12.972656 L 16 11.5 L 16 11 L 12 11 z '/%3E %3C/svg%3E\");\n}\n\n.mapboxgl-ctrl-icon.mapboxgl-ctrl-compass > .mapboxgl-ctrl-compass-arrow {\n    width: 20px;\n    height: 20px;\n    margin: 5px;\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpolygon fill='%23333333' points='6,9 10,1 14,9'/%3E %3Cpolygon fill='%23CCCCCC' points='6,11 10,19 14,11 '/%3E %3C/svg%3E\");\n    background-repeat: no-repeat;\n    display: inline-block;\n}\n\na.mapboxgl-ctrl-logo {\n    width: 85px;\n    height: 21px;\n    margin: 0 0 -3px -3px;\n    display: block;\n    background-repeat: no-repeat;\n    cursor: pointer;\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3C?xml version='1.0' encoding='utf-8'?%3E%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 84.49 21' style='enable-background:new 0 0 84.49 21;' xml:space='preserve'%3E%3Cg%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M83.25,14.26c0,0.12-0.09,0.21-0.21,0.21h-1.61c-0.13,0-0.24-0.06-0.3-0.17l-1.44-2.39l-1.44,2.39 c-0.06,0.11-0.18,0.17-0.3,0.17h-1.61c-0.04,0-0.08-0.01-0.12-0.03c-0.09-0.06-0.13-0.19-0.06-0.28l0,0l2.43-3.68L76.2,6.84 c-0.02-0.03-0.03-0.07-0.03-0.12c0-0.12,0.09-0.21,0.21-0.21h1.61c0.13,0,0.24,0.06,0.3,0.17l1.41,2.36l1.4-2.35 c0.06-0.11,0.18-0.17,0.3-0.17H83c0.04,0,0.08,0.01,0.12,0.03c0.09,0.06,0.13,0.19,0.06,0.28l0,0l-2.37,3.63l2.43,3.67 C83.24,14.18,83.25,14.22,83.25,14.26z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M66.24,9.59c-0.39-1.88-1.96-3.28-3.84-3.28c-1.03,0-2.03,0.42-2.73,1.18V3.51c0-0.13-0.1-0.23-0.23-0.23h-1.4 c-0.13,0-0.23,0.11-0.23,0.23v10.72c0,0.13,0.1,0.23,0.23,0.23h1.4c0.13,0,0.23-0.11,0.23-0.23V13.5c0.71,0.75,1.7,1.18,2.73,1.18 c1.88,0,3.45-1.41,3.84-3.29C66.37,10.79,66.37,10.18,66.24,9.59L66.24,9.59z M62.08,13c-1.32,0-2.39-1.11-2.41-2.48v-0.06 c0.02-1.38,1.09-2.48,2.41-2.48s2.42,1.12,2.42,2.51S63.41,13,62.08,13z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M71.67,6.32c-1.98-0.01-3.72,1.35-4.16,3.29c-0.13,0.59-0.13,1.19,0,1.77c0.44,1.94,2.17,3.32,4.17,3.3 c2.35,0,4.26-1.87,4.26-4.19S74.04,6.32,71.67,6.32z M71.65,13.01c-1.33,0-2.42-1.12-2.42-2.51s1.08-2.52,2.42-2.52 c1.33,0,2.42,1.12,2.42,2.51S72.99,13,71.65,13.01L71.65,13.01z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M62.08,7.98c-1.32,0-2.39,1.11-2.41,2.48v0.06C59.68,11.9,60.75,13,62.08,13s2.42-1.12,2.42-2.51 S63.41,7.98,62.08,7.98z M62.08,11.76c-0.63,0-1.14-0.56-1.17-1.25v-0.04c0.01-0.69,0.54-1.25,1.17-1.25 c0.63,0,1.17,0.57,1.17,1.27C63.24,11.2,62.73,11.76,62.08,11.76z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M71.65,7.98c-1.33,0-2.42,1.12-2.42,2.51S70.32,13,71.65,13s2.42-1.12,2.42-2.51S72.99,7.98,71.65,7.98z M71.65,11.76c-0.64,0-1.17-0.57-1.17-1.27c0-0.7,0.53-1.26,1.17-1.26s1.17,0.57,1.17,1.27C72.82,11.21,72.29,11.76,71.65,11.76z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M45.74,6.53h-1.4c-0.13,0-0.23,0.11-0.23,0.23v0.73c-0.71-0.75-1.7-1.18-2.73-1.18 c-2.17,0-3.94,1.87-3.94,4.19s1.77,4.19,3.94,4.19c1.04,0,2.03-0.43,2.73-1.19v0.73c0,0.13,0.1,0.23,0.23,0.23h1.4 c0.13,0,0.23-0.11,0.23-0.23V6.74c0-0.12-0.09-0.22-0.22-0.22C45.75,6.53,45.75,6.53,45.74,6.53z M44.12,10.53 C44.11,11.9,43.03,13,41.71,13s-2.42-1.12-2.42-2.51s1.08-2.52,2.4-2.52c1.33,0,2.39,1.11,2.41,2.48L44.12,10.53z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M41.71,7.98c-1.33,0-2.42,1.12-2.42,2.51S40.37,13,41.71,13s2.39-1.11,2.41-2.48v-0.06 C44.1,9.09,43.03,7.98,41.71,7.98z M40.55,10.49c0-0.7,0.52-1.27,1.17-1.27c0.64,0,1.14,0.56,1.17,1.25v0.04 c-0.01,0.68-0.53,1.24-1.17,1.24C41.08,11.75,40.55,11.19,40.55,10.49z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M52.41,6.32c-1.03,0-2.03,0.42-2.73,1.18V6.75c0-0.13-0.1-0.23-0.23-0.23h-1.4c-0.13,0-0.23,0.11-0.23,0.23 v10.72c0,0.13,0.1,0.23,0.23,0.23h1.4c0.13,0,0.23-0.1,0.23-0.23V13.5c0.71,0.75,1.7,1.18,2.74,1.18c2.17,0,3.94-1.87,3.94-4.19 S54.58,6.32,52.41,6.32z M52.08,13.01c-1.32,0-2.39-1.11-2.42-2.48v-0.07c0.02-1.38,1.09-2.49,2.4-2.49c1.32,0,2.41,1.12,2.41,2.51 S53.4,13,52.08,13.01L52.08,13.01z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M52.08,7.98c-1.32,0-2.39,1.11-2.42,2.48v0.06c0.03,1.38,1.1,2.48,2.42,2.48s2.41-1.12,2.41-2.51 S53.4,7.98,52.08,7.98z M52.08,11.76c-0.63,0-1.14-0.56-1.17-1.25v-0.04c0.01-0.69,0.54-1.25,1.17-1.25c0.63,0,1.17,0.58,1.17,1.27 S52.72,11.76,52.08,11.76z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M36.08,14.24c0,0.13-0.1,0.23-0.23,0.23h-1.41c-0.13,0-0.23-0.11-0.23-0.23V9.68c0-0.98-0.74-1.71-1.62-1.71 c-0.8,0-1.46,0.7-1.59,1.62l0.01,4.66c0,0.13-0.11,0.23-0.23,0.23h-1.41c-0.13,0-0.23-0.11-0.23-0.23V9.68 c0-0.98-0.74-1.71-1.62-1.71c-0.85,0-1.54,0.79-1.6,1.8v4.48c0,0.13-0.1,0.23-0.23,0.23h-1.4c-0.13,0-0.23-0.11-0.23-0.23V6.74 c0.01-0.13,0.1-0.22,0.23-0.22h1.4c0.13,0,0.22,0.11,0.23,0.22V7.4c0.5-0.68,1.3-1.09,2.16-1.1h0.03c1.09,0,2.09,0.6,2.6,1.55 c0.45-0.95,1.4-1.55,2.44-1.56c1.62,0,2.93,1.25,2.9,2.78L36.08,14.24z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M84.34,13.59l-0.07-0.13l-1.96-2.99l1.94-2.95c0.44-0.67,0.26-1.56-0.41-2.02c-0.02,0-0.03,0-0.04-0.01 c-0.23-0.15-0.5-0.22-0.78-0.22h-1.61c-0.56,0-1.08,0.29-1.37,0.78L79.72,6.6l-0.34-0.56C79.09,5.56,78.57,5.27,78,5.27h-1.6 c-0.6,0-1.13,0.37-1.35,0.92c-2.19-1.66-5.28-1.47-7.26,0.45c-0.35,0.34-0.65,0.72-0.89,1.14c-0.9-1.62-2.58-2.72-4.5-2.72 c-0.5,0-1.01,0.07-1.48,0.23V3.51c0-0.82-0.66-1.48-1.47-1.48h-1.4c-0.81,0-1.47,0.66-1.47,1.47v3.75 c-0.95-1.36-2.5-2.18-4.17-2.19c-0.74,0-1.46,0.16-2.12,0.47c-0.24-0.17-0.54-0.26-0.84-0.26h-1.4c-0.45,0-0.87,0.21-1.15,0.56 c-0.02-0.03-0.04-0.05-0.07-0.08c-0.28-0.3-0.68-0.47-1.09-0.47h-1.39c-0.3,0-0.6,0.09-0.84,0.26c-0.67-0.3-1.39-0.46-2.12-0.46 c-1.83,0-3.43,1-4.37,2.5c-0.2-0.46-0.48-0.89-0.83-1.25c-0.8-0.81-1.89-1.25-3.02-1.25h-0.01c-0.89,0.01-1.75,0.33-2.46,0.88 c-0.74-0.57-1.64-0.88-2.57-0.88H28.1c-0.29,0-0.58,0.03-0.86,0.11c-0.28,0.06-0.56,0.16-0.82,0.28c-0.21-0.12-0.45-0.18-0.7-0.18 h-1.4c-0.82,0-1.47,0.66-1.47,1.47v7.5c0,0.82,0.66,1.47,1.47,1.47h1.4c0.82,0,1.48-0.66,1.48-1.48l0,0V9.79 c0.03-0.36,0.23-0.59,0.36-0.59c0.18,0,0.38,0.18,0.38,0.47v4.57c0,0.82,0.66,1.47,1.47,1.47h1.41c0.82,0,1.47-0.66,1.47-1.47 l-0.01-4.57c0.06-0.32,0.25-0.47,0.35-0.47c0.18,0,0.38,0.18,0.38,0.47v4.57c0,0.82,0.66,1.47,1.47,1.47h1.41 c0.82,0,1.47-0.66,1.47-1.47v-0.38c0.96,1.29,2.46,2.06,4.06,2.06c0.74,0,1.46-0.16,2.12-0.47c0.24,0.17,0.54,0.26,0.84,0.26h1.39 c0.3,0,0.6-0.09,0.84-0.26v2.01c0,0.82,0.66,1.47,1.47,1.47h1.4c0.82,0,1.47-0.66,1.47-1.47v-1.77c0.48,0.15,0.99,0.23,1.49,0.22 c1.7,0,3.22-0.87,4.17-2.2v0.52c0,0.82,0.66,1.47,1.47,1.47h1.4c0.3,0,0.6-0.09,0.84-0.26c0.66,0.31,1.39,0.47,2.12,0.47 c1.92,0,3.6-1.1,4.49-2.73c1.54,2.65,4.95,3.53,7.58,1.98c0.18-0.11,0.36-0.22,0.53-0.36c0.22,0.55,0.76,0.91,1.35,0.9H78 c0.56,0,1.08-0.29,1.37-0.78l0.37-0.61l0.37,0.61c0.29,0.48,0.81,0.78,1.38,0.78h1.6c0.81,0,1.46-0.66,1.45-1.46 C84.49,14.02,84.44,13.8,84.34,13.59L84.34,13.59z M35.86,14.47h-1.41c-0.13,0-0.23-0.11-0.23-0.23V9.68 c0-0.98-0.74-1.71-1.62-1.71c-0.8,0-1.46,0.7-1.59,1.62l0.01,4.66c0,0.13-0.1,0.23-0.23,0.23h-1.41c-0.13,0-0.23-0.11-0.23-0.23 V9.68c0-0.98-0.74-1.71-1.62-1.71c-0.85,0-1.54,0.79-1.6,1.8v4.48c0,0.13-0.1,0.23-0.23,0.23h-1.4c-0.13,0-0.23-0.11-0.23-0.23 V6.74c0.01-0.13,0.11-0.22,0.23-0.22h1.4c0.13,0,0.22,0.11,0.23,0.22V7.4c0.5-0.68,1.3-1.09,2.16-1.1h0.03 c1.09,0,2.09,0.6,2.6,1.55c0.45-0.95,1.4-1.55,2.44-1.56c1.62,0,2.93,1.25,2.9,2.78l0.01,5.16C36.09,14.36,35.98,14.46,35.86,14.47 L35.86,14.47z M45.97,14.24c0,0.13-0.1,0.23-0.23,0.23h-1.4c-0.13,0-0.23-0.11-0.23-0.23V13.5c-0.7,0.76-1.69,1.18-2.72,1.18 c-2.17,0-3.94-1.87-3.94-4.19s1.77-4.19,3.94-4.19c1.03,0,2.02,0.43,2.73,1.18V6.74c0-0.13,0.1-0.23,0.23-0.23h1.4 c0.12-0.01,0.22,0.08,0.23,0.21c0,0.01,0,0.01,0,0.02v7.51h-0.01V14.24z M52.41,14.67c-1.03,0-2.02-0.43-2.73-1.18v3.97 c0,0.13-0.1,0.23-0.23,0.23h-1.4c-0.13,0-0.23-0.1-0.23-0.23V6.75c0-0.13,0.1-0.22,0.23-0.22h1.4c0.13,0,0.23,0.11,0.23,0.23v0.73 c0.71-0.76,1.7-1.18,2.73-1.18c2.17,0,3.94,1.86,3.94,4.18S54.58,14.67,52.41,14.67z M66.24,11.39c-0.39,1.87-1.96,3.29-3.84,3.29 c-1.03,0-2.02-0.43-2.73-1.18v0.73c0,0.13-0.1,0.23-0.23,0.23h-1.4c-0.13,0-0.23-0.11-0.23-0.23V3.51c0-0.13,0.1-0.23,0.23-0.23 h1.4c0.13,0,0.23,0.11,0.23,0.23v3.97c0.71-0.75,1.7-1.18,2.73-1.17c1.88,0,3.45,1.4,3.84,3.28C66.37,10.19,66.37,10.8,66.24,11.39 L66.24,11.39L66.24,11.39z M71.67,14.68c-2,0.01-3.73-1.35-4.17-3.3c-0.13-0.59-0.13-1.19,0-1.77c0.44-1.94,2.17-3.31,4.17-3.3 c2.36,0,4.26,1.87,4.26,4.19S74.03,14.68,71.67,14.68L71.67,14.68z M83.04,14.47h-1.61c-0.13,0-0.24-0.06-0.3-0.17l-1.44-2.39 l-1.44,2.39c-0.06,0.11-0.18,0.17-0.3,0.17h-1.61c-0.04,0-0.08-0.01-0.12-0.03c-0.09-0.06-0.13-0.19-0.06-0.28l0,0l2.43-3.68 L76.2,6.84c-0.02-0.03-0.03-0.07-0.03-0.12c0-0.12,0.09-0.21,0.21-0.21h1.61c0.13,0,0.24,0.06,0.3,0.17l1.41,2.36l1.41-2.36 c0.06-0.11,0.18-0.17,0.3-0.17h1.61c0.04,0,0.08,0.01,0.12,0.03c0.09,0.06,0.13,0.19,0.06,0.28l0,0l-2.38,3.64l2.43,3.67 c0.02,0.03,0.03,0.07,0.03,0.12C83.25,14.38,83.16,14.47,83.04,14.47L83.04,14.47L83.04,14.47z'/%3E %3Cpath class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' d='M10.5,1.24c-5.11,0-9.25,4.15-9.25,9.25s4.15,9.25,9.25,9.25s9.25-4.15,9.25-9.25 C19.75,5.38,15.61,1.24,10.5,1.24z M14.89,12.77c-1.93,1.93-4.78,2.31-6.7,2.31c-0.7,0-1.41-0.05-2.1-0.16c0,0-1.02-5.64,2.14-8.81 c0.83-0.83,1.95-1.28,3.13-1.28c1.27,0,2.49,0.51,3.39,1.42C16.59,8.09,16.64,11,14.89,12.77z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M10.5-0.01C4.7-0.01,0,4.7,0,10.49s4.7,10.5,10.5,10.5S21,16.29,21,10.49C20.99,4.7,16.3-0.01,10.5-0.01z M10.5,19.74c-5.11,0-9.25-4.15-9.25-9.25s4.14-9.26,9.25-9.26s9.25,4.15,9.25,9.25C19.75,15.61,15.61,19.74,10.5,19.74z'/%3E %3Cpath class='st1' style='opacity:0.35; enable-background:new;' d='M14.74,6.25C12.9,4.41,9.98,4.35,8.23,6.1c-3.16,3.17-2.14,8.81-2.14,8.81s5.64,1.02,8.81-2.14 C16.64,11,16.59,8.09,14.74,6.25z M12.47,10.34l-0.91,1.87l-0.9-1.87L8.8,9.43l1.86-0.9l0.9-1.87l0.91,1.87l1.86,0.9L12.47,10.34z'/%3E %3Cpolygon class='st0' style='opacity:0.9; fill: %23FFFFFF; enable-background: new;' points='14.33,9.43 12.47,10.34 11.56,12.21 10.66,10.34 8.8,9.43 10.66,8.53 11.56,6.66 12.47,8.53 '/%3E%3C/g%3E%3C/svg%3E\");\n}\n\na.mapboxgl-ctrl-logo.mapboxgl-compact {\n    width: 21px;\n    height: 21px;\n    background-image: url(\"data:image/svg+xml;charset=utf-8,%3C?xml version='1.0' encoding='utf-8'?%3E %3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 21 21' style='enable-background:new 0 0 21 21;' xml:space='preserve'%3E%3Cg transform='translate(0,0.01)'%3E%3Cpath d='m 10.5,1.24 c -5.11,0 -9.25,4.15 -9.25,9.25 0,5.1 4.15,9.25 9.25,9.25 5.1,0 9.25,-4.15 9.25,-9.25 0,-5.11 -4.14,-9.25 -9.25,-9.25 z m 4.39,11.53 c -1.93,1.93 -4.78,2.31 -6.7,2.31 -0.7,0 -1.41,-0.05 -2.1,-0.16 0,0 -1.02,-5.64 2.14,-8.81 0.83,-0.83 1.95,-1.28 3.13,-1.28 1.27,0 2.49,0.51 3.39,1.42 1.84,1.84 1.89,4.75 0.14,6.52 z' style='opacity:0.9;fill:%23ffffff;enable-background:new' class='st0'/%3E%3Cpath d='M 10.5,-0.01 C 4.7,-0.01 0,4.7 0,10.49 c 0,5.79 4.7,10.5 10.5,10.5 5.8,0 10.5,-4.7 10.5,-10.5 C 20.99,4.7 16.3,-0.01 10.5,-0.01 Z m 0,19.75 c -5.11,0 -9.25,-4.15 -9.25,-9.25 0,-5.1 4.14,-9.26 9.25,-9.26 5.11,0 9.25,4.15 9.25,9.25 0,5.13 -4.14,9.26 -9.25,9.26 z' style='opacity:0.35;enable-background:new' class='st1'/%3E%3Cpath d='M 14.74,6.25 C 12.9,4.41 9.98,4.35 8.23,6.1 5.07,9.27 6.09,14.91 6.09,14.91 c 0,0 5.64,1.02 8.81,-2.14 C 16.64,11 16.59,8.09 14.74,6.25 Z m -2.27,4.09 -0.91,1.87 -0.9,-1.87 -1.86,-0.91 1.86,-0.9 0.9,-1.87 0.91,1.87 1.86,0.9 z' style='opacity:0.35;enable-background:new' class='st1'/%3E%3Cpolygon points='11.56,12.21 10.66,10.34 8.8,9.43 10.66,8.53 11.56,6.66 12.47,8.53 14.33,9.43 12.47,10.34 ' style='opacity:0.9;fill:%23ffffff;enable-background:new' class='st0'/%3E%3C/g%3E%3C/svg%3E\");\n}\n\n.mapboxgl-ctrl.mapboxgl-ctrl-attrib {\n    padding: 0 5px;\n    background-color: rgba(255, 255, 255, 0.5);\n    margin: 0;\n}\n\n@media screen {\n    .mapboxgl-ctrl-attrib.mapboxgl-compact {\n        margin: 10px;\n        position: relative;\n        background-color: #fff;\n        border-radius: 3px 12px 12px 3px;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact:hover {\n        padding: 2px 24px 2px 4px;\n        visibility: visible;\n    }\n\n    .mapboxgl-ctrl-top-left > .mapboxgl-ctrl-attrib.mapboxgl-compact:hover,\n    .mapboxgl-ctrl-bottom-left > .mapboxgl-ctrl-attrib.mapboxgl-compact:hover {\n        padding: 2px 4px 2px 24px;\n        border-radius: 12px 3px 3px 12px;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner {\n        display: none;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact:hover .mapboxgl-ctrl-attrib-inner {\n        display: block;\n    }\n\n    .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        content: '';\n        cursor: pointer;\n        position: absolute;\n        background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath fill='%23333333' fill-rule='evenodd' d='M4,10a6,6 0 1,0 12,0a6,6 0 1,0 -12,0 M9,7a1,1 0 1,0 2,0a1,1 0 1,0 -2,0 M9,10a1,1 0 1,1 2,0l0,3a1,1 0 1,1 -2,0'/%3E %3C/svg%3E\");\n        background-color: rgba(255, 255, 255, 0.5);\n        width: 24px;\n        height: 24px;\n        box-sizing: border-box;\n        border-radius: 12px;\n    }\n\n    .mapboxgl-ctrl-bottom-right > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        bottom: 0;\n        right: 0;\n    }\n\n    .mapboxgl-ctrl-top-right > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        top: 0;\n        right: 0;\n    }\n\n    .mapboxgl-ctrl-top-left > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        top: 0;\n        left: 0;\n    }\n\n    .mapboxgl-ctrl-bottom-left > .mapboxgl-ctrl-attrib.mapboxgl-compact::after {\n        bottom: 0;\n        left: 0;\n    }\n}\n\n.mapboxgl-ctrl-attrib a {\n    color: rgba(0, 0, 0, 0.75);\n    text-decoration: none;\n}\n\n.mapboxgl-ctrl-attrib a:hover {\n    color: inherit;\n    text-decoration: underline;\n}\n\n/* stylelint-disable-next-line selector-class-pattern */\n.mapboxgl-ctrl-attrib .mapbox-improve-map {\n    font-weight: bold;\n    margin-left: 2px;\n}\n\n.mapboxgl-attrib-empty {\n    display: none;\n}\n\n.mapboxgl-ctrl-scale {\n    background-color: rgba(255, 255, 255, 0.75);\n    font-size: 10px;\n    border-width: medium 2px 2px;\n    border-style: none solid solid;\n    border-color: #333;\n    padding: 0 5px;\n    color: #333;\n    box-sizing: border-box;\n}\n\n.mapboxgl-popup {\n    position: absolute;\n    top: 0;\n    left: 0;\n    display: flex;\n    will-change: transform;\n    pointer-events: none;\n}\n\n.mapboxgl-popup-anchor-top,\n.mapboxgl-popup-anchor-top-left,\n.mapboxgl-popup-anchor-top-right {\n    flex-direction: column;\n}\n\n.mapboxgl-popup-anchor-bottom,\n.mapboxgl-popup-anchor-bottom-left,\n.mapboxgl-popup-anchor-bottom-right {\n    flex-direction: column-reverse;\n}\n\n.mapboxgl-popup-anchor-left {\n    flex-direction: row;\n}\n\n.mapboxgl-popup-anchor-right {\n    flex-direction: row-reverse;\n}\n\n.mapboxgl-popup-tip {\n    width: 0;\n    height: 0;\n    border: 10px solid transparent;\n    z-index: 1;\n}\n\n.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {\n    align-self: center;\n    border-top: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {\n    align-self: flex-start;\n    border-top: none;\n    border-left: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {\n    align-self: flex-end;\n    border-top: none;\n    border-right: none;\n    border-bottom-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {\n    align-self: center;\n    border-bottom: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {\n    align-self: flex-start;\n    border-bottom: none;\n    border-left: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {\n    align-self: flex-end;\n    border-bottom: none;\n    border-right: none;\n    border-top-color: #fff;\n}\n\n.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {\n    align-self: center;\n    border-left: none;\n    border-right-color: #fff;\n}\n\n.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {\n    align-self: center;\n    border-right: none;\n    border-left-color: #fff;\n}\n\n.mapboxgl-popup-close-button {\n    position: absolute;\n    right: 0;\n    top: 0;\n    border: 0;\n    border-radius: 0 3px 0 0;\n    cursor: pointer;\n    background-color: transparent;\n}\n\n.mapboxgl-popup-close-button:hover {\n    background-color: rgba(0, 0, 0, 0.05);\n}\n\n.mapboxgl-popup-content {\n    position: relative;\n    background: #fff;\n    border-radius: 3px;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    padding: 10px 10px 15px;\n    pointer-events: auto;\n}\n\n.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content {\n    border-top-left-radius: 0;\n}\n\n.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content {\n    border-top-right-radius: 0;\n}\n\n.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content {\n    border-bottom-left-radius: 0;\n}\n\n.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content {\n    border-bottom-right-radius: 0;\n}\n\n.mapboxgl-marker {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n}\n\n.mapboxgl-user-location-dot {\n    background-color: #1da1f2;\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n    box-shadow: 0 0 2px rgba(0, 0, 0, 0.25);\n}\n\n.mapboxgl-user-location-dot::before {\n    background-color: #1da1f2;\n    content: '';\n    width: 15px;\n    height: 15px;\n    border-radius: 50%;\n    position: absolute;\n    -webkit-animation: mapboxgl-user-location-dot-pulse 2s infinite;\n    animation: mapboxgl-user-location-dot-pulse 2s infinite;\n}\n\n.mapboxgl-user-location-dot::after {\n    border-radius: 50%;\n    border: 2px solid #fff;\n    content: '';\n    height: 19px;\n    left: -2px;\n    position: absolute;\n    top: -2px;\n    width: 19px;\n    box-sizing: border-box;\n}\n\n@-webkit-keyframes mapboxgl-user-location-dot-pulse {\n    0%   { -webkit-transform: scale(1); opacity: 1; }\n    70%  { -webkit-transform: scale(3); opacity: 0; }\n    100% { -webkit-transform: scale(1); opacity: 0; }\n}\n\n@keyframes mapboxgl-user-location-dot-pulse {\n    0%   { transform: scale(1); opacity: 1; }\n    70%  { transform: scale(3); opacity: 0; }\n    100% { transform: scale(1); opacity: 0; }\n}\n\n.mapboxgl-user-location-dot-stale {\n    background-color: #aaa;\n}\n\n.mapboxgl-user-location-dot-stale::after {\n    display: none;\n}\n\n.mapboxgl-crosshair,\n.mapboxgl-crosshair .mapboxgl-interactive,\n.mapboxgl-crosshair .mapboxgl-interactive:active {\n    cursor: crosshair;\n}\n\n.mapboxgl-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n}\n\n@media print {\n    /* stylelint-disable-next-line selector-class-pattern */\n    .mapbox-improve-map {\n        display: none;\n    }\n}\n",""])}}]);
//# sourceMappingURL=0.9661511a8b38d2d1dee0.bundle.js.map