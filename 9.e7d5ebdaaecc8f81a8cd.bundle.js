(window.webpackJsonp=window.webpackJsonp||[]).push([[9,2],{1041:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(1104),i=n.n(a),o=n(1105),r=n.n(o),s=n(1037),l=n(1051);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}const u={console:console,_:r(),colors:l,d3array:s};function g(e,t,n){const a={},o="SAFE_EVAL_"+Math.floor(1e6*Math.random());a[o]={};const r=o+"="+e,s=c({},u,{},t);Object.keys(s).forEach(e=>{a[e]=s[e]});try{return i.a.runInNewContext(r,a,n),a[o]}catch(e){return()=>e}}},1048:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var a=n(1037),i=n(1041);function o(e,t,n,a){const o=e;let r,s,l=n;return o.js_tooltip&&(l=Object(i.a)(o.js_tooltip)),l&&(r=e=>{e.picked?t({content:l(e),x:e.x,y:e.y}):t(null)}),o.js_onclick_href?s=e=>{const t=Object(i.a)(o.js_onclick_href)(e);window.open(t)}:o.table_filter&&void 0!==a&&(s=e=>a(e.object[o.line_column])),{onClick:s,onHover:r,pickable:Boolean(r)}}const r={p1:.01,p5:.05,p95:.95,p99:.99};function s(e,t){if(void 0===e&&(e="sum"),void 0===t&&(t=null),"count"===e)return e=>e.length;let n;return n=e in r?(n,i)=>{let o;return o=t?n.sort((e,n)=>a.ascending(t(e),t(n))):n.sort(a.ascending),a.quantile(o,r[e],i)}:a[e],t?e=>n(e.map(e=>t(e))):e=>n(e)}},1050:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(1),i=n.n(a),o=n(0),r=n.n(o);const s={label:r.a.string.isRequired,value:r.a.string.isRequired};class l extends i.a.PureComponent{render(){const{label:e,value:t}=this.props;return i.a.createElement("div",null,e,i.a.createElement("strong",null,t))}}l.propTypes=s},1051:function(e,t,n){"use strict";n.r(t),n.d(t,"hexToRGB",(function(){return i}));var a=n(24);function i(e,t){if(void 0===t&&(t=255),!e)return[0,0,0,t];const{r:n,g:i,b:o}=Object(a.g)(e);return[n,i,o,t]}},1054:function(e,t,n){"use strict";var a=n(1135),i=n(1037);const o=[-90,90],r=[-180,180];function s(e,t,n){let[a,i]=e,[o,r]=t;return void 0===n&&(n=.25),a<i?[a,i]:[Math.max(o,a-n),Math.min(r,i+n)]}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function c(e,t){let{points:n,width:c,height:u,minExtent:g,maxZoom:d,offset:p,padding:h=20}=t;const{bearing:f,pitch:v}=e,m=function(e){const t=s(Object(i.extent)(e,e=>e[1]),o),n=s(Object(i.extent)(e,e=>e[0]),r);return[[n[0],t[0]],[n[1],t[1]]]}(n);try{return l({},Object(a.a)({bounds:m,width:c,height:u,minExtent:g,maxZoom:d,offset:p,padding:h}),{bearing:f,pitch:v})}catch(e){console.error("Could not fit viewport",e)}return e}n.d(t,"a",(function(){return c}))},1057:function(e,t,n){"use strict";var a=n(1),i=n.n(a),o=n(0),r=n.n(o),s=n(1113),l=n(1356),c=n(219),u=n.n(c),g=n(1106);function d(e){const{tooltip:t}=e;if(null==t)return null;const{x:n,y:o,content:r}=t,s=Object(a.useMemo)(()=>({position:"absolute",top:o+"px",left:n+"px",padding:"8px",margin:"8px",background:"rgba(0, 0, 0, 0.8)",color:"#fff",maxWidth:"300px",fontSize:"12px",zIndex:9,pointerEvents:"none"}),[n,o]);if("string"==typeof r){const e=Object(a.useMemo)(()=>({__html:Object(g.filterXSS)(r,{stripIgnoreTag:!0})}),[r]);return i.a.createElement("div",{style:s},i.a.createElement("div",{dangerouslySetInnerHTML:e}))}return i.a.createElement("div",{style:s},r)}n(1107),n(1078);function p(){const e=function(e,t){t||(t=e.slice(0));return e.raw=t,e}(["\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n"]);return p=function(){return e},e}const h={viewport:r.a.object.isRequired,layers:r.a.array.isRequired,setControlValue:r.a.func,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,children:r.a.node,bottomMargin:r.a.number,width:r.a.number.isRequired,height:r.a.number.isRequired};class f extends i.a.Component{constructor(e){var t,n,a;super(e),a=e=>{this.setState({tooltip:e})},(n="setTooltip")in(t=this)?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,this.tick=this.tick.bind(this),this.onViewStateChange=this.onViewStateChange.bind(this),this.state={timer:setInterval(this.tick,250),tooltip:null,viewState:e.viewport}}componentWillUnmount(){clearInterval(this.state.timer)}onViewStateChange(e){let{viewState:t}=e;this.setState({viewState:t,lastUpdate:Date.now()})}tick(){const{lastUpdate:e}=this.state;if(e&&Date.now()-e>250){const e=this.props.setControlValue;e&&e("viewport",this.state.viewState),this.setState({lastUpdate:null})}}layers(){return this.props.layers.some(e=>"function"==typeof e)?this.props.layers.map(e=>"function"==typeof e?e():e):this.props.layers}render(){const{children:e,bottomMargin:t,height:n,width:a}=this.props,{viewState:o,tooltip:r}=this.state,c=n-t,u=this.layers();return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{position:"relative",width:a,height:c}},i.a.createElement(l.a,{initWebGLParameters:!0,controller:!0,width:a,height:c,layers:u,viewState:o,onViewStateChange:this.onViewStateChange},i.a.createElement(s.a,{mapStyle:this.props.mapStyle,mapboxApiAccessToken:this.props.mapboxApiAccessToken})),e),i.a.createElement(d,{tooltip:r}))}}f.propTypes=h,f.defaultProps={mapStyle:"light",setControlValue:()=>{},children:null,bottomMargin:0};t.a=u()(f)(p())},1058:function(e,t,n){"use strict";var a=n(1),i=n.n(a),o=n(0),r=n.n(o),s=n(321),l=n(1057),c=n(157),u=n(1063),g=n(1059),d=n(1051),p=n(1062),h=n(1041),f=n(1054);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{getScale:y}=c.CategoricalColorNamespace;const b={formData:r.a.object.isRequired,mapboxApiKey:r.a.string.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,getLayer:r.a.func.isRequired,getPoints:r.a.func.isRequired,payload:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class S extends i.a.PureComponent{constructor(e){super(e),m(this,"containerRef",i.a.createRef()),m(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const n=e.payload.data.features||[],a=n.map(e=>e.__timestamp),i=function(e,t){const n=e.color_picker||{r:0,g:0,b:0,a:1},a=[n.r,n.g,n.b,255*n.a],i=y(e.color_scheme),o={};return t.forEach(t=>{if(null!=t.cat_color&&!o.hasOwnProperty(t.cat_color)){let r;r=e.dimension?Object(d.hexToRGB)(i(t.cat_color),255*n.a):a,o[t.cat_color]={color:r,enabled:!0}}}),o}(e.formData,n);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:i});const o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:s,getStep:l,values:c,disabled:u}=Object(p.a)(a,o),{width:g,height:h,formData:m}=e;let{viewport:b}=e;return m.autozoom&&(b=Object(f.a)(b,{width:g,height:h,points:e.getPoints(n)})),{start:r,end:s,getStep:l,values:c,disabled:u,viewport:b,selected:[],lastClick:0,formData:e.payload.form_data,categories:i}}getLayers(e){const{getLayer:t,payload:n,formData:a,onAddFilter:i}=this.props;let o=n.data.features?[...n.data.features]:[];if(o=this.addColor(o,a),a.js_data_mutator){o=Object(h.a)(a.js_data_mutator)(o)}o=e[0]===e[1]||e[1]===this.end?o.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):o.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const r=this.state.categories;return a.dimension&&(o=o.filter(e=>r[e.cat_color]&&r[e.cat_color].enabled)),[t(a,v({},n,{data:v({},n.data,{features:o})}),i,this.setTooltip)]}addColor(e,t){const n=t.color_picker||{r:0,g:0,b:0,a:1},a=y(t.color_scheme);return e.map(e=>{let i;return t.dimension?(i=Object(d.hexToRGB)(a(e.cat_color),255*n.a),v({},e,{color:i})):e})}toggleCategory(e){const t=this.state.categories[e],n=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(n).every(e=>!e.enabled)&&Object.values(n).forEach(e=>{e.enabled=!0}),this.setState({categories:n})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(u.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},i.a.createElement(g.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}S.propTypes=b,n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return A}));const C={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},O={onAddFilter(){}};function j(e,t){class n extends i.a.PureComponent{constructor(e){super(e),w(this,"containerRef",i.a.createRef()),w(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:n,height:a,formData:o}=e;let{viewport:r}=e;o.autozoom&&(r=Object(f.a)(r,{width:n,height:a,points:t(e.payload.data.features)})),this.state={viewport:r,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=x({},e.formData,{viewport:null}),n=x({},this.props.formData,{viewport:null});Object(s.isEqual)(t,n)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:n,payload:a,onAddFilter:i}=t;return e(n,a,i,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:n,height:a,width:o}=this.props,{layer:r,viewport:s}=this.state;return i.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[r],mapStyle:e.mapbox_style,setControlValue:n,width:o,height:a,onViewportChange:this.onViewportChange})}}return n.propTypes=C,n.defaultProps=O,n}function A(e,t){function n(n){const{formData:a,payload:o,setControlValue:r,viewport:s,width:l,height:c}=n;return i.a.createElement(S,{formData:a,mapboxApiKey:o.data.mapboxApiKey,setControlValue:r,viewport:s,getLayer:e,payload:o,getPoints:t,width:l,height:c})}return n.propTypes=C,n.defaultProps=O,n}},1059:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(1),i=n.n(a),o=n(0),r=n.n(o),s=n(1065);n(1060);const l={categories:r.a.object,toggleCategory:r.a.func,showSingleCategory:r.a.func,format:r.a.string,position:r.a.oneOf([null,"tl","tr","bl","br"])};class c extends i.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.formatNumber)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,n]=e;const a={color:"rgba("+n.color.join(", ")+")"},o=n.enabled?"◼":"◻";return i.a.createElement("li",{key:t},i.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},i.a.createElement("span",{style:a},o)," ",this.formatCategoryLabel(t)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return i.a.createElement("div",{className:"legend",style:t},i.a.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},1060:function(e,t,n){var a=n(501),i=n(1061);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1},r=(a(i,o),i.locals?i.locals:{});e.exports=r},1061:function(e,t,n){(t=n(502)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n  font-size: 90%;\n  position: absolute;\n  background: #fff;\n  box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n  margin: 24px;\n  padding: 12px 20px;\n  outline: none;\n  overflow-y: scroll;\n  max-height: 200px;\n}\n\nul.categories {\n  list-style: none;\n  padding-left: 0;\n  margin: 0;\n}\n\nul.categories li a {\n  color: rgb(51, 51, 51);\n  text-decoration: none;\n}\n\nul.categories li a span {\n  margin-right: 10px;\n}\n',""]),e.exports=t},1062:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(1133),i=n.n(a);const o=[1,0,1,0,0,0,0];function r(e,t){const n=parseInt(i()(t).format("x"),10);return parseInt(i()(t).add(e).format("x"),10)-n}function s(e,t){const n=i()(Math.min(...e)),a=i()(Math.max(...e));let s,l,c;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=i()(e[0]),s=i.a.duration(e[1])):(l=i()(e[1]),s=i.a.duration(e[0]))}else s=i.a.duration(t),l=function(e,t){const n=i()(e).subtract(t),a=e.toArray(),r=n.toArray(),s=a.map((e,t)=>r[t]!==e).indexOf(!0),l=a.map((e,t)=>{if(t===s){const n=e-r[t];return e-(e-o[t])%n}return t<s||-1===s?e:o[t]});return i()(l)}(n,s);const u=n.valueOf();for(c=l.clone();c.valueOf()<u;)c.add(s);for(;c.valueOf()>u;)c.subtract(s);let g;const d=a.valueOf();for(g=l.clone();g.valueOf()>d;)g.subtract(s);for(;g.valueOf()<d;)g.add(s);const p=null!=t?[c,c.clone().add(s)]:[c,g],h=e.every(e=>null===e);return{start:parseInt(c.format("x"),10),end:parseInt(g.format("x"),10),getStep:r.bind(this,s),values:p.map(e=>parseInt(e.format("x"),10)),disabled:h}}},1063:function(e,t,n){"use strict";var a=n(1),i=n.n(a),o=n(0),r=n.n(o),s=n(1057),l=n(1130),c=n.n(l),u=n(3),g=n(1131),d=n.n(g);n(1132),n(1089);function p(e){return i.a.createElement("span",{className:"BootstrapSliderWrapper"},i.a.createElement(d.a,e))}n(1091);const h={start:r.a.number.isRequired,step:r.a.number.isRequired,end:r.a.number.isRequired,values:r.a.array.isRequired,onChange:r.a.func,loopDuration:r.a.number,maxFrames:r.a.number,orientation:r.a.oneOf(["horizontal","vertical"]),reversed:r.a.bool,disabled:r.a.bool,range:r.a.bool};class f extends i.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,n=Math.min(e.maxFrames,t/e.step),a=t/n;this.intervalMilliseconds=e.loopDuration/n,this.increment=a<e.step?e.step:a-a%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:n,values:a,disabled:i}=this.props;if(i)return;const o=(Array.isArray(a)?a:[a,a+n]).map(e=>e+this.increment),r=o[1]>t?o[0]-e:0;this.props.onChange(o.map(e=>e-r))}stepBackward(){const{start:e,end:t,step:n,values:a,disabled:i}=this.props;if(i)return;const o=(Array.isArray(a)?a:[a,a+n]).map(e=>e-this.increment),r=o[0]<e?t-o[1]:0;this.props.onChange(o.map(e=>e+r))}formatter(e){if(this.props.disabled)return Object(u.t)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:n,orientation:a,reversed:o,disabled:r,range:s,values:l}=this.props;return i.a.createElement("div",{className:"play-slider"},i.a.createElement("div",{className:"play-slider-controls padded"},i.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),i.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),i.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),i.a.createElement("div",{className:"play-slider-scrobbler padded"},i.a.createElement(p,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:n,orientation:a,reversed:o,disabled:r?"disabled":"enabled"})))}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}f.propTypes=h,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},n.d(t,"a",(function(){return y}));const m={getLayers:r.a.func.isRequired,start:r.a.number.isRequired,end:r.a.number.isRequired,getStep:r.a.func,values:r.a.array.isRequired,aggregation:r.a.bool,disabled:r.a.bool,viewport:r.a.object.isRequired,children:r.a.node,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,setControlValue:r.a.func,onValuesChange:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class y extends i.a.PureComponent{constructor(){super(...arguments),v(this,"containerRef",i.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:n,disabled:a,aggregation:o,children:r,getLayers:l,values:c,onValuesChange:u,viewport:g,setControlValue:d,mapStyle:p,mapboxApiAccessToken:h,height:v,width:m}=this.props,y=l(c);return i.a.createElement("div",null,i.a.createElement(s.a,{ref:this.containerRef,viewport:g,layers:y,setControlValue:d,mapStyle:p,mapboxApiAccessToken:h,bottomMargin:a?0:20,width:m,height:v}),!a&&i.a.createElement(f,{start:e,end:t,step:n(e),values:c,range:!o,onChange:u}),r)}}y.propTypes=m,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},1078:function(e,t,n){var a=n(501),i=n(1079);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1},r=(a(i,o),i.locals?i.locals:{});e.exports=r},1079:function(e,t,n){(t=n(502)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.deckgl-tooltip > div {\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n',""]),e.exports=t},1089:function(e,t,n){var a=n(501),i=n(1090);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1},r=(a(i,o),i.locals?i.locals:{});e.exports=r},1090:function(e,t,n){(t=n(502)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.BootstrapSliderWrapper .slider-selection {\n  background: #efefef;\n}\n\n.BootstrapSliderWrapper .slider-handle {\n  background: #b3b3b3;\n}\n',""]),e.exports=t},1091:function(e,t,n){var a=n(501),i=n(1092);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1},r=(a(i,o),i.locals?i.locals:{});e.exports=r},1092:function(e,t,n){(t=n(502)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.play-slider {\n  display: flex;\n  height: 40px;\n  width: 100%;\n  margin: 0;\n}\n\n.play-slider-controls {\n  flex: 0 0 80px;\n  text-align: middle;\n}\n\n.play-slider-scrobbler {\n  flex: 1 1;\n}\n\n.slider.slider-horizontal {\n  width: 100% !important;\n}\n\n.slider-button {\n  color: #b3b3b3;\n  margin-right: 5px;\n}\n\ndiv.slider > div.tooltip.tooltip-main.top.in {\n  margin-left: 0 !important;\n}\n',""]),e.exports=t},1109:function(e,t){},1134:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(1029),i=n(1030),o=n(1032),r=n(1031),s=n(1043),l=n(1033),c=n(1099),u=n(1052),g=n(1086),d=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(i.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(r.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,a=t.pickable,i=t.visible,o=t.parameters,r=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,c=t.highlightColor,u=t.coordinateSystem,g=t.coordinateOrigin,d=t.wrapLongitude,p=t.positionFormat,h=t.modelMatrix,f=t._subLayerProps,v={opacity:n,pickable:a,visible:i,parameters:o,getPolygonOffset:r,highlightedObjectIndex:s,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:g,wrapLongitude:d,positionFormat:p,modelMatrix:h};if(e){var m=f&&f[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(g.b)(e,{filter:Boolean}),this.internalState.subLayers=e,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.parent=this}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}},{key:"isComposite",get:function(){return!0}}]),t}(c.a);d.layerName="CompositeLayer"},1217:function(e,t,n){"use strict";n.r(t);var a=n(1029),i=n(1030),o=n(1032),r=n(1031),s=n(1033),l=n(1134),c=n(1098),u=n(1043),g=n(1225),d=n(1052),p=n(1075),h=n(1127),f=n(1358),v=n(1036),m=n(1095),y=n(1122),b=v.a.count,S=f.a.fp64LowPart;function x(e){return Number.isFinite(e)?e:0}function w(e){var t=e.data,n=e.getPosition,a=e.cellSizeMeters,i=e.gpuGridAggregator,o=e.gpuAggregation,r=e.aggregationFlags,s=e.weightParams,l=e.fp64,c=void 0!==l&&l,u=e.coordinateSystem,g=void 0===u?m.a.LNGLAT:u,p=e.viewport,f=void 0===p?null:p,v=e.boundingBox,w=void 0===v?null:v,O={};r.dataChanged&&(w=(O=function(e,t,n){var a,i,o=b(e),r=new Float64Array(2*o),s=new Float32Array(2*o),l=1/0,c=-1/0,u=1/0,g=-1/0,d={};for(var p in n)d[p]=Object.assign({},n[p],{values:new Float32Array(3*o)});var h=Object(y.a)(e),f=h.iterable,v=h.objectInfo,m=!0,w=!1,C=void 0;try{for(var O,j=f[Symbol.iterator]();!(m=(O=j.next()).done);m=!0){var A=O.value;v.index++;var P=t(A,v),D=v.index;for(var L in i=P[0],a=P[1],r[2*D]=i,r[2*D+1]=a,s[2*D]=S(i),s[2*D+1]=S(a),n){var E=n[L].getWeight(A);Array.isArray(E)?(d[L].values[3*D]=E[0],d[L].values[3*D+1]=E[1],d[L].values[3*D+2]=E[2]):d[L].values[3*D]=E}Number.isFinite(a)&&Number.isFinite(i)&&(l=a<l?a:l,c=a>c?a:c,u=i<u?i:u,g=i>g?i:g)}}catch(e){w=!0,C=e}finally{try{m||null==j.return||j.return()}finally{if(w)throw C}}var k={xMin:x(u),xMax:x(g),yMin:x(l),yMax:x(c)};return{positions:r,positions64xyLow:s,weights:d,boundingBox:k}}(t,n,s)).boundingBox);var j=[a,a],A=[0,0];switch(d.a.assert(g===m.a.LNGLAT||g===m.a.IDENTITY),g){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var P=function(e,t){var n=e.yMin,a=e.yMax;return function(e,t){var n=(r=e,r/6378e3*(180/Math.PI)),a=(i=t,o=e,o/6378e3*(180/Math.PI)/Math.cos(i*Math.PI/180));var i,o;var r;return{yOffset:n,xOffset:a}}(t,(n+a)/2)}(w,a);j=[P.xOffset,P.yOffset],A=[-180,-90];break;case m.a.IDENTITY:A=[-f.width/2,-f.height/2];break;default:d.a.assert(!1)}var D=function(e){var t=e.boundingBox,n=e.cellSize,a=e.worldOrigin,i=t.yMin,o=t.yMax,r=t.xMin,s=t.xMax,l=C(r-a[0],n[0])+a[0],c=C(i-a[1],n[1])+a[1],u=(new h.a).translate([-1*l,-1*c,0]),g=[l,c],d=s-r+n[0],p=o-i+n[1],f=[Math.ceil(d/n[0]),Math.ceil(p/n[1])];return{gridOrigin:g,gridSize:f,width:d,height:p,gridTransformMatrix:u}}({boundingBox:w,cellSize:j,worldOrigin:A});return{weights:i.run({positions:O.positions,positions64xyLow:O.positions64xyLow,weights:O.weights,cellSize:j,width:D.width,height:D.height,gridTransformMatrix:D.gridTransformMatrix,useGPU:o,changeFlags:r,fp64:c}),gridSize:D.gridSize,gridOrigin:D.gridOrigin,cellSize:j,boundingBox:w}}function C(e,t){var n=e<0?-1:1,a=n<0?Math.abs(e)+t:Math.abs(e);return(a=Math.floor(a/t)*t)*n}var O=n(1074),j=n(1099),A=n(1216),P=n(1084),D=n(1162),L=n(1346),E=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),k=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),_=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),R=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),I={POSITION:{size:3,value:new Float32Array(k)},NORMAL:{size:3,value:new Float32Array(_)},TEXCOORD_0:{size:2,value:new Float32Array(R)}},F=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)(this,t);var n=e.id,i=void 0===n?Object(L.c)("cube-geometry"):n;return Object(o.a)(this,Object(r.a)(t).call(this,Object(P.a)({},e,{id:i,indices:{size:1,value:new Uint16Array(E)},attributes:Object(P.a)({},I,e.attributes)})))}return Object(s.a)(t,e),t}(D.a),M=f.a.fp64LowPart,T=new g.a,V={colorDomain:null,colorRange:O.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:T},N=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:"_getModel",value:function(e){return new A.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new F,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,a=n.data,i=n.cellSize,o=n.offset,r=n.extruded,s=n.elevationScale,l=n.coverage,c=n.gridSize,u=n.gridOrigin,g=n.gridOffset,d=n.colorRange,p=n.elevationRange,h=[M(u[0]),M(u[1])],f=[M(g[0]),M(g[1])],v=a.color.maxMinBuffer,m=a.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,y,{cellSize:i,offset:o,extruded:r,elevationScale:s,coverage:l,gridSize:c,gridOrigin:u,gridOriginLow:h,gridOffset:g,gridOffsetLow:f,colorRange:d,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:"calculateElevations",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var e=this.props,t=e.colorDomain,n=e.elevationDomain,a={};return null!==t?(a.colorDomainValid=!0,a.colorDomain=t):a.colorDomainValid=!1,null!==n?(a.elevationDomainValid=!0,a.elevationDomain=n):a.elevationDomainValid=!1,a}},{key:"_setupUniformBuffer",value:function(e){var t=this.context.gl,n=e.program.handle,a=t.getUniformBlockIndex(n,"ColorData"),i=t.getUniformBlockIndex(n,"ElevationData");t.uniformBlockBinding(n,a,0),t.uniformBlockBinding(n,i,1)}}]),t}(j.a);N.layerName="GPUGridCellLayer",N.defaultProps=V;var z=n(1039);function U(e,t,n){var a=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=1/0,o=-1/0,r=Object(y.a)(t),s=r.iterable,l=r.objectInfo,c=!0,u=!1,g=void 0;try{for(var d,p=s[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;l.index++,e=a(h,l)[1],Number.isFinite(e)&&(i=e<i?e:i,o=e>o?e:o)}}catch(e){u=!0,g=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw g}}var f=(i+o)/2,v=B(n,f);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var b=!0,S=!1,x=void 0;try{for(var w,C=s[Symbol.iterator]();!(b=(w=C.next()).done);b=!0){var O=w.value;l.index++;var j=a(O,l),A=Object(z.a)(j,2),P=A[0],D=A[1];if(Number.isFinite(D)&&Number.isFinite(P)){var L=Math.floor((D+90)/v.yOffset),E=Math.floor((P+180)/v.xOffset),k="".concat(L,"-").concat(E);m[k]=m[k]||{count:0,points:[]},m[k].count+=1,m[k].points.push(O)}}}catch(e){S=!0,x=e}finally{try{b||null==C.return||C.return()}finally{if(S)throw x}}return{gridHash:m,gridOffset:v}}(e,t,n),i=a.gridHash,o=a.gridOffset;return{gridHash:i,gridOffset:o,layerData:function(e,t){return Object.keys(e).reduce((function(n,a,i){var o=a.split("-"),r=parseInt(o[0],10),s=parseInt(o[1],10);return n.push(Object.assign({index:i,position:[t.xOffset*s-180,t.yOffset*r-90]},e[a])),n}),[])}(i,o)}}function B(e,t){var n;return{yOffset:e/6378e3*(180/Math.PI),xOffset:(n=t,e/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180))}}var G=new g.a,q={colorDomain:null,colorRange:O.b,getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:G,gpuAggregation:!0},W=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,t=c.a.isSupported(e);t||d.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new c.a(e,n),isSupported:t}}},{key:"updateState",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(u.a)(Object(r.a)(t.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(e){var t=e.oldProps,n=e.props,a=e.changeFlags,i=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:n,changeFlags:a})&&(i=Object.assign({},i,{dataChanged:!0})),t.cellSize!==n.cellSize&&(i=Object.assign({},i,{cellSizeChanged:!0})),i)}},{key:"isDataChanged",value:function(e){var t=e.oldProps,n=e.props,a=e.changeFlags;return!!a.dataChanged||(t.gpuAggregation!==n.gpuAggregation||(t.colorAggregation!==n.colorAggregation||t.elevationAggregation!==n.elevationAggregation||!(!a.updateTriggersChanged||!(a.updateTriggersChanged.all||a.updateTriggersChanged.getPosition||a.updateTriggersChanged.getColorWeight||a.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(e){var t=this.state,n=t.gridSize,a=t.gridOrigin,i=t.cellSize,o=Math.floor(e/n[0]),r=e-o*n[0],s=Math.floor((o*i[1]+a[1]+90+i[1]/2)/i[1]),l=Math.floor((r*i[0]+a[0]+180+i[0]/2)/i[0]);return"".concat(s,"-").concat(l)}},{key:"getPositionForIndex",value:function(e){var t=this.state,n=t.gridSize,a=t.gridOrigin,i=t.cellSize,o=Math.floor(e/n[0]),r=e-o*n[0],s=o*i[1]+a[1];return[r*i[0]+a[0],s]}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.mode,a=t.index,i=null;if(a>=0){var o=this.state.gpuGridAggregator,r=this.getPositionForIndex(a),s=c.a.getAggregationData(Object.assign({pixelIndex:a},o.getData("color"))),l=c.a.getAggregationData(Object.assign({pixelIndex:a},o.getData("elevation")));if(i={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:r,totalCount:s.totalCount||l.totalCount},"hover"!==n){var u=this.props,g=u.data,d=u.getPosition,p=this.state.gridHash;if(!p)p=U(g,this.props.cellSize,d).gridHash,this.setState({gridHash:p});var h=p[this.getHashKeyForIndex(a)];Object.assign(i,h)}}return Object.assign(t,{picked:Boolean(i),object:i})}},{key:"getLayerData",value:function(e){var t=this.props,n=t.data,a=t.cellSize,i=t.getPosition,o=t.gpuAggregation,r=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,c=t.elevationAggregation,u=t.fp64,g=w({data:n,cellSizeMeters:a,getPosition:i,weightParams:{color:{getWeight:r,operation:p.a[s]||p.a[q.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:p.a[c]||p.a[q.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:o,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:u}),d=g.weights,h=g.gridSize,f=g.gridOrigin,v=g.cellSize,m=g.boundingBox;this.setState({weights:d,gridSize:h,gridOrigin:f,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,n=e.fp64,a=e.extruded,i=e.cellSize,o=e.coverage,r=e.material,s=e.elevationRange,l=e.colorDomain,c=e.elevationDomain,u=this.state,g=u.weights,d=u.gridSize,p=u.gridOrigin,h=u.cellSize,f=Object(O.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",N))({gridSize:d,gridOrigin:p,gridOffset:h,colorRange:f,elevationRange:s,colorDomain:l,elevationDomain:c,fp64:n,cellSize:i,coverage:o,material:r,elevationScale:t,extruded:a},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:g,numInstances:d[0]*d[1]})}}]),t}(l.a);W.layerName="GPUGridLayer",W.defaultProps=q;var H=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"getGeometry",value:function(e){return new F}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,a=n.elevationScale,i=n.extruded,o=n.offset,r=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:o,extruded:i,coverage:r,elevationScale:a,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(n(1167).a);H.layerName="GridCellLayer",H.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var Y=n(1111),K=n(1112);function X(){}var Z=new g.a,J={colorDomain:null,colorRange:O.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:X,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:X,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:Z},Q=["getColorValue","colorAggregation","getColorWeight"],$=["getElevationValue","elevationAggregation","getElevationWeight"],ee=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:X,elevationScaleFunc:X,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,a=e.props,i=e.changeFlags;this.updateGetValueFuncs(n,a);var o=this.needsReProjectPoints(n,a,i);i.dataChanged||o?this.getLayerData():(this.getDimensionChanges(n,a)||[]).forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,a=!1,i=0;i<Q.length;i++){var o=Q[i];e[o]!==t[o]&&(n=!0)}for(var r=0;r<$.length;r++){var s=$[r];e[s]!==t[s]&&(a=!0)}return{colorChanged:n,elevationChanged:a}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,a=t.getElevationValue,i=this.props,o=i.colorAggregation,r=i.getColorWeight,s=i.elevationAggregation,l=i.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,g=c.elevationChanged;u&&null===n&&(n=Object(p.b)(o,r)),g&&null===a&&(a=Object(p.b)(s,l)),n&&this.setState({getColorValue:n}),a&&this.setState({getElevationValue:a})}},{key:"needsReProjectPoints",value:function(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,a=[];for(var i in n){var o=n[i].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));o&&a.push(o.updater)}return a.length?a:null}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,a=n.sortedColorBins,i=n.sortedElevationBins,o=null;if(t.picked&&t.index>-1){var r=this.state.layerData[t.index],s=a.binMap[r.index]&&a.binMap[r.index].value,l=i.binMap[r.index]&&i.binMap[r.index].value;o=Object.assign({colorValue:s,elevationValue:l},r)}return Object.assign(t,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},a=function(a){n[a]={};var i=!0,o=!1,r=void 0;try{for(var s,l=t[a][Symbol.iterator]();!(i=(s=l.next()).done);i=!0){s.value.triggers.forEach((function(t){n[a][t]=e.props[t]}))}}catch(e){o=!0,r=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw r}}};for(var i in t)a(i);return n}},{key:"getLayerData",value:function(){var e=this.props,t=U(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,a=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof a&&a(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,a=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof a&&a(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(K.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(K.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,a=t.colorScaleFunc,i=t.colorValueDomain,o=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.colorDomain||i,s=o>=r[0]&&o<=r[r.length-1]?a(o):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,a=t.elevationScaleFunc,i=t.elevationValueDomain,o=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.elevationDomain||i;return o>=r[0]&&o<=r[r.length-1]?a(o):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,a=e.extruded,i=e.cellSize,o=e.coverage,r=e.material,s=e.transitions;return new(this.getSubLayerClass("grid-cell",H))({fp64:n,cellSize:i,coverage:o,material:r,elevationScale:t,extruded:a,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);ee.layerName="CPUGridLayer",ee.defaultProps=J;var te=Object.assign({},W.defaultProps,ee.defaultProps,{gpuAggregation:!1}),ne=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(i.a)(t,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=(e.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(n)}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.updateTriggers,a=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",W):this.getSubLayerClass("CPU",ee))(this.props,this.getSubLayerProps({id:a,updateTriggers:n}),{data:t})}},{key:"canUseGPUAggregation",value:function(e){var t=e.gpuAggregation,n=e.lowerPercentile,a=e.upperPercentile,i=e.getColorValue,o=e.getElevationValue;return!!t&&(!!c.a.isSupported(this.context.gl)&&(0===n&&100===a&&(null===i&&null===o)))}}]),t}(l.a);ne.layerName="GridLayer",ne.defaultProps=te;var ae=n(1),ie=n.n(ae),oe=n(3),re=n(1048),se=n(1041),le=n(1058),ce=n(1050);function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function ge(e){return ie.a.createElement("div",{className:"deckgl-tooltip"},ie.a.createElement(ce.a,{label:Object(oe.t)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),ie.a.createElement(ce.a,{label:Object(oe.t)("Height")+": ",value:""+e.object.elevationValue}))}function de(e,t,n,a){const i=e,o=i.color_picker;let r=t.data.features.map(e=>ue({},e,{color:[o.r,o.g,o.b,255*o.a]}));if(i.js_data_mutator){r=Object(se.a)(i.js_data_mutator)(r)}const s=Object(re.b)(i.js_agg_function,e=>e.weight);return new ne(ue({id:"grid-layer-"+i.slice_id,data:r,pickable:!0,cellSize:i.grid_size,minColor:[0,0,0,0],extruded:i.extruded,maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getElevationValue:s,getColorValue:s},Object(re.a)(i,a,ge)))}n.d(t,"getLayer",(function(){return de}));t.default=Object(le.b)(de,(function(e){return e.map(e=>e.position)}))},1225:function(e,t,n){"use strict";var a=n(1029),i=n(1032),o=n(1031),r=n(1040),s=n(1033);n.d(t,"a",(function(){return c}));var l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},c=function(e){function t(e){var n;return Object(a.a)(this,t),n=Object(i.a)(this,Object(o.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(r.a)(n),e),n}return Object(s.a)(t,e),t}((function e(){Object(a.a)(this,e)}))}}]);